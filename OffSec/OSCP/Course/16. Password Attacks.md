# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 16\. Password Attacks

In this Learning Module, we will cover the following Learning Units:

-   Attacking Network Service Logins
-   Password Cracking Fundamentals
-   Working with Password Hashes

Although there are many modern approaches to user account and service authentication (such as [_biometric authentication_](https://en.wikipedia.org/wiki/Biometrics) or [_Public Key Infrastructure_](https://en.wikipedia.org/wiki/Public_key_infrastructure)), simple password authentication remains the most dominant and basic approach.

In this Module, we'll demonstrate how to discover and leverage passwords (and in some cases their underlying implementation components) in order to gain access to a user account or system. We'll discuss network attacks, password cracking, and attacks against Windows-based authentication implementations.

## 16.1. Attacking Network Services Logins

This Learning Unit covers the following Learning Objectives:

-   Attack SSH and RDP logins
-   Attack HTTP POST login forms

In the last decade, _brute-force_ and dictionary attacks against publicly-exposed network services have increased dramatically. In fact, in some cases, the common _Secure Shell_ (SSH), _Remote Desktop Protocol_ (RDP), and [_Virtual Network Computing_](https://en.wikipedia.org/wiki/Virtual_Network_Computing) (VNC) services as well as web-based login forms are often [attacked seconds after they are launched](https://www.ssh.com/blog/ssh-key-scan-attack-honeypot).

Brute-force attacks attempt every possible password variation, working systematically through every combination of letters, digits and special characters. Although this process may take considerable time depending on the password length and the protocol used, these attacks could theoretically bypass any ill-protected password-based authentication system.

On the other hand, dictionary attacks attempt to authenticate to services with passwords from lists of common words (_wordlists_). If the correct password is not contained in the wordlist, the dictionary attack will fail.

In this Learning Unit, we'll use dictionary attacks to discover valid credentials for network services and HTTP login forms.

## 16.1.1. SSH and RDP

In this section, we'll execute dictionary attacks against the common SSH and RDP services using the open-source [_THC Hydra_](https://github.com/vanhauser-thc/thc-hydra) tool, which can execute a broad variety of password attacks against a variety of network services and protocols. We'll also use the popular **rockyou.txt** wordlist, which contains over 14 million passwords. Both of these are pre-installed on our Kali machine.

To begin, we will start the BRUTE machine (VM #1 under Resources). In the first example, we'll attack the SSH service (port 2222) on this machine, which has an IP address of 192.168.50.201. We'll attempt to determine the password for the user _george_.

The IP address of BRUTE may differ in your environment.

Before we start our dictionary attack, we should confirm that the target is running an SSH service on port 2222.

```
kali@kali:~$ sudo nmap -sV -p 2222 192.168.50.201
...
PORT   STATE SERVICE
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
...
```

> Listing 1 - Checking if target is running a SSH service

The output indicates that SSH is open. Let's assume that through the _information gathering process_ we have already discovered the _george_ user.

It's worth noting that the format of the username also suggests that the company may use the first name of the user for account names. This information may assist us in later information gathering attempts.

Next, let's prepare to use the **rockyou.txt** wordlist file. Since the file is compressed to save space, we must uncompress it with [**gzip -d**](https://www.gnu.org/software/gzip/). Finally, we can run **hydra**.

We'll attack a single username with **\-l george**, specify the port with **\-s**, indicate our password list with **\-P** and define our target with **ssh://192.168.50.201**:

```
kali@kali:~$ cd /usr/share/wordlists/

kali@kali:~$ ls
dirb  dirbuster  fasttrack.txt  fern-wifi  metasploit  nmap.lst  rockyou.txt.gz  wfuzz

kali@kali:~$ sudo gzip -d rockyou.txt.gz

kali@kali:~$ hydra -l george -P /usr/share/wordlists/rockyou.txt -s 2222 ssh://192.168.50.201
...
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://192.168.50.201:22/
[2222][ssh] host: 192.168.50.201   login: george   password: chocolate
1 of 1 target successfully completed, 1 valid password found
...
```

> Listing 2 - Unzipping Gzip Archive and attacking SSH

Good. We successfully used Hydra to discover a valid login for the _george_ user.

The dictionary attack worked because the password was contained in the **rockyou.txt** wordlist and we knew the name of the user we wanted to attack. However, if we didn't have valid usernames, we would use enumeration and information gathering techniques to find them. Alternatively, we could also attack built-in accounts such as _root_ (on Linux) or _Administrator_ (on Windows).

In this next example, we will attempt to use a single password against a variety of usernames in a technique known as [_password spraying_](https://owasp.org/www-community/attacks/Password_Spraying_Attack).

Since there are many different ways to gain access to passwords, this is an extremely viable technique. For example, we may gain access to credentials using one of the techniques discussed later in this Module, or we may find them stored as plaintext in a file or through the use of an online password leak database. These services (such as [_ScatteredSecrets_](https://scatteredsecrets.com/)) track password leaks and compromises and sell the plaintext passwords. This can be very beneficial during a penetration test, but we must make sure we do not violate the terms of these services, we must ensure that we only use the passwords in direct cooperation with the legal owner, and we must review the service carefully to determine if it's operating legally. For example, [_WeLeakInfo_](https://www.justice.gov/usao-dc/pr/weleakinfoto-and-related-domain-names-seized) was recently seized by the FBI and U.S. Department of Justice for alleged illegal activity.

Let's demonstrate this scenario by executing a spray attack against the RDP service on BRUTE2. We'll first shut down BRUTE (VM #1) and start BRUTE2 (VM #2) under Resources. In this example, we'll assume we have already obtained a valid user password (_SuperS3cure1337#_), and we will attempt that password against a variety of potential user account names.

We'll again use **hydra**, setting a list of usernames with **\-L /usr/share/wordlists/dirb/others/names.txt** (which contains over eight thousand username entries) and try a single password with **\-p "SuperS3cure1337#"**. We'll use the RDP protocol this time and set the target with **rdp://192.168.50.202**. For hydra to successfully identify the username, the username must be on the list. The usernames _daniel_ and _justin_ are not in the **names.txt** file. We need to add them. Let's do that from the command like.

```
kali@kali:~$ echo -e "daniel\njustin" | sudo tee -a /usr/share/wordlists/dirb/others/names.txt

kali@kali:~$ hydra -L /usr/share/wordlists/dirb/others/names.txt -p "SuperS3cure1337#" rdp://192.168.50.202
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:14344399/p:1), ~3586100 tries per task
[DATA] attacking rdp://192.168.50.202:3389/
...
[3389][rdp] host: 192.168.50.202   login: daniel   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
[3389][rdp] host: 192.168.50.202   login: justin   password: SuperS3cure1337#
[ERROR] freerdp: The connection failed to establish.
...
```

> Listing 3 - Spraying a password on RDP service

The password attack for the selected list will take about 15 minutes to uncover the two valid credentials." To expedite the process, we can create a list that only contains two lines, "daniel" and "justin".

In this case, we identified two usernames with the password we discovered in the database leak. We should always try to leverage every plaintext password we discover by spraying them against the target's systems. This could reveal users that use the same password across multiple systems. However, we must also use caution when leveraging broad-range attacks.

Dictionary attacks generate a lot of noise in terms of logs, events, and traffic. While a huge amount of network traffic can bring down a network, the reactions of various security technologies could be even more undesirable. For example, a basic brute force protection program could lock a user's account after three failed login attempts. In a real-world penetration test, this could lead to a situation in which we lock users out of critical production systems. Before indiscriminately launching tools, we must perform a thorough enumeration to identify and avoid these risks.

In this section, we performed dictionary attacks on the common SSH and RDP network services. While Hydra makes the process straightforward for most protocols, some protocols require more information. We'll explore this with HTTP POST login forms in the next section.

Before we head into the first exercises of this Module, we need to be aware that the process of attacking authentication on a target shouldn't take longer than three minutes in the exercises or the challenge labs. If the process takes longer, double-check your command and arguments or consider a different approach.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

| 
Name

(Click to sort ascending) | 

IP Address

 | 

 |
| --- | --- | --- |
| 

Password Attacks - SSH and RDP - VM #1

Start **Password Attacks - SSH and RDP - VM #1** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #2

Start **Password Attacks - SSH and RDP - VM #2** with Kali browser access







 | 

 | 

 |
| 

Password Attacks - SSH and RDP - VM #3

Start **Password Attacks - SSH and RDP - VM #3** with Kali browser access







 | 

 | 

 |

#### Labs

1.  Follow the steps outlined in this section to leverage a dictionary attack to get access to SSH (port 2222) on VM #1 (BRUTE). Find the flag in the _george_ user's home directory.

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)