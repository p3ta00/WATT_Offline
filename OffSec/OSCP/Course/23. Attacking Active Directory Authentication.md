# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)

# 23\. Attacking Active Directory Authentication

In this Module, we will cover the following Learning Units:

-   Understanding Active Directory Authentication
-   Performing Attacks on Active Directory Authentication

Having enumerated user accounts, group memberships, and registered Service Principal Names in the previous Module _Active Directory Introduction and Enumeration_, let's now attempt to use this information to compromise Active Directory.

In this Module, we'll first explore authentication mechanisms of Active Directory (AD) and learn where Windows caches authentication objects such as password hashes and tickets. Next, we'll get familiar with the attack methods targeting these authentication mechanisms. We can use these techniques during different phases of a penetration test to obtain user credentials and access to systems and services. For this Module, we'll target the same domain (_corp.com_) as in the previous Module.

## 23.1. Understanding Active Directory Authentication

This Learning Unit covers the following Learning Objectives:

-   Understand NTLM Authentication
-   Understand Kerberos Authentication
-   Become familiar with cached AD Credentials

Active Directory supports multiple authentication protocols and techniques that implement authentication to Windows computers as well as those running Linux and macOS.

Active Directory supports several older protocols including [_WDigest_](https://technet.microsoft.com/en-us/library/cc778868(v=ws.10).aspx). While these may be useful for older operating systems like Windows 7 or Windows Server 2008 R2, we will only focus on more modern authentication protocols in this Learning Unit.

In this Learning Unit, we'll discuss the details of [_NTLM_](https://en.wikipedia.org/wiki/NT_LAN_Manager) and [_Kerberos_](https://en.wikipedia.org/wiki/Kerberos_(protocol)) authentication. In addition, we'll explore where and how AD credentials are cached on Windows systems.

## 23.1.1. NTLM Authentication

In _Password Attacks_, we briefly discussed what NTLM is and where to find its hashes. In this section, we'll explore NTLM authentication in the context of Active Directory.

[NTLM authentication](https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/) is used when a client authenticates to a server by IP address (instead of by hostname), or if the user attempts to authenticate to a hostname that is not registered on the Active Directory-integrated DNS server. Likewise, third-party applications may choose to use NTLM authentication instead of Kerberos.

The NTLM authentication protocol consists of seven steps:

![Figure 1: Diagram of NTLM authentication in Active Directory](https://static.offsec.com/offsec-courses/PEN-200/imgs/ad/efc3ae731d085f29a1673782d583e64d-ad_ntlm.png)

Figure 1: Diagram of NTLM authentication in Active Directory

In the first step, the computer calculates a cryptographic hash, called the _NTLM hash_, from the user's password. Next, the client computer sends the username to the server, which returns a random value called the _nonce_ or _challenge_. The client then encrypts the nonce using the NTLM hash, now known as a _response_, and sends it to the server.

The server forwards the response along with the username and the nonce to the domain controller. The validation is then performed by the domain controller, since it already knows the NTLM hash of all users. The domain controller encrypts the nonce itself with the NTLM hash of the supplied username and compares it to the response it received from the server. If the two are equal, the authentication request is successful.

As with any other cryptographic hash, NTLM cannot be reversed. However, it is considered a _fast-hashing_ algorithm since short passwords \[can be cracked quickly using modest equipment\]https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505).

By using cracking software like [Hashcat](https://hashcat.net/hashcat/) with top-of-the-line graphic processors, it is possible to test over 600 billion NTLM hashes every second. This means that eight-character passwords may be cracked within 2.5 hours and nine-character passwords may be cracked within 11 days.

However, even with its relative weaknesses, completely disabling and blocking NTLM authentication requires [extensive planning and preparation](https://techcommunity.microsoft.com/t5/ask-the-directory-services-team/ntlm-blocking-and-you-application-analysis-and-auditing/ba-p/397191) as it's an important fallback mechanism and used by many third-party applications. Therefore, we'll encounter enabled NTLM authentication in most assessments.

Now that we've briefly covered NTLM authentication, in the next section we'll begin exploring Kerberos. Kerberos is the default authentication protocol in Active Directory and for associated services.

#### Labs

1.  What is the name of the cryptographic hash function a computer calculates from the user's password?

Answer[View hints](https://portal.offsec.com/courses/pen-200-44065/learning/vulnerability-scanning-48659/wrapping-up-48703/wrapping-up-48710#)