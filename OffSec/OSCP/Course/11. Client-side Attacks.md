# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer

# 11\. Client-side Attacks

In this Learning Module, we will cover the following Learning Units:

-   Target Reconnaissance
-   Exploiting Microsoft Office
-   Abusing Windows Library Files

In penetration tests, we may be tasked by a client to breach the perimeter of their enterprise and obtain an initial foothold inside the network. In a traditional attack model, we enumerate the client's accessible machines and attempt to exploit exposed services. However, overcoming the perimeter by exploiting technical vulnerabilities has become increasingly rare and difficult according to a [report](https://www.verizon.com/business/resources/reports/2022/dbir/2022-data-breach-investigations-report-dbir.pdf) from [_Verizon_](https://www.verizon.com/). The report states that [_Phishing_](https://support.microsoft.com/en-au/windows/protect-yourself-from-phishing-0c7ea947-ba98-3bd9-7184-430e1f860a44) is the second largest attack vector used for breaching a perimeter, only surpassed by credential attacks.

Phishing often leverages client-side attacks. This type of attack works by delivering malicious files directly to users. Once they execute these files on their machine, we can get a foothold in the internal network. Client-side attacks often exploit weaknesses or functions in local software and applications such as browsers, operating system components, or office programs. To execute malicious on the client's system, we typically need to persuade or deceive the target user.

This concept of deception is an important one for us to consider as penetration testers. It raises the question, _who_ exactly are we deceiving? Who are we trying to persuade? Client-side attacks allow us the opportunity to contemplate the vulnerabilities, biases and fragility inherent to _people_, and not just computers or networks. This implies that to become the best possible attackers we must not only be adept at technical skills like system administration and networking (for example), but also develop knowledge about human psychology, corporate culture and social norms.

When we leverage client-side attacks in penetration tests, we must also consider the moral aspect of targeting users. Our goal should not only be to obtain code execution on their system, but also to not overstep any ethical or legal boundaries such as blackmailing employees or impersonating the police.

Since the client's machine in an internal enterprise network is not usually a directly accessible system, and since it does not often offer externally-exposed services, this kind of attack vector is hard to mitigate and especially insidious. These types of attacks have encouraged new defense paradigms.

Client-side attacks often use specific delivery mechanisms and payload combinations, including email attachments or links to malicious websites or files. We could even leverage more advanced delivery mechanisms such as [_USB Dropping_](https://www.tripwire.com/state-of-security/featured/does-dropping-malicious-usb-sticks-really-work-yes-worryingly-well/) or [_watering hole attacks_](https://en.wikipedia.org/wiki/Watering_hole_attack).

Regardless of which delivery mechanism we choose, we must often deliver our payload to a target on a non-routable internal network, since client systems are rarely exposed externally.

It has become increasingly difficult to deliver payloads via email due to spam filters, firewalls, and other security technologies scanning emails for links and attachments.

When choosing an attack vector and payload, we must first perform reconnaissance to determine the operating system of the target as well as any installed applications. This is a critical first step, as our payload must match the capability of the target. For example, if the target is running the Windows operating system, we can use a variety of client-side attacks like malicious [_JScript_](https://en.wikipedia.org/wiki/JScript) code executed through the [_Windows Script Host_](https://en.wikipedia.org/wiki/Windows_Script_Host) or [_.lnk_](https://web.archive.org/web/20220519184752/https://forensicswiki.xyz/page/LNK) shortcut files pointing to malicious resources. If the target has installed Microsoft Office, we could leverage documents with embedded malicious macros.

In this Module, we'll learn how to perform reconnaissance against a target, walk through exploitation scenarios involving malicious Microsoft Office documents, and leverage [_Windows Library files_](https://docs.microsoft.com/en-us/windows/client-management/windows-libraries).

## 11.1. Target Reconnaissance

This Learning Unit covers the following Learning Objectives:

-   Gather information to prepare client-side attacks
-   Leverage client fingerprinting to obtain information

Before executing a client-side attack, it's crucial to identify potential users and gather detailed information about their operating system and installed software. This helps us improve our chances of a successful attack. We can identify these users by browsing the company website and searching for points of contact or use passive information gathering techniques to find employees on social media.

Unlike traditional network reconnaissance performed against a target system, we do not often have a direct connection to the target of a client-side attack. Instead, we must use a more tailored and creative approach.

In this Learning Unit, we'll explore these unique information gathering techniques and discuss social engineering vectors designed to effectively enumerate the details of the target system.

## 11.1.1. Information Gathering

In this section, we'll discuss various methods of enumerating a target's installed software without interacting with the target machine. These techniques are best suited for situations in which we have no way to interact with the target. Since we are not interacting with the target, we won't alert monitoring systems or leave forensic traces of our inquiry.

One approach is to inspect the [_metadata tags_](https://exiftool.org/TagNames/) of publicly available documents associated with the target organization. Although this data can be manually sanitized, it often is not. These tags (categorized by [_tag groups_](https://exiftool.org/#Tag%20Groups)) can include a variety of information about a document including author, creation date, the name and version of the software used to create the document, operating system of the client, and much more.

In some cases, this information is stored explicitly in the metadata, and in some cases, it is inferred, but either way the information can be quite revealing, helping us to build an accurate profile of software installed on clients in a target organization. Bear in mind that our findings may be outdated if we are inspecting older documents. In addition, different branches of the organization may use slightly different software.

Although this is a "hands-off" approach to data gathering, the trade-off is that we may not gather accurate information. Still, this approach is viable and effective.

Let's review some sample documents so we can demonstrate metadata analysis.

We'll leverage some of the techniques we learned in the Information Gathering Module. For example, we can use the **site:example.com filetype:pdf** Google dork to find PDF files on a target's web page. If we want to target a specific branch or location, we can add that information via keywords to narrow the results.

If we want to interact with the target's web site, we could also use tools like [_gobuster_](https://github.com/OJ/gobuster) with the **\-x** parameter to search for specific file extensions on the target's web site. This is noisy and will generate log entries on the target. We can also simply browse the target website for other specific information useful in a client-side attack, but we won't delve into that subject in this section.

Let's practice searching for and retrieving documents from the _Mountain Vegetables_ website. We'll open Firefox and navigate to **http://192.168.50.197**.

![Figure 1: Mountain Vegetables Single Page Application](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/7e5f0faef4437b202eb80abd4ba9d0cd-csa_mountainvegetables.png)

Figure 1: Mountain Vegetables Single Page Application

Figure 1 shows the website's landing page. The text on the site states that the website is currently under development. Scrolling through the page and hovering over buttons, we find a link to download a brochure.

![Figure 2: Download PDF Brochure](https://static.offsec.com/offsec-courses/PEN-200/imgs/clientsideattacks/c5e92101baeaa6d7569f2cedadfca2c6-csa_downloadbrochure2.png)

Figure 2: Download PDF Brochure

Once we click _CURRENT_, Firefox opens the document in a new tab where we can download it.

To display the metadata of any [_supported file_](https://exiftool.org/#supported), we can use [_exiftool_](https://exiftool.org/). Let's provide the arguments **\-a** to display duplicated tags and **\-u** to display unknown tags along with the filename **brochure.pdf**:

```
kali@kali:~$ cd Downloads 

kali@kali:~/Downloads$ exiftool -a -u brochure.pdf 
ExifTool Version Number         : 12.41
File Name                       : brochure.pdf
Directory                       : .
File Size                       : 303 KiB
File Modification Date/Time     : 2022:04:27 03:27:39-04:00
File Access Date/Time           : 2022:04:28 07:56:58-04:00
File Inode Change Date/Time     : 2022:04:28 07:56:58-04:00
File Permissions                : -rw-------
File Type                       : PDF
File Type Extension             : pdf
MIME Type                       : application/pdf
PDF Version                     : 1.7
Linearized                      : No
Page Count                      : 4
Language                        : en-US
Tagged PDF                      : Yes
XMP Toolkit                     : Image::ExifTool 12.41
Creator                         : Stanley Yelnats
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Create Date                     : 2022:04:27 07:34:01+02:00
Creator Tool                    : Microsoft® PowerPoint® for Microsoft 365
Modify Date                     : 2022:04:27 07:34:01+02:00
Document ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Instance ID                     : uuid:B6ED3771-D165-4BD4-99C9-A15FA9C3A3CF
Title                           : Mountain Vegetables
Author                          : Stanley Yelnats
Create Date                     : 2022:04:27 07:34:01+02:00
Modify Date                     : 2022:04:27 07:34:01+02:00
Producer                        : Microsoft® PowerPoint® for Microsoft 365
Creator                         : Stanley Yelnats
```

> Listing 1 - Displaying the metadata for brochure.pdf

This generated a lot of output. For us, the most important information includes the file creation date, last modified date, the author's name, the operating system, and the application used to create the file.

The _Create Date_ and _Modify Date_ sections reveal the relative age of the document. Given that these dates are relatively recent (at the time of this writing) we have a high level of trust that this is a good source of metadata.

The _Author_ section reveals the name of an internal employee. We could use our knowledge of this person to better establish a trust relationship by dropping their name casually into a targeted email or phone conversation. This is especially helpful if the author maintains a relatively small public profile.

The output further reveals that the PDF was created with Microsoft PowerPoint for Microsoft 365. This is crucial information for us to plan our client-side attack since we now know that the target uses Microsoft Office and since there is no mention of "macOS" or "for Mac" in any of the metadata tags, it's very probable that Windows was used to create this document.

We can now leverage client-side attack vectors ranging from Windows system components to malicious Office documents.

## Resources

Some of the labs require you to start the target machine(s) below.

Please note that the IP addresses assigned to your target machines may not match those referenced in the Module text and video.

client-side Attacks - Information Gathering - VM #1

client-side Attacks - Information Gathering - VM #2

#### Labs

1.  Download **old.pdf** from the _Mountain Vegetables_ website on VM #1 by clicking on the **OLD** button. Use _exiftool_ to review the file's metadata. Enter the value of the _Author_ tag.

Answer